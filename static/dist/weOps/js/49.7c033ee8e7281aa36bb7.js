(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{RCSB:function(t,e,i){"use strict";i.r(e);var s,o=i("zBjk"),n=i("7hWu"),a=i("G0B5"),l=(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=function(t,e,i,s){var o,n=arguments.length,a=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tableLoading=!1,e.list=[],e.activeIndex=0,e.settingVisible=!1,e.showColumns=["ip","duration","could","code","status"],e.showColumnsCopy=["ip","duration","could","code","status"],e.isCheckAll=!0,e.reportLoading=!1,e.timer=null,e.pagination={current:1,count:1,limit:20},e.flag=!0,e.columnTypeList=[{name:"IP",value:"ip",isDisabled:!0},{name:"耗时（s）",value:"duration",isDisabled:!1},{name:"云区域",value:"could",isDisabled:!1},{name:"执行结果",value:"code",isDisabled:!1},{name:"执行状态",value:"status",isDisabled:!1}],e.isAlreadyCompleted=!1,e}return l(e,t),Object.defineProperty(e.prototype,"isNetwork",{get:function(){return"true"===this.$route.query.isNetwork},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){var t=this;if(this.isNetwork&&(this.showColumns=["bk_inst_name","bk_obj_name","duration","status"],this.showColumnsCopy=JSON.parse(JSON.stringify(this.showColumns)),this.columnTypeList=[{name:"实例名",value:"bk_inst_name",isDisabled:!0},{name:"类型",value:"bk_obj_name",isDisabled:!1},{name:"耗时（s）",value:"duration",isDisabled:!1},{name:"执行状态",value:"status",isDisabled:!1}]),this.$route.params.delay){this.reportLoading=!0;var e=setTimeout((function(){t.getReports(),clearTimeout(e)}),2e3)}else this.getReports()},e.prototype.beforeDestroy=function(){this.timer&&clearTimeout(this.timer)},e.prototype.forceStop=function(){var t=this;this.reportLoading=!0,this.$api.maintainTool.forceStop({id:this.$route.query.id}).then((function(e){if(!e.result)return t.$error(e.message),!1;t.$success("终止成功!")})).finally((function(){t.reportLoading=!1}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getReports()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getReports()},e.prototype.getReports=function(t){var e=this;t||(this.reportLoading=!0),console.log(this.isNetwork),this.$api.maintainTool.getReports({id:this.$route.query.id,page:this.pagination.current,page_size:this.pagination.limit,report_type:this.isNetwork?"network":"host"}).then((function(i){if(!i.result)return e.$error(i.message),!1;(e.timer&&clearTimeout(e.timer),e.pagination.count=i.data.count,i.data.items.success?(e.isAlreadyCompleted=!0,e.flag&&(e.flag=!1,e.getReports(!0))):e.timer=setTimeout((function(){e.getReports(!0)}),1e4),e.list=i.data.items.data.map((function(t){return{id:t.id,ip:t.ip,duration:t.run_time,could:t.bk_cloud_name,code:t.status_info,status:t.status_code,success:t.success,bk_obj_name:t.bk_obj_name,bk_inst_name:t.bk_inst_name}})),e.list.length>0)&&e.$refs.logDetail.getReportDetail(e.list[e.activeIndex].id,t)})).finally((function(){e.reportLoading=!1}))},e.prototype.checkAll=function(t){this.showColumns=t?this.isNetwork?["bk_inst_name","bk_obj_name","duration","status"]:["ip","duration","could","code","status"]:this.isNetwork?["bk_inst_name"]:["ip"]},e.prototype.changeCheckboxGroup=function(t){this.isCheckAll=t.length===(this.isNetwork?4:5)},e.prototype.isShow=function(t){return this.showColumnsCopy.includes(t)},e.prototype.checkDetail=function(t,e){this.activeIndex=e,this.$refs.logDetail.getReportDetail(this.list[e].id)},e.prototype.showSettingBox=function(){this.settingVisible=!0,this.isCheckAll=this.showColumns.length===(this.isNetwork?4:5),this.showColumnsCopy=JSON.parse(JSON.stringify(this.showColumns))},e.prototype.confirm=function(){this.settingVisible=!1,this.showColumnsCopy=this.showColumns},e.prototype.cancel=function(){this.settingVisible=!1,this.showColumns=this.showColumnsCopy},e=r([Object(a.a)({components:{logDetail:o.a,bkSpin:n.bkSpin}})],e)}(a.e),u=c,p=i("KHd+"),d=Object(p.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"record-detail-box"},[t.isAlreadyCompleted||t.isNetwork?t._e():i("div",{staticClass:"btn-box"},[i("bk-popconfirm",{attrs:{title:"确认终止执行任务？",content:"仅对未执行完成的实例生效",trigger:"click"},on:{confirm:t.forceStop}},[i("bk-button",[t._v("强制终止")])],1)],1),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.reportLoading,zIndex:10},expression:"{ isLoading: reportLoading, zIndex: 10 }"}],staticClass:"record-detail"},[i("div",{staticClass:"table-box"},[t.settingVisible?i("div",{staticClass:"setting-box"},[i("div",{staticClass:"setting-content"},[i("div",[t._v("字段显示设置")]),t._v(" "),i("bk-checkbox",{staticStyle:{margin:"20px 0"},attrs:{"true-value":!0,"false-value":!1},on:{change:t.checkAll},model:{value:t.isCheckAll,callback:function(e){t.isCheckAll=e},expression:"isCheckAll"}},[t._v("\n                        全选\n                    ")]),t._v(" "),i("bk-checkbox-group",{on:{change:t.changeCheckboxGroup},model:{value:t.showColumns,callback:function(e){t.showColumns=e},expression:"showColumns"}},t._l(t.columnTypeList,(function(e){return i("bk-checkbox",{key:e.value,staticStyle:{"margin-right":"40px","margin-bottom":"10px"},attrs:{value:e.value,disabled:e.isDisabled}},[t._v("\n                            "+t._s(e.name)+"\n                        ")])})),1)],1),t._v(" "),i("div",{staticClass:"setting-footer"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:"确定"},on:{click:t.confirm}},[t._v("\n                        确定\n                    ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{theme:"default",type:"submit",title:"取消"},on:{click:t.cancel}},[t._v("\n                        取消\n                    ")])],1)]):t._e(),t._v(" "),i("div",{staticClass:"table-header"},[t.isShow("bk_inst_name")?i("div",{staticClass:"bk-inst-name label"},[i("div",[t._v("实例名")])]):t._e(),t._v(" "),t.isShow("bk_obj_name")?i("div",{staticClass:"bk-obj-name label"},[i("div",[t._v("类型")])]):t._e(),t._v(" "),t.isShow("ip")?i("div",{staticClass:"ip label"},[i("div",[t._v("IP")])]):t._e(),t._v(" "),t.isShow("duration")?i("div",{staticClass:"duration label"},[i("div",[t._v("耗时(s)")])]):t._e(),t._v(" "),t.isShow("could")?i("div",{staticClass:"could label"},[i("div",[t._v("云区域")])]):t._e(),t._v(" "),t.isShow("code")?i("div",{staticClass:"code label"},[i("div",[t._v("执行结果")])]):t._e(),t._v(" "),t.isShow("status")?i("div",{staticClass:"status label"},[i("div",[t._v("执行状态")])]):t._e(),t._v(" "),i("div",{staticClass:"setting",on:{click:t.showSettingBox}},[i("bk-icon",{attrs:{type:"cog-shape"}})],1)]),t._v(" "),i("div",{staticClass:"table-body"},[t._l(t.list,(function(e,s){return i("div",{key:s,class:["list-item",t.activeIndex===s&&"list-item-active"],on:{click:function(i){return t.checkDetail(e,s)}}},[t.isShow("bk_inst_name")?i("div",{staticClass:"bk-inst-name hide-text"},[i("span",{attrs:{title:e.could}},[t._v(t._s(e.bk_inst_name||"--"))])]):t._e(),t._v(" "),t.isShow("bk_obj_name")?i("div",{staticClass:"bk-obj-name hide-text"},[i("span",{attrs:{title:e.could}},[t._v(t._s(e.bk_obj_name||"--"))])]):t._e(),t._v(" "),t.isShow("ip")?i("div",{staticClass:"ip ip-slot hide-text"},[i("span",{staticClass:"tag",style:{backgroundColor:e.status?"#2dc89d":"#ea3636"}}),t._v(" "),i("span",{attrs:{title:e.ip}},[t._v(t._s(e.ip))])]):t._e(),t._v(" "),t.isShow("duration")?i("div",{staticClass:"duration hide-text"},[i("span",{attrs:{title:e.duration}},[t._v(t._s(0===e.duration?e.duration:e.duration||"--"))])]):t._e(),t._v(" "),t.isShow("could")?i("div",{staticClass:"could hide-text"},[i("span",{attrs:{title:e.could}},[t._v(t._s(e.could||"--"))])]):t._e(),t._v(" "),t.isShow("code")?i("div",{staticClass:"code hide-text"},[i("span",{attrs:{title:e.code}},[t._v(t._s(e.code||"--"))])]):t._e(),t._v(" "),t.isShow("status")?i("div",{staticClass:"status"},[e.success?i("span",[t._v("已完成")]):i("span",[i("span",[t._v("执行中")]),t._v(" "),i("bk-spin",{attrs:{size:"mini"}})],1)]):t._e(),t._v(" "),i("bk-icon",{attrs:{type:"right-shape"}})],1)})),t._v(" "),0===t.list.length?i("bk-exception",{staticClass:"exception-wrap-item exception-part",class:{"exception-gray":!1},attrs:{type:"empty",scene:"part"}}):t._e()],2),t._v(" "),i("div",{staticStyle:{padding:"10px"}},[i("bk-pagination",{attrs:{small:![4,5].includes(t.showColumnsCopy.length),current:t.pagination.current,count:t.pagination.count,limit:t.pagination.limit},on:{"update:current":function(e){return t.$set(t.pagination,"current",e)},"update:count":function(e){return t.$set(t.pagination,"count",e)},change:t.handlePageChange,"limit-change":t.limitChange}})],1)]),t._v(" "),i("div",{staticClass:"detail-box"},[i("log-detail",{ref:"logDetail",attrs:{report:t.list[t.activeIndex]}})],1)])])}),[],!1,null,"59a854fe",null);e.default=d.exports}}]);