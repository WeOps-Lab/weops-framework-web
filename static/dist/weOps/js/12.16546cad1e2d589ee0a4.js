(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"4nRk":function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjE4cHgiIGhlaWdodD0iMThweCIgdmlld0JveD0iMCAwIDE4IDE4IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPg0KICAgIDx0aXRsZT7lm77moIcvMy7lip/og73lm77moIcv5Li75py65aSH5Lu9IDE4PC90aXRsZT4NCiAgICA8ZyBpZD0i6aG16Z2iLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPg0KICAgICAgICA8ZyBpZD0i6KeG5Zu+LeaLk+aJkS3mi5PmiZHnrqHnkIYt57yW6L6R5ouT5omR6KGl5YWFIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTEwLjAwMDAwMCwgLTcyMi4wMDAwMDApIj4NCiAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwNy4wMDAwMDAsIDcxOS4wMDAwMDApIj4NCiAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0i6Lev5b6EIiBwb2ludHM9IjAgMCAyNCAwIDI0IDI0IDAgMjQiPjwvcG9seWdvbj4NCiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjAsMyBDMjAuNTUyMjg0NywzIDIxLDMuNDQ3NzE1MjUgMjEsNCBMMjEsMjAgQzIxLDIwLjU1MjI4NDcgMjAuNTUyMjg0NywyMSAyMCwyMSBMNCwyMSBDMy40NDc3MTUyNSwyMSAzLDIwLjU1MjI4NDcgMywyMCBMMyw0IEMzLDMuNDQ3NzE1MjUgMy40NDc3MTUyNSwzIDQsMyBMMjAsMyBaIE0xNS4wMzc1LDEyLjAzNzUgTDEzLjk3NywxMy4wOTggTDE1Ljg3OSwxNSBMNiwxNSBMNiwxNi41IEwxNS44NzksMTYuNDk5MjUgTDEzLjk3NywxOC40MDIgTDE1LjAzNzUsMTkuNDYyNSBMMTguNzUsMTUuNzUgTDE1LjAzNzUsMTIuMDM3NSBaIE04Ljk2MjUsNC41Mzc1IEw1LjI1LDguMjUgTDguOTYyNSwxMS45NjI1IEwxMC4wMjMsMTAuOTAyIEw4LjEyMSw5IEwxOCw5IEwxOCw3LjUgTDguMTIxLDcuNSBMMTAuMDIzLDUuNTk4IEw4Ljk2MjUsNC41Mzc1IFoiIGlkPSLlvaLnirbnu5PlkIgiIGZpbGw9IiMxMjcyRkYiPjwvcGF0aD4NCiAgICAgICAgICAgIDwvZz4NCiAgICAgICAgPC9nPg0KICAgIDwvZz4NCjwvc3ZnPg=="},s1jS:function(t,e,i){"use strict";i.r(e);var n,r=i("ac6i"),o=i("uMZD"),a=i("t2rG"),s=i.n(a),l={name:"column-expand",functional:!0,props:{row:Object,render:Function},render:function(t,e){var i={row:e.props.row};return e.props.render(t,i)}},c=l,u=i("KHd+"),p=Object(u.a)(c,undefined,undefined,!1,null,null,null),d=p.exports,f=i("G0B5"),m=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=function(){return h=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},h.apply(this,arguments)},b=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},g=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},y=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.visible=!1,e.formData={id:"",name:"",display_name:""},e.rules={name:[{required:!0,message:"请输入英文名称",trigger:"blur"}],display_name:[{required:!0,message:"请输入中文名称",trigger:"blur"}]},e}return m(e,t),e.prototype.handleShow=function(t){this.formData=t?{id:t.id,name:t.name,display_name:t.display_name}:{id:"",name:"",display_name:""},this.visible=!0},e.prototype.handleConfirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){return g(t,void 0,void 0,(function(){var t,e,i;return y(this,(function(n){switch(n.label){case 0:this.loading=!0,t=this.formData.id?"updateMetricGroup":"addMetricGroup",n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.monitorAlarm[t](h({bk_obj_id:this.currentNode.bk_obj_id,network_classification_id:this.isDeviceDetail?this.networkDeviceTemplate.id:0},this.formData))];case 2:return(e=n.sent()).result?(this.visible=!1,this.formData.id?this.$emit("update",this.formData):this.$emit("add",h(h({},this.formData),{id:null===(i=e.data)||void 0===i?void 0:i.id,isExpand:!1,metric_list:[]})),[2,this.$success("".concat(this.formData.id?"修改":"新增","分组名称成功"))]):(this.$error(e.message),[3,4]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))}))},b([Object(f.d)()],e.prototype,"currentNode",void 0),b([Object(f.d)({type:Boolean,default:function(){return!1}})],e.prototype,"isDeviceDetail",void 0),b([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"networkDeviceTemplate",void 0),e=b([Object(f.a)({})],e)}(f.e),_=v,k=_,w=Object(u.a)(k,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-dialog",{attrs:{width:"500px","mask-close":!1,"header-position":"left","render-directive":"if",title:(t.formData.id?"编辑":"新建")+"分组"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",[i("bk-form",{ref:"validateForm",attrs:{"label-width":100,model:t.formData,rules:t.rules}},[t.formData.id?t._e():i("bk-form-item",{attrs:{label:"英文名称",required:!0,property:"name","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:"",placeholder:"请输入英文名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"显示名称",required:!0,property:"display_name","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:"",placeholder:"请输入中文名称"},model:{value:t.formData.display_name,callback:function(e){t.$set(t.formData,"display_name",e)},expression:"formData.display_name"}})],1)],1)],1),t._v(" "),i("div",{staticStyle:{width:"100%"},attrs:{slot:"footer"},slot:"footer"},[i("div",[i("bk-button",{staticClass:"mr20",attrs:{theme:"primary",loading:t.loading},on:{click:t.handleConfirm}},[t._v("\n                确定\n            ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",disabled:t.loading},on:{click:function(e){t.visible=!1}}},[t._v("\n                取消\n            ")])],1)])])}),[],!1,null,null,null),x=w.exports,C=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),D=function(){return D=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},D.apply(this,arguments)},j=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},O=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},L=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.visible=!1,e.isDropdownShow=!1,e.formData={metric_group:0,compare_way:"",compare_value:"",field_cn_name:"",description:"",unit:"",fun:""},e.dataTypeList=["int","float","double"],e.valueMapList=[{key:"",value:"",id:e.$random(4)}],e.cloneData={},e.rules={},e.envData=[">",">=","<","<=","=","!="],e.type="",e.metricDetail="",e.isNetwork=!1,e}return C(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBuildIn",{get:function(){return!!this.metricDetail&&this.metricDetail.is_build_in},enumerable:!1,configurable:!0}),e.prototype.created=function(){var t=this;[{key:"field_cn_name",tip:"请输入中文名称"},{key:"metric_group",tip:"请选择指标分组"},{key:"metric_field",tip:"请输入英文名称"},{key:"field_type",tip:"请选择数据类型"},{key:"oid",tip:"请输入oid"}].forEach((function(e){t.rules[e.key]=[{required:!0,message:e.tip,trigger:"blur"}]}))},e.prototype.changeType=function(t){"enum"===t?this.formData.unit="":this.valueMapList=[{key:"",value:"",id:this.$random(4)}]},e.prototype.operateValueMap=function(t,e){"add"===t?this.valueMapList.push({key:"",value:"",id:this.$random(4)}):this.valueMapList.splice(e,1)},e.prototype.handleShow=function(t,e){var i=this;this.type=e,this.metricDetail=t,this.isNetwork=!1,this.isAdd&&(this.isNetwork=!0);var n=function(){i.valueMapList=t.enum_list.length?t.enum_list.map((function(t){return{id:i.$random(4),key:t.key,value:t.value}})):[{key:"",value:"",id:i.$random(4)}];var e=D(D({},t),{metric_group:t.group_id,metric_type:t.enum_list.length?"enum":"number"});return t.oid&&!t.fun&&(e.type="pointerMode",i.isNetwork=!0),!t.oid&&t.fun&&(e.type="computedMode",i.isNetwork=!0),i.$copy(e)},r=function(){return i.$copy({oid:"",field_type:"",metric_group:"",compare_way:"",compare_value:"",field_cn_name:"",description:"",unit:"",fun:"",metric_field:"",metric_type:"number",type:"pointerMode"})};this.cloneData=this.isAdd?r():n(),this.formData=this.isAdd?r():n(),this.visible=!0},e.prototype.handleClose=function(){var t=this;this.$compareFormData(this.formData,this.cloneData)?this.visible=!1:this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.visible=!1}})},e.prototype.handleConfirm=function(){var t=this;this.$refs.metricForm.validate().then((function(e){return O(t,void 0,void 0,(function(){var t,e;return L(this,(function(i){switch(i.label){case 0:if("enum"===this.formData.metric_type&&!this.valueMapList.find((function(t){return t.key&&t.value})))return this.$warn("请填写完整的值映射数据!"),[2,!1];this.loading=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),(t=D({},this.formData)).enum_list="enum"===this.formData.metric_type?this.valueMapList.filter((function(t){return t.key&&t.value})).map((function(t){return{key:Number(t.key),value:t.value}})):[],this.isAdd?t.is_show=!0:this.isBuildIn||(t.oid="pointerMode"===t.type?t.oid:"",t.fun="pointerMode"===t.type?"":t.fun),delete t.metric_type,delete t.type,[4,this.$api.monitorAlarm[this.isAdd?"createMetric":"updateMetricData"](t)];case 2:return(e=i.sent()).result?(this.visible=!1,this.$success(this.isAdd?"新建指标成功":"指标".concat(this.formData.field_name,"修改成功")),this.isAdd?this.$emit("refresh-list"):this.$emit("update",this.formData,e.data),[3,4]):[2,this.$error(e.message)];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))}))},e.prototype.dropdownShow=function(){this.isDropdownShow=!0},e.prototype.dropdownHide=function(){this.isDropdownShow=!1},e.prototype.triggerHandler=function(t){this.isDropdownShow=!1,this.formData.compare_way=t},j([Object(f.d)()],e.prototype,"groupList",void 0),e=j([Object(f.a)({})],e)}(f.e),S=T,I=S,P=Object(u.a)(I,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:500,"quick-close":!0,"before-close":t.handleClose,"is-show":t.visible,"ext-cls":"common-dialog-wrapper"},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n        "+t._s(t.isAdd?"新增指标":"修改指标")+"\n        "),t.isAdd?t._e():i("span",{staticClass:"sub-title"},[t._v("\n            - "+t._s(t.formData.field_cn_name||"--")+"\n        ")])]),t._v(" "),i("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"metricForm",attrs:{"label-width":100,rules:t.rules,model:t.formData}},[i("bk-form-item",{attrs:{label:"英文名称",property:"metric_field",required:!0,"error-display-type":"normal"}},[i("bk-input",{attrs:{disabled:!t.isAdd},model:{value:t.formData.metric_field,callback:function(e){t.$set(t.formData,"metric_field",e)},expression:"formData.metric_field"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"显示名称",required:!0,property:"field_cn_name","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:"",placeholder:"请输入显示名称"},model:{value:t.formData.field_cn_name,callback:function(e){t.$set(t.formData,"field_cn_name",e)},expression:"formData.field_cn_name"}})],1),t._v(" "),t.isNetwork&&(t.isAdd||!t.isBuildIn||t.formData.type)?i("bk-form-item",{attrs:{label:"类型",required:!0,property:"description","error-display-type":"normal"}},[i("bk-radio-group",{model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[i("bk-radio",{staticStyle:{"margin-right":"15px"},attrs:{value:"pointerMode"}},[t._v("指标型")]),t._v(" "),i("bk-radio",{attrs:{value:"computedMode"}},[t._v("计算型")])],1)],1):t._e(),t._v(" "),(t.isAdd?"pointerMode"===t.formData.type:t.isBuildIn?t.formData.type&&"pointerMode"===t.formData.type:"pointerMode"===t.formData.type)?i("bk-form-item",{attrs:{label:"oid",required:!0,property:"oid","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:"",placeholder:"请输入oid"},model:{value:t.formData.oid,callback:function(e){t.$set(t.formData,"oid",e)},expression:"formData.oid"}})],1):t._e(),t._v(" "),(t.isAdd?"computedMode"===t.formData.type:t.isBuildIn?t.formData.type&&"computedMode"===t.formData.type:"computedMode"===t.formData.type)?i("bk-form-item",{attrs:{label:"表达式"}},[i("bk-input",{attrs:{rows:3,clearable:"",type:"textarea",placeholder:"请输入表达式"},model:{value:t.formData.fun,callback:function(e){t.$set(t.formData,"fun",e)},expression:"formData.fun"}})],1):t._e(),t._v(" "),i("bk-form-item",{attrs:{label:"指标分组",required:!0,property:"metric_group","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"100%"},attrs:{searchable:"",placeholder:"请选择指标分组"},model:{value:t.formData.metric_group,callback:function(e){t.$set(t.formData,"metric_group",e)},expression:"formData.metric_group"}},t._l(t.groupList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.display_name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"推荐阈值","error-display-type":"normal"}},[i("div",{staticStyle:{display:"flex"}},[i("bk-input",{attrs:{clearable:!0,"font-size":"medium",placeholder:"请输入阈值"},model:{value:t.formData.compare_value,callback:function(e){t.$set(t.formData,"compare_value",e)},expression:"formData.compare_value"}},[i("bk-dropdown-menu",{ref:"dropdown",staticClass:"group-text",attrs:{slot:"prepend",trigger:"click","font-size":"medium"},on:{show:t.dropdownShow,hide:t.dropdownHide},slot:"prepend"},[i("bk-button",{staticStyle:{height:"28px","line-height":"28px"},attrs:{slot:"dropdown-trigger",type:"primary"},slot:"dropdown-trigger"},[t._l(t.envData,(function(e){return[t.formData.compare_way===e?i("span",{key:e},[t._v(t._s(e))]):t._e()]})),t._v(" "),i("i",{class:["bk-icon icon-angle-down",{"icon-flip":t.isDropdownShow}]})],2),t._v(" "),i("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},t._l(t.envData,(function(e){return i("li",{key:e},[i("a",{attrs:{href:"javascript:;"},on:{click:function(i){return t.triggerHandler(e)}}},[t._v(t._s(e))])])})),0)],1)],1),t._v(" "),i("span",[t._v(t._s(t.formData.real_unit))])],1)]),t._v(" "),i("bk-form-item",{attrs:{label:"指标类型",required:!0,property:"description","error-display-type":"normal"}},[i("bk-radio-group",{on:{change:t.changeType},model:{value:t.formData.metric_type,callback:function(e){t.$set(t.formData,"metric_type",e)},expression:"formData.metric_type"}},[i("bk-radio",{staticStyle:{"margin-right":"15px"},attrs:{value:"number"}},[t._v("数值型")]),t._v(" "),i("bk-radio",{attrs:{value:"enum"}},[t._v("枚举型")])],1)],1),t._v(" "),"number"===t.formData.metric_type?i("bk-form-item",{attrs:{label:"数据类型",required:!0,property:"field_type","error-display-type":"normal"}},[i("div",{staticStyle:{display:"flex"}},[i("bk-select",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{disabled:!1,"ext-cls":"select-custom",clearable:!1,"ext-popover-cls":"select-popover-custom"},model:{value:t.formData.field_type,callback:function(e){t.$set(t.formData,"field_type",e)},expression:"formData.field_type"}},t._l(t.dataTypeList,(function(t){return i("bk-option",{key:t,attrs:{id:t,name:t}})})),1),t._v(" "),i("bk-input",{attrs:{clearable:"",placeholder:"请输入数据单位"},model:{value:t.formData.unit,callback:function(e){t.$set(t.formData,"unit",e)},expression:"formData.unit"}})],1)]):t._e(),t._v(" "),"enum"===t.formData.metric_type?i("bk-form-item",{attrs:{required:!0,label:"值映射"}},[i("div",{staticClass:"value-map"},[i("div",{staticClass:"title"},[i("div",{staticClass:"label"},[t._v("原始值")]),t._v(" "),i("div",{staticClass:"label",staticStyle:{"padding-left":"3px"}},[t._v("映射值")])]),t._v(" "),t._l(t.valueMapList,(function(e,n){return i("div",{key:e.id,staticStyle:{display:"flex","margin-bottom":"10px"}},[i("bk-input",{staticClass:"label",attrs:{clearable:"",type:"number",placeholder:"请输入原始值"},model:{value:e.key,callback:function(i){t.$set(e,"key",i)},expression:"item.key"}}),t._v(" "),i("bk-input",{staticClass:"label",attrs:{clearable:"",placeholder:"请输入映射值"},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}}),t._v(" "),i("div",{staticClass:"icon-box"},[i("bk-icon",{staticClass:"mr5",attrs:{type:"plus-circle"},on:{click:function(e){return t.operateValueMap("add")}}}),t._v(" "),t.valueMapList.length>1?i("bk-icon",{attrs:{type:"minus-circle"},on:{click:function(e){return t.operateValueMap("del",n)}}}):t._e()],1)],1)}))],2)]):t._e(),t._v(" "),i("bk-form-item",{attrs:{label:"指标描述",property:"description","error-display-type":"normal"}},[i("bk-input",{attrs:{rows:3,clearable:"",type:"textarea",placeholder:"请输入指标描述"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1)],1),t._v(" "),i("template",{slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{title:"确认",theme:"primary",loading:t.loading},on:{click:t.handleConfirm}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{attrs:{type:"submit",title:"取消",theme:"default",disabled:t.loading},on:{click:function(e){return t.handleClose()}}},[t._v("\n            取消\n        ")])],1)],2)}),[],!1,null,"a0d8e1ce",null),$=P.exports,M=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),N=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.targetFiles="",e.loading=!1,e.formData={brandName:"",modelName:""},e.rules={brandName:[{required:!0,message:"必填项",trigger:"blur"}],brandId:[{required:!0,message:"必填项",trigger:"blur"}],modelName:[{required:!0,message:"必填项",trigger:"blur"}]},e}return M(e,t),e.prototype.showDialog=function(t){this.visible=!0,this.targetFiles="",this.formData={brandName:"",modelName:""}},e.prototype.customUpload=function(t){this.targetFiles=t.fileList[0]},e.prototype.cancel=function(){this.visible=!1},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){if(!t.targetFiles)return t.$warn("请上传要导入的模板!"),!1;var i={file:t.targetFiles.origin,brand_name:t.formData.brandName,bk_obj_id:t.currentNode.bk_obj_id,device_model:t.formData.modelName},n=new FormData;for(var r in i)n.append(r,i[r]);t.loading=!0,t.$api.monitorAlarm.uploadModel(n).then((function(e){var i=e.result,n=e.message;if(!i)return t.$error(n),!1;t.$success("导入成功"),t.$emit("import-success"),t.cancel()})).finally((function(){t.loading=!1}))}))},N([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),e=N([Object(f.a)({})],e)}(f.e),E=A,R=E,q=Object(u.a)(R,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"batch-edit"},[i("bk-sideslider",{attrs:{width:640,"is-show":t.visible,"mask-close":!1},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e},hidden:function(e){t.visible=!1}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("模板导入")]),t._v(" "),i("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"upload-wrapper"},[i("bk-form",{ref:"validateForm",staticStyle:{"margin-bottom":"20px"},attrs:{"label-width":100,model:t.formData,rules:t.rules}},[i("bk-form-item",{attrs:{label:"品牌名称",required:!0,property:"brandName","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入品牌名称"},model:{value:t.formData.brandName,callback:function(e){t.$set(t.formData,"brandName",e)},expression:"formData.brandName"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"模板名称",required:!0,property:"modelName","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入模板名称"},model:{value:t.formData.modelName,callback:function(e){t.$set(t.formData,"modelName",e)},expression:"formData.modelName"}})],1)],1),t._v(" "),i("bk-upload",{attrs:{url:"0",limit:1,"with-credentials":!0,"ext-cls":"upload-sec","custom-request":t.customUpload}}),t._v(" "),t.targetFiles?i("div",{staticClass:"result-response"},[i("ul",[i("li",{staticClass:"result-response-li"},[i("div",{staticClass:"file-icon"},[i("i",{staticClass:"bk-icon icon-text-file"})]),t._v(" "),i("div",{staticClass:"file-content"},[i("div",{staticClass:"file-name"},[i("span",[t._v(t._s(t.targetFiles.name))])]),t._v(" "),i("div",{staticClass:"file-message"},[i("span",{staticClass:"file-size done"},[t._v("100%")])])])])])]):t._e()],1),t._v(" "),i("div",{staticClass:"foot-box"},[i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n                    取消\n                ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                    确认\n                ")])],1)])])],1)}),[],!1,null,"aaac9e8a",null),z=q.exports,F=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),H=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.detail="",e.loading=!1,e.formData={showName:""},e.rules={showName:[{required:!0,message:"必填项",trigger:"blur"}]},e}return F(e,t),e.prototype.show=function(t){this.visible=!0,this.detail=t,this.formData.showName=this.detail.field_cn_name},e.prototype.close=function(){this.visible=!1},e.prototype.closeResetDialog=function(){this.formData.showName="",this.$refs.validatePsdForm.clearError()},e.prototype.confirmReset=function(){var t=this;this.$refs.validatePsdForm.validate().then((function(e){t.loading=!0;var i={id:t.detail.id,field_cn_name:t.formData.showName};t.$api.monitorAlarm.updateMetric(i).then((function(e){if(!e.result)return t.$error(e.message),!1;t.$success("修改成功!"),t.$emit("update-data",e.data),t.close()})).finally((function(){t.loading=!1}))}))},e=H([Object(f.a)({name:"modify-dimension"})],e)}(f.e),V=B,W=V,G=Object(u.a)(W,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-dialog",{attrs:{width:500,theme:"primary","mask-close":!1,"header-position":"left",title:"修改维度-"+t.detail.field_name},on:{"after-leave":t.closeResetDialog},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[i("bk-form",{ref:"validatePsdForm",attrs:{"label-width":70,model:t.formData,rules:t.rules}},[i("bk-form-item",{attrs:{label:"显示名",required:!0,property:"showName"}},[i("bk-input",{attrs:{clearable:!0,placeholder:"请输入"},model:{value:t.formData.showName,callback:function(e){t.$set(t.formData,"showName",e)},expression:"formData.showName"}})],1)],1)],1),t._v(" "),i("template",{slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{disabled:t.loading,theme:"primary",title:"确认"},on:{click:t.confirmReset}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:t.close}},[t._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null),U=G.exports,K=i("wd/R"),Y=i.n(K),X=["operating_system","sql","middleware","bk_device","bk_hardware","cloud","k8s","uptimecheck_group","web_measurement","others"],J=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Z=function(){return Z=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Z.apply(this,arguments)},Q=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},tt=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},et=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},it=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectBrand="",e.selectBrandModel="",e.brandModelList=[],e.searchKey="",e.networkFilterType="brand_name",e.networkSearchList=[{label:"品牌",id:"brand_name"},{label:"模板",id:"device_model"}],e.dimensionLayout=[{key:"dimension_name",span:2,name:"指标/维度"},{key:"field_name",span:3,name:"英文名"},{key:"field_cn_name",span:3,name:"显示名"},{key:"is_show",span:2,name:"展示/隐藏",render:function(t,i){var n=i.row;return t("bk-switcher",{directives:[{name:"permission",value:e.permissionObj}],props:{size:"small",theme:"primary",value:n.is_show,disabled:!e.$BtnPermission(e.permissionObj),preCheck:function(){return e.changeDimensionShowStatus(n,"is_show")}}})}},{key:"operation",span:2,name:"操作",render:function(t,i){var n=i.row;return t("bk-button",{directives:[{name:"permission",value:e.permissionObj}],props:{text:!0},on:{click:function(){e.handleEditDimension(n)}}},"修改")}}],e.lists=[],e.indicatorLayout=[{key:"metric_name",span:2,name:"指标/维度"},{key:"field_name",span:3,name:"英文名"},{key:"field_cn_name",span:3,name:"显示名"},{key:"is_key_index",span:1,name:"关键指标",render:function(t,i){var n=i.row;return t("bk-switcher",{directives:[{name:"permission",value:e.permissionObj}],props:{size:"small",theme:"primary",value:n.is_key_index,disabled:!e.$BtnPermission(e.permissionObj),preCheck:function(){return e.changeShowStatus(n,"is_key_index")}}})}},{key:"is_show",span:1,name:"展示/隐藏",render:function(t,i){var n=i.row;return t("bk-switcher",{directives:[{name:"permission",value:e.permissionObj}],props:{size:"small",theme:"primary",value:n.is_show,disabled:!e.$BtnPermission(e.permissionObj),preCheck:function(){return e.changeShowStatus(n,"is_show")}}})}},{key:"operation",span:2,name:"操作"}],e.loading=!1,e.groupList=[],e.currentNode={},e.parentNode={},e.groupIdsMap={},e.metricIdsMap={},e.currentItem={},e.refreshLoading=!1,e.searchValue="",e.isBkDevice=!1,e.networkDeviceTemplateList=[],e.networkDeviceTemplateListV1=[],e.networkDeviceTemplate={},e.isDeviceDetail=!1,e.allBrandList=[],e.allRecommendMetricList=[],e.conditionsMetList=[{id:"gt",name:">"},{id:"gte",name:">="},{id:"lt",name:"<"},{id:"lte",name:"<="},{id:"eq",name:"="}],e}return J(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),e.prototype.created=function(){this.getObjGroupList()},e.prototype.handleCreateStrategy=function(){var t=this,e=[];this.allRecommendMetricList.forEach((function(i){var n;i.unit_suffix_list=i.unit_suffix_list.filter((function(t){return"x100%"!==t.id})),"x100%"===i.unit_suffix_id&&(i.unit_suffix_id="%");var r={curMetricItem:{description:i.field_cn_name,dimension_list:i.dimension_list||[],enum_list:i.enum_list||[],field_name:i.field_name,require_object_inst_list:i.require_object_inst_list||!0,table_id:i.table_id||"",unit:i.unit,unit_suffix_id:i.unit_suffix_id,unit_suffix_list:i.unit_suffix_list},data:{agg_condition:[],agg_dimension:[],agg_interval:1,agg_interval_unit:"min",agg_method:"AVG",alarm_level:null,config_obj:{deadly:[],remind:[],warning:[{algorithmUnit:i.unit_suffix_id,config:[{method:null===(n=t.conditionsMetList.find((function(t){return t.name===i.compare_way})))||void 0===n?void 0:n.id,threshold:i.compare_value}],hover:!1,title:"静态阈值",type:"Threshold"}]},description:i.field_cn_name,item_name:i.field_name,monitor_item_type:"metric",no_data_config:{continuous:5,is_enabled:!1},recovery_config:{check_window:5},trigger_config:{check_window:5,count:1}},isAdd:!0};e.push(r)})),sessionStorage.setItem("metricMinorList",JSON.stringify(e));var i=this.currentNode,n=i.bk_obj_name,r=i.id,o=i.bk_obj_id,a=i.type;this.$router.push({name:"monitor-strategyGroupAdd",query:{bkObjName:n+"监控"+Y()().format("YYYYMMDDHHmmss"),id:r,bkObjId:o,name:n,taskId:"",type:a,parentNodeId:this.parentNode.id,formOrigin:"metric"}})},e.prototype.goBack=function(){this.isBkDevice=!0,this.isDeviceDetail=!1},e.prototype.filterNetwork=function(){var t=this;if(this.searchKey.trim())if("brand_name"===this.networkFilterType)this.networkDeviceTemplateList=this.networkDeviceTemplateListV1.filter((function(e){return-1!==e.name.indexOf(t.searchKey.trim())}));else{var e=JSON.parse(JSON.stringify(this.networkDeviceTemplateListV1));e.forEach((function(e){e.children=e.children.filter((function(e){return-1!==e.name.indexOf(t.searchKey.trim())}))})),this.networkDeviceTemplateList=e.filter((function(t){return t.children.length}))}else this.networkDeviceTemplateList=this.networkDeviceTemplateListV1},e.prototype.addIndicator=function(t){this.$BtnPermission(this.permissionObj)&&this.$refs.modifyMetric.handleShow("",t)},e.prototype.setExpand=function(t){t.isExpand=!t.isExpand,t.isExpand||(t.isShowDimensionality=!1)},e.prototype.refreshDimensionList=function(t){this.lists.forEach((function(e){(e.dimensionList||[]).forEach((function(e){e.id===t.id&&(e.field_cn_name=t.field_cn_name)}))}))},e.prototype.changeDimensionShowStatus=function(t,e){var i=this;if(this.$BtnPermission(this.permissionObj))return new Promise((function(n,r){var o={id:t.id};o[e]=!t[e],i.$api.monitorAlarm.updateMetric(o).then((function(a){a.result?(t[e]=!t[e],n(a.result),i.$success(o[e]?"维度展示成功":"维度隐藏成功")):(i.$error(a.message),r(a))}))}))},e.prototype.handleEditDimension=function(t){this.$refs.modifyDimension.show(t)},e.prototype.setDimensionality=function(t){t.isShowDimensionality=!t.isShowDimensionality,t.isShowDimensionality&&(t.isExpand=!0,t.dimensionList||this.getDimensionList(t))},e.prototype.getDimensionList=function(t){var e=this;this.$api.monitorAlarm.getDimensionList({monitor_group_id:t.id}).then((function(i){var n=i.result,r=i.data;if(!n)return!1;e.$set(t,"dimensionList",r)}))},e.prototype.importSuccess=function(){this.getNetworkClassificationList(),this.getAllBrand()},e.prototype.changeBrand=function(){this.selectBrandModel="",this.getBrandDeviceModel()},e.prototype.importTemplate=function(){this.$BtnPermission(this.permissionObj)&&this.$refs.importTemplate.showDialog()},e.prototype.changeBrandModel=function(){var t={bk_obj_id:this.currentNode.bk_obj_id,obj_id:this.currentNode.id,network_classification_id:this.selectBrandModel||0};this.getMetricGroup(t)},e.prototype.clearSelectBrand=function(){this.selectBrandModel=""},e.prototype.getBrandDeviceModel=function(){var t=this;this.$api.monitorAlarm.getBrandDeviceModel({bk_obj_id:this.currentNode.bk_obj_id,brand_id:this.selectBrand}).then((function(e){var i,n=e.result,r=e.data;if(!n)return!1;t.brandModelList=r,t.selectBrandModel?t.changeBrandModel():t.selectBrandModel=null===(i=t.brandModelList[0])||void 0===i?void 0:i.id}))},e.prototype.checkDeviceDetail=function(t,e){this.networkDeviceTemplate=t,this.selectBrand=e.id,this.selectBrandModel=t.id,this.getBrandDeviceModel(),this.isBkDevice=!1,this.isDeviceDetail=!0},e.prototype.getMetricGroup=function(t){return void 0===t&&(t={bk_obj_id:"host",obj_id:1,network_classification_id:this.selectBrandModel||0}),tt(this,void 0,void 0,(function(){var e;return et(this,(function(i){switch(i.label){case 0:this.loading=!0,this.allRecommendMetricList=[],i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.$api.monitorAlarm.getMetricGroup(t)];case 2:return(e=i.sent()).result&&(this.lists=e.data.map((function(t,e){return Z(Z({},t),{isExpand:0===e,isShowDimensionality:!1})})),this.groupIdsMap=this.getGroupIdsMap(),this.metricIdsMap=this.getMetricIdsMap(),this.allRecommendMetricList=this.getRecommendMetricList()),[3,4];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.getRecommendMetricList=function(){var t=[];return this.lists.forEach((function(e){t.push.apply(t,e.metric_list.filter((function(t){return t.compare_value&&t.is_show})))})),t},e.prototype.basicKeys=function(t){return!["key_index","ungrouped"].includes(t.name)},e.prototype.getGroupIdsMap=function(){return Object.fromEntries(this.lists.map((function(t,e){return[t.id,e+1]})))},e.prototype.getMetricIdsMap=function(){var t=this.lists.map((function(t){var e=t.id;return t.metric_list.forEach((function(t,i){t.index=i+1,t.group_id=e})),t.metric_list}));return Object.fromEntries(t.flat().map((function(t){return[t.id,{index:t.index,group_id:t.group_id}]})))},e.prototype.getObjGroupList=function(){var t;return tt(this,void 0,void 0,(function(){var e,i,n,r,o=this;return et(this,(function(a){switch(a.label){case 0:this.loading=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.monitorAlarm.getObjGroupList()];case 2:return e=a.sent(),i=function(t){var e=t.map((function(t){var e;return(null===(e=t.children)||void 0===e?void 0:e.length)?Z(Z({},t),{bk_obj_id:t.name,bk_obj_name:t.cn_name,sortIndex:X.findIndex((function(e){return e===t.name.toLowerCase()})),children:i(t.children)}):t}));return e},e.result&&(this.groupList=i(e.data).sort((function(t,e){return t.sortIndex-e.sortIndex})),this.groupList.length&&(n=this.groupList.at(0),r=null===(t=n.children)||void 0===t?void 0:t.at(0),this.$nextTick((function(){o.$refs.tree.setSelected(r.bk_obj_id),o.$refs.tree.setExpanded(r.bk_obj_id)})))),[3,4];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.beforeSelect=function(t){var e;if(null===(e=t.children)||void 0===e?void 0:e.length)return!1;this.isBkDevice="bk_device"===t.parent.data.bk_obj_id;var i=t.data,n=t.parent;if(this.currentNode=i,this.parentNode=n,this.isBkDevice)this.getNetworkClassificationList(),this.getAllBrand();else{this.isDeviceDetail=!1,this.selectBrandModel="",this.selectBrand="";var r={bk_obj_id:i.bk_obj_id,obj_id:i.id,network_classification_id:this.selectBrandModel||0};this.getMetricGroup(r)}return!0},e.prototype.getNetworkClassificationList=function(){var t=this,e={bk_obj_id:this.currentNode.bk_obj_id,field:this.networkFilterType,search:this.searchKey};this.$api.monitorAlarm.getNetworkClassificationList(e).then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.networkDeviceTemplateList=n,t.networkDeviceTemplateListV1=JSON.parse(JSON.stringify(n))}))},e.prototype.getAllBrand=function(){var t=this;this.$api.monitorAlarm.getAllBrand({bk_obj_id:this.currentNode.bk_obj_id}).then((function(e){var i,n=e.result,r=e.data;if(!n)return!1;t.allBrandList=r,t.selectBrand=null===(i=t.allBrandList[0])||void 0===i?void 0:i.brand_id,t.getBrandDeviceModel()}))},e.prototype.clone=function(t){return t},e.prototype.changeShowStatus=function(t,e){return tt(this,void 0,void 0,(function(){var i=this;return et(this,(function(n){return this.$BtnPermission(this.permissionObj)?[2,new Promise((function(n,r){var o={id:t.id};o[e]=!t[e],i.$api.monitorAlarm.updateMetric(o).then((function(a){a.result?(t[e]=!t[e],i.allRecommendMetricList=i.getRecommendMetricList(),n(a.result),"is_show"===e?i.$success(o[e]?"指标展示成功":"指标隐藏成功"):i.$success(o[e]?"关键指标设置成功":"关键指标取消成功")):(i.$error(a.message),r(a))}))}))]:[2]}))}))},e.prototype.toEnd=function(t,e){var i,n;return tt(this,void 0,void 0,(function(){var r,o,a,s;return et(this,(function(l){switch(l.label){case 0:return this.currentItem=(null===(i=t.item)||void 0===i?void 0:i._underlying_vm_)||{},r={},a=(o="group"===e)?this.getGroupIdsMap():this.getMetricIdsMap(),s=o?this.groupIdsMap:this.metricIdsMap,Object.keys(a).forEach((function(t){o&&a[t]===s[t]||(o||JSON.stringify(a[t])!==JSON.stringify(s[t]))&&(r[t]=a[t])})),"{}"===JSON.stringify(r)?[2]:[4,this.$api.monitorAlarm.changeGroupIndex({type:e,index:r,current_metric:(null===(n=this.currentItem)||void 0===n?void 0:n.field_name)||""})];case 1:return l.sent().result&&(o?this.groupIdsMap=this.getGroupIdsMap():this.metricIdsMap=this.getMetricIdsMap()),[2]}}))}))},e.prototype.handleDeleteGroup=function(t){var e=this;this.$BtnPermission(this.permissionObj)&&(t.metric_list.length||this.$bkInfo({title:"是否删除指标分组-".concat(t.display_name),confirmLoading:!0,confirmFn:function(){return tt(e,void 0,void 0,(function(){return et(this,(function(e){switch(e.label){case 0:return[4,this.confirmDelete(t)];case 1:return e.sent(),[2]}}))}))}}))},e.prototype.confirmDelete=function(t){return tt(this,void 0,void 0,(function(){var e,i;return et(this,(function(n){switch(n.label){case 0:return[4,this.$api.monitorAlarm.deleteMetricGroup({id:t.id,bk_obj_name:this.currentNode.bk_obj_name})];case 1:return(e=n.sent()).result?(this.$success("".concat(t.display_name,"删除成功")),i=this.lists.findIndex((function(e){return e.id===t.id})),this.lists.splice(i,1),[2]):[2,this.$error(e.message)]}}))}))},e.prototype.handleModifyGroup=function(t){var e;this.$BtnPermission(this.permissionObj)&&(null===(e=this.$refs.modifyGroup)||void 0===e||e.handleShow(t))},e.prototype.handleSyncMetrics=function(){return tt(this,void 0,void 0,(function(){var t,e;return et(this,(function(i){switch(i.label){case 0:if(!this.$BtnPermission(this.permissionObj))return[2];if(this.refreshLoading)return[2];this.refreshLoading=!0,i.label=1;case 1:return i.trys.push([1,,5,6]),[4,this.$api.monitorAlarm.syncMetrics()];case 2:return(t=i.sent()).result?(this.$success("同步成功"),e={bk_obj_id:this.currentNode.bk_obj_id,obj_id:this.currentNode.id,network_classification_id:this.selectBrandModel||0},[4,this.getMetricGroup(e)]):[3,4];case 3:return i.sent(),[2];case 4:return this.$error(t.message),[3,6];case 5:return this.refreshLoading=!1,[7];case 6:return[2]}}))}))},e.prototype.handleAddList=function(t){this.lists.push(t)},e.prototype.handleUpdateList=function(t,e){var i=this.lists.find((function(e){return e.id===t.id}));i&&(i.display_name=t.display_name)},e.prototype.handleUpdateMetric=function(t,e){var i=this.lists.find((function(e){return e.id===t.group_id}));if(null==i?void 0:i.metric_list.length){var n=null==i?void 0:i.metric_list.findIndex((function(e){return e.id===t.id}));if(t.group_id===t.metric_group)null==i||i.metric_list.splice(n,1,t);else{null==i||i.metric_list.splice(n,1);var r=this.lists.find((function(e){return e.id===t.metric_group}));null==r||r.metric_list.push(Z(Z({},t),{group_id:t.metric_group}))}}this.lists.forEach((function(t){(t.metric_list||[]).forEach((function(t){if(t.id===e.id)for(var i in e)t[i]=e[i]}))}))},e.prototype.deleteMetric=function(t,e,i){var n=this;if(!this.$BtnPermission(this.permissionObj))return!1;this.$bkInfo({title:"确认要删除该指标？",confirmLoading:!0,confirmFn:function(){return tt(n,void 0,void 0,(function(){return et(this,(function(n){switch(n.label){case 0:return[4,this.confirmDeleteMetric(t,e,i)];case 1:return n.sent(),[2]}}))}))}})},e.prototype.confirmDeleteMetric=function(t,e,i){return tt(this,void 0,void 0,(function(){var n;return et(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.$api.monitorAlarm.deleteMetric({id:t.id})];case 1:return(n=r.sent()).result?(this.$success("删除成功!"),i.splice(e,1)):this.$error(n.message),[2,!0];case 2:return r.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.handleEditMetric=function(t){if(!this.$BtnPermission(this.permissionObj))return!1;this.$refs.modifyMetric.handleShow(t)},e.prototype.handleSearch=function(t){this.searchValue=t,this.lists.forEach((function(e){e.isExpand=e.metric_list.some((function(e){return t&&-1!==e.field_cn_name.indexOf(t)}))}))},e.prototype.brightKeyWord=function(t){var e=new RegExp(this.searchValue,"i");return t.replace(e,'<span style="color: #f00;">'.concat(this.searchValue,"</span>"))||"--"},e.prototype.deleteTemplate=function(t){var e=this;this.$bkInfo({title:"确认要删除该模板？",confirmLoading:!0,confirmFn:function(){return tt(e,void 0,void 0,(function(){return et(this,(function(e){switch(e.label){case 0:return[4,this.confirmDeleteTemplate(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmDeleteTemplate=function(t){return tt(this,void 0,void 0,(function(){var e;return et(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$api.monitorAlarm.deleteNetworkClassification({id:t.id})];case 1:return(e=i.sent()).result?(this.$success("删除成功!"),this.getNetworkClassificationList()):this.$error(e.message),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e=Q([Object(f.a)({components:{draggable:s.a,ModifyGroup:x,ModifyMetric:$,ColumnExpand:d,ImportTemplate:z,ModifyDimension:U}})],e)}(f.e),nt=it,rt=nt,ot=Object(u.a)(rt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"indicator-manage"},[n("div",{staticClass:"group-tree"},[t.groupList.length?n("bk-big-tree",{ref:"tree",attrs:{data:t.groupList,"enable-title-tip":"",selectable:!0,"show-checkbox":!1,"show-link-line":!1,"use-default-empty":!0,options:{idKey:"bk_obj_id",nameKey:"bk_obj_name"},"before-select":t.beforeSelect}}):n("bk-exception",{staticClass:"exception-wrap-item exception-part",class:{"exception-gray":!1},attrs:{type:"empty",scene:"part"}})],1),t._v(" "),t.isBkDevice?n("div",{staticClass:"network-device"},[n("div",{staticClass:"action-bar"},[n("div",{staticClass:"search-box"},[n("bk-select",{staticStyle:{width:"100px"},attrs:{disabled:!1,"ext-cls":"select-custom",clearable:!1,"ext-popover-cls":"select-popover-custom"},model:{value:t.networkFilterType,callback:function(e){t.networkFilterType=e},expression:"networkFilterType"}},t._l(t.networkSearchList,(function(t){return n("bk-option",{key:t.id,attrs:{id:t.id,name:t.label}})})),1),t._v(" "),n("bk-input",{attrs:{clearable:!0},on:{enter:t.filterNetwork},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"ml20",attrs:{theme:"primary"},on:{click:t.importTemplate}},[t._v("\n                导入模板\n            ")])],1),t._v(" "),n("div",{staticClass:"model-list"},[t._l(t.networkDeviceTemplateList,(function(e){return n("div",{key:e.id,staticClass:"template-list"},[n("div",{staticClass:"template-title"},[n("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(e.name))]),t._v(" "),n("span",[t._v("("+t._s(e.children.length)+")")])]),t._v(" "),n("div",{staticClass:"template-content"},t._l(e.children,(function(r){return n("div",{key:r.id,staticClass:"template-card",on:{click:function(i){return t.checkDeviceDetail(r,e)}}},[n("img",{attrs:{src:i("4nRk"),alt:""}}),t._v(" "),n("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"template-name hide-text"},[t._v(t._s(r.name))]),t._v(" "),t.userInfo.is_super?n("bk-icon",{attrs:{type:"delete"},on:{click:function(e){return e.stopPropagation(),t.deleteTemplate(r)}}}):t._e()],1)})),0)])})),t._v(" "),t.networkDeviceTemplateList.length?t._e():n("bk-exception",{staticClass:"exception-wrap-item exception-part mt50",attrs:{type:"empty",scene:"part"}})],2)]):n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"indicator-list-wrapper"},[n("div",{staticStyle:{display:"flex","margin-bottom":"20px"}},[t.isDeviceDetail?n("div",{staticClass:"device-detail"},[n("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}}),t._v(" "),n("bk-select",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{disabled:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",clearable:!1},on:{change:t.changeBrand,clear:t.clearSelectBrand},model:{value:t.selectBrand,callback:function(e){t.selectBrand=e},expression:"selectBrand"}},t._l(t.allBrandList,(function(t){return n("bk-option",{key:t.brand_id,attrs:{id:t.brand_id,name:t.brand_name}})})),1),t._v(" "),n("bk-select",{staticStyle:{width:"150px"},attrs:{disabled:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",clearable:!1},on:{change:t.changeBrandModel},model:{value:t.selectBrandModel,callback:function(e){t.selectBrandModel=e},expression:"selectBrandModel"}},t._l(t.brandModelList,(function(t){return n("bk-option",{key:t.id,attrs:{id:t.id,name:t.device_model}})})),1)],1):t._e(),t._v(" "),n("div",{staticStyle:{flex:"1"}},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.handleModifyGroup()}}},[t._v("\n                    新增分组\n                ")]),t._v(" "),t.isDeviceDetail?n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticStyle:{"margin-left":"10px"},attrs:{theme:"primary"},on:{click:function(e){return t.addIndicator("add")}}},[t._v("\n                    新增指标\n                ")]):t._e(),t._v(" "),n("div",{staticClass:"fr ml10 mr10",staticStyle:{width:"18px",height:"100%",position:"relative"}},[n("i",{staticClass:"cw-icon weops-info create-strategy-icon",attrs:{title:"创建监控策略"},on:{click:function(e){return t.handleCreateStrategy()}}})]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"fr btn",attrs:{disabled:t.refreshLoading,icon:t.refreshLoading?"loading":"icon-refresh"},on:{click:function(e){return t.handleSyncMetrics()}}}),t._v(" "),n("bk-input",{staticClass:"fr",staticStyle:{width:"40%",margin:"0 15px"},attrs:{clearable:"",value:t.searchValue,placeholder:"请输入指标名搜索","right-icon":"bk-icon icon-search"},on:{enter:t.handleSearch,"right-icon-click":t.handleSearch}})],1)]),t._v(" "),n("draggable",{staticClass:"indicator-group",attrs:{list:t.lists,scroll:!0,animation:"500",handle:".mover","ghost-class":"ghost","force-fallback":"true"},on:{sort:function(e){return t.toEnd(e,"group")}}},t._l(t.lists,(function(e){return n("div",{key:e.id,staticClass:"indicator-group-li",class:{active:e.isExpand}},[n("div",{staticClass:"name"},[t.$BtnPermission(t.permissionObj)?n("span",{staticClass:"cw-icon weops-drag-drop mover"}):t._e(),t._v(" "),n("bk-icon",{attrs:{type:e.isExpand?"down-shape":"right-shape"},on:{click:function(i){return t.setExpand(e)}}}),t._v("\n                    "+t._s(e.display_name)+"\n                    "),n("span",{staticStyle:{color:"#e3e3e3"}},[t._v("("+t._s(e.name)+")")]),t._v(" "),t.basicKeys(e)?n("bk-icon",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"fr operation",class:{disabled:!!e.metric_list.length},attrs:{type:"delete"},on:{click:function(i){return i.stopPropagation(),t.handleDeleteGroup(e)}}}):t._e(),t._v(" "),t.basicKeys(e)?n("bk-icon",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"fr mr10",attrs:{type:"edit"},on:{click:function(i){return i.stopPropagation(),t.handleModifyGroup(e)}}}):t._e(),t._v(" "),n("span",{staticClass:"fr mr30 dimensionality-btn",on:{click:function(i){return t.setDimensionality(e)}}},[t._v(t._s(e.isShowDimensionality?"隐藏维度":"显示维度"))])],1),t._v(" "),n("bk-transition",{directives:[{name:"show",rawName:"v-show",value:e.isShowDimensionality,expression:"item.isShowDimensionality"}],attrs:{name:"collapse"}},[n("div",{staticClass:"indicator-content"},[n("bk-container",{attrs:{col:12,margin:0,gutter:0}},[n("bk-row",{staticClass:"column-header"},t._l(t.dimensionLayout,(function(e){return n("bk-col",{key:e.key,attrs:{span:e.span}},[n("div",{staticClass:"column"},[t._v(t._s(e.name))])])})),1)],1),t._v(" "),t._l(e.dimensionList,(function(e){return n("bk-container",{key:e.id,attrs:{col:12,margin:0,gutter:0}},[n("bk-row",{staticClass:"table-row-txt"},t._l(t.dimensionLayout,(function(i){return n("bk-col",{key:i.key,attrs:{span:i.span}},[n("div",{staticClass:"column"},[i.render?n("column-expand",{key:e.id,attrs:{row:e,render:i.render}}):"dimension_name"===i.key?n("span",[t._v("维度")]):n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"overflow"},[t._v("\n                                            "+t._s(e[i.key]||"--")+"\n                                        ")])],1)])})),1)],1)}))],2)]),t._v(" "),n("bk-transition",{attrs:{name:"collapse"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.isExpand,expression:"item.isExpand"}],staticClass:"indicator-content"},[n("bk-container",{attrs:{col:12,margin:0,gutter:0}},[n("bk-row",{staticClass:"column-header"},t._l(t.indicatorLayout,(function(e){return n("bk-col",{key:e.key,attrs:{span:e.span}},[n("div",{staticClass:"column"},[t._v(t._s(e.name))])])})),1)],1),t._v(" "),n("draggable",{staticClass:"drag-area",class:{"border-bottom":!e.metric_list.length},attrs:{list:e.metric_list,clone:t.clone,scroll:!0,group:"people",handle:".col-mover","ghost-class":"ghost"},on:{end:function(e){return t.toEnd(e,"metric")}}},t._l(e.metric_list,(function(i,r){return n("bk-container",{key:i.id,attrs:{col:12,margin:0,gutter:0}},[n("bk-row",{staticClass:"table-row-txt"},t._l(t.indicatorLayout,(function(o){return n("bk-col",{key:o.key,attrs:{span:o.span}},[n("div",{staticClass:"column"},[o.render?n("column-expand",{key:i.id,attrs:{row:i,render:o.render}}):t._e(),t._v(" "),"metric_name"===o.key?n("div",[t.$BtnPermission(t.permissionObj)?n("span",{staticClass:"cw-icon weops-drag-drop col-mover"}):t._e(),t._v(" "),n("span",[t._v("指标")])]):"field_cn_name"===o.key?n("div",{staticClass:"field-name"},[n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"overflow"},[n("span",{domProps:{innerHTML:t._s(t.brightKeyWord(i[o.key]))}})])]):"operation"===o.key?n("div",[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleEditMetric(i)}}},[t._v("\n                                                    修改\n                                                ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary",text:""},on:{click:function(n){return t.deleteMetric(i,r,e.metric_list)}}},[t._v("\n                                                    删除\n                                                ")])],1):n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"overflow"},[t._v("\n                                                "+t._s(i[o.key]||"--")+"\n                                            ")])],1)])})),1)],1)})),1)],1)])],1)})),0)],1),t._v(" "),n("modify-group",{ref:"modifyGroup",attrs:{"current-node":t.currentNode,"is-device-detail":t.isDeviceDetail,"network-device-template":t.networkDeviceTemplate},on:{add:t.handleAddList,update:t.handleUpdateList}}),t._v(" "),n("modify-metric",{ref:"modifyMetric",attrs:{"group-list":t.lists},on:{"refresh-list":t.changeBrandModel,update:t.handleUpdateMetric}}),t._v(" "),n("import-template",{ref:"importTemplate",attrs:{"current-node":t.currentNode},on:{"import-success":t.importSuccess}}),t._v(" "),n("modify-dimension",{ref:"modifyDimension",on:{"update-data":t.refreshDimensionList}})],1)}),[],!1,null,"38114162",null),at=ot.exports,st=i("JnIg"),lt=i("/gAG"),ct=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ut=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},pt=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},dt=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ft=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.monitorData=[],e.selectedRow={},e.columns=[{type:"selection",fixed:"left"},{label:"策略名称",key:"name",minWidth:"200px"},{label:"监控项",key:"monitor_item_name",minWidth:"100px"},{label:"监控目标",key:"monitor_num",minWidth:"100px"},{label:"创建记录",key:"created_at",minWidth:"160px"},{label:"更新记录",key:"updated_at",minWidth:"160px"},{label:"启/停",key:"is_enabled",minWidth:"100px",scopedSlots:"status"},{label:"操作",key:"operation",width:"200px",prop:"operation",fixed:"right",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:20},e.selectedTableData=[],e.monitorDetail=[],e.plocyData=[],e.objectSelectType="list",e.targetData=[],e}return ct(e,t),Object.defineProperty(e.prototype,"isTopo",{get:function(){return!["vm","storage","esxi"].includes(this.currentNode.bk_obj_id)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showTopo",{get:function(){return["Operating_System","SQL","middleware"].includes(this.parentNode.id)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listDisabled",{get:function(){return"group"===this.objectSelectType&&!!this.targetData.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupDisabled",{get:function(){return"list"===this.objectSelectType&&!!this.targetData.length},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&this.getObjCollectTask()},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.batchUpdateStatus=function(t){return pt(this,void 0,void 0,(function(){var e,i,n,r;return dt(this,(function(o){switch(o.label){case 0:return this.$BtnPermission(this.permissionObj)?(e=this.selectedTableData.map((function(t){return t.id})),i=this.selectedTableData.map((function(t){return t.name})).join(),n={strategy_list:e,is_enabled:"start"===t,name:i,type:this.isTopo?"other":"VMware",bk_obj_id:this.currentNode.bk_obj_name},this.tableLoading=!0,[4,this.$api.monitorCollect.updateStatus(n)]):[2];case 1:return(r=o.sent()).result?(this.$success("操作成功"),this.getObjCollectTask(),[2]):(this.$error(r.message),this.tableLoading=!1,[2])}}))}))},e.prototype.updateMonitorTaskTargets=function(t,e){return pt(this,void 0,void 0,(function(){var i,n,r,o;return dt(this,(function(a){switch(a.label){case 0:return i=t.data,n=t.type,r={object_inst_ids:i,create_type:"other",name:e.name,object_select_type:n,bk_obj_id:this.currentNode.bk_obj_name,id:e.id},this.tableLoading=!0,[4,this.$api.monitorCollect.updateMonitorTaskTargets(r)];case 1:return(o=a.sent()).result?(this.$success("操作成功"),this.getObjCollectTask(),[2]):(this.$error(o.message),this.tableLoading=!1,[2])}}))}))},e.prototype.updateMonitorTargets=function(t){return pt(this,void 0,void 0,(function(){var e;return dt(this,(function(i){switch(i.label){case 0:return this.tableLoading=!0,[4,this.$api.monitorCollect.updateMonitorTask(t)];case 1:return(e=i.sent()).result?(this.$success("操作成功"),this.getObjCollectTask(),this.tableLoading=!1,[2]):(this.$error(e.message),[2])}}))}))},e.prototype.selectTarget=function(t){return pt(this,void 0,void 0,(function(){var e,i,n,r,o;return dt(this,(function(a){switch(a.label){case 0:return this.targetData=t.object_inst_ids||[],this.objectSelectType=t.object_select_type,(e={objId:this.currentNode.id,entry:this.isTopo?"policy-others":"policy-isVirtualization"}).panels=[{name:"list",disabled:this.listDisabled},{name:"topo",hide:!this.showTopo,disabled:this.listDisabled},{name:"group",hide:!this.isTopo,disabled:this.groupDisabled}],this.$BtnPermission(this.permissionObj)?(i=[],this.isTopo?[3,2]:[4,this.$api.monitorCollect.getStrategyDataInstance({id:t.id})]):[2];case 1:if(!(n=a.sent()).result)return this.$error(n.message),[2];this.plocyData=n.data,i=n.data.cloud_resource_targets.map((function(t){return{bk_inst_id:t}})),(r=Object.values(n.data.alarm_strategies)[0]).forEach((function(t){t.config_obj=t.strategy_config.config_obj,t.trigger_config=t.strategy_config.trigger_config,t.recovery_config=t.strategy_config.recovery_config,t.monitor_item_type=t.item_type,t.item_name=t.item.name,t.agg_interval_unit=t.item.unit,t.agg_method=t.item.metric,t.description=t.item.description,t.metric=t.item.metric,t.unit_suffix_id=t.item.unit_suffix_id,t.unit_suffix_list=t.item.unit_suffix_list})),this.monitorDetail=r,a.label=2;case 2:return this.selectedRow=t,o=this.isTopo?t.object_inst_ids:i,this.$refs.selectTargets.show(o,t,e),[2]}}))}))},e.prototype.getSelectedTargets=function(t){return pt(this,void 0,void 0,(function(){var e,i,n,r=this;return dt(this,(function(o){return this.objectSelectType=t.type,this.isTopo?(this.updateMonitorTaskTargets(t,this.selectedRow),[2]):(e={id:this.selectedRow.id,created_by:this.plocyData.created_by,monitor_item:this.$copy(this.monitorDetail),bk_obj_id:this.currentNode.bk_obj_id,monitor_object:this.currentNode.id,create_type:"VMware",notice_groups:[],type:"cloud_resource",cloud_targets:[],cloud_type:"VMware",name:this.selectedRow.name,is_enabled:this.selectedRow.is_enabled,cloud_resource_targets:t.data.map((function(t){return t.bk_inst_id})),object_inst_ids:t.data.map((function(t){return t.bk_inst_id})),object_select_type:t.type},i=this.currentNode.bk_obj_id,(n={})[i]=e.monitor_item.map((function(t){return{name:"".concat(r.selectedRow.name,"#").concat(r.currentNode.bk_obj_name,"#").concat(t.description),item:{metric:t.metric,name:t.item_name,description:t.description,unit:t.agg_interval_unit,unit_suffix_id:t.unit_suffix_id,unit_suffix_list:t.unit_suffix_list,mapping:{VMware:{alias:t.metric,namespace:r.currentNode.bk_obj_id}},hide:!1},id:t.id,cloud_resource_type:r.currentNode.bk_obj_id,cloud_type:"VMware",item_type:t.monitor_item_type,strategy_config:{config_obj:t.config_obj,trigger_config:t.trigger_config,recovery_config:t.recovery_config}}})),e.monitor_item=n,this.updateMonitorTargets(e),[2])}))}))},e.prototype.setPlugins=function(t){var e=t.task_plugins,i="--";return(null==e?void 0:e.length)&&(i=e.reduce((function(t,e){return t+"".concat(e.plugin_id,",")}),"").slice(0,-1)),i},e.prototype.linkToPlugin=function(t,e){if(void 0===e&&(e={}),this.$BtnPermission(this.permissionObj)){var i=this.currentNode,n=i.bk_obj_name,r=i.id,o=i.bk_obj_id,a=i.type;"modify"===t&&sessionStorage.setItem("policyModifyData",JSON.stringify(e)),this.$router.push({name:"modify"===t?"monitor-strategyGroupModify":"monitor-strategyGroupAdd",query:{bkObjName:n+"监控"+Y()().format("YYYYMMDDHHmmss"),id:r,bkObjId:o,name:n,taskId:e.id,type:a,parentNodeId:this.parentNode.id}})}},e.prototype.selectTableData=function(t,e){this.selectedTableData=t},e.prototype.selectAllTableData=function(t){this.selectedTableData=t},e.prototype.updateStatus=function(t){return pt(this,void 0,void 0,(function(){var e,i,n,r,o;return dt(this,(function(a){switch(a.label){case 0:return this.$BtnPermission(this.permissionObj)?(e=t.id,i=t.is_enabled,n=t.name,r={strategy_list:[e],is_enabled:i,name:n,type:this.isTopo?"other":"VMware",bk_obj_id:this.currentNode.bk_obj_name},this.tableLoading=!0,[4,this.$api.monitorCollect.updateStatus(r)]):[2];case 1:return(o=a.sent()).result?(this.$success("操作成功"),this.getObjCollectTask(),[2]):(this.$error(o.message),this.tableLoading=!1,[2])}}))}))},e.prototype.getObjCollectTask=function(){return pt(this,void 0,void 0,(function(){var t,e,i,n,r,o=this;return dt(this,(function(a){switch(a.label){case 0:this.tableLoading=!0,t=this.getParams(),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getStrategyData(t)];case 2:return e=a.sent(),i=e.result,n=e.data,r=e.message,i?(this.monitorData=n.results,this.pagination.count=n.count,this.selectedTableData.length&&this.$nextTick((function(){o.monitorData.forEach((function(t){o.selectedTableData.find((function(e){return e.id===t.id}))&&o.$refs.table.toggleRowSelection(t,!0)}))})),[3,4]):(this.$error(r),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this.pagination,e=t.limit,i=t.current,n=["vm","storage","esxi"].includes(this.currentNode.bk_obj_id),r={page_size:e,page:i,name:this.search,monitor_object_type:this.currentNode.bk_obj_id,strategy_type:n?0:1};return n&&(r.order_by=-1,r.cloud_type="VMware",r.bk_obj_id=this.currentNode.bk_obj_id,delete r.monitor_object_type),r},e.prototype.handleDelete=function(t){return pt(this,void 0,void 0,(function(){var e=this;return dt(this,(function(i){return this.$BtnPermission(this.permissionObj)?(this.$bkInfo({title:"提示",subTitle:"确定删除该策略？",theme:"primary",confirmFn:function(){e.confirmDeleteTask(t)}}),[2]):[2]}))}))},e.prototype.confirmDeleteTask=function(t){return pt(this,void 0,void 0,(function(){var e,i,n,r;return dt(this,(function(o){switch(o.label){case 0:return e=t.id,i=t.name,this.tableLoading=!0,n={id:e,type:this.isTopo?"other":"VMware",name:i,bk_obj_id:this.currentNode.bk_obj_name},[4,this.$api.monitorCollect.deleteInstance(n)];case 1:return(r=o.sent()).result?(this.$success("删除成功"),this.pagination.current>1&&1===this.monitorData.length&&this.pagination.current--,this.refreshTree(this.currentNode),this.getObjCollectTask(),[2]):(this.$error(r.message),this.tableLoading=!1,[2])}}))}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getObjCollectTask()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getObjCollectTask()},e.prototype.refreshTree=function(t){return t},ut([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),ut([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"parentNode",void 0),ut([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),ut([Object(f.b)("refreshTree")],e.prototype,"refreshTree",null),e=ut([Object(f.a)({components:{ComTable:st.a,SelectTargets:lt.a},activated:function(){this.getObjCollectTask()}})],e)}(f.e),mt=ft,ht=mt,bt=Object(u.a)(ht,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"policy-table"},[i("div",{staticClass:"nav-area"},[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.linkToPlugin("add")}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"ml10",attrs:{disabled:!t.selectedTableData.length},on:{click:function(e){return t.batchUpdateStatus("start")}}},[t._v("\n                批量启动\n            ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"ml10",attrs:{disabled:!t.selectedTableData.length},on:{click:function(e){return t.batchUpdateStatus("stop")}}},[t._v("\n                批量停止\n            ")])],1),t._v(" "),i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入策略组名称",clearable:""},on:{enter:t.getObjCollectTask},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.monitorData,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange,select:t.selectTableData,"select-all":t.selectAllTableData},scopedSlots:t._u([{key:"taskPlugins",fn:function(e){var n=e.row;return[i("span",[t._v(t._s(t.setPlugins(n)))])]}},{key:"status",fn:function(e){var n=e.row;return[i("bk-switcher",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{disabled:!t.$BtnPermission(t.permissionObj),theme:"primary"},on:{change:function(e){return t.updateStatus(n)}},model:{value:n.is_enabled,callback:function(e){t.$set(n,"is_enabled",e)},expression:"row.is_enabled"}})]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.selectTarget(n)}}},[t._v("\n                        增删目标\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.linkToPlugin("modify",n)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDelete(n)}}},[t._v("\n                        删除\n                    ")])],1)]}}])})],1),t._v(" "),i("SelectTargets",{ref:"selectTargets",attrs:{"current-node":t.currentNode},on:{getSelectedTargets:t.getSelectedTargets}})],1)}),[],!1,null,"01212a61",null),gt=bt.exports,yt=i("SeYB"),vt=i("qz1i"),_t=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),kt=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},wt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageUrl="",e.ownCss=!1,e.pageName="policyConfigure",e}return _t(e,t),e.prototype.mounted=function(){this.pageUrl=yt.a.policyConfigure},e=kt([Object(f.a)({components:{WikiIframe:vt.a},name:"web-policy"})],e)}(f.e),xt=wt,Ct=xt,Dt=Object(u.a)(Ct,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"web-policy"}},[i("div",{ref:"iframeWraper",staticClass:"iframe-wrapper"},[i("wiki-iframe",{attrs:{url:t.pageUrl,name:t.pageName,link:"policyConfigure"}})],1)])}),[],!1,null,"3bc64fed",null),jt=Dt.exports,Ot=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Lt=function(){return Lt=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Lt.apply(this,arguments)},Tt=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},St=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},It=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Pt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.groupList=[],e.currentNode={},e.parentNode={},e.longConfig={placement:"right",width:140,content:"已监控实例数/未监控实例数"},e}return Ot(e,t),e.prototype.created=function(){this.getObjGroupList({bk_obj_id:this.$route.query.bkObjId})},e.prototype.refreshTree=function(t){this.getObjGroupList(t)},e.prototype.getObjGroupList=function(t){var e;return void 0===t&&(t={}),St(this,void 0,void 0,(function(){var i,n,r,o,a=this;return It(this,(function(s){switch(s.label){case 0:this.loading=!0,s.label=1;case 1:return s.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getStrategyTree()];case 2:return i=s.sent(),n=function(t){var e=t.map((function(t){var e;return(null===(e=t.children)||void 0===e?void 0:e.length)?Lt(Lt({},t),{bk_obj_id:t.name,bk_obj_name:t.cn_name,sortIndex:X.findIndex((function(e){return e===t.name.toLowerCase()})),children:n(t.children)}):t}));return e},i.result&&(this.groupList=n(i.data).sort((function(t,e){return t.sortIndex-e.sortIndex})),this.groupList.length&&(r=this.groupList.at(0),o=null===(e=r.children)||void 0===e?void 0:e.at(0),this.$nextTick((function(){a.$refs.tree.setSelected(t.bk_obj_id||o.bk_obj_id),a.$refs.tree.setExpanded(t.bk_obj_id||o.bk_obj_id)})))),[3,4];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.beforeSelect=function(t){var e;if(null===(e=t.children)||void 0===e?void 0:e.length)return!1;var i=t.data,n=t.parent;return this.currentNode=i,this.parentNode=n,!0},e=Tt([Object(f.a)({components:{Monitor:gt,WebMonitorPolicy:jt}})],e)}(f.e),$t=Pt,Mt=$t,Nt=Object(u.a)(Mt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"monitor-policy"},[i("div",{staticClass:"group-tree"},[t.groupList.length?i("bk-big-tree",{ref:"tree",attrs:{data:t.groupList,"enable-title-tip":"",selectable:!0,"show-checkbox":!1,"show-link-line":!1,"use-default-empty":!0,options:{idKey:"bk_obj_id",nameKey:"bk_obj_name"},"before-select":t.beforeSelect},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,r=e.data;return n.level?i("div",{staticClass:"tree-node"},[i("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"tree-node-name"},[t._v(t._s(r.bk_obj_name))])]):t._e()}}],null,!0)}):i("bk-exception",{staticClass:"exception-wrap-item exception-part",class:{"exception-gray":!1},attrs:{type:"empty",scene:"part"}})],1),t._v(" "),i("div",{staticClass:"indicator-list-wrapper"},["bk_web_measurement"===t.currentNode.bk_obj_id?i("WebMonitorPolicy"):i("Monitor",{attrs:{"current-node":t.currentNode,"parent-node":t.parentNode},on:{refreshTree:t.refreshTree}})],1)])}),[],!1,null,"6abaa8c1",null),At=Nt.exports,Et={host:{title:"主机",content:[{text:"配置说明",children:[{text:"安装到业务：主机安装 Agent 以后，需指定录入到哪个业务，默认会放置到业务下的 “/空闲池/空闲机” 下"},{text:"云区域：主机需要被指定属于哪个云区域，如果部署的环境可以直接连接到此主机，没有网络隔离，选择“直连区域”。如果公司有复杂的网络划分，无法直接连接到此主机，需要先在“云区域管理”做好网络规划，再进行 Agent 的安装"},{text:"接入点：此配置一般在云区域中默认指定，部分未指定接入点的云区域需要用户手动选择"},{text:"安装信息：IP 地址：蓝鲸连接到此主机使用的 IP 地址",children:["登录 IP：安装 Agent 时，登录的 IP 地址。此参数可以为空，通常此地址与第一个参数“IP 地址”一致。如果存在不一致，才需要填写此参数","操作系统：此主机安装的操作系统类型，由于不同操作系统登录的方式有所差异，请务必填写正确","登录端口：通常 SSH 登录端口为 22，端口错误会导致无法正常登录安装","登录账户：Linux 请使用 root 账户，Windows 请使用 Administrator","认证方式：目前支持“密码”和“密钥”两种方式，选择密钥需要上传密钥文件。这些敏感信息，为了保证安全的同时避免用户重复输入，节点管理默认保存 24 小时，超时以后会删除登录账号信息"]}]}]},process:{title:"主机-进程",content:[{text:"使用指引",children:[{type:"text",content:"进程监控采集任务配置好下发到目标机器后，会基于采集的任务信息进行工作。通过配置需要监控的进程名，条件可以选择包含，不包含（排除）某些命令行的关键字，过滤出需要的进程，然后探测该进程是否开启端口(可选功能)，同时会采集该进程的相关使用情况。"}]},{text:"配置说明",children:[{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途","监控对象：默认为主机，不可修改","选择插件：默认为“进程采集”，不可修改","采集周期：默认为5min，可按需配置","进程匹配：分为命令行匹配和pid文件2种方式"]},{type:"text",content:"命令行匹配方式"},{type:"code",content:["包含：进程匹配字符串，一般是进程的名称，注意Linux是cmdline, windows是匹配进程名","排除：即不上报的进程，可以填写正则表达式，如(\\d+)，不采集匹配数字的进程\n"]},{type:"list",content:["进程别名：进程的名称，可以填写进程的实际名称，也可以填写正则，正则的括号表示最终取值的内容。如(/containers/\\d+)，如其cmdline为"]},{type:"code",content:["/bin/java -Xms30720m -Xmx30720m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -server -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j.skipJansi=true -XX:+HeapDumpOnOutOfMemoryError -Des.path.home=/data1/containers/1495608881000003411/es -cp /data1/containers/1495608881000003411/es/lib/* org.elasticsearch.bootstrap.Elasticsearch -d"]},{type:"text",content:"则最终上报的进程名是/containers/1495608881000003411。"},{type:"list",content:["端口探测：探测该进程是否开启端口","监控目标：选择进程对应的主机"]}]}]},mongodb:{title:"数据库-mongoDB",content:[{text:"版本支持",children:[{type:"text",content:"系统支持: Linux"},{type:"text",content:"mongoDB"}]},{text:"使用指引",children:[{type:"text",content:"该采集器基于exporter实现，请确认目标机器已安装`golang"},{type:"text",content:'请填写监控对象mongodb的连接信息：类似"mongodb://user:password@host:port"'}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"100px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"使用举例",key:"example",align:"left",minWidth:"100px"}],tableList:[{params_name:"-web.listen-address",meaning:"exporter监听的url，提供给采集器使用",example:"127.0.0.1:9602"},{params_name:"SCRAPE_USER",meaning:"mongodb账号",example:""},{params_name:"SCRAPE_PASSWORD",meaning:"用户密码",example:""},{params_name:"SCRAPE_HOST",meaning:"采集目标的主机IP，默认为localhost",example:"127.0.0.1"},{params_name:"SCRAPE_PORT",meaning:"采集目标的端口,默认为80",example:"27017"}]},{type:"text",content:"采集器将会根据你配置的内容，定期在本地访问"},{type:"code",content:["http://ip:9601/metrics"]},{type:"text",content:"以获取指标数据。"}]}]},oracle:{title:"数据库-oracle",content:[{text:"使用指引",children:[{type:"text",content:"安装Oracle instance client依赖包："},{type:"downLoad",content:'\n                                    <div>\n                                        <span>下载</span>\n                                        <a href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html" target="_blank" style="color: #0d72ff;">【Oracle instance client的RPM包】,</a>\n                                        <span>basic、devel、sqlplus三个RPM包，并用命令安装：</span>\n                                    </div>\n                                '},{type:"code",content:["rpm -ivh oracle-instantclient11.2-*"]},{type:"text",content:"配置相应的环境变量和软连接："},{type:"code",content:["export LD_LIBRARY_PATH=/usr/lib/oracle/11.2/client64/lib:$LD_LIBRARY_PATH",'echo "export LD_LIBRARY_PATH=/usr/lib/oracle/11.2/client64/lib:$LD_LIBRARY_PATH" >>/etc/profile',"echo /usr/lib/oracle/11.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf","ldconfig"]},{type:"text",isOverStriking:!0,content:"注：归档日志相关指标需要配置后才可以采集到；"},{type:"text",isOverStriking:!0,content:"注：asm相关指标需要配置后才可以采集到；"},{type:"text",isOverStriking:!0,content:"注：rac下指标需要rac集群才可以采集到；"}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"是否必填",key:"isRequired",align:"left",minWidth:"80px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"service",meaning:"oracle 服务id",isRequired:"是",example:"orcl"},{params_name:"user",meaning:"oracle用户",isRequired:"是",example:"user"},{params_name:"password",meaning:"oracle密码",isRequired:"是",example:"123456"},{params_name:"host",meaning:"oracle ip地址",isRequired:"是",example:"127.0.0.1"},{params_name:"port",meaning:"oracle端口",isRequired:"是",example:"1521"},{params_name:"asm_service",meaning:"asm服务id",isRequired:"是",example:"asmorcl"},{params_name:"port",meaning:"oracle端口",isRequired:"是",example:"1521"},{params_name:"asm_user",meaning:"asm用户名",isRequired:"是",example:"asm用户名"},{params_name:"asm_password",meaning:"asm密码",isRequired:"是",example:"123456"},{params_name:"instance_ip_list",meaning:"RAC下oracle ip列表地址",isRequired:"是",example:"127.0.0.1,127.0.0.2"},{params_name:"instance_vip_list",meaning:"RAC下oracle Virtual ip列表",isRequired:"是",example:"127.0.0.3,127.0.0.4"},{params_name:"is_rac",meaning:"是否是RAC，yes or no",isRequired:"否",example:"no"},{params_name:"loglevel",meaning:"日志等级，debug,info,error",isRequired:"否",example:"error"},{params_name:"web.listen-address",meaning:"exporter监听地址",isRequired:"否",example:":9601"},{params_name:"is_deadlock",meaning:"是否采集死锁指标，默认为no。yes表示采集",isRequired:"否",example:"no/yes"}]}]}]},mysql:{title:"数据库-mysql",content:[{text:"版本支持：插件支持linux、windows操作系统",children:[{type:"text",content:"支持版本：理论上可支持MySQL >= 5.6、MariaDB >= 5.5"},{type:"text",content:"（实测支持MySQL 5.7.33\\8.0.26 ;MariaDB 5.5.68）"}]},{text:"使用指引",children:[{type:"text",content:"登录mysql并执行如下命令为你的MySQL创建蓝鲸监控账号的访问权限："},{type:"code",content:['CREATE USER "用户名"@"localhost" IDENTIFIED BY "你的密码" WITH MAX_USER_CONNECTIONS 3;','GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO "用户名"@"localhost";"']},{type:"text",content:"你可以通过以下指令，查看用户是否创建成功，且权限是否正确："},{type:"code",content:['mysql -u 用户名 --password=你的密码 -e "show global status" | \\','grep Uptime && echo -e "MySQL 授权成功！" || \\','echo -e "无法连接至MySQL，请确认配置是否正确！"','mysql -u 用户名 --password=你的密码 -e "show slave status" && \\','echo -e "MySQL 授权成功！" || \\','echo -e "无法访问slave信息，请确认REPLICATION CLIENT权限是否正常授予！"']},{type:"text",content:"**注：用户名中请不要使用冒号【:】 **"}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"是否必填",key:"isRequired",align:"left",minWidth:"80px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"host",meaning:"监听的IP，提供给采集器使用",isRequired:"否",example:"127.0.0.1"},{params_name:"port",meaning:"监听的端口，提供给采集器使用",isRequired:"否",example:"9601"},{params_name:"user",meaning:"mysql用户名",isRequired:"是",example:"root"},{params_name:"password",meaning:"mysql密码，根据环境变量获取，或直接使用",isRequired:"是",example:"123456"},{params_name:"host",meaning:"主机ip",isRequired:"是",example:"127.0.0.1"},{params_name:"port",meaning:"数据库端口",isRequired:"是",example:"3306"},{params_name:"dbname",meaning:"数据库名",isRequired:"是",example:"mysql"},{params_name:"web.listen-address",meaning:"监听id及端口地址",isRequired:"否",example:"127.0.0.1:9601"},{params_name:"timeout",meaning:"查询超时时间",isRequired:"否",example:"60（单位是s）"}]}]}]},mssql:{title:"数据库-mssql",content:[{text:"版本支持",children:[{type:"text",content:"系统支持：Linux、Windows"},{type:"text",content:"版本支持：Mssql2019向下兼容"}]},{text:"使用指引",children:[{type:"text",content:"根据微软指引创建mssql服务实例，之后对对应需求参数进行填写即可运行"},{type:"text",content:"进行操作时需要提供mssql的帐号密码，如果权限不足可以申请对应需求的表的权限，操作如下："},{type:"code",content:["# 0. 创建用户","use master","EXEC sp_addlogin 'username', '1qaz@WSX', 'master'","# 1. 授予username看到所有数据库的权限","USE [master]","GO","GRANT VIEW ANY DATABASE TO [username]","# 2. 授予username对所有数据库的public访问权限","EXEC sp_MSforeachdb 'use[*] CREATE USER [username] FOR LOGIN [username]',@replacechar = '*'\n","# 3. 授予username查看实例状态权限","USE [master]","GO","GRANT VIEW SERVER STATE TO [username]","# 4. 授予ovuser查看所有定义权限","USE [master]","GO","GRANT VIEW ANY DEFINITION TO [username]","GO","# 5.授予username查看作业状态权限","use master","GRANT select ON sys.dm_hadr_availability_group_states to username","GRANT select ON sys.dm_os_sys_memory to username","GRANT select ON sys.dm_os_performance_counters to username","GRANT select ON sysperfinfo to username\n"]}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"是否必填",key:"isRequired",align:"left",minWidth:"80px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"host",meaning:"监听的IP，提供给采集器使用",isRequired:"否",example:"127.0.0.1"},{params_name:"port",meaning:"监听的端口，提供给采集器使用",isRequired:"否",example:"9601"},{params_name:"host",meaning:"mssql服务ip",isRequired:"是",example:"127.0.0.1"},{params_name:"port",meaning:"端口",isRequired:"是",example:"1433"},{params_name:"user",meaning:"采集目标的用户名,默认为空",isRequired:"是",example:"sa"},{params_name:"port",meaning:"数据库端口",isRequired:"是",example:"3306"},{params_name:"password",meaning:"采集目标认证密码，默认为空",isRequired:"是",example:"1qaz@WSX"},{params_name:"web.listen-address",meaning:"exporter监听的url，提供给采集器使用",isRequired:"否",example:"127.0.0.1:9601"}]}]}]},redis:{title:"数据库-redis",content:[{text:"版本支持",children:[{type:"text",content:"Linux实测：centos7、centos6"},{type:"text",content:"Windows实测：windows7、windows10"},{type:"text",content:"实测支持：redis 5.0.13"},{type:"text",content:"理论支持：redis 5.x 理论上可支持redis 3.x，4.x，5.x及其他可用redis info命令查询到redis信息的版本"}]},{text:"使用指引",children:[{type:"text",content:"采集器将定期使用命令redis info 获取相关监控信息"},{type:"text",content:"因此请确保设置的 redis 用户可以使用该命令获取到祥光信息"}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"是否必填",key:"isRequired",align:"left",minWidth:"80px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"username",meaning:"用户名，redis 5.x以上使用，没有不填，默认为空",isRequired:"否",example:"user"},{params_name:"password",meaning:"密码，没有不填，默认为空",isRequired:"否",example:"123456"},{params_name:"host",meaning:"redis ip地址",isRequired:"是",example:"127.0.0.1"},{params_name:"port",meaning:"端口号",isRequired:"是",example:"6379"}]},{type:"text",content:'参数为空时，应当填上""(英文双引号)'},{type:"text",content:'用户名或密码中含有特殊字符时，应当加上""(英文双引号)\n'}]}]},k8s_cluster:{title:"K8S集群",content:[{text:"使用指引",children:[{type:"text",content:"K8S集群监控是将K8S集群下的pod和node纳入监控中，实时呈现其运行状态和关键监控数据。"}]},{text:"配置说明",children:[{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途，已默认填写，可修改","监控目标：选择需要监控的K8S集群，若无可新增","采集频率：默认为5分钟，可修改","下载并安装监控插件包：点击下载监控插件包，并运行页面命令进行安装"]},{type:"code",content:["（1）若集群可以使用公网镜像源时，解压安装包，进行安装即可","tar -zxvf weops-kubernetes.tgz","helm install weops-collecter weops-kubenetes-discovery-3.11.0.tgz -n weops --create-namespace --set remoteWrtieUrl=http://$(接收数据的Prometheus IP，一版为weops的appt ip):$(接收数据的Prometheus端口，一般为9093)/api/v1/write\n","","（2）若不能使用公网镜像源时，需要先手动导入镜像并推送到私有仓库中，当集群不能使用公网镜像源时，需要手动导入镜像并推送到私有仓库中，压缩包里附带了需要用到的镜像文件，kube-state-metrics.tgz，node_exporter.tgz，cadvisor.tgz，prometheus.tgz","需要在helm install时指定本地仓库镜像helm install weops-collecter weops-kubenetes-discovery-3.11.0.tgz -n weops --create-namespace \\","--set remoteWrtieUrl=http://$(接收数据的Prometheus IP，一般为weops的appt ip):$(接收数据的Prometheus端口，一般为9093)/api/v1/write \\","--set image.repository=$(prometheus的私有仓库，如10.10.10.10:5000\\prometheus) \\","--set kube-state-metrics.image.repository=$(kube-state-metrics的私有仓库，如10.10.10.10:5000\\kube-state-metrics) \\","--set cadvisor-exporter.image=$(cadvisor的私有仓库，如10.10.10.10:5000\\cadvisor):latest \\","--set node-exporter.image=$(node-exporter的私有仓库，如.10.10.10:5000\\cadvisor):latest"]}]}]},apache:{title:"中间件-apache",content:[{text:"使用指引",children:[{type:"text",content:"确保 mod_status 已安装"},{type:"code",content:["请务必确认mod_status模块已安装到您的Apache服务器上，并且ExtendedStatus被设置为 ON。"]},{type:"text",content:"配置示例："},{type:"code",content:["ExtendedStatus On","","SetHandler server-status","Order deny,Allow","Deny from all # 表示禁止任何来源访问","Allow from 127.0.0.1 # 表示只允许本机访问"]}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"--telemetry.address",meaning:"exporter监听的IP和端口，提供给采集器使用",isRequired:"否",example:"127.0.0.1:9110"},{params_name:"SCRAPE_HOST",meaning:"采集目标的主机IP，默认为localhost",isRequired:"否",example:"127.0.0.1"},{params_name:"SCRAPE_PORT",meaning:"采集目标的端口,默认为80",isRequired:"是",example:"80"},{params_name:"SCRAPE_PATH",meaning:"采集目标的路径",isRequired:"是",example:"server-status?auto"},{params_name:"SCRAPE_USER",meaning:"采集目标认证用户名，没有就为空",isRequired:"是",example:"test"},{params_name:"SCRAPE_PASSWORD",meaning:"采集目标认证密码，没有就为空",isRequired:"是",example:"test123"}]},{type:"text",content:"如上配置所示，采集器将会根据你配置的内容，定期在本地访问"},{type:"code",content:["http://${SCRAPE_USER}:${SCRAPE_PASSWORD}@${SCRAPE_HOST}:${SCRAPE_PORT}/${SCRAPE_PATH}"]},{type:"text",content:"以获取Apache的指标数据。"}]}]},nginx:{title:"中间件-nginx",content:[{text:"使用指引",children:[{type:"text",content:"确保 http_stub_status_module 已安装"},{type:"code",content:["请务必确认 http_stub_status_module 模块已安装到您的NginX服务器上。"]},{type:"text",content:"检查是否安装："},{type:"text",content:"您可以通过以下指令来检查，当前版本的 NGINX 是否支持："},{type:"code",content:["nginx -V |& grep http_stub_status_module"]},{type:"text",content:"若出现"},{type:"code",content:["configure arguments:"]},{type:"text",content:"并且后面接的一连串参数中，能够找到该模块名，即已支持。"},{type:"text",content:"配置示例："},{type:"text",content:"确认http状态模块可用后，可以通过如下配置，确定 URL 地址："},{type:"code",content:["server {","listen 80;\n","server_name localhost;","","allow 127.0.0.1; # 表示只允许本机访问","deny all; # 表示禁止任何来源访问","","location /nginx_status {","stub_status on;","}","}"]}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"web.listen-address",meaning:"exporter监听的url，提供给采集器使用",isRequired:"否",example:"127.0.0.1:9602"},{params_name:"SCRAPE_HOST",meaning:"采集目标的主机IP，默认为localhost",isRequired:"否",example:"127.0.0.1"},{params_name:"SCRAPE_PORT",meaning:"采集目标的端口,默认为80",isRequired:"是",example:"80"},{params_name:"SCRAPE_USER",meaning:"采集目标认证用户名，没有就为空",isRequired:"是",example:"test"},{params_name:"SCRAPE_PASSWORD",meaning:"采集目标认证密码，没有就为空",isRequired:"是",example:"test123"},{params_name:"SCRAPE_PATH",meaning:"采集目标的路径",isRequired:"是",example:"nginx_status"}]},{type:"text",content:"采集器将会根据你配置的内容，定期在本地访问"},{type:"code",content:["http://${SCRAPE_USER}:${SCRAPE_PASSWORD}@${SCRAPE_HOST}:${SCRAPE_PORT}/${SCRAPE_PATH"]},{type:"text",content:"以获取NginX的指标数据。"}]}]},tomcat:{title:"中间件-tomcat",content:[{text:"版本支持",children:[{type:"text",content:"系统支持： Linux/Windows"},{type:"text",content:"版本支持: Tomcat/7.0.76"},{type:"text",content:"本版本支持密码强类型"}]},{text:"使用指引",children:[{type:"text",content:"如果采集器运行异常，根据指定账号密码和端口，设置日志级别为debug观察日志是否有相关报错确认是否有问题"},{type:"text",content:"./tomcat_exporter -host $host -user $user -password $paasword -port $port -logLevel debug\n"}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"host_ip",meaning:"主机ip",isRequired:"否",example:"127.0.0.1"},{params_name:"port",meaning:"端口",isRequired:"否",example:"10020"},{params_name:"jmx_url",meaning:"连接字符串",isRequired:"是",example:"service:jmx:rmi:///jndi/rmi://10.11.29.13:9999/jmxrmi"},{params_name:"user",meaning:"tomcat用户名",isRequired:"是",example:"admin"},{params_name:"password",meaning:"tomcatl密码，根据环境变量获取，或直接使用",isRequired:"是",example:"123456"}]}]}]},iis:{title:"中间件-IIS",content:[{text:"支持版本",children:[{type:"text",content:"该插件支持在Windows Server versions 2008R2 以后，和desktop Windows version 7 以后的Windows操作系统版本运行"}]},{text:"配置说明",children:[{type:"table",tableHeader:[{label:"参数名",key:"params_name",align:"left",minWidth:"80px"},{label:"含义",key:"meaning",align:"left",minWidth:"100px"},{label:"使用举例",key:"example",align:"left",minWidth:"80px"}],tableList:[{params_name:"-web.listen-address",meaning:"exporter监听的url，提供给采集器使用",isRequired:"否",example:"127.0.0.1:9602"}]}]},{text:"采集原理",children:[{type:"text",content:"说明采集的原理过程，可以更好的方便使用"},{type:"text",content:"如：采集器将定期访问 http://127.0.0.1/server-status 以获取IIS的指标数据。"}]}]},VMware:{title:"云平台-vmware",content:[{text:"使用指引",children:[{type:"text",content:"VMware监控用于对虚拟机、数据存储和ESXI监控状态的采集和呈现，设置合理的监控可以实时了解系统业务的运行情况，提前发现问题，避免可能会出现的业务故障"},{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途","VCenter：展示WeOps已经纳管的VCenter，通过VCenter的监控采集，可以采集VCenter下虚拟机、ESXI、数据存储的监控情况。若无监控采集对象，请先添加资产，并通过自动发现采集VCenter下虚拟机、ESXI、数据存储的相关资产的配置信息","凭据：选择与VCenter关联的凭据，若无可新建","采集频率：默认为5分钟，可修改"]}]}]},aliyun:{title:"云平台-阿里云",content:[{text:"使用指引",children:[{type:"text",content:"阿里云平台监控用于对云服务器ECS监控状态的采集和呈现，设置合理的监控可以实时了解系统业务的运行情况，提前发现问题，避免可能会出现的业务故障"}]},{text:"配置说明",children:[{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途","云账户：阿里云ECS的集合，选择对应云账户，则该云账户关联的ECS均可采集监控数据。若无监控采集对象，请先添加资产，并通过自动发现采集云账号下的ECS","凭据：选择与云账户关联的凭据，若无可新建","采集频率：默认为5分钟，可修改"]}]}]},qcloud:{title:"云平台-腾讯云",content:[{text:"使用指引",children:[{type:"text",content:"腾讯云平台监控用于对云服务器CVM监控状态的采集和呈现，设置合理的监控可以实时了解系统业务的运行情况，提前发现问题，避免可能会出现的业务故障"},{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途","云账户：腾讯云CVM的集合，选择对应云账户，则该云账户关联的CVM均可采集监控数据。若无监控采集对象，请先添加资产，并通过自动发现采集云账号下CVM","凭据：选择与云账户关联的凭据，若无可新建","采集频率：默认为5分钟，可修改"]}]}]},mo_server:{title:"云平台-华为云-ManageOne",content:[{text:"使用指引",children:[{type:"text",content:"ManageOne监控用于ManageOne平台下的云服务器监控状态采集和呈现，设置合理的监控可以实时了解系统业务的运行情况，提前发现问题，避免可能会出现的业务故障"},{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途","ManageOne平台：展示WeOps已经纳管的ManageOne平台，通过ManageOne平台的监控采集，可以采集其下云服务器的监控情况。若无监控采集对象，请先添加资产，并通过自动发现采集云服务器的相关配置信息","凭据：选择与ManageOne平台关联的凭据，若无可新建","采集频率：默认为5分钟，可修改"]}]}]},web:{title:"网站监测",content:[{text:"使用指引",children:[{type:"text",content:"网站服务拨测是探测服务（应用）可用性的监控方式，通过拨测节点对目标服务进行周期性探测，主要通过可用性和响应时间来度量服务（应用）的状态"}]},{text:"配置说明",children:[{type:"list",content:["任务名称：采集项的名称，表示该数据采集的用途","协议： HTTP(包含HTTPS, GET和POST方法）、TCP、UDP、ICMP","目标业务：网站对应的应用","目标地址：需要进行拨测的网站地址","拨测节点：当没有现成可用的拨测节点时，需要先创建至少1个状态正常的拨测节点才可以添加拨测任务。新增节点需选取主机、地区、运营商并填写节点名称","超时设置：默认为3000ms，可修改。超过该时长未正常采集数据时，系统判断该任务状态为不可用状态","高级选项：支持设置请求周期、期待返回码、期待响应信息、SSL证书协议等"]}]}]},bk_switch:{title:"网络设备-交换机",content:[{text:"使用指引",children:[{text:"交换机监控是交换机纳入监控中，实时呈现其运行状态和关键监控数据。"}]},{text:"配置说明",children:[{text:"任务名称：采集项的名称，表示该数据采集的用途，已默认填写，可修改"},{text:"采集频率：默认为1分钟，暂时不支持修改"},{text:"接入点：用于不同网络区域的网络设备采集"},{text:"监控目标：选择需要监控的交换机，若无可新增资产",children:["选择指标模板：选择该交换机适用的监控指标模板，后续将会按照该指标模板进行监控数据的采集和呈现","填写凭据：可选择该交换机已关联的凭据，或新建凭据"]}]}]},bk_router:{title:"网络设备-路由器",content:[{text:"使用指引",children:[{text:"路由器监控是路由器纳入监控中，实时呈现其运行状态和关键监控数据。"}]},{text:"配置说明",children:[{text:"任务名称：采集项的名称，表示该数据采集的用途，已默认填写，可修改"},{text:"采集频率：默认为1分钟，暂时不支持修改"},{text:"接入点：用于不同网络区域的网络设备采集"},{text:"监控目标：选择需要监控的路由器，若无可新增资产",children:["选择指标模板：选择该路由器适用的监控指标模板，后续将会按照该指标模板进行监控数据的采集和呈现","填写凭据：可选择该路由器已关联的凭据，或新建凭据"]}]}]},bk_firewall:{title:"网络设备-防火墙",content:[{text:"使用指引",children:[{text:"防火墙监控是防火墙纳入监控中，实时呈现其运行状态和关键监控数据。"}]},{text:"配置说明",children:[{text:"任务名称：采集项的名称，表示该数据采集的用途，已默认填写，可修改"},{text:"采集频率：默认为1分钟，暂时不支持修改"},{text:"接入点：用于不同网络区域的网络设备采集"},{text:"监控目标：选择需要监控的防火墙，若无可新增资产",children:["选择指标模板：选择该防火墙适用的监控指标模板，后续将会按照该指标模板进行监控数据的采集和呈现","填写凭据：可选择该防火墙已关联的凭据，或新建凭据"]}]}]},bk_loadbalance:{title:"网络设备-负载均衡",content:[{text:"使用指引",children:[{text:"负载均衡监控是负载均衡纳入监控中，实时呈现其运行状态和关键监控数据。"}]},{text:"配置说明",children:[{text:"任务名称：采集项的名称，表示该数据采集的用途，已默认填写，可修改"},{text:"采集频率：默认为1分钟，暂时不支持修改"},{text:"接入点：用于不同网络区域的网络设备采集"},{text:"监控目标：选择需要监控的防火墙，若无可新增资产",children:["选择指标模板：选择该负载均衡适用的监控指标模板，后续将会按照该指标模板进行监控数据的采集和呈现","填写凭据：可选择该负载均衡已关联的凭据，或新建凭据"]}]}]}},Rt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),qt=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.typeMap=Et,e.isExpand=!1,e.isExit=!1,e}return Rt(e,t),e.prototype.mounted=function(){this.typeMap[this.type]&&(this.isExit=!0)},qt([Object(f.d)({type:String,default:function(){return""}})],e.prototype,"type",void 0),qt([Object(f.d)({type:Boolean,default:function(){return!0}})],e.prototype,"needMove",void 0),e=qt([Object(f.a)({name:"introduce-info",components:{ComTable:st.a}})],e)}(f.e),Ft=zt,Ht=Ft,Bt=Object(u.a)(Ht,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isExit?i("div",{class:["introduce-info",t.needMove&&"move-position",!t.isExpand&&"hide-border"]},[i("div",{staticClass:"info-content",style:{width:t.isExpand?"375px":0}},[t.isExpand?i("div",{staticClass:"title"},[t._v(t._s(t.typeMap[t.type].title))]):t._e(),t._v(" "),t.isExpand?i("div",{staticClass:"show-content"},[["host","bk_router","bk_switch","bk_firewall","bk_loadbalance"].includes(t.type)?i("div",{staticClass:"host-type"},t._l(t.typeMap[t.type].content,(function(e,n){return i("div",{key:n},[i("div",{staticClass:"show-title mb10"},[t._v(t._s(e.text))]),t._v(" "),t._l(e.children,(function(e,n){return i("div",{key:n},[i("div",{staticClass:"first-level"},[i("span",{staticClass:"black-tag"}),t._v(" "),i("span",[t._v(t._s(e.text))])]),t._v(" "),e.children?i("div",t._l(e.children,(function(e,n){return i("div",{key:n,staticClass:"second-level"},[i("span",{staticClass:"tag"}),t._v(" "),i("span",[t._v(t._s(e))])])})),0):t._e()])}))],2)})),0):i("div",{staticClass:"sql-type"},t._l(t.typeMap[t.type].content,(function(e,n){return i("div",{key:n,staticClass:"first-level"},[i("div",{staticClass:"show-title"},[t._v(t._s(e.text))]),t._v(" "),t._l(e.children,(function(e,n){return i("div",{key:n,staticClass:"second-level"},["table"===e.type?i("com-table",{ref:"sourceTable",refInFor:!0,attrs:{id:"center_table",data:e.tableList,columns:e.tableHeader}}):"code"===e.type?i("div",{staticClass:"code-box"},t._l(e.content,(function(e,n){return i("div",{key:n,staticClass:"code-list"},[i("div",{staticClass:"index"},[t._v(t._s(n+1))]),t._v(" "),i("div",{staticClass:"text"},[t._v(t._s(e))])])})),0):"downLoad"===e.type?i("div",{domProps:{innerHTML:t._s(e.content)}}):"list"===e.type?i("div",{staticClass:"list-box"},t._l(e.content,(function(e,n){return i("div",{key:n,staticClass:"mb5"},[i("span",{staticClass:"black-tag"}),t._v(" "),i("span",[t._v(t._s(e))])])})),0):i("span",{class:[e.isOverStriking&&"over-striking"]},[t._v(t._s(e.content))])],1)}))],2)})),0)]):t._e()]),t._v(" "),i("div",{staticClass:"set-btn",on:{click:function(e){t.isExpand=!t.isExpand}}},[i("bk-icon",{attrs:{type:t.isExpand?"angle-double-right":"angle-double-left"}}),t._v(" "),i("div",[t._v("配置说明")])],1)]):t._e()}),[],!1,null,"7067172c",null),Vt=Bt.exports,Wt=i("JcrP"),Gt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ut=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Kt=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Yt=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentInstallWay="longDistance",e.uploadFiles="",e.formData={business:"",cloudArea:"",accessPoint:"",hostId:""},e.batchEditVisible=!1,e.batchEditObj={},e.batchEditValue="",e.rules={business:[{required:!0,message:"必填项",trigger:"blur"}],cloudArea:[{required:!0,message:"必填项",trigger:"blur"}],accessPoint:[{required:!0,message:"必填项",trigger:"blur"}]},e.installColumns=[{key:"ip",label:"IP地址",isRequire:!0,isNeedTip:!1,isAllowEdit:!1,isShow:!0,isHandMovement:!0,width:"120px"},{key:"business",label:"业务",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"select",isShow:!0,isExcelColumn:!0,options:[],optionsMap:"businessData"},{key:"cloudArea",label:"云区域",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"select",isShow:!0,isExcelColumn:!0,options:[],optionsMap:"cloudArea"},{key:"accessPoint",label:"接入点",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"select",isShow:!0,isExcelColumn:!0,options:[],optionsMap:"accessPoint"},{key:"operateSystem",label:"操作系统",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"select",isShow:!0,isHandMovement:!0,options:[{id:"LINUX",name:"Linux"},{id:"WINDOWS",name:"Windows"},{id:"AIX",name:"AIX"}]},{key:"loginPort",label:"登录端口",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"input",isShow:!0},{key:"loginAccount",label:"登录账号",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"input",isShow:!0},{key:"authWay",label:"认证方式",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,tip:"密钥方式仅对Linux/AIX系统生效",type:"select",isShow:!0,options:[{id:"PASSWORD",name:"密码"},{id:"KEY",name:"密钥"}]},{key:"password",label:"密码/密钥",isRequire:!0,isNeedTip:!1,isAllowEdit:!0,type:"input",isPassword:!0,isShow:!0},{key:"loginIp",label:"登录IP",isRequire:!1,isNeedTip:!1,isAllowEdit:!1,type:"input",width:"110px",isShow:!0,isHandMovement:!0},{key:"nodeDetection",label:"BT节点探测",isRequire:!1,isNeedTip:!0,isAllowEdit:!0,type:"bool",width:"105px",isShow:!0,isHandMovement:!0},{key:"speedLimit",label:"传输限速",isRequire:!1,isNeedTip:!1,isAllowEdit:!0,type:"input-slot",width:"135px",isShow:!0,isHandMovement:!0}],e.installData={ip:{type:"input",value:"",errorMsg:!1,isRequired:!0,cname:"IP地址",defaultValue:""},operateSystem:{type:"select",value:"LINUX",errorMsg:!1,isRequired:!0,list:[{id:"LINUX",name:"Linux"},{id:"WINDOWS",name:"Windows"},{id:"AIX",name:"AIX"}],cname:"操作系统",defaultValue:""},loginPort:{type:"input",value:"22",isDisabled:!1,errorMsg:!1,isRequired:!0,cname:"登录端口",defaultValue:""},loginAccount:{type:"input",value:"root",errorMsg:!1,isRequired:!0,cname:"登录账号",defaultValue:""},authWay:{type:"select",value:"PASSWORD",list:[{id:"PASSWORD",name:"密码"},{id:"KEY",name:"密钥"}],errorMsg:!1,isRequired:!0,cname:"认证方式",defaultValue:""},password:{type:"input",isPassword:!0,value:"",errorMsg:!1,isRequired:!0,cname:"密码/密钥",defaultValue:""},loginIp:{type:"input",value:"",errorMsg:!1,cname:"登录IP",defaultValue:""},nodeDetection:{type:"bool",value:"",cname:"BT节点探测",defaultValue:!1},speedLimit:{type:"input-slot",value:"",errorMsg:!1,cname:"传输限速",defaultValue:100},id:"",business:{type:"select",list:[],errorMsg:!1,isRequired:!0,listMap:"businessData",value:"",cname:"业务",defaultValue:""},cloudArea:{type:"select",list:[],errorMsg:!1,isRequired:!0,listMap:"cloudArea",value:"",cname:"云区域",defaultValue:""},accessPoint:{type:"select",list:[],errorMsg:!1,isRequired:!0,listMap:"accessPoint",value:"",cname:"接入点",defaultValue:""},hostId:"",uploadFileKey:{value:"",cname:""}},e.excelColumns=[{key:"business",id:"bk_biz_id",name:"bk_biz_name"},{key:"cloudArea",id:"bk_cloud_id",name:"bk_cloud_name"},{key:"accessPoint",id:"id",name:"name"}],e.installList=[],e.footBtnMap={INSTALL_AGENT:"安装",REINSTALL_AGENT:"重装",RELOAD_AGENT:"重载配置",UNINSTALL_AGENT:"卸载"},e.reInstallData={},e.uploadExcelData=[],e.isImportCompleted=!1,e}return Gt(e,t),Object.defineProperty(e.prototype,"notAllowDel",{get:function(){return 1===this.installList.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInstallAgent",{get:function(){return"INSTALL_AGENT"===this.agentMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showColumns",{get:function(){var t=this;return this.installColumns.filter((function(e){return t.isExcelInstall?e.isShow:e.isShow&&!e.isExcelColumn}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"handMovementColumns",{get:function(){return this.installColumns.filter((function(t){return t.isHandMovement}))},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){var t=this;this.excelColumns.forEach((function(e){for(var i in t.installColumns.forEach((function(i){i.key===e.key&&(i.options=t[i.optionsMap].map((function(t){return{id:t[e.id],name:t[e.name]}})))})),t.installData)i===e.key&&(t.installData[i].list=t[t.installData[i].listMap].map((function(t){return{id:t[e.id],name:t[e.name]}})))})),this.addInstallList()},e.prototype.goBack=function(){this.setCurrentMode()},e.prototype.importData=function(){if(!this.uploadExcelData.length)return this.$warn("当前模板无数据，请重新上传!"),!1;this.isImportCompleted=!0,this.installList=this.uploadExcelData},e.prototype.previous=function(){this.isImportCompleted=!1,this.uploadExcelData=[],this.installList=[],this.uploadFiles=""},e.prototype.handleUploadKey=function(t,e){return Kt(this,void 0,void 0,(function(){var i;return Yt(this,(function(n){switch(n.label){case 0:return[4,this.readFile(t.fileList[0].origin)];case 1:return i=n.sent(),e.uploadFileKey.value=i,e.uploadFileKey.cname=t.fileList[0].name,e.password.value=i,[2]}}))}))},e.prototype.deleteUploadKey=function(t){t.uploadFileKey.value="",t.uploadFileKey.cname="",t.password.value=""},e.prototype.handleUpload=function(t){return Kt(this,void 0,void 0,(function(){var e,i,n,r,o,a,s=this;return Yt(this,(function(l){switch(l.label){case 0:return this.uploadFiles=t.fileList[0],[4,this.readFile(this.uploadFiles.origin)];case 1:for(e=l.sent(),i=Wt.a(e,{type:"binary"}),n=i.Sheets[i.SheetNames[0]],r=Wt.b.sheet_to_json(n),o=1;o<=r.length;o++)(a=f.e.prototype.$deepClone(this.installData)).id=f.e.prototype.$random(5),this.uploadExcelData.push(a);return r.forEach((function(t,e){var i,n=function(n){if("object"==typeof s.uploadExcelData[e][n]){var r=t[s.uploadExcelData[e][n].cname];"select"===s.uploadExcelData[e][n].type&&(r=null===(i=s.uploadExcelData[e][n].list.find((function(t){return t.name===r})))||void 0===i?void 0:i.id),s.uploadExcelData[e][n].value=[0,!1].includes(r)?r:r||s.uploadExcelData[e][n].defaultValue}};for(var r in s.uploadExcelData[e])n(r)})),[2]}}))}))},e.prototype.deleteFile=function(){this.uploadFiles=""},e.prototype.readFile=function(t){return new Promise((function(e){var i=new FileReader;i.readAsBinaryString(t),i.onload=function(t){e(t.target.result)}}))},e.prototype.downTemplate=function(){window.open(window.STATIC_URL+"templates/bk_nodeman_info.xlsx")},e.prototype.verifyForm=function(t){this.$set(t,"errorMsg",""===t.value.trim())},e.prototype.hideErrorIcon=function(t){this.$set(t,"errorMsg",!1)},e.prototype.confirmBatchEdit=function(){var t=this;this.installList.forEach((function(e){e[t.batchEditObj.key].value=t.batchEditValue})),this.cancelBatchEdit()},e.prototype.cancelBatchEdit=function(){this.batchEditVisible=!1},e.prototype.batchEdit=function(t){this.batchEditVisible=!0,this.batchEditObj=t,"bool"===t.type?this.batchEditValue=!1:this.batchEditValue=""},e.prototype.getReInstallData=function(t){var e=this;this.reInstallData=t;var i=t.length-this.installList.length;if(t.length>this.installList.length)for(var n=1;n<=i;n++){var r=f.e.prototype.$deepClone(this.installData);r.id=f.e.prototype.$random(5),this.installList.push(r)}t.forEach((function(t,i){e.installList[i].ip.value=t.inner_ip||"",e.installList[i].business.value=t.bk_biz_id,e.installList[i].cloudArea.value=t.bk_cloud_id,e.installList[i].accessPoint.value=t.ap_id,e.installList[i].hostId=t.bk_host_id,e.installList[i].operateSystem.value=t.os_type||"",e.installList[i].loginIp.value=t.login_ip||"",e.installList[i].loginPort.value=t.identity_info.port,e.installList[i].loginAccount.value=t.identity_info.account||"",e.installList[i].authWay.value=t.identity_info.auth_type||"",e.installList[i].speedLimit.value=t.extra_data.bt_speed_limit||100,e.installList[i].nodeDetection.value=1===t.extra_data.peer_exchange_switch_for_agent}))},e.prototype.confirm=function(){var t=this,e=!0;if(this.installList.forEach((function(i){Object.keys(i).forEach((function(n){var r=!0;!t.isExcelInstall&&["业务","云区域","接入点"].includes(i[n].cname)&&(r=!1);var o=t.installColumns.filter((function(t){return!t.isHandMovement})).map((function(t){return t.label}));"handMovement"===t.currentInstallWay&&o.includes(i[n].cname)&&(r=!1),r&&i[n].isRequired&&(i[n].errorMsg=![0,!1].includes(i[n].value)&&!i[n].value,i[n].errorMsg&&(e=!1))}))})),e){if(["INSTALL_AGENT","REINSTALL_AGENT"].includes(this.agentMode)){if(this.isExcelInstall)return this.getParams(),!1;this.$refs.validateForm.validate().then((function(e){t.getParams()}))}["RELOAD_AGENT","UNINSTALL_AGENT"].includes(this.agentMode)&&this.getParams()}},e.prototype.getParams=function(){var t=this,e={jobType:this.agentMode,hosts:[]};e.hosts=this.installList.map((function(e){var i={};return i="longDistance"===t.currentInstallWay?{bk_cloud_id:e.cloudArea.value,ap_id:e.accessPoint.value,bk_biz_id:e.business.value,os_type:e.operateSystem.value||"",inner_ip:e.ip.value||"",account:e.loginAccount.value||"",port:e.loginPort.value||"",auth_type:e.authWay.value||"",password:"PASSWORD"===e.authWay.value?e.password.value:"",key:"KEY"===e.authWay.value?e.password.value:"",bt_speed_limit:e.speedLimit.value||100,peer_exchange_switch_for_agent:e.nodeDetection.value?1:0}:{bk_cloud_id:e.cloudArea.value,ap_id:e.accessPoint.value,bk_biz_id:e.business.value,os_type:e.operateSystem.value||"",inner_ip:e.ip.value||"",login_ip:e.loginIp.value||"",account:"root",is_manual:!0,port:22,auth_type:"PASSWORD",bt_speed_limit:e.speedLimit.value||100,peer_exchange_switch_for_agent:e.nodeDetection.value?1:0},"INSTALL_AGENT"===t.agentMode?t.isExcelInstall||(i.bk_cloud_id=t.formData.cloudArea,i.ap_id=t.formData.accessPoint,i.bk_biz_id=t.formData.business):i.bk_host_id=e.hostId||0,i.login_ip=e.loginIp.value||e.ip.value,i})),this.operateAgent(e)},e.prototype.changeSelect=function(t,e){if("operateSystem"===e.key){var i="WINDOWS"===t.operateSystem.value,n=[{id:"PASSWORD",name:"密码"},{id:"KEY",name:"密钥"}];t.loginPort.value=i?"445":"22",t.loginPort.isDisabled=i,t.loginAccount.value=i?"Administrator":"root",t.password.list=i?[n[0]]:n,t.password.value="PASSWORD"}"authWay"===e.key&&(t.password.value="",t.uploadFileKey.value="",t.uploadFileKey.cname="")},e.prototype.addInstallList=function(){if(!this.isExcelInstall){var t=f.e.prototype.$deepClone(this.installData);t.id=f.e.prototype.$random(5),this.installList.push(t)}},e.prototype.delInstallList=function(t){if(this.notAllowDel)return!1;this.installList.splice(t,1)},e.prototype.cancel=function(){this.setCurrentMode()},e.prototype.setCurrentMode=function(){return""},e.prototype.operateAgent=function(t){return t},Ut([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"businessData",void 0),Ut([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"cloudArea",void 0),Ut([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"accessPoint",void 0),Ut([Object(f.d)({type:String,default:function(){return""}})],e.prototype,"agentMode",void 0),Ut([Object(f.d)({type:Boolean,default:function(){return!1}})],e.prototype,"isExcelInstall",void 0),Ut([Object(f.b)("setCurrentMode")],e.prototype,"setCurrentMode",null),Ut([Object(f.b)("operateAgent")],e.prototype,"operateAgent",null),e=Ut([Object(f.a)({components:{IntroduceInfo:Vt}})],e)}(f.e),Jt=Xt,Zt=Jt,Qt=Object(u.a)(Zt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"operate-agent"},[i("div",{staticClass:"main-box"},[i("div",{staticClass:"top-action"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}})],1),t._v(" "),t.isExcelInstall?t._e():i("bk-form",{ref:"validateForm",class:["form-box",["INSTALL_AGENT","REINSTALL_AGENT"].includes(t.agentMode)&&"mb20"],attrs:{"label-width":t.isInstallAgent?106:80,model:t.formData,rules:t.rules}},[["INSTALL_AGENT","REINSTALL_AGENT"].includes(t.agentMode)?i("bk-form-item",{attrs:{label:"安装方式",property:"name"}},[i("div",{staticStyle:{display:"flex"}},[i("div",{class:["install-way-btn","longDistance"===t.currentInstallWay&&"install-way-active"],on:{click:function(e){t.currentInstallWay="longDistance"}}},[i("bk-popover",{attrs:{content:"需要提供登录信息，远程完成安装",placement:"top"}},[i("span",[t._v("远程安装")])])],1),t._v(" "),i("div",{class:["install-way-btn","handMovement"===t.currentInstallWay&&"install-way-active"],on:{click:function(e){t.currentInstallWay="handMovement"}}},[i("bk-popover",{attrs:{content:"需要提供登录信息，远程完成安装",placement:"top"}},[i("span",[t._v("手动安装")])])],1)])]):t._e(),t._v(" "),t.isInstallAgent?i("bk-form-item",{attrs:{label:"安装到应用",required:!0,property:"business"}},[i("bk-select",{staticStyle:{width:"480px"},attrs:{searchable:"",placeholder:"选择应用"},model:{value:t.formData.business,callback:function(e){t.$set(t.formData,"business",e)},expression:"formData.business"}},t._l(t.businessData,(function(t){return i("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1)],1):t._e(),t._v(" "),t.isInstallAgent?i("bk-form-item",{attrs:{label:"云区域",required:!0,property:"cloudArea"}},[i("bk-select",{staticStyle:{width:"480px"},attrs:{placeholder:"选择云区域"},model:{value:t.formData.cloudArea,callback:function(e){t.$set(t.formData,"cloudArea",e)},expression:"formData.cloudArea"}},t._l(t.cloudArea,(function(t){return i("bk-option",{key:t.bk_cloud_id,attrs:{id:t.bk_cloud_id,name:t.bk_cloud_name}})})),1)],1):t._e(),t._v(" "),t.isInstallAgent?i("bk-form-item",{attrs:{label:"接入点",required:!0,property:"accessPoint"}},[i("bk-select",{staticStyle:{width:"480px"},attrs:{placeholder:"选择接入点"},model:{value:t.formData.accessPoint,callback:function(e){t.$set(t.formData,"accessPoint",e)},expression:"formData.accessPoint"}},t._l(t.accessPoint,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):t._e()],1),t._v(" "),i("div",{staticClass:"install-info"},[t.isInstallAgent&&!t.isExcelInstall?i("div",{staticClass:"title"},[t._v("安装信息")]):t._e(),t._v(" "),i("div",{staticClass:"info-table-box"},[i("div",{staticClass:"table-header"},[i("div",{staticClass:"columns-box"},t._l("longDistance"===t.currentInstallWay?t.showColumns:t.handMovementColumns,(function(e){return i("div",{key:e.key,staticClass:"column-item",style:{minWidth:e.width||"0"}},[i("span",[e.isNeedTip?i("bk-popover",{attrs:{content:"启用BT节点探测在跨VPC网络可能会占用专线带宽，建议这种场景下关闭该配置",placement:"top"}},[i("span",{staticClass:"label"},[t._v(t._s(e.label))])]):i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(e.label))])],1),t._v(" "),e.isRequire?i("span",{staticClass:"require-icon"},[t._v("*")]):t._e(),t._v(" "),e.isAllowEdit?i("bk-icon",{attrs:{type:"edit"},on:{click:function(i){return t.batchEdit(e)}}}):t._e()],1)})),0),t._v(" "),i("div",{staticClass:"setting-box"})]),t._v(" "),i("div",{staticClass:"table-body",style:{paddingRight:t.isExcelInstall&&!t.isImportCompleted?"15px":0}},[!t.isExcelInstall||t.uploadFiles||t.isImportCompleted?t._e():i("bk-upload",{attrs:{url:"0",limit:1,"ext-cls":"upload-sec",multiple:!1,"with-credentials":!0,accept:".xlsx","custom-request":t.handleUpload}}),t._v(" "),t.uploadFiles&&!t.isImportCompleted?i("div",{staticClass:"upload-file-list"},[i("bk-icon",{staticStyle:{"font-size":"36px"},attrs:{type:"file"}}),t._v(" "),i("div",{staticClass:"file-info"},[i("div",{staticClass:"base-info"},[i("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"hide-text"},[t._v(t._s(t.uploadFiles.name))]),t._v(" "),i("span",[t._v("上传完毕")])]),t._v(" "),i("bk-progress",{attrs:{theme:"success",percent:1,size:"small","show-text":!1}})],1),t._v(" "),i("bk-icon",{staticClass:"close-icon",attrs:{type:"close"},on:{click:t.deleteFile}})],1):t._e(),t._v(" "),t.isExcelInstall&&!t.isImportCompleted?i("div",{staticClass:"upload-tip"},[i("span",[t._v("仅支持 .xlsx 格式的文件，下载")]),t._v(" "),i("span",{staticStyle:{color:"#3a84ff",cursor:"pointer"},on:{click:t.downTemplate}},[t._v("模板文件")])]):t._e(),t._v(" "),t._l(t.installList,(function(e,n){return i("div",{key:e.id,staticClass:"install-list"},[t._l("longDistance"===t.currentInstallWay?t.showColumns:t.handMovementColumns,(function(n){return i("div",{key:n.key+e.id,staticClass:"list-item",style:{minWidth:n.width||"0"}},["textarea"===e[n.key].type?i("bk-input",{attrs:{placeholder:"多IP可用，、空行空格换行分隔",type:"textarea",rows:1},model:{value:e[n.key].value,callback:function(i){t.$set(e[n.key],"value",i)},expression:"item[tex.key].value"}}):"select"===e[n.key].type?i("bk-select",{staticStyle:{width:"100%"},attrs:{clearable:!1,placeholder:"请选择"},on:{change:function(i){return t.changeSelect(e,n)}},model:{value:e[n.key].value,callback:function(i){t.$set(e[n.key],"value",i)},expression:"item[tex.key].value"}},t._l(e[n.key].list,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1):"bool"===e[n.key].type?i("bk-switcher",{attrs:{theme:"primary"},model:{value:e[n.key].value,callback:function(i){t.$set(e[n.key],"value",i)},expression:"item[tex.key].value"}}):"input-slot"===e[n.key].type?i("bk-input",{attrs:{type:"number"},model:{value:e[n.key].value,callback:function(i){t.$set(e[n.key],"value",i)},expression:"item[tex.key].value"}},[i("template",{slot:"append"},[i("div",{staticClass:"group-text"},[t._v("MB/s")])])],2):i("div",["KEY"===e.authWay.value&&"password"===n.key?i("div",[e.uploadFileKey.value?i("div",{staticStyle:{position:"relative"}},[i("span",[t._v(t._s(e.uploadFileKey.cname))]),t._v(" "),i("bk-icon",{staticStyle:{position:"absolute",right:"-4px",top:"-12px"},attrs:{type:"close-circle-shape"},on:{click:function(i){return t.deleteUploadKey(e)}}})],1):i("bk-upload",{attrs:{url:"0",theme:"button",limit:1,"ext-cls":"upload-sec",multiple:!1,"with-credentials":!0,"custom-request":function(i){return t.handleUploadKey(i,e)}}})],1):i("bk-input",{attrs:{"ext-cls":e[n.key].errorMsg&&n.isRequire?"form-input":"",type:e[n.key].isPassword?"password":"text",placeholder:"请输入",disabled:e[n.key].isDisabled},on:{blur:function(i){return t.verifyForm(e[n.key])},focus:function(i){return t.hideErrorIcon(e[n.key])}},model:{value:e[n.key].value,callback:function(i){t.$set(e[n.key],"value",i)},expression:"item[tex.key].value"}})],1),t._v(" "),i("bk-popover",{attrs:{content:"必填项",transfer:!0,placement:"top","ext-cls":"error-icon-popover"}},[n.isRequire&&e[n.key].errorMsg?i("bk-icon",{staticClass:"error-icon",attrs:{type:"exclamation-circle"}}):t._e()],1)],1)})),t._v(" "),i("div",{staticClass:"action-bar"},[t.isInstallAgent&&!t.isExcelInstall?i("bk-icon",{staticClass:"mr5",attrs:{type:"plus-circle"},on:{click:t.addInstallList}}):t._e(),t._v(" "),i("bk-icon",{class:[t.notAllowDel&&"disabled"],attrs:{type:"minus-circle"},on:{click:function(e){return t.delInstallList(n)}}})],1)],2)}))],2)])]),t._v(" "),"INSTALL_AGENT"===t.agentMode?i("introduce-info",{attrs:{type:"host"}}):t._e()],1),t._v(" "),i("div",{staticClass:"footer-box"},[t.isExcelInstall&&!t.isImportCompleted?i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",disabled:!t.uploadFiles},on:{click:t.importData}},[t._v("\n            导入\n        ")]):i("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:t.confirm}},[i("div",{staticClass:"form-btn-install"},[i("span",[t._v(t._s(t.footBtnMap[t.agentMode]))]),t._v(" "),i("span",{staticClass:"num"},[t._v("\n                    "+t._s(t.installList.length)+"\n                ")])])]),t._v(" "),t.isImportCompleted?i("bk-button",{staticClass:"mr10",attrs:{theme:"default",type:"submit",title:"上一步"},on:{click:t.previous}},[t._v("\n            上一步\n        ")]):t._e(),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit",title:"基础按钮"},on:{click:t.cancel}},[t._v("\n            取消\n        ")])],1),t._v(" "),i("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"批量编辑"+t.batchEditObj.label},model:{value:t.batchEditVisible,callback:function(e){t.batchEditVisible=e},expression:"batchEditVisible"}},[i("div",{staticClass:"batch-edit"},[i("div",{staticClass:"batch-body"},[i("div",["select"===t.batchEditObj.type?i("bk-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.batchEditValue,callback:function(e){t.batchEditValue=e},expression:"batchEditValue"}},t._l(t.batchEditObj.options,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1):"bool"===t.batchEditObj.type?i("bk-switcher",{attrs:{theme:"primary"},model:{value:t.batchEditValue,callback:function(e){t.batchEditValue=e},expression:"batchEditValue"}}):"input-slot"===t.batchEditObj.type?i("bk-input",{attrs:{type:"number"},model:{value:t.batchEditValue,callback:function(e){t.batchEditValue=e},expression:"batchEditValue"}},[i("template",{slot:"append"},[i("div",{staticClass:"group-text"},[t._v("MB/s")])])],2):i("bk-input",{attrs:{clearable:"",type:t.batchEditObj.isPassword?"password":"text",placeholder:"请输入"},model:{value:t.batchEditValue,callback:function(e){t.batchEditValue=e},expression:"batchEditValue"}})],1),t._v(" "),t.batchEditObj.tip?i("div",{staticClass:"tip"},[t._v(t._s(t.batchEditObj.tip))]):t._e()])]),t._v(" "),i("template",{slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:"确认"},on:{click:t.confirmBatchEdit}},[t._v("\n                确认\n            ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:t.cancelBatchEdit}},[t._v("\n                取消\n            ")])],1)],2)],1)}),[],!1,null,"1cfb77e7",null),te=Qt.exports,ee=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ie=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},ne=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.detail={},e.commands="",e.loading=!1,e}return ee(e,t),e.prototype.show=function(t){console.log(t),this.isShow=!0,this.detail=t,this.getManagementCommands()},e.prototype.getManagementCommands=function(){var t=this;this.loading=!0,this.$api.agentManage.getManagementCommands({job_id:this.jobId,bk_host_id:this.detail.bk_host_id}).then((function(e){var i,n=e.result,r=e.data;if(!n)return!1;t.commands=r.solutions&&(null===(i=r.solutions[0])||void 0===i?void 0:i.steps)})).finally((function(){t.loading=!1}))},ie([Object(f.d)({type:[Number,String],default:function(){return""}})],e.prototype,"jobId",void 0),e=ie([Object(f.a)({name:"hand-movement"})],e)}(f.e),re=ne,oe=re,ae=Object(u.a)(oe,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:600,"is-show":t.isShow,"quick-close":!0},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n        手动"+t._s(t.detail.inner_ip)+"\n    ")]),t._v(" "),i("div",{staticClass:"content",attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"mb20"},[t._v("您可以通过以下方式手动安装 Agent：")]),t._v(" "),i("div",{staticClass:"mb20"},[t._v("执行安装指令")]),t._v(" "),i("bk-alert",{staticClass:"mb20",attrs:{type:"info",title:"请将指令中的 账号 端口 密码/密钥 替换成 真实数据 再执行。"}}),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"show-result"},[t.commands.length?i("div",{staticClass:"text-box"},t._l(t.commands,(function(e,n){return i("div",{key:n,class:["custom-step",n!==t.commands.length-1&&"custom-step-space"]},[i("div",{staticClass:"step-number"},[t._v(t._s(n+1))]),t._v(" "),i("div",{staticClass:"step-content"},[i("div",{staticClass:"step-content-title"},[t._v(t._s(e.description))]),t._v(" "),i("div",{staticClass:"step-result"},t._l(e.contents,(function(e,n){return i("div",{key:n,staticStyle:{position:"relative"}},[i("bk-icon",{directives:[{name:"copy",rawName:"v-copy",value:e.text,expression:"tex.text"}],staticClass:"operate-icon-copy",attrs:{type:"clipboard"}}),t._v(" "),i("span",[t._v(t._s(e.text))])],1)})),0)])])})),0):i("bk-exception",{staticClass:"exception-wrap-item exception-part",attrs:{type:"empty",scene:"part"}})],1)],1)])}),[],!1,null,"48626c89",null),se=ae.exports,le={SUCCESS:{backgroundColor:"rgba(20,165,104,.1)",borderColor:"#14a568"},FAILED:{backgroundColor:"rgba(234,53,54,.1)",borderColor:"#ea3536"},PENDING:{backgroundColor:"rgba(151,155,165,.1)",borderColor:"#63656e"},RUNNING:{backgroundColor:"rgba(151,155,165,.1)",borderColor:"#63656e"},FILTERED:{backgroundColor:"rgba(151,155,165,.1)",borderColor:"#63656e"}},ce={SUCCESS:{backgroundColor:"rgba(20,165,104,.1)",color:"#14a568"},FAILED:{backgroundColor:"rgba(234,53,54,.1)",color:"#ea3536"},PENDING:{backgroundColor:"rgba(151,155,165,.1)",color:"#63656e"},RUNNING:{backgroundColor:"rgba(151,155,165,.1)",color:"#63656e"},FILTERED:{backgroundColor:"rgba(151,155,165,.1)",color:"#63656e"}},ue=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),pe=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},de=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.columns=[{label:"IP",key:"inner_ip",align:"left",minWidth:"200"},{label:"云区域",key:"bk_cloud_name",align:"left",minWidth:"100"},{label:"业务",key:"bk_biz_name",align:"left",minWidth:"100"},{label:"安装方式",key:"installWay",align:"left",minWidth:"100",scopedSlots:"installWay"},{label:"执行状态",key:"status",align:"left",minWidth:"200",scopedSlots:"status"},{label:"操作",key:"operation",align:"left",width:"160px",scopedSlots:"operation"}],e.taskDetail={},e.tableLoading=!1,e.maxHeight="",e.search="",e.searchInputShow=!0,e.searchFilterList=[{name:"IP",id:"ip",show:!0},{name:"执行状态",id:"status",children:[{name:"等待执行",id:"PENDING"},{name:"正在执行",id:"RUNNING"},{name:"执行成功",id:"SUCCESS"},{name:"执行失败",id:"FAILED"},{name:"已忽略",id:"FILTERED"}],show:!0}],e.resultMap={PENDING:"等待执行",RUNNING:"正在执行",SUCCESS:"执行成功",FAILED:"执行失败",FILTERED:"已忽略"},e.searchValue=[],e.searchParams=[],e.dataList=[],e.timer=null,e.pagination={current:1,count:1,limit:20},e}return ue(e,t),Object.defineProperty(e.prototype,"resultStyleMap",{get:function(){return ce},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagStyleMap",{get:function(){return le},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){var t=this;this.maxHeight=window.innerHeight-244,window.onresize=function(){t.maxHeight=window.innerHeight-244},this.getAgentTaskDetail(!0)},e.prototype.beforeDestroy=function(){this.timer&&clearTimeout(this.timer)},e.prototype.handMovement=function(t){this.$refs.handMovement.show(t)},e.prototype.checkLog=function(t){this.goLog(t)},e.prototype.getAgentTaskDetail=function(t){var e=this;t&&(this.tableLoading=!0);var i={id:this.taskResult.job_id,body:{conditions:JSON.stringify(this.searchParams),page:this.pagination.current,page_size:this.pagination.limit}};this.$api.agentManage.getAgentTaskDetail(i).then((function(t){if(!t.result)return!1;e.timer&&clearTimeout(e.timer),e.taskDetail=t.data,["PENDING","RUNNING"].includes(e.taskDetail.status)&&(e.timer=setTimeout((function(){e.getAgentTaskDetail(!1)}),5e3)),e.dataList=t.data.list})).finally((function(){t&&(e.tableLoading=!1)}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getAgentTaskDetail(!0)},e.prototype.limitChange=function(t){this.pagination.limit=t,this.pagination.current=1,this.getAgentTaskDetail(!0)},e.prototype.clearSearchParams=function(){this.searchParams=[],this.pagination.current=1,this.getAgentTaskDetail(!0)},e.prototype.clickSearchIcon=function(){this.pagination.current=1,this.getAgentTaskDetail(!0)},e.prototype.changeSearchValue=function(t){var e=this;this.searchParams=[],this.searchFilterList.forEach((function(e){var i=t.find((function(t){return t.id===e.id}));e.show=!i})),t.forEach((function(t){var i={key:t.id,value:[]};i.value="ip"===t.id?t.values[0].id:t.values.map((function(t){return t.id})),e.searchParams.push(i)})),this.pagination.current=1,this.searchInputShow=!1,this.$nextTick((function(){e.searchInputShow=!0}))},e.prototype.goBack=function(){this.setCurrentMode()},e.prototype.setCurrentMode=function(){return""},e.prototype.goLog=function(t){return{jobId:this.taskResult.job_id,instanceId:t.instance_id}},pe([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"taskResult",void 0),pe([Object(f.d)({type:String,default:function(){return""}})],e.prototype,"agentMode",void 0),pe([Object(f.b)("setCurrentMode")],e.prototype,"setCurrentMode",null),pe([Object(f.b)("goLog")],e.prototype,"goLog",null),e=pe([Object(f.a)({components:{ComTable:st.a,HandMovement:se}})],e)}(f.e),fe=de,me=fe,he=Object(u.a)(me,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],staticClass:"task-detail"},[i("div",{staticClass:"title-box"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}}),t._v(" "),i("span",[t._v("任务详情:")]),t._v(" "),i("span",{staticClass:"ml10 mr10"},[t._v(t._s(t.taskDetail.job_type_display||"--"))]),t._v(" "),i("span",[t._v(t._s(t.taskDetail.start_time?t.taskDetail.start_time.split("+")[0]:""))]),t._v(" "),i("div",{staticClass:"tag",style:t.resultStyleMap[t.taskDetail.status]},[t._v(t._s(t.resultMap[t.taskDetail.status]))])],1),t._v(" "),t.searchInputShow?i("bk-search-select",{staticStyle:{width:"470px"},attrs:{clearable:"",placeholder:"搜索IP,执行状态","show-popover-tag-change":!1,data:t.searchFilterList.filter((function(t){return t.show}))},on:{change:t.changeSearchValue,clear:t.clearSearchParams,"key-enter":t.clickSearchIcon,search:t.clickSearchIcon},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}):t._e(),t._v(" "),i("div",{staticClass:"table-header"},[i("div",{staticClass:"left-info"},[i("span",[t._v(t._s(t.taskDetail.job_type_display))]),t._v(" "),i("span",[t._v(t._s("(共 "+t.dataList.length+" 个)"))])]),t._v(" "),i("div",{staticClass:"right-info"},[i("span",[t._v(t._s(t.dataList.filter((function(t){return"FAILED"===t.status})).length))]),t._v(" "),i("span",[t._v("个失败")])])]),t._v(" "),i("com-table",{ref:"comTable",attrs:{data:t.dataList,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[["PENDING","RUNNING"].includes(n.status)?i("bk-spin",{attrs:{size:"mini"}}):i("span",{staticClass:"status-tag",style:t.tagStyleMap[n.status]}),t._v(" "),i("span",[t._v(t._s(n.status_display))])]}},{key:"operation",fn:function(e){var n=e.row;return[["INSTALL_AGENT"].includes(t.taskDetail.job_type)?i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:"PENDING"===n.status},on:{click:function(e){return t.handMovement(n)}}},[t._v("\n                手动安装\n            ")]):t._e(),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.checkLog(n)}}},[t._v("\n                查看日志\n            ")])]}}])},[i("template",{slot:"installWay"},[t._v("\n            远程\n        ")])],2),t._v(" "),i("hand-movement",{ref:"handMovement",attrs:{"job-id":t.taskResult.job_id}})],1)}),[],!1,null,"75a8d579",null),be=he.exports,ge=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ye=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},ve=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.taskDetail={},e.logLoading=!1,e.stepDetail=[],e.stepResultMap={SUCCESS:"执行成功",FAILED:"执行失败",PENDING:"等待执行",RUNNING:"正在执行",FILTERED:"已忽略"},e.timer=null,e.ip="",e.failedIndex=100,e}return ge(e,t),Object.defineProperty(e.prototype,"tagStyleMap",{get:function(){return le},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.getAgentTaskDetail(),this.getTaskLog(!0)},e.prototype.beforeDestroy=function(){this.timer&&clearTimeout(this.timer)},e.prototype.quickTo=function(t){document.querySelector("#".concat(t.tag)).scrollIntoView(!0)},e.prototype.goBottom=function(){this.$nextTick((function(){document.querySelector("#footer-tag").scrollIntoView(!0)}))},e.prototype.setFullScreen=function(){this.isFullScreen=!this.isFullScreen;var t=document.getElementById("logDetail");this.isFullScreen?(t.style.position="fixed",t.style.zIndex="9999",t.style.top="0",t.style.left="0",t.style.height="100vh",t.style.width="100vw"):(t.style.position="relative",t.style.zIndex="1",t.style.height="100%",t.style.width="100%")},e.prototype.getTaskLog=function(t){var e=this;t&&(this.logLoading=!0),this.$api.agentManage.getTaskLog({id:this.jobId,instanceId:this.instanceId}).then((function(t){if(!t.result)return!1;e.stepDetail=t.data,e.stepDetail.forEach((function(t,i){if(t.tag="step_"+i,"FAILED"===t.status&&(e.failedIndex=i),t.start_time&&t.finish_time){var n=new Date(t.start_time).getTime(),r=new Date(t.finish_time).getTime();t.time=(r-n)/1e3+"s"}else t.time="--";t.log&&(t.logList=t.log.split("\n"))})),e.goBottom()})).finally((function(){e.logLoading=!1}))},e.prototype.getAgentTaskDetail=function(){var t=this;this.$api.agentManage.getAgentTaskDetail({id:this.jobId}).then((function(e){if(!e.result)return!1;t.timer&&clearTimeout(t.timer),t.taskDetail=e.data;var i=t.taskDetail.list.find((function(e){return e.instance_id===t.instanceId}));t.ip=i?i.inner_ip:"",["PENDING","RUNNING"].includes(t.taskDetail.status)&&(t.timer=setTimeout((function(){t.getAgentTaskDetail(),t.getTaskLog(!1)}),5e3))}))},e.prototype.goBack=function(){this.setCurrentMode()},e.prototype.setCurrentMode=function(){return"task"},ye([Object(f.d)({type:Number,default:function(){return 0}})],e.prototype,"jobId",void 0),ye([Object(f.d)({type:String,default:function(){return""}})],e.prototype,"instanceId",void 0),ye([Object(f.b)("setCurrentMode")],e.prototype,"setCurrentMode",null),e=ye([f.a],e)}(f.e),_e=ve,ke=_e,we=Object(u.a)(ke,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"task-log"},[i("div",{staticClass:"title-box"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}}),t._v(" "),i("span",[t._v(t._s(t.ip||"--"))]),t._v(" "),i("span",{staticClass:"ml10 mr10"},[t._v(t._s(t.taskDetail.job_type_display||"--"))]),t._v(" "),i("span",[t._v("的执行日志")])],1),t._v(" "),i("bk-alert",{attrs:{type:"info",closable:""}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",[t._v("点击步骤可以快速定位对应日志内容；点击日志右下方的")]),t._v(" "),i("bk-icon",{attrs:{type:"arrows-down-circle-shape"}}),t._v(" "),i("span",[t._v("可以快速定位到最新日志内容。")])],1)]),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.logLoading,zIndex:10},expression:"{ isLoading: logLoading, zIndex: 10 }"}],staticClass:"show-box"},[i("div",{staticClass:"step-box"},[t._m(0),t._v(" "),i("div",{staticClass:"content"},t._l(t.stepDetail,(function(e,n){return i("div",{key:n,class:["step-list",(!e.start_time&&!e.finish_time||n>t.failedIndex)&&"disabled-list"],on:{click:function(i){return t.quickTo(e)}}},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"step hide-text"},[t._v("\n                        "+t._s(n+1+". "+e.step)+"\n                    ")]),t._v(" "),i("div",{staticClass:"time"},[t._v(t._s(e.time))]),t._v(" "),i("div",{staticClass:"situation"},[["RUNNING"].includes(e.status)?i("bk-spin",{attrs:{size:"mini"}}):i("span",{staticClass:"status-tag",style:t.tagStyleMap[e.status]}),t._v(" "),i("span",[t._v(t._s(t.stepResultMap[e.status]))])],1),t._v(" "),i("div",{staticClass:"action"})])})),0)]),t._v(" "),i("div",{staticClass:"log-box",attrs:{id:"logDetail"}},[i("div",{staticClass:"log-header"},[i("span",{staticClass:"title"},[t._v("执行日志")]),t._v(" "),i("i",{class:["cw-icon",t.isFullScreen?"weops-full-view":"weops-exit-full-screen"],on:{click:t.setFullScreen}})]),t._v(" "),i("div",{staticClass:"log-content"},[t._l(t.stepDetail.filter((function(t){return t.log})),(function(e,n){return i("div",{key:n,attrs:{id:e.tag}},t._l(e.logList,(function(e,n){return i("div",{key:n,staticStyle:{padding:"0 30px"}},[i("span",{staticClass:"log-info",domProps:{innerHTML:t._s(e)}})])})),0)})),t._v(" "),i("div",{attrs:{id:"footer-tag"}}),t._v(" "),i("bk-icon",{staticClass:"go-bottom",attrs:{type:"arrows-down-circle-shape"},on:{click:t.goBottom}})],2)])])],1)}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"header"},[i("div",{staticClass:"step"},[t._v("步骤")]),t._v(" "),i("div",{staticClass:"time"},[t._v("耗时")]),t._v(" "),i("div",{staticClass:"situation"},[t._v("执行情况")]),t._v(" "),i("div",{staticClass:"setting"})])}],!1,null,"df7afc46",null),xe=we.exports,Ce=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),De=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},je=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Oe=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Le=function(t,e,i){if(i||2===arguments.length)for(var n,r=0,o=e.length;r<o;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Te=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentMode="table",e.taskResult={ip_filter:[],job_id:""},e.jobId=0,e.instanceId="",e.selectTableData=[],e.agentMode="INSTALL_AGENT",e.businessTopology=[],e.topologyList=[],e.operateAgentLoading=!1,e.actionList=[{key:"upgrade",value:"升级",isDisabled:!1},{key:"uninstall",value:"卸载",isDisabled:!1},{key:"overloadConfig",value:"重载配置",isDisabled:!1},{key:"reboot",value:"重启",isDisabled:!1},{key:"log",value:"最新执行日志",isDisabled:!1}],e.business=[],e.businessData=[],e.searchValue=[],e.searchFilterList=[],e.tableLoading=!1,e.dataList=[],e.searchInputShow=!0,e.columns=[{type:"selection",width:"50px",fixed:"left"},{label:"IP",key:"inner_ip",align:"left",minWidth:"130px",disabled:!0},{label:"登录IP",key:"login_ip",align:"left",minWidth:"130px"},{label:"归属应用",key:"bk_biz_name",align:"left",minWidth:"100px"},{label:"云区域",key:"bk_cloud_id",align:"left",minWidth:"100px",filterable:!0,filterKey:"bk_cloud_id",filterRemote:!0,filterMultiple:!0,filters:[],scopedSlots:"bk_cloud_id"},{label:"操作系统",key:"os_type",align:"left",minWidth:"120"},{label:"Agent状态",key:"status",align:"left",minWidth:"120",disabled:!0,filterable:!0,filterKey:"status",filterRemote:!0,filterMultiple:!0,filters:[],scopedSlots:"status_display"},{label:"Agent版本",key:"version",align:"left",minWidth:"120"},{label:"安装方式",key:"is_manual",align:"left",minWidth:"120",scopedSlots:"is_manual"},{label:"BT节点探测",key:"bt_agent",align:"left",minWidth:"120",scopedSlots:"bt_agent"},{label:"传输限速",key:"speed_limit",align:"left",minWidth:"120",scopedSlots:"speed_limit"},{label:"安装时间",key:"created_at",align:"left",minWidth:"160",scopedSlots:"created_at"},{label:"更新时间",key:"updated_at",align:"left",minWidth:"160",scopedSlots:"updated_at"},{label:"应用拓扑",key:"topology",align:"left",minWidth:"200",scopedSlots:"topology"},{label:"操作",key:"operation",align:"left",width:"100px",fixed:"right",scopedSlots:"operation"}],e.maxHeight="",e.pagination={current:1,count:1,limit:20},e.settingsFields=e.columns.slice(1,e.columns.length-1),e.htmlConfig={allowHtml:!0,width:104,trigger:"click",theme:"light",content:"#tip-html",placement:"bottom",extCls:"ext-tip",onShow:function(){}},e.clickRowIndex="",e.topologyParams={key:"topology",value:{bk_biz_id:0}},e.businessTopologyShow=!0,e.searchParams=[],e.filterParams=[],e.selectData={},e.cloudArea=[],e.accessPoint=[],e.isExcelInstall=!1,e}return Ce(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onBusinessChanged=function(t){1===t.length&&(this.topologyParams.value.bk_biz_id=t[0])},e.prototype.mounted=function(){var t=this;this.maxHeight=window.innerHeight-224,window.onresize=function(){t.maxHeight=window.innerHeight-224},this.getAgentList(),this.getEnumFields(),this.getBiz(),this.getCloudArea(),this.getAccessPointList()},e.prototype.goLog=function(t){var e=t.jobId,i=t.instanceId;this.currentMode="log",this.jobId=e,this.instanceId=i},e.prototype.getCloudArea=function(){var t=this;this.$api.agentManage.getCloudArea().then((function(e){if(!e.result)return!1;t.cloudArea=e.data}))},e.prototype.getAccessPointList=function(){var t=this;this.$api.agentManage.getAccessPointList().then((function(e){if(!e.result)return!1;t.accessPoint=e.data}))},e.prototype.clearSearchParams=function(){this.searchParams=[],this.pagination.current=1,this.getAgentList()},e.prototype.clickSearchIcon=function(){this.pagination.current=1,this.getAgentList()},e.prototype.changeBusiness=function(t){var e=this;1===t.length?(this.pagination.current=1,this.getAgentList(),this.$api.agentManage.getTopologyNode({id:t[0]}).then((function(t){if(!t.result)return!1;e.topologyList=t.data}))):(this.businessTopologyShow=!1,this.$nextTick((function(){e.businessTopologyShow=!0,e.businessTopology=[],e.pagination.current=1,e.getAgentList()})))},e.prototype.clearTopology=function(){this.pagination.current=1,this.getAgentList()},e.prototype.changeTopology=function(t,e,i){var n=i.find((function(t){return"module"===t.type}));n&&(this.topologyParams.value.bk_module_ids=[n.id]);var r=i.find((function(t){return"set"===t.type}));r&&(this.topologyParams.value.bk_set_ids=[r.id]),this.pagination.current=1,this.getAgentList()},e.prototype.changeSearchValue=function(t){var e=this;this.searchParams=[],this.searchFilterList.forEach((function(e){var i=t.find((function(t){return t.id===e.id}));e.show=!i})),t.forEach((function(t){var i={key:t.id,value:t.values.map((function(t){return t.id}))};e.searchParams.push(i)})),this.pagination.current=1,this.getAgentList(),this.searchInputShow=!1,this.$nextTick((function(){e.searchInputShow=!0}))},e.prototype.getBiz=function(){var t=this;this.$api.Server.getBizs().then((function(e){if(!e.result)return!1;t.businessData=e.data}))},e.prototype.setAgentStatus=function(t){switch(t){case"RUNNING":return{borderColor:"#e5f6ea",backgroundColor:"#3fc06d"};case"TERMINATED":return{borderColor:"#ffe6e6",backgroundColor:"#ea3636"};default:return{borderColor:"#f0f1f5",backgroundColor:"#b2b5bd"}}},e.prototype.getEnumFields=function(){var t=this;this.$api.agentManage.getEnumFields().then((function(e){if(!e.result)return!1;t.searchFilterList=e.data,t.searchFilterList.forEach((function(t){"inner_ip"!==t.id&&(t.multiable=!0),t.show=!0})),t.columns.forEach((function(t){if(t.filterable){var i=e.data.find((function(e){return e.id===t.filterKey}));i&&(t.filters=i.children.map((function(t){return{text:t.name,value:t.id}})))}}));var i=t.$refs.sourceTable;i&&i.updateColumns(t.columns)}))},e.prototype.getBtAgent=function(t){return"{}"===JSON.stringify(t.extra_data)?"停用":t.extra_data&&1===t.extra_data.peer_exchange_switch_for_agent?"启用":"停用"},e.prototype.getSpeedLimit=function(t){return"{}"===JSON.stringify(t.extra_data)?"--":t.extra_data.bt_speed_limit||"--"},e.prototype.handleShowTime=function(t){return t?t.split("+")[0]:"--"},e.prototype.excelInstall=function(){this.$BtnPermission(this.permissionObj)&&(this.currentMode="agent",this.agentMode="INSTALL_AGENT",this.isExcelInstall=!0)},e.prototype.installAgent=function(){this.$BtnPermission(this.permissionObj)&&(this.currentMode="agent",this.agentMode="INSTALL_AGENT")},e.prototype.setCurrentMode=function(t){this.currentMode=t||"table",this.isExcelInstall=!1,"table"===this.currentMode&&this.getAgentList()},e.prototype.getAgentList=function(){var t=this,e={bk_biz_ids:this.business,conditions:Le(Le([],this.searchParams,!0),this.filterParams,!0),page:this.pagination.current,page_size:this.pagination.limit};this.businessTopology.length>0&&e.conditions.push(this.topologyParams),this.tableLoading=!0,this.$api.agentManage.getAgentList(e).then((function(e){if(!e.result)return!1;t.dataList=e.data.items,t.pagination.count=e.data.count})).finally((function(){t.tableLoading=!1}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getAgentList()},e.prototype.limitChange=function(t){this.pagination.limit=t,this.pagination.current=1,this.getAgentList()},e.prototype.filterChange=function(t){var e=this;Object.keys(t).forEach((function(i){var n={key:i,value:t[i]},r=e.filterParams.findIndex((function(t){return t.key===i}));-1===r?e.filterParams.push(n):0===n.value.length?e.filterParams.splice(r,1):e.filterParams[r]=n})),this.pagination.current=1,this.getAgentList()},e.prototype.select=function(t){this.selectTableData=t},e.prototype.handleSettingChange=function(t){this.columns=t,this.handleColumn(),this.$refs.sourceTable.updateColumns(this.columns)},e.prototype.selectMore=function(t){this.selectData=t,this.jobId=this.selectData.job_result.job_id,this.instanceId=this.selectData.job_result.instance_id,this.actionList.forEach((function(e){e.isDisabled="NOT_INSTALLED"===t.status&&!["remove","log"].includes(e.key)}))},e.prototype.handleColumn=function(){this.columns.unshift({type:"selection",minWidth:"50px",fixed:"left"}),this.columns.push({label:"操作",key:"operation",align:"left",width:"100px",fixed:"right",scopedSlots:"operation"})},e.prototype.selectOperate=function(t){if(t.isDisabled)return!1;switch(this.setToolTipVisible(),t.key){case"upgrade":this.upgradeOrReboot("upgrade","one");break;case"uninstall":this.moreAgentAction([this.selectData],"UNINSTALL_AGENT");break;case"remove":this.removeHost("one");break;case"overloadConfig":this.moreAgentAction([this.selectData],"RELOAD_AGENT");break;case"reboot":this.upgradeOrReboot("reboot","one");break;case"log":this.checkLog()}},e.prototype.removeHost=function(t){var e=this;f.e.prototype.$bkInfo({title:"one"===t?"确认要移除该主机？":"确认要批量移除选中主机？",confirmLoading:!0,confirmFn:function(){return je(e,void 0,void 0,(function(){var e;return Oe(this,(function(i){switch(i.label){case 0:return e=("one"===t?[this.selectData]:this.selectTableData).map((function(t){return{bk_host_id:t.bk_host_id,bk_biz_id:t.bk_biz_id,bk_host_innerip:t.inner_ip}})),[4,this.confirmRemove(e)];case 1:return i.sent(),[2]}}))}))}})},e.prototype.confirmRemove=function(t){return je(this,void 0,void 0,(function(){var e;return Oe(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$api.Resource.batchDeleteResource({bk_obj_id:"host",bk_data:t})];case 1:return(e=i.sent()).result?(this.$success("删除成功"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getAgentList(),[3,3]):[2,this.$error(e.message)];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.checkLog=function(){this.currentMode="log"},e.prototype.setToolTipVisible=function(){var t=document.querySelector(".ext-tip");t&&(t.style.top="-9999px")},e.prototype.moreAgentAction=function(t,e){var i=this;this.$BtnPermission(this.permissionObj)&&(this.currentMode="agent",this.agentMode=e,this.$nextTick((function(){i.$refs.operateAgent.getReInstallData(t)})))},e.prototype.operateAgent=function(t){var e=this,i={job_type:t.jobType,hosts:t.hosts};this.operateAgentLoading=!0,this.$api.agentManage.operateAgent(i).then((function(t){if(!t.result)return f.e.prototype.$error(t.message),!1;e.currentMode="task",e.taskResult=t.data})).finally((function(){e.operateAgentLoading=!1}))},e.prototype.handleHostParams=function(t){return t.map((function(t){return{bk_cloud_id:t.bk_cloud_id,bk_host_id:t.bk_host_id,ap_id:t.ap_id,bk_biz_id:t.bk_biz_id,os_type:t.os_type||"",inner_ip:t.inner_ip||"",login_ip:t.login_ip||"",account:t.identity_info.account||"",port:t.identity_info.port||"",auth_type:t.identity_info.auth_type||"",password:t.password||"password",key:t.key||"key"}}))},e.prototype.upgradeOrReboot=function(t,e){var i=this;if(this.$BtnPermission(this.permissionObj)){var n="",r=[],o="upgrade"===t?"升级":"重启",a="upgrade"===t?"Agent到最新版本？":"Agent?";"batch"===e?(n="请确认是否".concat(o," ").concat(this.selectTableData[0].inner_ip,"等").concat(this.selectTableData.length,"个IP的").concat(a),r=this.handleHostParams(this.selectTableData)):(n="请确认是否".concat(o," ").concat(this.selectData.inner_ip," 的").concat(a),r=this.handleHostParams([this.selectData])),f.e.prototype.$bkInfo({title:"请确认是否".concat("batch"===e?"批量":"").concat("upgrade"===t?"升级":"重启"),subTitle:n,confirmLoading:!0,confirmFn:function(){return je(i,void 0,void 0,(function(){return Oe(this,(function(e){switch(e.label){case 0:return[4,this.operateAgent({jobType:"upgrade"===t?"UPGRADE_AGENT":"RESTART_AGENT",hosts:r})];case 1:return e.sent(),[2]}}))}))}})}},De([Object(f.f)("business",{immediate:!0,deep:!0})],e.prototype,"onBusinessChanged",null),e=De([Object(f.a)({components:{ComTable:st.a,OperateAgent:te,TaskDetail:be,TaskLog:xe}})],e)}(f.e),Se=Te,Ie=Se,Pe=Object(u.a)(Ie,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"agent-manage"},["table"===t.currentMode?i("div",[i("div",{staticClass:"action-bar"},[i("bk-dropdown-menu",{ref:"dropdown",staticClass:"mr15"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{slot:"dropdown-trigger",theme:"primary","icon-right":"icon-angle-down"},slot:"dropdown-trigger"},[t._v("\n                    安装Agent\n                ")]),t._v(" "),i("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:t.installAgent}},[t._v("\n                            普通安装\n                        ")])]),t._v(" "),i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:t.excelInstall}},[t._v("\n                            Excel导入安装\n                        ")])])])],1),t._v(" "),i("bk-dropdown-menu",{ref:"dropdown",staticClass:"mr15",attrs:{disabled:!t.selectTableData.length||t.operateAgentLoading}},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{slot:"dropdown-trigger",theme:"default","icon-right":"icon-angle-down"},slot:"dropdown-trigger"},[t._v("\n                    批量\n                ")]),t._v(" "),i("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:function(e){return t.moreAgentAction(t.selectTableData,"REINSTALL_AGENT")}}},[t._v("\n                            安装\n                        ")])]),t._v(" "),i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:function(e){return t.upgradeOrReboot("upgrade","batch")}}},[t._v("\n                            升级\n                        ")])]),t._v(" "),i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:function(e){return t.moreAgentAction(t.selectTableData,"UNINSTALL_AGENT")}}},[t._v("\n                            卸载\n                        ")])]),t._v(" "),i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:function(e){return t.moreAgentAction(t.selectTableData,"RELOAD_AGENT")}}},[t._v("\n                            重载配置\n                        ")])]),t._v(" "),i("li",[i("span",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],on:{click:function(e){return t.upgradeOrReboot("reboot","batch")}}},[t._v("\n                            重启\n                        ")])])])],1),t._v(" "),i("bk-select",{staticClass:"mr15",staticStyle:{width:"200px",height:"32px"},attrs:{search:"",multiple:""},on:{change:t.changeBusiness},model:{value:t.business,callback:function(e){t.business=e},expression:"business"}},t._l(t.businessData,(function(t){return i("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1),t._v(" "),t.businessTopologyShow?i("bk-cascade",{staticClass:"mr15",staticStyle:{width:"200px",height:"32px"},attrs:{list:t.topologyList,disabled:1!==t.business.length,clearable:"",placeholder:"业务拓扑","ext-popover-cls":"custom-cls"},on:{change:t.changeTopology,clear:t.clearTopology},model:{value:t.businessTopology,callback:function(e){t.businessTopology=e},expression:"businessTopology"}}):t._e(),t._v(" "),t.searchInputShow?i("bk-search-select",{staticStyle:{flex:"1"},attrs:{clearable:"",placeholder:"搜索IP,云区域","show-popover-tag-change":!1,data:t.searchFilterList.filter((function(t){return t.show}))},on:{change:t.changeSearchValue,clear:t.clearSearchParams,search:t.clickSearchIcon},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}):t._e()],1),t._v(" "),i("div",{staticClass:"content-body"},[i("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading|t.operateAgentLoading,zIndex:10},expression:"{ isLoading: tableLoading | operateAgentLoading, zIndex: 10 }"}],ref:"sourceTable",staticClass:"com-table",attrs:{id:"center_table",data:t.dataList,columns:t.columns,"max-height":t.maxHeight,pagination:t.pagination,"select-column":{visible:!0,fixed:!1},"settings-fields":t.settingsFields},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange,"filter-change":t.filterChange,"select-all":t.select,select:t.select,"handle-setting-change":t.handleSettingChange},scopedSlots:t._u([{key:"bt_agent",fn:function(e){var n=e.row;return[i("bk-tag",{attrs:{theme:"启用"===t.getBtAgent(n)?"success":""}},[t._v(t._s(t.getBtAgent(n)))])]}},{key:"speed_limit",fn:function(e){var i=e.row;return[t._v("\n                    "+t._s(t.getSpeedLimit(i))+"\n                ")]}},{key:"topology",fn:function(e){var i=e.row;return[t._v("\n                    "+t._s(i.topology&&i.topology[0]||"--")+"\n                ")]}},{key:"is_manual",fn:function(e){var i=e.row;return[t._v("\n                    "+t._s(i.is_manual?"手动":"远程")+"\n                ")]}},{key:"created_at",fn:function(e){var i=e.row;return[t._v("\n                    "+t._s(t.handleShowTime(i.created_at))+"\n                ")]}},{key:"updated_at",fn:function(e){var i=e.row;return[t._v("\n                    "+t._s(t.handleShowTime(i.updated_at))+"\n                ")]}},{key:"bk_cloud_id",fn:function(e){var i=e.row;return[t._v("\n                    "+t._s(i.bk_cloud_name)+"\n                ")]}},{key:"status_display",fn:function(e){var n=e.row;return[i("span",{staticClass:"agent-status",style:t.setAgentStatus(n.status)}),t._v(" "),i("span",[t._v(t._s(n.status_display||"--"))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.moreAgentAction([n],"REINSTALL_AGENT")}}},[t._v("\n                        "+t._s("NOT_INSTALLED"===n.status?"安装":"重装")+"\n                    ")]),t._v(" "),t.$BtnPermission(t.permissionObj)?i("div",{staticClass:"tip-html",attrs:{id:"tip-html"}},[i("ul",{staticClass:"action-list"},t._l(t.actionList,(function(e){return i("li",{key:e.key,class:[e.isDisabled&&"disabled-item"],on:{click:function(i){return t.selectOperate(e)}}},[t._v("\n                                "+t._s(e.value)+"\n                            ")])})),0)]):t._e(),t._v(" "),t.$BtnPermission(t.permissionObj)?i("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.htmlConfig,expression:"htmlConfig"}],ref:"tooltipsHtml",staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.selectMore(n)}}},[t._v("\n                        更多\n                    ")]):t._e()]}}],null,!1,2428780495)})],1)]):t._e(),t._v(" "),"agent"===t.currentMode?i("operate-agent",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.operateAgentLoading,zIndex:10},expression:"{ isLoading: operateAgentLoading, zIndex: 10 }"}],ref:"operateAgent",attrs:{"business-data":t.businessData,"cloud-area":t.cloudArea,"access-point":t.accessPoint,"agent-mode":t.agentMode,"is-excel-install":t.isExcelInstall},on:{setCurrentMode:t.setCurrentMode,operateAgent:t.operateAgent}}):t._e(),t._v(" "),"task"===t.currentMode?i("task-detail",{ref:"taskDetail",attrs:{"task-result":t.taskResult,"agent-mode":t.agentMode},on:{setCurrentMode:t.setCurrentMode,goLog:t.goLog}}):t._e(),t._v(" "),"log"===t.currentMode?i("task-log",{ref:"taskLog",attrs:{"job-id":t.jobId,"instance-id":t.instanceId},on:{setCurrentMode:t.setCurrentMode}}):t._e()],1)}),[],!1,null,"2215bbb8",null),$e=Pe.exports,Me=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ne=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Ae=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.pageLoading=!1,e.columns=[{label:"变量名",key:"name",minWidth:"200px"},{label:"含义",key:"description",minWidth:"200px"}],e}return Me(e,t),e.prototype.show=function(){this.visible=!0},e.prototype.cancel=function(){this.visible=!1},e.prototype.getVariableFormat=function(){return"{{target.对象.字段名}}"},Ne([Object(f.d)({type:Array,default:[]})],e.prototype,"variableData",void 0),e=Ne([Object(f.a)({components:{ComTable:st.a}})],e)}(f.e),Ee=Ae,Re=Ee,qe=Object(u.a)(Re,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:800,"is-show":t.visible,"quick-close":!0,title:"推荐变量","ext-cls":"common-dialog-wrapper","before-close":t.cancel},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"content"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],ref:"table",staticClass:"table",attrs:{data:t.variableData,columns:t.columns}}),t._v(" "),i("div",{staticClass:"introduce"},[i("b",{staticClass:"introduce-title"},[t._v("格式说明")]),t._v(" "),i("div",{staticClass:"introduce-item"},[i("div",[t._v("变量格式 ：")]),t._v(" "),i("div",[t._v(t._s(t.getVariableFormat()))])]),t._v(" "),i("div",{staticClass:"introduce-item"},[i("div",[t._v("对象包含：")]),t._v(" "),i("div",[t._v("host 主机")]),t._v(" "),i("div",[t._v("process 进程")]),t._v(" "),i("div",[t._v("service 服务实例")])]),t._v(" "),i("div",{staticClass:"introduce-item"},[i("div",[t._v("字段名 ：")]),t._v(" "),i("div",[t._v("资产配置信息中定义的字段名")])])])],1)]),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n            取消\n        ")])],1)])}),[],!1,null,"47840550",null),ze=qe.exports,Fe=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),He=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Be=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.instanceData=[],e.instanceColumns=[],e.instanceDetail={},e.visible=!1,e}return Fe(e,t),e.prototype.show=function(t){this.instanceDetail=this.$copy(t),this.visible=!0},e.prototype.confirm=function(){this.instanceDetail.childData.some((function(t){return!t.value}))?this.$error("参数值不能为空！"):(this.updateInstance(this.instanceDetail),this.visible=!1)},e.prototype.cancel=function(){this.visible=!1},e.prototype.updateInstance=function(t){return t},He([Object(f.b)("updateInstance")],e.prototype,"updateInstance",null),e=He([Object(f.a)({components:{ComTable:st.a}})],e)}(f.e),Ve=Be,We=Ve,Ge=Object(u.a)(We,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:600,"is-show":t.visible,"quick-close":!0,title:"参数修改","ext-cls":"common-dialog-wrapper","before-close":t.cancel},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[i("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("ComTable",{ref:"table",attrs:{data:t.instanceDetail.childData,columns:t.instanceDetail.childColums},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[i("bk-input",{model:{value:n.value,callback:function(e){t.$set(n,"value",e)},expression:"row.value"}})]}}])})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:t.confirm}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n            取消\n        ")])],1)])}),[],!1,null,null,null),Ue=Ge.exports,Ke=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ye=function(){return Ye=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ye.apply(this,arguments)},Xe=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Je=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Ze=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Qe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.asstId="",e.currentAsst={},e.paramsValue="",e.selectedOptions={bk_biz_name:[],status_display:[]},e.pagination={limit:10,current:1,count:0},e.instanceList=[],e.initInstanceList=[],e.instanceColumn=[{key:"bk_inst_name",label:"实例名",sortable:!1,instType:"inst",showOverflowTooltip:!0},{key:"bk_host_innerip",label:"内网IP",sortable:!1,instType:"host",showOverflowTooltip:!0},{key:"bk_biz_name",label:"所属应用",sortable:!1,showOverflowTooltip:!0,filters:[],filterMultiple:!0,filterRemote:!0},{key:"status_display",label:"agent状态",sortable:!1,showOverflowTooltip:!0,scopedSlots:"status_display",filters:[],filterMultiple:!0,filterRemote:!0},{label:"操作",scopedSlots:"operation",width:"100px"}],e.instLoading=!1,e.targetRow={},e}return Ke(e,t),Object.defineProperty(e.prototype,"instType",{get:function(){return this.currentAsst.is_target_object?"host"===this.currentAsst.bk_asst_obj_id?"inst":"host":"host"===this.currentAsst.bk_obj_id?"inst":"host"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){var t=this;return this.instanceColumn.filter((function(e){return e.instType!==t.instType}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"powerParams",{get:function(){return{id:this.$route.meta.activeMenu?this.$route.meta.activeMenu:this.$route.name,type:"AssetRecordsHost"===this.$route.query.formPage?"hostManage":"".concat(this.$route.query.formPage,"Manage")}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableData",{get:function(){var t=this,e=this.selectedOptions,i=e.bk_biz_name,n=e.status_display;return this.initInstanceList.filter((function(e){return e.bk_host_innerip.includes(t.paramsValue)&&(!i.length||i.includes(e.bk_biz_name))&&(!n.length||n.includes(e.status_display))}))},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.getBusinessList()},e.prototype.linkToAgent=function(){var t=this.$router.resolve({name:"MonitorManage",query:{bkObjId:"host"}}).href;window.open(t,"_blank")},e.prototype.getBusinessList=function(){return Je(this,void 0,void 0,(function(){var t;return Ze(this,(function(e){switch(e.label){case 0:return[4,this.$api.healthAdvisor.getBusiness()];case 1:return(t=e.sent()).result&&this.instanceColumn.forEach((function(e){"bk_biz_name"===e.key&&(e.filters=t.data.map((function(t){return{text:t.bk_biz_name,value:t.bk_biz_name}})))})),[2]}}))}))},e.prototype.getAgentList=function(t){var e={},i=[];return t.forEach((function(t){e.hasOwnProperty(t.status)||(e[t.status]=t.status_display,i.push({text:t.status_display,value:t.status_display}))})),i},e.prototype.setAgentStatus=function(t){switch(t){case"RUNNING":return{borderColor:"#e5f6ea",backgroundColor:"#3fc06d"};case"TERMINATED":return{borderColor:"#ffe6e6",backgroundColor:"#ea3636"};default:return{borderColor:"#f0f1f5",backgroundColor:"#b2b5bd"}}},e.prototype.sourceFilterMethod=function(t){var e=Object.keys(t),i=Object.values(t);this.selectedOptions[e[0]]=i[0],this.pagination.current=1,this.initData()},e.prototype.showDialog=function(t){this.targetRow=t,this.visible=!0,this.asstId||(this.asstId=this.list[0].bk_obj_asst_id||"",this.currentAsst=this.list[0])},e.prototype.updateColumn=function(){var t=this,e=this.instanceColumn.filter((function(e){return e.instType!==t.instType}));this.$refs.instTable.updateColumns(e)},e.prototype.getInstanceList=function(t){return void 0===t&&(t=Ye({},this.currentAsst)),Je(this,void 0,void 0,(function(){var e,i=this;return Ze(this,(function(n){switch(n.label){case 0:if("{}"===JSON.stringify(t))return[2,!1];this.instLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.Resource.getInstanceInfo({bk_obj_id:t.is_target_object?t.bk_obj_id:t.bk_asst_obj_id,bk_inst_id:this.instId})];case 2:return(e=n.sent()).result?(this.initInstanceList=e.data.host_list,this.initData(),this.instanceColumn.forEach((function(t){"status_display"===t.key&&(t.filters=i.getAgentList(i.initInstanceList))})),[3,4]):(this.$error(e.message),[2]);case 3:return this.instLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.initData=function(){var t=this.pagination,e=t.current,i=t.limit;this.instanceList=this.tableData.slice((e-1)*i,e*i),this.pagination.count=this.tableData.length},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.initData()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.initData()},e.prototype.handleSearch=function(){this.pagination.current=1,this.initData()},e.prototype.handleRelate=function(t){return Je(this,void 0,void 0,(function(){var e,i,n;return Ze(this,(function(r){switch(r.label){case 0:return this.$BtnPermission(this.powerParams)?t.enabled?[4,this.$api.Resource.deleteInstanceRelation({asst_id:t.asst_id,bk_obj_id:this.currentAsst.bk_obj_id})]:[3,2]:[2];case 1:return(e=r.sent()).result?(this.$success("取消关联成功"),[3,4]):(this.$error(e.message),[2]);case 2:return[4,this.$api.Resource.addInstanceRelation({bk_obj_asst_id:this.currentAsst.bk_obj_asst_id,bk_inst_id:this.instId,bk_asst_inst_id:this.currentAsst.is_target_object?"host"===this.currentAsst.bk_asst_obj_id?t.bk_host_id:t.bk_inst_id:"host"===this.currentAsst.bk_obj_id?t.bk_host_id:t.bk_inst_id,is_target_object:this.currentAsst.is_target_object,bk_obj_id:this.currentAsst.bk_obj_id})];case 3:if(!(i=r.sent()).result)return this.$error(i.message),[2];this.$success("添加关联成功"),n=[{bk_biz_id:t.bk_biz_id,bk_cloud_id:t.bk_cloud_id,bk_host_id:t.bk_host_id,bk_host_innerip:t.bk_host_innerip,ip:t.bk_host_innerip,id:t.bk_host_innerip}],this.$set(this.targetRow,"ip_list",n),this.visible=!1,r.label=4;case 4:return[4,this.getInstanceList()];case 5:return r.sent(),[2]}}))}))},e.prototype.refreshInstanceList=function(){this.getInstanceList()},e.prototype.handleCancel=function(){this.paramsValue="",this.selectedOptions={bk_biz_name:[],status_display:[]},this.pagination={limit:10,current:1,count:0},this.visible=!1},Xe([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"list",void 0),Xe([Object(f.d)({type:[String,Number],default:function(){return""}})],e.prototype,"instId",void 0),e=Xe([Object(f.a)({name:"AddRelation",components:{ComTable:st.a}})],e)}(f.e),ti=Qe,ei=ti,ii=Object(u.a)(ei,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-relation"},[i("bk-sideslider",{attrs:{width:640,"is-show":t.visible,"mask-close":!1},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e},hidden:t.handleCancel}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("关联管理")]),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"add-relation-content"},[i("div",{staticClass:"relation-agent"},[i("bk-alert",{attrs:{closable:"",type:"info"}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",[t._v("若无已安装Agent的主机，请先")]),t._v(" "),i("bk-button",{attrs:{theme:"primary",text:"",size:"small"},on:{click:t.linkToAgent}},[t._v("纳管设备")])],1)])],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"row-left"},[i("bk-input",{attrs:{clearable:"",placeholder:"请输入内网IP"},on:{enter:t.handleSearch,clear:t.handleSearch},model:{value:t.paramsValue,callback:function(e){t.paramsValue=e},expression:"paramsValue"}})],1),t._v(" "),i("bk-icon",{staticClass:"refresh-icon",attrs:{type:"refresh"},on:{click:t.refreshInstanceList}})],1),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.instLoading,zIndex:10},expression:"{ isLoading: instLoading, zIndex: 10 }"}],staticStyle:{"padding-bottom":"20px"}},[i("ComTable",{ref:"instTable",attrs:{data:t.instanceList,columns:t.columns,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange,"filter-change":t.sourceFilterMethod},scopedSlots:t._u([{key:"status_display",fn:function(e){var n=e.row;return[i("span",{staticClass:"agent-status",style:t.setAgentStatus(n.status)}),t._v(" "),i("span",[t._v(t._s(n.status_display||"--"))])]}},{key:"operation",fn:function(e){return[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(i){return t.handleRelate(e.row)}}},[t._v("\n                                "+t._s(e.row.enabled?"取消关联":"关联")+"\n                            ")])]}}])})],1)])]),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticStyle:{"margin-left":"24px"},on:{click:t.handleCancel}},[t._v("关闭")])],1)])],1)}),[],!1,null,"7bf4272a",null),ni=ii.exports,ri=i("jAee"),oi=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ai=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return oi(e,t),e.prototype.handleCopy=function(){var t=document.createElement("input");document.body.appendChild(t),t.value=this.content,t.focus(),t.select(),document.execCommand("copy")&&document.execCommand("copy"),t.blur(),this.$success("复制成功"),document.body.removeChild(t)},e.prototype.handleDownload=function(){window.open("".concat(window.location.origin,"/download/weops-kubernetes.tgz"))},ai([Object(f.d)({type:[Number,String],default:function(){return"# 当集群可以使用公网镜像源时\n# 解压安装包\ntar -zxvf weops-kubernetes.tgz\nhelm install weops-collecter weops-kubenetes-discovery-3.11.0.tgz -n weops --create-namespace --set remoteWrtieUrl=http://$(接收数据的Prometheus IP，一版为weops的appt ip):$(接收数据的Prometheus端口，一般为9093)/api/v1/write\n\n# # 当集群不能使用公网镜像源时，需要手动导入镜像并推送到私有仓库中，压缩包里附带了需要用到的镜像文件，kube-state-metrics.tgz，node_exporter.tgz，cadvisor.tgz，prometheus.tgz\n# # 需要在helm install时指定本地仓库镜像\n# helm install weops-collecter weops-kubenetes-discovery-3.11.0.tgz -n weops --create-namespace \\\n# --set remoteWrtieUrl=http://$(接收数据的Prometheus IP，一般为weops的appt ip):$(接收数据的Prometheus端口，一般为9093)/api/v1/write \\\n# --set image.repository=$(prometheus的私有仓库，如10.10.10.10:5000prometheus) \\\n# --set kube-state-metrics.image.repository=$(kube-state-metrics的私有仓库，如10.10.10.10:5000kube-state-metrics) \\\n# --set cadvisor-exporter.image=$(cadvisor的私有仓库，如10.10.10.10:5000cadvisor):latest \\\n# --set node-exporter.image=$(node-exporter的私有仓库，如.10.10.10:5000cadvisor):latest"}})],e.prototype,"content",void 0),e=ai([Object(f.a)({components:{}})],e)}(f.e),li=si,ci=li,ui=Object(u.a)(ci,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"command-operator"},[i("div",{staticClass:"text-box"},[t._v("\n        "+t._s(t.content)+"\n    ")]),t._v(" "),i("div",{staticClass:"operation-area"},[i("i",{staticClass:"cw-icon weops-copy icon",on:{click:function(e){return e.stopPropagation(),t.handleCopy()}}}),t._v(" "),i("i",{staticClass:"cw-icon weops-download icon",on:{click:function(e){return e.stopPropagation(),t.handleDownload()}}})])])}),[],!1,null,"84cb469e",null),pi=ui.exports,di=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),fi=function(){return fi=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},fi.apply(this,arguments)},mi=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},hi=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},bi=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},gi=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]])}return i},yi=function(t,e,i){if(i||2===arguments.length)for(var n,r=0,o=e.length;r<o;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},vi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterCondition="",e.hostList=[],e.pageLoading=!1,e.selectedPlugin=[],e.selectedHosts=[],e.globalData=[],e.typeItem={},e.bkInstId="",e.bottomLoadingOptions={current:1,limit:10,size:"small",isLoading:!1,count:0},e.globalColumns=[{label:"插件ID",key:"plugin_id",minWidth:"100px"},{label:"参数ID",key:"name",minWidth:"100px"},{label:"参数说明",key:"description",minWidth:"100px"},{label:"参数值",key:"default",minWidth:"100px",scopedSlots:"default"}],e.targetColumns=[],e.groupColumns=[{type:"expand",scopedSlots:"expand"},{label:"分组名称",key:"name",minWidth:"200px"},{label:"Agent状态",key:"status",minWidth:"200px",scopedSlots:"status"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.otherColumns=[],e.targetData=[],e.formData={task_name:"",plugin:[],interval:null,hostIp:[],is_support_remote:!1,cmdb_model_field:null,collect_type:"BkPluginCollect",k8sTarget:""},e.pluginList=[],e.cmdbList=[],e.variablesList=[],e.rules={task_name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],is_support_remote:[{required:!0,message:"请选择采集类型",trigger:"blur"}],interval:[{required:!0,message:"请输入采集频率",trigger:"blur"}],plugin:[{required:!0,message:"请选择采集插件",trigger:"blur"}],cmdb_model_field:[{required:!0,message:"请选择CMDB模型IP字段",trigger:"blur"}],k8sTarget:[{required:!0,message:"请选择监控目标",trigger:"blur"}],hostIp:[{required:!0,message:"请指定采集主机",trigger:"blur"}]},e.btnLoading=!1,e.taskInfo={},e.propertyList=[],e.propertyData=[],e.icons=["icon-right-shape","icon-down-shape"],e.configStatus=!0,e.targetStatus=!0,e.instanceFields=[],e.relationList=[],e.k8sTargetList=[],e.objectSelectType="list",e}return di(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.taskDetial.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultPlugins",{get:function(){var t=this;return this.pluginList.filter((function(e){return e.is_support_remote===t.formData.is_support_remote}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canAddCmdp",{get:function(){return this.defaultPlugins.some((function(t){return"snmp"===t.plugin_type}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isK8s",{get:function(){return"k8s_cluster"===this.taskDetial.bkObjId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showTopo",{get:function(){return["SQL","middleware"].includes(this.taskDetial.parentNodeId)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listDisabled",{get:function(){return"group"===this.objectSelectType&&!!this.targetData.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupDisabled",{get:function(){return"list"===this.objectSelectType&&!!this.targetData.length},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){return hi(this,void 0,void 0,(function(){var t,e,i;return bi(this,(function(n){switch(n.label){case 0:return this.pageLoading=!0,this.isK8s?[3,2]:[4,this.getObjPropertyList()];case 1:return n.sent(),this.getMoudleIpList(),this.getCollectVariables(),[3,3];case 2:this.getK8sClusterList(),n.label=3;case 3:return t=this.taskDetial,e=t.bkObjId,i=t.name,this.typeItem={name:e,nameCn:i,label:i,listUrl:"getOtherResourceList",filedUrl:"getOtherResourceFields",updateFieldUrl:"updateOtherResourceFields",batchEditUrl:"modifyOtherResourceBulk",changeRecordUrl:"getOtherSrcChange"},this.getAppCustomFields(),!this.isK8s?[4,this.getCollectPlugin()]:[3,5];case 4:n.sent(),n.label=5;case 5:return this.isAdd?(this.initDataByAdd(),this.pageLoading=!1):this.getTaskInfo(),[2]}}))}))},e.prototype.connectHost=function(t){return hi(this,void 0,void 0,(function(){return bi(this,(function(e){switch(e.label){case 0:return this.bkInstId=t.bk_inst_id,[4,this.getObjRelationList(this.taskDetial.bkObjId)];case 1:return e.sent(),this.$refs.addRelation.showDialog(t),[2]}}))}))},e.prototype.getObjPropertyList=function(){return hi(this,void 0,void 0,(function(){var t;return bi(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getObjPropertyList({monitor_obj_id:this.taskDetial.id})];case 1:return(t=e.sent()).result?(this.propertyData=t.data,this.propertyList=t.data.map((function(t){return{label:t.bk_property_name,key:t.bk_property_id}})),this.otherColumns=yi(yi([{type:"expand",scopedSlots:"expand"}],this.propertyList,!0),[{label:"采集执行主机",scopedSlots:"ip_list",key:"ip_list"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],!1),[2]):(this.$error(t.message),[2])}}))}))},e.prototype.remoteSearch=function(t){this.filterCondition=t,this.bottomLoadingOptions.current=1,this.debounce(this.handleScrollToBottom,1e3)();var e=document.querySelector(".bk-options");e&&(e.scrollTop=0)},e.prototype.toggleOptions=function(t){this.filterCondition="";var e=document.querySelector(".bk-options");t?e.addEventListener("scroll",this.debounce(this.scrollEventListener,200),!1):e&&e.removeEventListener("scroll",this.debounce(this.scrollEventListener,200),!1)},e.prototype.scrollEventListener=function(){var t=document.querySelector(".bk-options"),e=t.clientHeight/(t.scrollHeight-t.scrollTop)>=.9,i=this.bottomLoadingOptions.current<Math.ceil(this.bottomLoadingOptions.count/10);e&&i&&(this.bottomLoadingOptions.current++,this.handleScrollToBottom())},e.prototype.debounce=function(t,e){return function(i){var n=this,r=i;clearTimeout(t.id),t.id=setTimeout((function(){t.call(n,r)}),e)}},e.prototype.getTaskInfo=function(){return hi(this,void 0,void 0,(function(){var t,e,i;return bi(this,(function(n){switch(n.label){case 0:this.pageLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),t={task_id:this.taskDetial.taskId},[4,this.$api.monitorCollect.getTaskInfo(t)];case 2:return e=n.sent(),i=e.data,e.result?(this.taskInfo=i,this.initDetailData(i),[3,4]):(this.$error(e.message),[2]);case 3:return this.pageLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getK8sClusterList=function(){return hi(this,void 0,void 0,(function(){var t;return bi(this,(function(e){switch(e.label){case 0:this.pageLoading=!0,e.label=1;case 1:return e.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getK8sClusterList()];case 2:return(t=e.sent()).result?(this.k8sTargetList=t.data,[3,4]):(this.$error(t.message),[2]);case 3:return this.pageLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.initDetailData=function(t){var e=this;for(var i in t)this.formData.hasOwnProperty(i)&&(this.formData[i]=t[i]);var n=t.task_plugins;this.formData.plugin=n.map((function(t){return t.plugin_id})),this.formData.interval=(null==n?void 0:n.length)?n[0].interval:null,this.formData.interval_unit=(null==n?void 0:n.length)?n[0].interval_unit:"min",this.formData.hostIp=(null==n?void 0:n.length)?n[0].remote_collect_hosts.map((function(t){return t.ip})):[],this.formData.cmdb_model_field=(null==n?void 0:n.length)?n[0].cmdb_model_field:null,this.targetData=t.target_list.map((function(t){var i=t.instance_detail;for(var r in t.childData=n.reduce((function(t,e){return t.concat(i.collect_params[e.plugin_id])}),[]),t.childColums=e.globalColumns,i)"collect_params"!==r&&(t[r]=i[r]);return fi({},t)})),this.objectSelectType=t.object_select_type,this.targetColumns=this.$copy("group"===this.objectSelectType?this.groupColumns:this.otherColumns)},e.prototype.handleScrollToBottom=function(){var t=this,e={plugin_id:this.formData.plugin[0],current:this.bottomLoadingOptions.current,size:this.bottomLoadingOptions.limit,search_ip:this.filterCondition};this.bottomLoadingOptions.isLoading=!0,this.$api.monitorCollect.getCollectHostList(e).then((function(e){if(e.result){if(1===t.bottomLoadingOptions.current)t.hostList=e.data.info;else{var i=t.hostList.map((function(t){return t.bk_host_id})),n=e.data.info.filter((function(t){return!i.includes(t.bk_host_id)}));t.hostList=t.hostList.concat(n)}t.bottomLoadingOptions.count=e.data.count}else t.$error(e.message)})).finally((function(){t.bottomLoadingOptions.isLoading=!1}))},e.prototype.changeHost=function(t){this.selectedHosts=this.hostList.filter((function(e){return t.includes(e.ip)}))},e.prototype.updateInstance=function(t){var e=this.targetData.findIndex((function(e){return e.bk_inst_id===t.bk_inst_id}));this.$set(this.targetData,e,t)},e.prototype.deleteInstance=function(t,e){this.targetData.splice(e,1)},e.prototype.getIplist=function(t){var e;return t.ip?t.ip:(null===(e=t.ip_list)||void 0===e?void 0:e.length)?t.ip_list[0].ip:"--"},e.prototype.getIp=function(t){var e=this.hostList.filter((function(e){return t.includes(e.ip)})).map((function(t){return t.bk_host_innerip}));return e.length?e.join("，"):"--"},e.prototype.getSelectedTargets=function(t){var e=this,i=this.$copy(t),n=i.data,r=i.type;this.objectSelectType=r,this.targetColumns=this.$copy("group"===r?this.groupColumns:this.otherColumns),n.forEach((function(t){t.childColums=e.globalColumns,t.childData=t.childData||e.globalData,t.target_id=t.target_id||e.getIplist(t)})),this.targetData=n,this.$nextTick((function(){e.$refs.monitorTable.updateColumns(e.targetColumns)}))},e.prototype.createTargetSuccess=function(t){var e=this.$copy(t);if(this.isK8s){var i={bk_inst_id:e.bk_inst_id,bk_inst_name:e.bk_inst_name};this.k8sTargetList.push(i),this.formData.k8sTarget=e.bk_inst_id}else e.childColums=this.globalColumns,e.childData=e.childData||this.globalData,e.target_id=e.target_id||this.getIplist(e),this.targetData.push(e)},e.prototype.handlePluginChange=function(t){this.selectedPlugin=this.pluginList.filter((function(e){return t.includes(e.plugin_id)})),this.formData.plugin.length&&this.handleScrollToBottom(),this.globalData=this.getGlobalData()},e.prototype.getGlobalData=function(){var t=this,e=!this.isAdd&&this.formData.is_support_remote===this.taskInfo.is_support_remote,i=e?this.taskInfo.task_plugins.map((function(t){return t.plugin_id})):[],n=(e?this.$copy(this.taskInfo.public_collect_config):[]).filter((function(e){return t.formData.plugin.includes(e.plugin_id)})),r=this.selectedPlugin.filter((function(t){return!i.includes(t.plugin_id)})).map((function(t){var e=t.config_json,i=gi(t,["config_json"]);return e.forEach((function(t){Object.assign(t,i)})),e})).flat();return r.forEach((function(t){t.value=t.default})),yi(yi([],n,!0),r,!0)},e.prototype.selectCollectType=function(){if(this.isAdd||this.formData.is_support_remote!==this.taskInfo.is_support_remote)return this.formData.plugin=this.defaultPlugins.map((function(t){return t.plugin_id})),void(this.targetData=[]);this.initDetailData(this.taskInfo)},e.prototype.initDataByAdd=function(){this.formData.task_name=this.taskDetial.bkObjName,this.formData.interval=5},e.prototype.motifyInstance=function(t){this.$refs.motifyInstance.show(t)},e.prototype.createTarget=function(){var t=this.$deepClone(this.instanceFields);t.forEach((function(t){t.children=t.children.filter((function(t){return!["录入方式","录入时间"].includes(t.bk_property_name)}))})),this.$refs.addResource.showDialog(this.typeItem,t)},e.prototype.selectTarget=function(){var t={objId:this.taskDetial.id,entry:"collect-others"};t.panels=[{name:"list",disabled:this.listDisabled},{name:"topo",hide:!this.showTopo,disabled:this.listDisabled},{name:"group",disabled:this.groupDisabled}],this.$refs.selectTargets.show(this.targetData,this.propertyData,t)},e.prototype.checkRecommend=function(){this.$refs.recommendVariable.show()},e.prototype.getCollectPlugin=function(){return hi(this,void 0,void 0,(function(){var t;return bi(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getCollectPlugin({monitor_obj_id:this.taskDetial.id})];case 1:return(t=e.sent()).result?(this.pluginList=t.data,this.isAdd&&this.selectCollectType(),[2]):(this.$error(t.message),[2])}}))}))},e.prototype.getMoudleIpList=function(){return hi(this,void 0,void 0,(function(){var t;return bi(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getFieldList({bk_obj_id:this.taskDetial.bkObjId})];case 1:return(t=e.sent()).result?(this.cmdbList=t.data,[2]):(this.$error(t.message),[2])}}))}))},e.prototype.getCollectVariables=function(){return hi(this,void 0,void 0,(function(){var t;return bi(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getCollectVariables({bk_obj_id:this.taskDetial.bkObjId})];case 1:return(t=e.sent()).result?(this.variablesList=t.data,[2]):(this.$error(t.message),[2])}}))}))},e.prototype.createK8sTask=function(){var t=this;this.configStatus=this.targetStatus=!0,setTimeout((function(){t.$refs.validateForm.validate().then((function(e){t.createK8sTaskRequest()}))}),0)},e.prototype.createTask=function(){var t=this;this.configStatus=this.targetStatus=!0,setTimeout((function(){t.$refs.validateForm.validate().then((function(e){t.targetData.length?t.createTaskRequest():t.$error("监控目标不能为空！")}))}),0)},e.prototype.createK8sTaskRequest=function(){return hi(this,void 0,void 0,(function(){var t,e,i,n=this;return bi(this,(function(r){switch(r.label){case 0:this.btnLoading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),t={task_name:this.formData.task_name,period:this.formData.interval,cluster_inst_id:this.formData.k8sTarget},(e=this.k8sTargetList.find((function(t){return t.bk_inst_id===n.formData.k8sTarget})))&&(t.target_k8s_cluster=e.bk_inst_name),[4,this.$api.monitorCollect.addK8sCollect(t)];case 2:return(i=r.sent()).result?(this.$success("新建成功"),this.$emit("refreshTable"),this.taskDetial.status=!1,[3,4]):(this.$error(i.message),[2]);case 3:return this.btnLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.createTaskRequest=function(){return hi(this,void 0,void 0,(function(){var t,e,i,n;return bi(this,(function(r){switch(r.label){case 0:this.btnLoading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),t=this.getParams(),this.isAdd||t.target_list.forEach((function(t){for(var e in t.collect_params)t.instance_detail.collect_params.hasOwnProperty(e)&&(t.collect_params[e].params=t.instance_detail.collect_params[e])})),e="createCollectTask",i="新增任务成功",this.isAdd||(t.task_id=this.taskDetial.taskId,e="updateCollectTask",i="修改任务成功"),[4,this.$api.monitorCollect[e](t)];case 2:return(n=r.sent()).result?(this.$success(i),this.$emit("refreshTable"),this.taskDetial.status=!1,[3,4]):(this.$error(n.message),[2]);case 3:return this.btnLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this,e={},i=this.taskDetial,n=i.name,r=i.id;e.task_name=this.formData.task_name,e.bk_obj_name=n,e.monitor_obj=r;var o=this.$copy(this.selectedPlugin);return o.forEach((function(e){e.interval=t.formData.interval,e.interval_unit="min",e.remote_collect_hosts=[],e.cmdb_model_field=t.formData.cmdb_model_field,e.remote_collect_hosts=t.selectedHosts})),e.plugins=o,e.object_select_type=this.objectSelectType,e.collect_type=this.formData.collect_type,e.target_count=this.targetData.length,e.collect_config=this.globalData.map((function(t){return fi(fi({},t),{value:t.value})})),e.target_list=this.handleTargetList(this.$copy(this.targetData),this.$copy(e.plugins)),e},e.prototype.handleTargetList=function(t,e){var i=this,n=[];return t.forEach((function(t){var r=(t.ip_list||[{ip:t.ip,target_id:t.ip}]).find((function(e){return e.ip===t.target_id}))||{},o=fi(fi(fi({collect_params:i.formatCollectParams(e,t)},t),r),{instance_detail:fi(fi(fi({},t),r),{has_modify_collect_params:0,collect_params:i.formatParams(e,t)}),has_modify_collect_params:0});"group"===i.objectSelectType&&(o.name=t.name,o.id=t.id),n.push(o)})),n},e.prototype.formatCollectParams=function(t,e){var i={};return t.forEach((function(t){t.params=e.childData,i[t.plugin_id]=t})),i},e.prototype.formatParams=function(t,e){var i={};return t.forEach((function(t){i[t.plugin_id]=e.childData})),i},e.prototype.cancel=function(){this.taskDetial.status=!1},e.prototype.getAppCustomFields=function(){return hi(this,void 0,void 0,(function(){var t,e;return bi(this,(function(i){switch(i.label){case 0:return(t={}).bk_obj_id=this.typeItem.name,[4,this.$api.Resource[this.typeItem.filedUrl](t)];case 1:return(e=i.sent()).result?(this.handleAllFields(e.data.all_field),[2]):(this.$error(e.message),[2])}}))}))},e.prototype.handleAllFields=function(t){var e=this;t.forEach((function(t,i){"list"!==t.bk_property_type&&"bool"!==t.bk_property_type||("list"===t.bk_property_type&&(t.option=t.option.map((function(t){return{id:t,name:t}}))),"bool"===t.bk_property_type&&(t.option=[{id:!0,name:"是"},{id:!1,name:"否"}])),t.checked=!1,t.batchValue="",t.editStatus=!1,t.editValue="",t.editLoading=!1,t.editIconShow=!1,e.buildFieldData(t,e.instanceFields)}))},e.prototype.buildFieldData=function(t,e){var i=e.findIndex((function(e){return e.key===t.bk_property_group}));-1===i?e.push({title:t.bk_property_group_name,children:[t],key:t.bk_property_group,collapseStatus:!0,id:this.$random(3)}):e[i].children.push(t)},e.prototype.getObjRelationList=function(t){return hi(this,void 0,void 0,(function(){var e;return bi(this,(function(i){switch(i.label){case 0:return i.trys.push([0,,2,3]),[4,this.$api.Resource.getObjRelationList({bk_obj_id:t})];case 1:return(e=i.sent()).result?(this.relationList=e.data,[3,3]):[2,this.$error(e.message)];case 2:return this.$refs.addRelation.getInstanceList(this.relationList[0]),[7];case 3:return[2]}}))}))},mi([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"taskDetial",void 0),e=mi([Object(f.a)({components:{RecommendVariable:ze,SelectTargets:lt.a,ComTable:st.a,MotifyInstance:Ue,AddRelation:ni,AddResource:ri.a,CommandOperator:pi,IntroduceInfo:Vt}})],e)}(f.e),_i=vi,ki=_i,wi=Object(u.a)(ki,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],staticClass:"plugin"},[i("div",{staticClass:"plugin-title"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.cancel}}),t._v("\n        "+t._s("add"===t.taskDetial.type?"新建采集":"修改采集")+"\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskDetial.type,expression:"taskDetial.type === 'modify'"}],staticClass:"sub-title line"},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskDetial.type,expression:"taskDetial.type === 'modify'"}],staticClass:"sub-title"},[t._v(t._s(t.taskDetial.subTitle))])],1),t._v(" "),i("div",{staticStyle:{position:"relative"}},[t.isK8s?i("bk-form",{ref:"validateForm",staticClass:"plugin-form",attrs:{"label-width":85,model:t.formData,rules:t.rules}},[i("bk-form-item",{staticClass:"task-name",attrs:{label:"任务名称",required:"",property:"task_name","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入任务名称",clearable:""},model:{value:t.formData.task_name,callback:function(e){t.$set(t.formData,"task_name",e)},expression:"formData.task_name"}})],1),t._v(" "),i("bk-card",{staticClass:"card-item",attrs:{title:"1、选择采集目标","is-collapse":!0,"collapse-status":t.targetStatus,"collapse-icons":t.icons},on:{"update:collapseStatus":function(e){t.targetStatus=e},"update:collapse-status":function(e){t.targetStatus=e}}},[i("bk-form-item",{attrs:{label:"监控目标",required:"",property:"k8sTarget","error-display-type":"normal"}},[i("div",{staticClass:"monitor-target"},[i("bk-select",{staticClass:"mr10",staticStyle:{width:"500px"},attrs:{searchable:"",placeholder:"请选择K8S集群"},model:{value:t.formData.k8sTarget,callback:function(e){t.$set(t.formData,"k8sTarget",e)},expression:"formData.k8sTarget"}},t._l(t.k8sTargetList,(function(t){return i("bk-option",{key:t.bk_inst_id,attrs:{id:t.bk_inst_id,name:t.bk_inst_name}})})),1),t._v(" "),i("span",{staticClass:"description"},[t._v("若无监控采集目标，请先")]),t._v(" "),i("bk-button",{staticClass:"add-target",attrs:{theme:"primary",text:"",size:"small"},on:{click:t.createTarget}},[t._v("\n                            添加资产\n                        ")])],1)])],1),t._v(" "),i("bk-card",{staticClass:"card-item",attrs:{title:"2、监控采集配置","is-collapse":!0,"collapse-icons":t.icons,"collapse-status":t.configStatus},on:{"update:collapseStatus":function(e){t.configStatus=e},"update:collapse-status":function(e){t.configStatus=e}}},[i("bk-form-item",{attrs:{label:"采集频率",required:"",property:"interval","error-display-type":"normal"}},[i("div",{staticClass:"interval"},[i("bk-input",{staticClass:"mr10",staticStyle:{width:"500px"},attrs:{type:"number",precision:0,min:1},model:{value:t.formData.interval,callback:function(e){t.$set(t.formData,"interval",e)},expression:"formData.interval"}}),t._v("分钟\n                    ")],1)]),t._v(" "),i("div",{staticClass:"command-title"},[t._v("请在您的K8S集群中运行以下命令，将监控数据传入WeOps：")]),t._v(" "),i("CommandOperator",{staticStyle:{width:"80%"}})],1)],1):i("bk-form",{ref:"validateForm",staticClass:"plugin-form",attrs:{"label-width":85,model:t.formData,rules:t.rules}},[i("bk-form-item",{staticClass:"task-name",attrs:{label:"任务名称",required:"",property:"task_name","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入任务名称",clearable:""},model:{value:t.formData.task_name,callback:function(e){t.$set(t.formData,"task_name",e)},expression:"formData.task_name"}})],1),t._v(" "),i("bk-card",{staticClass:"card-item",attrs:{title:"1、监控采集配置","is-collapse":!0,"collapse-status":t.configStatus,"collapse-icons":t.icons},on:{"update:collapseStatus":function(e){t.configStatus=e},"update:collapse-status":function(e){t.configStatus=e}}},[i("bk-form-item",{attrs:{label:"采集类型",property:"is_support_remote","error-display-type":"normal",required:""}},[i("bk-radio-group",{staticClass:"collect-type",on:{change:t.selectCollectType},model:{value:t.formData.is_support_remote,callback:function(e){t.$set(t.formData,"is_support_remote",e)},expression:"formData.is_support_remote"}},[i("bk-radio",{attrs:{value:!1}},[t._v("本地采集")]),t._v(" "),i("bk-radio",{attrs:{value:!0}},[t._v("远程采集")])],1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"采集插件",required:"",property:"plugin","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{multiple:"",searchable:""},on:{change:t.handlePluginChange},model:{value:t.formData.plugin,callback:function(e){t.$set(t.formData,"plugin",e)},expression:"formData.plugin"}},t._l(t.defaultPlugins,(function(t){return i("bk-option",{key:t.plugin_id,attrs:{id:t.plugin_id,name:t.plugin_display_name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"采集频率",required:"",property:"interval","error-display-type":"normal"}},[i("div",{staticClass:"interval"},[i("bk-input",{staticClass:"mr10",staticStyle:{width:"500px"},attrs:{type:"number",precision:0,min:1},model:{value:t.formData.interval,callback:function(e){t.$set(t.formData,"interval",e)},expression:"formData.interval"}}),t._v("分钟\n                    ")],1)]),t._v(" "),t.formData.is_support_remote?i("bk-form-item",{attrs:{label:"指定采集主机","error-display-type":"normal",required:"",property:"hostIp"}},[i("bk-select",{staticClass:"scroll-select",staticStyle:{width:"500px"},attrs:{multiple:"",searchable:"","display-tag":"",loading:t.bottomLoadingOptions.isLoading,"remote-method":t.remoteSearch},on:{toggle:t.toggleOptions,change:t.changeHost},model:{value:t.formData.hostIp,callback:function(e){t.$set(t.formData,"hostIp",e)},expression:"formData.hostIp"}},[t._l(t.hostList,(function(t){return i("bk-option",{key:t.bk_host_id,attrs:{id:t.ip,disabled:"异常"===t.agent_status,name:t.bk_host_innerip}})})),t._v(" "),i("bk-option",{directives:[{name:"show",rawName:"v-show",value:t.bottomLoadingOptions.isLoading,expression:"bottomLoadingOptions.isLoading"}],staticStyle:{"text-align":"center"},attrs:{name:"加载中...",id:"plus+",disabled:""}})],2)],1):t._e(),t._v(" "),t.canAddCmdp?i("bk-form-item",{attrs:{label:"CMDB模型IP字段",required:"",property:"cmdb_model_field","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{searchable:"","ext-cls":"select-custom","display-tag":""},model:{value:t.formData.cmdb_model_field,callback:function(e){t.$set(t.formData,"cmdb_model_field",e)},expression:"formData.cmdb_model_field"}},t._l(t.cmdbList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):t._e()],1),t._v(" "),i("bk-card",{staticClass:"card-item",attrs:{title:"2、选择采集目标","is-collapse":!0,"collapse-icons":t.icons,"collapse-status":t.targetStatus},on:{"update:collapseStatus":function(e){t.targetStatus=e},"update:collapse-status":function(e){t.targetStatus=e}}},[i("bk-form-item",{attrs:{label:"监控目标",required:"",property:"username","error-display-type":"normal"}},[i("bk-button",{staticClass:"mr10",attrs:{disabled:!t.formData.plugin.length},on:{click:t.selectTarget}},[t._v("\n                        选择目标\n                    ")]),t._v(" "),i("span",{staticClass:"description"},[t._v("若无监控采集目标，请先")]),t._v(" "),i("bk-button",{staticClass:"add-target",attrs:{theme:"primary",text:"",size:"small"},on:{click:t.createTarget}},[t._v("\n                        添加资产\n                    ")]),t._v(" "),i("div",{staticClass:"check-recommend"},[i("bk-icon",{attrs:{type:"info-circle-shape"}}),t._v(" "),i("span",[t._v("文本参数值的填写也可以使用资产配置信息")]),t._v(" "),i("bk-button",{attrs:{text:"",size:"small"},on:{click:t.checkRecommend}},[t._v("\n                            点击查看推荐变量\n                        ")])],1),t._v(" "),t.targetColumns.length&&t.targetData.length?i("div",{staticClass:"instance-table"},[i("ComTable",{ref:"monitorTable",attrs:{data:t.targetData,columns:t.targetColumns},scopedSlots:t._u([{key:"operation",fn:function(e){var n=e.row,r=e.index;return[i("div",[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.motifyInstance(n)}}},[t._v("修改")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.deleteInstance(n,r)}}},[t._v("删除")])],1)]}},{key:"status",fn:function(e){var n=e.row;return[i("span",{staticStyle:{color:"#ff0000"}},[t._v(t._s(n.error_count))]),t._v(" / "),i("span",[t._v(t._s(n.all_count))])]}},{key:"ip_list",fn:function(e){var n=e.row;return[t.formData.is_support_remote&&t.formData.hostIp.length?i("div",[t._v(t._s(t.getIp(t.formData.hostIp)))]):i("div",[n.ip_list&&n.ip_list.length>1?i("bk-select",{key:n.id,staticStyle:{width:"80%"},attrs:{searchable:"",clearable:!1},model:{value:n.target_id,callback:function(e){t.$set(n,"target_id",e)},expression:"row.target_id"}},t._l(n.ip_list,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.ip,name:t.ip}})})),1):n.ip?i("span",[t._v(t._s(n.ip))]):n.ip_list&&1===n.ip_list.length?i("span",[t._v(t._s(n.ip_list[0].ip))]):i("bk-button",{attrs:{theme:"primary"},on:{click:function(e){return t.connectHost(n)}}},[t._v("关联主机")])],1)]}},{key:"expand",fn:function(e){var n=e.row;return[i("ComTable",{ref:"table",attrs:{data:n.childData,columns:n.childColums},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.value||"--"))])]}}],null,!0)})]}}],null,!1,3198481777)})],1):t._e(),t._v(" "),i("div",{staticClass:"target-table"},[i("span",{staticClass:"target-table-title"},[t._v("全局变量")]),t._v(" "),i("ComTable",{ref:"table",attrs:{data:t.globalData,columns:t.globalColumns},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[i("bk-input",{model:{value:n.value,callback:function(e){t.$set(n,"value",e)},expression:"row.value"}})]}}])})],1)],1)],1)],1),t._v(" "),i("introduce-info",{attrs:{type:t.taskDetial.bkObjId}})],1),t._v(" "),i("div",{staticClass:"operation"},[t.isK8s?i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",loading:t.btnLoading,disabled:t.pageLoading},on:{click:t.createK8sTask}},[t._v("\n            确认\n        ")]):i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",loading:t.btnLoading,disabled:t.pageLoading},on:{click:t.createTask}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{on:{click:t.cancel}},[t._v("\n            取消\n        ")])],1),t._v(" "),i("RecommendVariable",{ref:"recommendVariable",attrs:{"variable-data":t.variablesList}}),t._v(" "),i("SelectTargets",{ref:"selectTargets",on:{getSelectedTargets:t.getSelectedTargets}}),t._v(" "),i("MotifyInstance",{ref:"motifyInstance",on:{updateInstance:t.updateInstance}}),t._v(" "),i("AddRelation",{ref:"addRelation",attrs:{"inst-id":t.bkInstId,list:t.relationList}}),t._v(" "),i("AddResource",{ref:"addResource",on:{"on-success":t.createTargetSuccess}})],1)}),[],!1,null,"c79243f6",null),xi=wi.exports,Ci=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Di=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},ji=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Oi=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Li=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.statusData=[],e.initTableData=[],e.timer=null,e.columns=[{type:"selection"},{label:"实例名称",key:"bk_inst_name",minWidth:"200px"},{label:"采集主机",key:"ip",minWidth:"200px"},{label:"插件名称",key:"plugin_name",minWidth:"200px"},{label:"状态",key:"task_status_display",minWidth:"100px"},{label:"详情",key:"message",minWidth:"200px"},{label:"操作",key:"operation",width:"160px",prop:"operation",fixed:"right",scopedSlots:"operation"}],e.selectedTableData=[],e}return Ci(e,t),e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-240,window.onresize=function(){t.maxHeight=window.innerHeight-240}},e.prototype.mounted=function(){return ji(this,void 0,void 0,(function(){return Oi(this,(function(t){return this.getCollecTaskStatus(),[2]}))}))},e.prototype.beforeDestroy=function(){this.clearTimer()},Object.defineProperty(e.prototype,"canRetry",{get:function(){return!this.selectedTableData.filter((function(t){return"FAILED"===t.running_status})).length},enumerable:!1,configurable:!0}),e.prototype.updateCollecTaskStatus=function(){var t=this;this.clearTimer(),this.timer=setInterval((function(){t.getCollecTaskStatus("update")}),1e4)},e.prototype.clearTimer=function(){this.timer&&clearInterval(this.timer)},e.prototype.handleEnter=function(){this.getCollecTaskStatus()},e.prototype.selectTableData=function(t){this.selectedTableData=t},e.prototype.selectAllTableData=function(t){this.selectedTableData=t},e.prototype.getCollecTaskStatus=function(t){return ji(this,void 0,void 0,(function(){var e,i,n,r,o,a,s=this;return Oi(this,(function(l){switch(l.label){case 0:this.clearTimer(),this.tableLoading="update"!==t,e=this.getParams(),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getCollecTaskStatus(e)];case 2:return i=l.sent(),n=i.result,r=i.data,o=i.is_need_sync,a=i.message,n?(this.statusData=r,this.$nextTick((function(){s.statusData.forEach((function(t){s.selectedTableData.find((function(e){return e.id===t.id}))&&s.$refs.table.toggleRowSelection(t,!0)}))})),o&&this.updateCollecTaskStatus(),[3,4]):(this.$error(a),this.clearTimer(),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){return{task_id:this.statusInfo.id,search:this.search}},e.prototype.operationEvent=function(t,e){return ji(this,void 0,void 0,(function(){var i,n,r,o;return Oi(this,(function(a){switch(a.label){case 0:return i=t.map((function(t){return t.id})),n=t.map((function(t){return t.bk_inst_name})),r={task_inst_ids:i,task_name:this.statusInfo.taskName,inst_name_list:n},this.tableLoading=!0,[4,this.$api.monitorCollect[e](r)];case 1:return(o=a.sent()).result?(this.getCollecTaskStatus(),[2]):(this.$error(o.message),this.tableLoading=!1,[2])}}))}))},e.prototype.goBack=function(){this.statusInfo.status=!1},Di([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"statusInfo",void 0),e=Di([Object(f.a)({components:{ComTable:st.a}})],e)}(f.e),Ti=Li,Si=Ti,Ii=Object(u.a)(Si,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"status-manage"},[i("div",{staticClass:"title-box"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}}),t._v(" "),i("span",[t._v("状态管理")]),t._v(" "),i("span",{staticClass:"sub-title line"},[t._v(" - ")]),t._v(" "),i("span",{staticClass:"sub-title"},[t._v(t._s(t.statusInfo.taskName))])],1),t._v(" "),i("div",{staticClass:"nav-area"},[i("div",{staticClass:"nav-area-left"},[i("bk-dropdown-menu",{ref:"dropdown",staticStyle:{height:"32px"}},[i("bk-button",{attrs:{slot:"dropdown-trigger",theme:"default","icon-right":"icon-angle-down",disabled:!t.selectedTableData.length},slot:"dropdown-trigger"},[t._v("\n                    实例操作\n                ")]),t._v(" "),i("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[i("li",[i("bk-button",{attrs:{theme:"primary",text:"",size:"small",disabled:t.canRetry},on:{click:function(e){return t.operationEvent(t.selectedTableData,"retrytask")}}},[t._v("\n                            重试\n                        ")])],1),t._v(" "),i("li",[i("bk-button",{attrs:{theme:"primary",text:"",size:"small",disabled:!t.selectedTableData.length},on:{click:function(e){return t.operationEvent(t.selectedTableData,"startTask")}}},[t._v("\n                            启动\n                        ")])],1),t._v(" "),i("li",[i("bk-button",{attrs:{theme:"primary",text:"",size:"small",disabled:!t.selectedTableData.length},on:{click:function(e){return t.operationEvent(t.selectedTableData,"stopTask")}}},[t._v("\n                            停止\n                        ")])],1)])],1)],1),t._v(" "),i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入实例名称或采集主机",clearable:""},on:{enter:t.handleEnter},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.statusData,columns:t.columns,"max-height":t.maxHeight},on:{select:t.selectTableData,"select-all":t.selectAllTableData},scopedSlots:t._u([{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:"FAILED"!==n.running_status},on:{click:function(e){return t.operationEvent([n],"retrytask")}}},[t._v("\n                        重试\n                    ")]),t._v(" "),"STOPPED"===n.task_status?i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.operationEvent([n],"startTask")}}},[t._v("\n                        启动\n                    ")]):i("bk-button",{attrs:{theme:"primary",text:"",disabled:"STARTED"!==n.task_status},on:{click:function(e){return t.operationEvent([n],"stopTask")}}},[t._v("\n                        停止\n                    ")])],1)]}}])})],1)])}),[],!1,null,"338eb1d8",null),Pi=Ii.exports,$i=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Mi=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Ni=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Ai=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Ei=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.monitorData=[],e.timer=null,e.columns=[{label:"任务名称",key:"task_name",minWidth:"200px"},{label:"采集插件",key:"port",minWidth:"100px",scopedSlots:"taskPlugins"},{label:"运行状态",key:"status",minWidth:"100px",scopedSlots:"status"},{label:"目标",key:"target_count",minWidth:"100px"},{label:"创建者",key:"created_by",minWidth:"100px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:20},e.taskInfo={},e.statusInfo={},e}return $i(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&this.getObjCollectTask()},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.beforeDestroy=function(){this.clearTimer()},e.prototype.changeStatus=function(){this.taskInfo.status=!1,this.statusInfo.status=!1},e.prototype.setPlugins=function(t){var e=t.task_plugins,i="--";return(null==e?void 0:e.length)&&(i=e.reduce((function(t,e){return t+"".concat(e.plugin_id,",")}),"").slice(0,-1)),i},e.prototype.linkTostatusManage=function(t){var e=t.id,i=t.task_name;this.$BtnPermission(this.permissionObj)&&(this.statusInfo={status:!0,id:e,taskName:i})},e.prototype.linkToPlugin=function(t,e){if(this.$BtnPermission(this.permissionObj)){var i=this.currentNode,n=i.bk_obj_name,r=i.id,o=i.bk_obj_id;this.taskInfo={bkObjName:n+"监控"+Y()().format("YYYYMMDDHHmmss"),id:r,type:t,bkObjId:o,name:n,taskId:null==e?void 0:e.id,status:!0,subTitle:null==e?void 0:e.task_name,parentNodeId:this.parentNode.id}}},e.prototype.setAgentStatus=function(t){switch(t){case"正常":return{borderColor:"#e5f6ea",backgroundColor:"#3fc06d"};case"异常":case"失败":case"部分失败":return{borderColor:"#ffe6e6",backgroundColor:"#ea3636"};default:return{borderColor:"#f0f1f5",backgroundColor:"#b2b5bd"}}},e.prototype.handleChange=function(t){return Ni(this,void 0,void 0,(function(){var e,i,n,r,o;return Ai(this,(function(a){switch(a.label){case 0:return e=t.id,i=t.is_enable,n=t.name,r={id:e,is_enable:i,name:n},this.tableLoading=!0,[4,this.$api.selfCureProcess.updateStatus(r)];case 1:return(o=a.sent()).result?(this.$message.success("操作成功"),this.getObjCollectTask(),[2]):(this.$error(o.message),this.tableLoading=!1,[2])}}))}))},e.prototype.getObjCollectTask=function(t){return Ni(this,void 0,void 0,(function(){var e,i,n,r,o,a;return Ai(this,(function(s){switch(s.label){case 0:this.clearTimer(),this.tableLoading="update"!==t,e=this.getParams(),s.label=1;case 1:return s.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getObjCollectTask(e)];case 2:return i=s.sent(),n=i.result,r=i.data,o=i.is_need_sync,a=i.message,n?(this.monitorData=r.results,this.pagination.count=r.count,o&&this.updateObjCollectTask(),[3,4]):(this.$error(a),this.clearTimer(),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.updateObjCollectTask=function(){var t=this;this.clearTimer(),this.timer=setInterval((function(){t.getObjCollectTask("update")}),1e4)},e.prototype.clearTimer=function(){this.timer&&clearInterval(this.timer)},e.prototype.getParams=function(){var t=this.pagination;return{page_size:t.limit,page:t.current,task_name:this.search,bk_obj_id:this.currentNode.bk_obj_id}},e.prototype.handleDelete=function(t){return Ni(this,void 0,void 0,(function(){var e=this;return Ai(this,(function(i){return this.$BtnPermission(this.permissionObj)?(this.$bkInfo({title:"提示",subTitle:"确定删除该任务？",theme:"primary",confirmFn:function(){e.confirmDeleteTask(t)}}),[2]):[2]}))}))},e.prototype.confirmDeleteTask=function(t){return Ni(this,void 0,void 0,(function(){var e,i;return Ai(this,(function(n){switch(n.label){case 0:return this.tableLoading=!0,e={task_id:t.id,task_name:t.task_name,bk_obj_name:this.currentNode.bk_obj_name},[4,this.$api.monitorCollect.deleteCollectTask(e)];case 1:return(i=n.sent()).result?(this.$message.success("删除成功"),this.pagination.current>1&&1===this.monitorData.length&&this.pagination.current--,this.refreshTree(this.currentNode),this.getObjCollectTask(),[2]):(this.$message.error(i.message),this.tableLoading=!1,[2])}}))}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getObjCollectTask()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getObjCollectTask()},e.prototype.refreshTree=function(t){return t},e.prototype.refreshTable=function(){this.getObjCollectTask()},Mi([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),Mi([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"parentNode",void 0),Mi([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),Mi([Object(f.b)("refreshTree")],e.prototype,"refreshTree",null),e=Mi([Object(f.a)({components:{ComTable:st.a,AddPlugin:xi,StatusManage:Pi}})],e)}(f.e),Ri=Ei,qi=Ri,zi=Object(u.a)(qi,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"monitor"},[t.statusInfo.status||t.taskInfo.status?t._e():i("div",{staticClass:"monitor-list"},[i("div",{staticClass:"nav-area"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.linkToPlugin("add")}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入任务名称",clearable:""},on:{enter:t.getObjCollectTask},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.monitorData,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return["部署中"!==n.status?i("span",{staticClass:"agent-status",style:t.setAgentStatus(n.status)}):i("bk-spin",{staticClass:"agent-loading",attrs:{size:"mini"}}),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.linkTostatusManage(n)}}},[t._v("\n                        "+t._s(n.status)+"\n                    ")])]}},{key:"taskPlugins",fn:function(e){var n=e.row;return[i("span",[t._v(t._s(t.setPlugins(n)))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.linkToPlugin("modify",n)}}},[t._v("\n                            修改\n                        ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDelete(n)}}},[t._v("\n                            删除\n                        ")])],1)]}}],null,!1,2344638293)})],1)]),t._v(" "),t.statusInfo.status?i("StatusManage",{attrs:{"status-info":t.statusInfo}}):t._e(),t._v(" "),t.taskInfo.status?i("AddPlugin",{staticClass:"plugin-operation",attrs:{"task-detial":t.taskInfo},on:{refreshTable:t.refreshTable}}):t._e()],1)}),[],!1,null,"c72e7dc2",null),Fi=zi.exports,Hi=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Bi=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Vi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.row={},e.content="helm uninstall weops-collecter -n weops",e}return Hi(e,t),e.prototype.confirmDelete=function(t){return t},e.prototype.show=function(t){this.row=t,this.visible=!0},e.prototype.closeDialog=function(){this.visible=!1},e.prototype.handleConfirm=function(){this.confirmDelete(this.row)},Bi([Object(f.b)("confirmDelete")],e.prototype,"confirmDelete",null),e=Bi([Object(f.a)({components:{CommandOperator:pi}})],e)}(f.e),Wi=Vi,Gi=Wi,Ui=Object(u.a)(Gi,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"delete-dialog"},[i("bk-dialog",{attrs:{"render-directive":"if","mask-close":!1,"close-icon":!1,"header-position":"center",width:600,title:"提示"},on:{confirm:t.handleConfirm},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{staticClass:"mb10"},[t._v("请在您的K8S集群中运行以下命令，关闭数据传输进程：")]),t._v(" "),i("CommandOperator",{attrs:{content:t.content}}),t._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"footer-operation"},[i("bk-button",{staticClass:"mr20",attrs:{theme:"primary"},on:{click:t.handleConfirm}},[t._v("\n                    已关闭\n                ")]),t._v(" "),i("bk-button",{on:{click:t.closeDialog}},[t._v("\n                    取消\n                ")])],1)])],1)],1)}),[],!1,null,"64db6057",null),Ki=Ui.exports,Yi=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Xi=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Ji=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Zi=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Qi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.monitorData=[],e.timer=null,e.columns=[{label:"任务名称",key:"task_name",minWidth:"200px"},{label:"K8S集群",key:"target_k8s_cluster",minWidth:"100px"},{label:"运行状态",key:"status",minWidth:"100px",scopedSlots:"status"},{label:"创建者",key:"created_by",minWidth:"100px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:20},e.taskInfo={},e}return Yi(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&this.getObjCollectTask()},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.linkToPlugin=function(t,e){if(this.$BtnPermission(this.permissionObj)){var i=this.currentNode,n=i.bk_obj_name,r=i.id,o=i.bk_obj_id;this.taskInfo={bkObjName:n+"监控"+Y()().format("YYYYMMDDHHmmss"),id:r,type:t,bkObjId:o,name:n,taskId:null==e?void 0:e.id,status:!0,subTitle:null==e?void 0:e.task_name}}},e.prototype.setAgentStatus=function(t){switch(t){case"正常":return{borderColor:"#e5f6ea",backgroundColor:"#3fc06d"};case"异常":case"失败":case"部分失败":return{borderColor:"#ffe6e6",backgroundColor:"#ea3636"};default:return{borderColor:"#f0f1f5",backgroundColor:"#b2b5bd"}}},e.prototype.handleChange=function(t){return Ji(this,void 0,void 0,(function(){var e,i,n,r,o;return Zi(this,(function(a){switch(a.label){case 0:return e=t.id,i=t.is_enable,n=t.name,r={id:e,is_enable:i,name:n},this.tableLoading=!0,[4,this.$api.selfCureProcess.updateStatus(r)];case 1:return(o=a.sent()).result?(this.$message.success("操作成功"),this.getObjCollectTask(),[2]):(this.$error(o.message),this.tableLoading=!1,[2])}}))}))},e.prototype.getObjCollectTask=function(){return Ji(this,void 0,void 0,(function(){var t,e,i,n,r;return Zi(this,(function(o){switch(o.label){case 0:this.tableLoading=!0,t=this.getParams(),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getK8sCollect(t)];case 2:return e=o.sent(),i=e.result,n=e.data,r=e.message,i?(this.monitorData=n.items,this.pagination.count=n.count,[3,4]):(this.$error(r),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this.pagination;return{page_size:t.limit,page:t.current,task_name:this.search}},e.prototype.handleDelete=function(t){return Ji(this,void 0,void 0,(function(){return Zi(this,(function(e){return this.$BtnPermission(this.permissionObj)?(this.$refs.deleteDialog.show(t),[2]):[2]}))}))},e.prototype.confirmDeleteTask=function(t){return Ji(this,void 0,void 0,(function(){var e,i;return Zi(this,(function(n){switch(n.label){case 0:return this.tableLoading=!0,e={id:t.id},[4,this.$api.monitorCollect.deleteK8sCollect(e)];case 1:return(i=n.sent()).result?(this.$message.success("删除成功"),this.pagination.current>1&&1===this.monitorData.length&&this.pagination.current--,this.$refs.deleteDialog.closeDialog(),this.refreshTree(this.currentNode),this.getObjCollectTask(),[2]):(this.$message.error(i.message),this.tableLoading=!1,[2])}}))}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getObjCollectTask()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getObjCollectTask()},e.prototype.refreshTable=function(){this.refreshTree(this.currentNode),this.getObjCollectTask()},e.prototype.changeStatus=function(){this.taskInfo.status=!1},e.prototype.refreshTree=function(t){return t},Xi([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),Xi([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),Xi([Object(f.b)("refreshTree")],e.prototype,"refreshTree",null),e=Xi([Object(f.a)({components:{ComTable:st.a,DeleteDialog:Ki,AddPlugin:xi}})],e)}(f.e),tn=Qi,en=tn,nn=Object(u.a)(en,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"monitor"},[t.taskInfo.status?i("AddPlugin",{staticClass:"plugin-operation",attrs:{"task-detial":t.taskInfo},on:{refreshTable:t.refreshTable}}):i("div",{staticClass:"monitor-list"},[i("div",{staticClass:"nav-area"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.linkToPlugin("add")}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入任务名称",clearable:""},on:{enter:t.getObjCollectTask},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.monitorData,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("span",{staticClass:"agent-status",style:t.setAgentStatus(n.status)}),t._v(" "),i("span",[t._v(t._s(n.status))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDelete(n)}}},[t._v("\n                            删除\n                        ")])],1)]}}],null,!1,1228629976)})],1)]),t._v(" "),i("DeleteDialog",{ref:"deleteDialog",on:{confirmDelete:t.confirmDeleteTask}})],1)}),[],!1,null,"495ea0ea",null),rn=nn.exports,on=i("ceJc"),an=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),sn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},ln=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},cn=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},un=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.confirmLoading=!1,e.form={name:"",vcenter:"",period:5,credential:""},e.formV2={},e.voucherList=[],e.modalLoading=!1,e.moduleCredDesign=-1,e.evidenceFormParams=[],e.instanceFields=[],e.typeItem={},e.rules={name:[{required:!0,message:"名称不能为空",trigger:"blur"}],vcenter:[{required:!0,message:"vCenter不能为空",trigger:"blur"}],cloud:[{required:!0,message:"云账号不能为空",trigger:"blur",validator:function(){return!!e.form.vcenter}}],manageOne:[{required:!0,message:"ManageOne平台不能为空",trigger:"blur",validator:function(){return!!e.form.vcenter}}],credential:[{required:!0,message:"凭据不能为空",trigger:"blur"}],period:[{required:!0,type:"number",message:"采集频率不能为空",trigger:"blur"}]},e.isFirstRender=!0,e}return an(e,t),Object.defineProperty(e.prototype,"isVmware",{get:function(){return"vmware_vc"===this.typeItem.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isManageOne",{get:function(){return"ManageOne"===this.typeItem.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEdit",{get:function(){return"edit"===this.taskInfo.mode},enumerable:!1,configurable:!0}),e.prototype.created=function(){return ln(this,void 0,void 0,(function(){var t,e,i,n=this;return cn(this,(function(r){switch(r.label){case 0:return this.modalLoading=!0,t=this.taskInfo.currentNode.bk_obj_name,e={aliyun:"aliyun_ecs",qcloud:"qcloud_cvm",VMware:"vmware_vc",mo_server:"ManageOne"},i={nameCn:t,label:t,listUrl:"getOtherResourceList",filedUrl:"getOtherResourceFields",updateFieldUrl:"updateOtherResourceFields",batchEditUrl:"modifyOtherResourceBulk",changeRecordUrl:"getOtherSrcChange"},this.typeItem=this.getBkObjParams(i,e,"name"),[4,this.getCredParams()];case 1:return r.sent(),Promise.all([this.getAppCustomFields(),this.isEdit&&this.getCredential()]).finally((function(){n.modalLoading=!1})),[2]}}))}))},e.prototype.getBkObjParams=function(t,e,i){var n=this.$copy(t),r=this.taskInfo.currentNode.bk_obj_id;return n[i]=e[r]||r,n},e.prototype.handleCreate=function(){this.$refs.voucherDialog.show("add",{})},e.prototype.updateCredential=function(t){this.getCredential(),this.relateHost(t.id),this.form.credential=t.id},e.prototype.handleVcenterChange=function(t){this.isFirstRender||(this.form.credential=""),this.isFirstRender=!1,t&&-1!==this.moduleCredDesign&&this.getCredential()},e.prototype.relateHost=function(t){return ln(this,void 0,void 0,(function(){var e,i,n;return cn(this,(function(r){switch(r.label){case 0:return[4,this.$api.remoteConnect.setCredResourceList({id:t,body:{bk_inst_id_list:[this.form.vcenter]}})];case 1:return e=r.sent(),i=e.result,n=e.message,i||this.$error(n),[2]}}))}))},e.prototype.linkToDiscover=function(){var t=this.$router.resolve({name:"AssetModel",query:{bkObjId:this.typeItem.name}}).href;window.open(t,"_blank")},e.prototype.createTargetSuccess=function(t){this.form.vcenter=t.id,this.$emit("updateVcenterList")},e.prototype.getCredential=function(){var t;return ln(this,void 0,void 0,(function(){var e,i;return cn(this,(function(n){switch(n.label){case 0:return e={page_size:99999,page:1,name:"",module_cred_design:this.moduleCredDesign,search_type:"all",bk_inst_id:this.form.vcenter},[4,this.$api.remoteConnect.getVaultCredential(e)];case 1:return(i=n.sent()).result?(this.voucherList=null===(t=i.data)||void 0===t?void 0:t.items,[2]):(this.$error(i.message),[2])}}))}))},e.prototype.getCredParams=function(){return ln(this,void 0,void 0,(function(){var t,e,i;return cn(this,(function(n){switch(n.label){case 0:return[4,this.$api.remoteConnect.getCredParams({bk_obj_id:this.typeItem.name})];case 1:return t=n.sent(),e=t.data,i=t.message,t.result?(this.moduleCredDesign=e.module_cred_design,this.evidenceFormParams=e.params,[2]):(this.$error(i),[2])}}))}))},e.prototype.handleAllFields=function(t){var e=this;t.forEach((function(t,i){"list"!==t.bk_property_type&&"bool"!==t.bk_property_type||("list"===t.bk_property_type&&(t.option=t.option.map((function(t){return{id:t,name:t}}))),"bool"===t.bk_property_type&&(t.option=[{id:!0,name:"是"},{id:!1,name:"否"}])),t.checked=!1,t.batchValue="",t.editStatus=!1,t.editValue="",t.editLoading=!1,t.editIconShow=!1,e.buildFieldData(t,e.instanceFields)}))},e.prototype.buildFieldData=function(t,e){var i=e.findIndex((function(e){return e.key===t.bk_property_group}));-1===i?e.push({title:t.bk_property_group_name,children:[t],key:t.bk_property_group,collapseStatus:!0,id:this.$random(3)}):e[i].children.push(t)},e.prototype.getAppCustomFields=function(){return ln(this,void 0,void 0,(function(){var t,e,i,n;return cn(this,(function(r){switch(r.label){case 0:return t=this.typeItem.filedUrl,e={aliyun:"aliyun_account",qcloud:"qcloud_account",VMware:"vmware_vc",mo_server:"mo_account"},i=this.getBkObjParams({},e,"bk_obj_id"),[4,this.$api.Resource[t](i)];case 1:return(n=r.sent()).result?(this.handleAllFields(n.data.all_field),[2]):(this.$error(n.message),[2])}}))}))},e.prototype.createTarget=function(){var t=this.$deepClone(this.instanceFields);t.forEach((function(t){t.children=t.children.filter((function(t){return!["录入方式","录入时间"].includes(t.bk_property_name)}))}));var e=this.getBkObjParams(this.typeItem,{aliyun:"aliyun_account",qcloud:"qcloud_account",VMware:"vmware_vc",mo_server:"mo_account"},"name");this.$refs.addResource.showDialog(e,t)},e.prototype.show=function(t){if(this.isEdit)return this.form.id=this.taskInfo.row.id,this.form.name=this.taskInfo.row.name,this.form.vcenter=this.taskInfo.row.bk_inst_id,this.form.credential=this.taskInfo.row.credential,this.form.period=this.taskInfo.row.period,void(this.formV2=this.$copy(this.form));this.resetForm(),this.formV2=this.$copy(this.form)},e.prototype.resetForm=function(){this.form.name=this.taskInfo.bkObjName,this.form.period=5,this.form.vcenter="",this.form.credential=""},e.prototype.cancelTask=function(){this.taskInfo.status=!1},e.prototype.saveTask=function(){var t=this;this.confirmLoading=!0;var e=this.typeItem.name;this.$refs.formValidate.validate().then((function(i){var n={name:t.form.name,bk_obj_id:"ManageOne"===e?"mo_server":e,period:t.form.period,bk_inst_id:t.form.vcenter,credential:t.form.credential},r=t.isEdit?"editCloudTask":"createCloudTask",o=t.isEdit?"修改成功":"新增成功";t.isEdit&&(n.id=t.form.id),t.$api.monitorCollect[r](n).then((function(e){if(t.confirmLoading=!1,e.result)return t.$success(o),t.taskInfo.status=!1,void t.confirmTask();t.$error(e.message)}))}),(function(e){t.confirmLoading=!1}))},e.prototype.confirmTask=function(){return""},sn([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"taskInfo",void 0),sn([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"vcenterList",void 0),sn([Object(f.b)("confirmTask")],e.prototype,"confirmTask",null),e=sn([Object(f.a)({components:{VoucherDialog:on.a,AddResource:ri.a,IntroduceInfo:Vt}})],e)}(f.e),pn=un,dn=pn,fn=Object(u.a)(dn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.modalLoading,zIndex:10},expression:"{ isLoading: modalLoading, zIndex: 10 }"}],attrs:{id:"taskModal"}},[i("div",{staticClass:"virtual-title"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.cancelTask}}),t._v("\n        "+t._s(t.taskInfo.title)+"\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"sub-title line"},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"sub-title"},[t._v(t._s(t.taskInfo.subTitle))])],1),t._v(" "),i("div",{staticClass:"plugin-form",staticStyle:{position:"relative"}},[i("bk-form",{ref:"formValidate",staticStyle:{"padding-right":"20px"},attrs:{model:t.form,"label-width":150,rules:t.rules}},[i("bk-form-item",{attrs:{label:"任务名称",property:"name",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入任务名称",clearable:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:t.isVmware?"VCenter":t.isManageOne?"ManageOne平台":"云账号",property:t.isVmware?"vcenter":t.isManageOne?"manageOne":"cloud",required:"","error-display-type":"normal"}},[i("div",{staticClass:"vcenter-config"},[i("bk-select",{staticClass:"vcenter-select",attrs:{placeholder:t.isVmware?"请选择Vcenter":t.isManageOne?"请选择ManageOne平台":"请选择云账号",disabled:t.isVmware&&t.isEdit},on:{change:t.handleVcenterChange},model:{value:t.form.vcenter,callback:function(e){t.$set(t.form,"vcenter",e)},expression:"form.vcenter"}},t._l(t.vcenterList,(function(t){return i("bk-option",{key:t.bk_inst_id,attrs:{id:t.bk_inst_id,name:t.bk_inst_name}})})),1),t._v(" "),i("span",[t._v("\n                        若无监控采集目标，请先\n                        "),i("bk-button",{attrs:{theme:"primary",text:""},on:{click:t.createTarget}},[t._v("\n                            添加资产\n                        ")]),t._v("\n                        ，并配置\n                        "),i("bk-button",{attrs:{theme:"primary",text:""},on:{click:t.linkToDiscover}},[t._v("\n                            自动发现\n                        ")])],1)],1)]),t._v(" "),t.form.vcenter?i("bk-form-item",{attrs:{label:"凭据",property:"credential","error-display-type":"normal",required:""}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{searchable:""},model:{value:t.form.credential,callback:function(e){t.$set(t.form,"credential",e)},expression:"form.credential"}},[t._l(t.voucherList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),t._v(" "),i("div",{staticClass:"credential-create",attrs:{slot:"extension"},slot:"extension"},[i("bk-button",{staticStyle:{color:"#63656e"},attrs:{icon:"plus-circle",text:"",disabled:!t.form.vcenter},on:{click:t.handleCreate}},[t._v("\n                            新建凭据\n                        ")])],1)],2)],1):t._e(),t._v(" "),i("bk-form-item",{attrs:{label:"采集频率",property:"period",required:!0,"error-display-type":"normal"}},[i("bk-input",{staticClass:"mr10",staticStyle:{width:"200px"},attrs:{placeholder:"请输入采集频率",type:"number",min:1,precision:0},model:{value:t.form.period,callback:function(e){t.$set(t.form,"period",e)},expression:"form.period"}}),t._v("\n                分钟\n            ")],1)],1),t._v(" "),i("introduce-info",{attrs:{type:t.taskInfo.currentNode.bk_obj_id,"need-move":!1}})],1),t._v(" "),i("div",{staticClass:"operation"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",loading:t.confirmLoading},on:{click:t.saveTask}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancelTask}},[t._v("\n            取消\n        ")])],1),t._v(" "),i("AddResource",{ref:"addResource",on:{"on-success":t.createTargetSuccess}}),t._v(" "),i("VoucherDialog",{ref:"voucherDialog",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.updateCredential}})],1)}),[],!1,null,"6e36962d",null),mn=fn.exports,hn=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),bn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},gn=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},yn=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},vn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.monitorData=[],e.taskInfo={},e.columns=[{label:"任务名称",key:"name",minWidth:"100px"},{label:"VCenter",key:"VCenter",minWidth:"100px",showLabel:["VMware"],scopedSlots:"account"},{label:"云账号",key:"account",minWidth:"100px",showLabel:["qcloud","aliyun"],scopedSlots:"account"},{label:"ManageOne平台",key:"account",minWidth:"100px",showLabel:["mo_server"],scopedSlots:"account"},{label:"创建者",key:"created_by",minWidth:"100px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.activeColumns=[],e.pagination={current:1,count:0,limit:20},e.vcenterList=[],e}return hn(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&(this.getObjCollectTask(),this.getVcenterList(),this.taskInfo.status=!1,this.updateColums())},e.prototype.onStatusChanged=function(){this.updateColums()},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.getBkObjParams=function(t,e){var i=this.$copy(t),n=this.currentNode.bk_obj_id;return i.bk_obj_id=e[n]||n,i},e.prototype.updateColums=function(){var t=this;this.$nextTick((function(){var e;t.activeColumns=t.columns.filter((function(e){var i;return(null===(i=e.showLabel)||void 0===i?void 0:i.includes(t.currentNode.bk_obj_id))||!e.showLabel})),null===(e=t.$refs.table)||void 0===e||e.updateColumns(t.activeColumns)}))},e.prototype.showDialog=function(t,e){var i=this;this.$BtnPermission(this.permissionObj)&&(this.taskInfo={status:!0,title:"".concat("add"===e?"新建":"修改","采集"),mode:e,subTitle:(null==t?void 0:t.name)||"",row:t||{},currentNode:this.currentNode,bkObjName:this.currentNode.bk_obj_name+"监控"+Y()().format("YYYYMMDDHHmmss")},this.$nextTick((function(){i.$refs.taskModal.show()})))},e.prototype.getAccount=function(t){var e=this.vcenterList.find((function(e){return e.bk_inst_id===t.bk_inst_id}));return(null==e?void 0:e.bk_inst_name)||"--"},e.prototype.setAgentStatus=function(t){switch(t){case"正常":return{borderColor:"#e5f6ea",backgroundColor:"#3fc06d"};case"异常":case"失败":case"部分失败":return{borderColor:"#ffe6e6",backgroundColor:"#ea3636"};default:return{borderColor:"#f0f1f5",backgroundColor:"#b2b5bd"}}},e.prototype.getVcenterList=function(){var t=this,e=this.getBkObjParams({},{aliyun:"aliyun_account",qcloud:"qcloud_account",VMware:"vmware_vc",mo_server:"mo_account"});this.$api.modelSetting.getVcenterList(e).then((function(e){e.result?t.vcenterList=e.data.result:t.$error(e.message)})),this.vcenterList=[]},e.prototype.getObjCollectTask=function(){return gn(this,void 0,void 0,(function(){var t,e,i,n,r;return yn(this,(function(o){switch(o.label){case 0:this.tableLoading=!0,t=this.getParams(),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getCloudTaskList(t)];case 2:return e=o.sent(),i=e.result,n=e.data,r=e.message,i?(this.monitorData=n.items,this.pagination.count=n.count,[3,4]):(this.$error(r),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this.pagination,e={page_size:t.limit,page:t.current,name:this.search};return this.getBkObjParams(e,{aliyun:"aliyun_ecs",qcloud:"qcloud_cvm",VMware:"vmware_vc"})},e.prototype.handleDelete=function(t){return gn(this,void 0,void 0,(function(){var e=this;return yn(this,(function(i){return this.$BtnPermission(this.permissionObj)?(this.$bkInfo({title:"提示",subTitle:"确定删除该任务？",theme:"primary",confirmFn:function(){e.confirmDeleteTask(t)}}),[2]):[2]}))}))},e.prototype.confirmDeleteTask=function(t){return gn(this,void 0,void 0,(function(){var e,i,n;return yn(this,(function(r){switch(r.label){case 0:return this.tableLoading=!0,e={aliyun:"aliyun_ecs",qcloud:"qcloud_cvm",VMware:"vmware_vc"},i={id:t.id,name:t.name},i=this.getBkObjParams(i,e),[4,this.$api.monitorCollect.deleteCloudTask(i)];case 1:return(n=r.sent()).result?(this.$message.success("删除成功"),this.pagination.current>1&&1===this.monitorData.length&&this.pagination.current--,this.refreshTree(this.currentNode),this.getObjCollectTask(),[2]):(this.$message.error(n.message),this.tableLoading=!1,[2])}}))}))},e.prototype.saveTask=function(){this.refreshTree(this.currentNode),this.getObjCollectTask()},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getObjCollectTask()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getObjCollectTask()},e.prototype.refreshTree=function(t){return t},bn([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),bn([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),bn([Object(f.f)("taskInfo.status",{deep:!0})],e.prototype,"onStatusChanged",null),bn([Object(f.b)("refreshTree")],e.prototype,"refreshTree",null),e=bn([Object(f.a)({components:{ComTable:st.a,TaskModal:mn}})],e)}(f.e),_n=vn,kn=_n,wn=Object(u.a)(kn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"monitor"},[t.taskInfo.status?i("task-modal",{ref:"taskModal",attrs:{"task-info":t.taskInfo,"vcenter-list":t.vcenterList},on:{confirmTask:t.saveTask,updateVcenterList:t.getVcenterList}}):i("div",{staticClass:"monitor-list"},[i("div",{staticClass:"nav-area"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.showDialog({},"add")}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入任务名称",clearable:""},on:{enter:t.getObjCollectTask},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.monitorData,columns:t.activeColumns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"account",fn:function(e){var n=e.row;return[i("span",[t._v(t._s(t.getAccount(n)))])]}},{key:"status",fn:function(e){var n=e.row;return[i("span",{staticClass:"agent-status",style:t.setAgentStatus(n.collection_state_display)}),t._v(" "),i("span",[t._v(t._s(n.collection_state_display))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.showDialog(n,"edit")}}},[t._v("\n                            修改\n                        ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDelete(n)}}},[t._v("\n                            删除\n                        ")])],1)]}}],null,!1,1830245146)})],1)])],1)}),[],!1,null,"51241ded",null),xn=wn.exports,Cn=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Dn=function(){return Dn=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Dn.apply(this,arguments)},jn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},On=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Ln=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Tn=function(t,e,i){if(i||2===arguments.length)for(var n,r=0,o=e.length;r<o;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Sn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPageLoading=!1,e.form={task_name:"",monitor_obj:"",plugin:"进程采集插件",period:5,period_unit:"min",process_name:"",match_type:"command",match_pattern:"",exclude_pattern:"",pid_path:"",port_detect:!0,target_list:[],object_select_type:""},e.initForm={},e.ruleValidate={task_name:[{required:!0,message:"任务名称不能为空",trigger:"blur, change"}],monitor_obj:[{required:!0,message:"监控对象不能为空",trigger:"blur"}],match_pattern:[{required:!0,trigger:"blur"}],pid_path:[{required:!0,trigger:"blur, change"}],process_name:[{required:!0,message:"进程别名不能为空",trigger:"blur, change"}],target_list:[{message:"监控目标未选择",trigger:"blur",required:!0,validator:function(t){return t.length>0}}],period:[{required:!0,message:"请输入采集频率",trigger:"blur"},{required:!0,message:"请输入整数",trigger:"blur, change",validator:function(t){return parseInt(t,10)===+t}},{required:!0,message:"采集频率不得小于10秒",trigger:"blur, change",validator:function(t){return!("sec"===e.form.period_unit&&t<10)}}]},e.monitorObjList=[],e.pluginList=[{plugin_id:"进程采集插件",plugin_display_name:"进程采集插件"}],e.targetModal={name:"",status:!1,target:[],monitorObjId:1,monitorObjName:"",propertyList:[],isDetail:!0,osType:0,title:"选择监控目标",objectSelectType:"list"},e.propertyList=[],e.monitorObjName="",e.paramsList=[],e.targetList=[],e.targetColumns=[],e.groupColumns=[{label:"分组名称",key:"name",minWidth:"200px"},{label:"Agent状态",key:"status",minWidth:"200px",scopedSlots:"status"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.otherColumns=[],e.submitLoading=!1,e.confirmLeave=!1,e.isInit=!1,e.timeList=[10,15,20,30],e.isLoading=!1,e}return Cn(e,t),Object.defineProperty(e.prototype,"listDisabled",{get:function(){return"group"===this.targetModal.objectSelectType&&!!this.targetList.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupDisabled",{get:function(){return"list"===this.targetModal.objectSelectType&&!!this.targetList.length},enumerable:!1,configurable:!0}),e.prototype.created=function(){return On(this,void 0,void 0,(function(){return Ln(this,(function(t){switch(t.label){case 0:return this.isPageLoading=!0,this.targetColumns=[],this.getMonitorObjList(),"modify"!==this.taskInfo.mode?[3,2]:(this.isInit=!0,[4,this.getInitData()]);case 1:t.sent(),t.label=2;case 2:return this.initForm=this.$copy(this.form),this.isPageLoading=!1,[2]}}))}))},e.prototype.getInitData=function(){return On(this,void 0,void 0,(function(){var t=this;return Ln(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getProcessDetail({id:this.taskInfo.rowId}).then((function(e){var i=e.data;if(e.result){for(var n in i)t.form.hasOwnProperty(n)&&(t.form[n]=i[n]);t.targetList=t.$copy(t.form.target_list),t.monitorObjName=t.monitorObjList.find((function(e){return e.id===t.form.monitor_obj})).bk_obj_name,t.targetModal.objectSelectType=i.object_select_type,t.targetColumns=t.$copy("group"===t.targetModal.objectSelectType?t.groupColumns:t.otherColumns)}}))];case 1:return e.sent(),[2]}}))}))},e.prototype.getMonitorObjList=function(){return On(this,void 0,void 0,(function(){return Ln(this,(function(t){return this.monitorObjList=[{bk_obj_id:"host",bk_obj_name:"主机",id:1}],this.form.monitor_obj=1,this.getPropertyList(),[2]}))}))},e.prototype.getPropertyList=function(){return On(this,void 0,void 0,(function(){var t=this;return Ln(this,(function(e){switch(e.label){case 0:return this.isLoading=!0,[4,this.$api.monitorCollect.getObjPropertyList({monitor_obj_id:1}).then((function(e){if(t.isLoading=!1,e.result){t.propertyList=e.data;var i=e.data.map((function(t){return{label:t.bk_property_name,key:t.bk_property_id}}));t.otherColumns=Tn(Tn([],i,!0),[{label:"采集执行主机",scopedSlots:"ip_list",key:"ip_list"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],!1)}else t.$error(e.message)}))];case 1:return e.sent(),[2]}}))}))},e.prototype.changeInterval=function(t){this.form.period=t,this.$refs.popover.hideHandler()},e.prototype.selectTarget=function(){var t={objId:this.targetModal.monitorObjId,entry:"collect-process"};t.panels=[{name:"list",disabled:this.listDisabled},{name:"topo",hide:!0},{name:"group",disabled:this.groupDisabled}],this.$refs.selectTargets.show(this.targetList,this.propertyList,t)},e.prototype.removeTarget=function(t,e){this.targetList.splice(e,1),this.form.target_list=this.targetList},e.prototype.submitTarget=function(t){var e=this,i=this.$copy(t),n=i.data,r=i.type;this.targetModal.objectSelectType=r,this.targetColumns=this.$copy("group"===r?this.groupColumns:this.otherColumns),n.forEach((function(t){t.target_id=t.target_id||e.getIplist(t)})),this.targetList=n,this.form.target_list=this.targetList,this.$nextTick((function(){e.$refs.processTable.updateColumns(e.targetColumns)}))},e.prototype.getIplist=function(t){var e;return t.ip?t.ip:(null===(e=t.ip_list)||void 0===e?void 0:e.length)?t.ip_list[0].ip:"--"},e.prototype.submit=function(){var t=this,e=this.targetList,i={task_name:this.form.task_name,monitor_obj:this.form.monitor_obj,period:this.form.period,period_unit:this.form.period_unit,match_type:this.form.match_type,port_detect:this.form.port_detect,process_name:this.form.process_name,object_select_type:this.targetModal.objectSelectType||"list",target_list:e};i="command"===this.form.match_type?Dn(Dn({},i),{exclude_pattern:this.form.exclude_pattern,match_pattern:this.form.match_pattern,pid_path:""}):Dn(Dn({},i),{pid_path:this.form.pid_path,exclude_pattern:"",match_pattern:""}),this.submitLoading=!0,this.$refs.validateForm.validate().then((function(e){t.createProcessCollect(i)}),(function(e){t.submitLoading=!1}))},e.prototype.createProcessCollect=function(t){var e=this,i="add"===this.taskInfo.mode?"createProcessTask":"updateProcessTask",n="add"===this.taskInfo.mode?"创建成功":"修改成功";"modify"===this.taskInfo.mode&&(t.id=this.taskInfo.rowId),this.$api.monitorCollect[i](t).then((function(t){if(e.submitLoading=!1,t.result)return e.confirmLeave=!0,e.$success(n),e.taskInfo.showModal=!1,void e.$emit("refreshTable");e.$error(t.message)}))},e.prototype.cancel=function(){this.taskInfo.showModal=!1},jn([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"taskInfo",void 0),e=jn([Object(f.a)({components:{TargetSelect:lt.a,ComTable:st.a,IntroduceInfo:Vt}})],e)}(f.e),In=Sn,Pn=Object(u.a)(In,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isPageLoading,zIndex:10},expression:"{ isLoading: isPageLoading, zIndex: 10 }"}],ref:"addProcess",staticClass:"padding-20",attrs:{id:"addProcess"}},[i("div",{staticClass:"process-title"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.cancel}}),t._v("\n        "+t._s("add"===t.taskInfo.mode?"新建进程":"修改进程")+"\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskInfo.mode,expression:"taskInfo.mode === 'modify'"}],staticClass:"sub-title line"},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskInfo.mode,expression:"taskInfo.mode === 'modify'"}],staticClass:"sub-title"},[t._v(t._s(t.taskInfo.subTitle))])],1),t._v(" "),i("div",{staticClass:"content-wrap",staticStyle:{position:"relative"}},[i("bk-form",{ref:"validateForm",staticClass:"plugin-form",attrs:{id:"form",model:t.form,"label-width":110,rules:t.ruleValidate}},[i("bk-form-item",{attrs:{label:"任务名称",property:"task_name",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入任务名称"},model:{value:t.form.task_name,callback:function(e){t.$set(t.form,"task_name",e)},expression:"form.task_name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"监控对象",required:!0,property:"monitor_obj","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",clearable:!1,disabled:!0,searchable:""},model:{value:t.form.monitor_obj,callback:function(e){t.$set(t.form,"monitor_obj",e)},expression:"form.monitor_obj"}},t._l(t.monitorObjList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.bk_obj_name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"选择插件",property:"plugin",required:"","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{searchable:"",disabled:!0},model:{value:t.form.plugin,callback:function(e){t.$set(t.form,"plugin",e)},expression:"form.plugin"}},t._l(t.pluginList,(function(t){return i("bk-option",{key:t.plugin_id,attrs:{id:t.plugin_id,name:t.plugin_display_name}})})),1)],1),t._v(" "),i("bk-form-item",{staticStyle:{position:"relative"},attrs:{label:"采集频率",property:"period",required:"","error-display-type":"normal"}},[i("bk-popover",{ref:"popover",attrs:{disabled:"min"===t.form.period_unit,arrow:"false",trigger:"click",theme:"light","ext-cls":"input-select-popover",width:"500",placement:"bottom-start"}},[i("div",{attrs:{slot:"content"},slot:"content"},t._l(t.timeList,(function(e){return i("div",{key:e,staticClass:"list-item",class:{active:e===+t.form.period},on:{click:function(i){return t.changeInterval(e)}}},[t._v(t._s(e))])})),0),t._v(" "),i("bk-input",{staticStyle:{width:"500px"},attrs:{min:"sec"===t.form.period_unit?10:1,precision:0,type:"number"},model:{value:t.form.period,callback:function(e){t.$set(t.form,"period",e)},expression:"form.period"}})],1),t._v(" "),i("bk-select",{staticClass:"unit-select",staticStyle:{width:"100px"},attrs:{clearable:!1},model:{value:t.form.period_unit,callback:function(e){t.$set(t.form,"period_unit",e)},expression:"form.period_unit"}},[i("bk-option",{attrs:{id:"min",name:"分钟"}})],1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"进程匹配",required:"","error-display-type":"normal",property:"command"===t.form.match_type?"match_pattern":"pid_path"}},[i("bk-radio-group",{model:{value:t.form.match_type,callback:function(e){t.$set(t.form,"match_type",e)},expression:"form.match_type"}},[i("bk-radio",{staticStyle:{"margin-right":"30px"},attrs:{value:"command"}},[t._v("命令行匹配")]),t._v(" "),i("bk-radio",{attrs:{value:"pid"}},[t._v("pid文件")])],1),t._v(" "),"command"===t.form.match_type?i("div",{staticStyle:{"margin-top":"16px",width:"500px"}},[i("bk-input",{model:{value:t.form.match_pattern,callback:function(e){t.$set(t.form,"match_pattern",e)},expression:"form.match_pattern"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"group-text"},[t._v("包含")])])],2),t._v(" "),i("bk-input",{staticStyle:{"margin-top":"6px"},model:{value:t.form.exclude_pattern,callback:function(e){t.$set(t.form,"exclude_pattern",e)},expression:"form.exclude_pattern"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"group-text"},[t._v("排除")])])],2)],1):i("bk-input",{staticStyle:{"margin-top":"16px",width:"500px"},attrs:{placeholder:"进程的pid绝对路径"},model:{value:t.form.pid_path,callback:function(e){t.$set(t.form,"pid_path",e)},expression:"form.pid_path"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"进程别名",property:"process_name",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入进程别名"},model:{value:t.form.process_name,callback:function(e){t.$set(t.form,"process_name",e)},expression:"form.process_name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"端口探测",required:!0,"error-display-type":"normal"}},[i("bk-switcher",{staticStyle:{"margin-right":"10px"},attrs:{theme:"primary",size:"small"},model:{value:t.form.port_detect,callback:function(e){t.$set(t.form,"port_detect",e)},expression:"form.port_detect"}})],1),t._v(" "),i("bk-form-item",{staticStyle:{width:"960px"},attrs:{label:"监控目标",property:"target_list","error-display-type":"normal",required:""}},[i("div",{staticStyle:{width:"100%","margin-bottom":"10px"}},[i("bk-button",{staticClass:"mr10",attrs:{disabled:!t.form.monitor_obj,theme:"default"},on:{click:t.selectTarget}},[t._v("\n                        选择目标\n                    ")])],1),t._v(" "),t.targetColumns.length&&t.targetList.length?i("div",{staticClass:"instance-table"},[i("ComTable",{ref:"processTable",attrs:{data:t.targetList,columns:t.targetColumns},scopedSlots:t._u([{key:"operation",fn:function(e){var n=e.row,r=e.index;return[i("div",[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.removeTarget(n,r)}}},[t._v("删除")])],1)]}},{key:"status",fn:function(e){var n=e.row;return[i("span",{staticStyle:{color:"#ff0000"}},[t._v(t._s(n.error_count))]),t._v(" / "),i("span",[t._v(t._s(n.all_count))])]}},{key:"ip_list",fn:function(e){var n=e.row;return[i("div",[n.ip_list&&n.ip_list.length>1?i("bk-select",{key:n.id,staticStyle:{width:"80%"},attrs:{searchable:"",clearable:!1},model:{value:n.target_id,callback:function(e){t.$set(n,"target_id",e)},expression:"row.target_id"}},t._l(n.ip_list,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.ip,name:t.ip}})})),1):n.ip?i("span",[t._v(t._s(n.ip))]):n.ip_list&&1===n.ip_list.length?i("span",[t._v(t._s(n.ip_list[0].ip))]):i("span",[t._v("--")])],1)]}}],null,!1,3080704260)})],1):t._e()])],1),t._v(" "),i("introduce-info",{attrs:{type:"process"}})],1),t._v(" "),i("div",{staticClass:"operation"},[i("bk-button",{attrs:{theme:"primary",loading:t.submitLoading},on:{click:t.submit}},[t._v("提交")]),t._v(" "),i("bk-button",{staticClass:"ml10",attrs:{theme:"default"},on:{click:t.cancel}},[t._v("取消")])],1),t._v(" "),i("target-select",{ref:"selectTargets",attrs:{"target-modal":t.targetModal},on:{getSelectedTargets:t.submitTarget}})],1)}),[],!1,null,"545ca895",null).exports,$n=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Mn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Nn=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},An=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},En=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterCondition="",e.tableLoading=!1,e.maxHeight=0,e.tableData=[],e.columns=[{label:"任务名称",key:"task_name",minWidth:"100px"},{label:"监控对象",key:"monitor_obj_display",minWidth:"100px"},{label:"运行状态",key:"task_status",minWidth:"100px",scopedSlots:"status"},{label:"目标",key:"target_inst_len",minWidth:"100px"},{label:"创建者",key:"created_by",minWidth:"100px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:10},e.row={},e.taskInfo={mode:"add",showModal:!1,rowId:null,subTitle:""},e}return $n(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&this.searchData()},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.mounted=function(){},e.prototype.searchData=function(){this.pagination.current=1,this.search()},e.prototype.search=function(){var t=this,e={search:this.filterCondition,page_size:this.pagination.limit,page:this.pagination.current};this.tableLoading=!0,this.$api.monitorCollect.searchProcessList(e).then((function(e){if(t.tableLoading=!1,e.result)return t.tableData=e.data.results,void(t.pagination.count=e.data.count);t.$error(e.message)}))},e.prototype.addTask=function(t,e){this.$BtnPermission(this.permissionObj)&&(this.taskInfo={mode:t,showModal:!0,rowId:e.id,subTitle:e.task_name})},e.prototype.deleteTask=function(t){var e=this;this.$BtnPermission(this.permissionObj)&&this.$bkInfo({title:"删除进程采集任务",subTitle:"是否删除进程采集任务【"+t.task_name+"】?",confirmLoading:!0,confirmFn:function(){return Nn(e,void 0,void 0,(function(){var e=this;return An(this,(function(i){switch(i.label){case 0:return[4,this.$api.monitorCollect.deleteProcessTask({id:t.id}).then((function(t){if(t.result)return e.$success("删除成功"),1===e.tableData.length&&(e.pagination.current-=1,0===e.pagination.current&&(e.pagination.current=1)),void e.search();e.$error(t.message)}))];case 1:return i.sent(),[2]}}))}))}})},e.prototype.handlePageLimitChange=function(t){this.pagination.limit=t,this.searchData()},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.search()},Mn([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),Mn([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),e=Mn([Object(f.a)({components:{ComTable:st.a,AddProcess:Pn}})],e)}(f.e),Rn=En,qn=Object(u.a)(Rn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"monitor-task"}},[t.taskInfo.showModal?i("div",{staticClass:"monitor-task-addProcess"},[i("AddProcess",{attrs:{"task-info":t.taskInfo},on:{refreshTable:t.searchData}})],1):i("div",{staticClass:"monitor-task-list"},[i("div",{staticClass:"nav-bar"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{"ext-cls":"mr5",theme:"primary"},on:{click:function(e){return t.addTask("add",{})}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-input",{staticStyle:{width:"360px",float:"right"},attrs:{placeholder:"请输入任务名称","right-icon":"bk-icon icon-search",clearable:""},on:{"right-icon-click":t.searchData,enter:t.searchData},model:{value:t.filterCondition,callback:function(e){t.filterCondition=e},expression:"filterCondition"}})],1),t._v(" "),i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",staticClass:"table-set",attrs:{data:t.tableData,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("div",{staticClass:"status-mark",class:{"status-normal":"正常"===n.task_status,"status-unnormal":n.task_status.includes("失败"),"status-loading":"部署中"===n.task_status}},[i("bk-spin",{directives:[{name:"show",rawName:"v-show",value:"部署中"===n.task_status,expression:"row.task_status === '部署中'"}],attrs:{size:"mini"}})],1),t._v(" "),i("span",[t._v(t._s(n.task_status))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.addTask("modify",n)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.deleteTask(n)}}},[t._v("\n                        删除\n                    ")])],1)]}}],null,!1,3275716797)})],1)])}),[],!1,null,"83d44c92",null).exports,zn=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Fn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Hn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.provinceList=[],e.formData={bk_biz_id:"",name:"",ip:"",operator:"",location:{country:"",province:""}},e.rules={name:[{required:!0,message:"必填项",trigger:"blur"}],ip:[{required:!0,message:"请选择目标主机",trigger:"blur"}]},e.operatorList=["联通","移动","电信","自定义"],e.loading=!1,e.formDataV2={},e.ipList=[],e}return zn(e,t),e.prototype.show=function(){this.isShow=!0,this.formData={bk_biz_id:"",name:"",ip:"",operator:"",location:{country:"",province:""}},this.formData.bk_biz_id=this.bkBizList[0].bk_biz_id,this.changeBusiness(),this.formDataV2=JSON.parse(JSON.stringify(this.formData))},e.prototype.changeBusiness=function(){var t=this;this.$api.webMonitorCollect.getCheckNodeServer({bk_biz_id:this.formData.bk_biz_id}).then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.ipList=n}))},e.prototype.selectCountry=function(t){if(!t)return this.provinceList=[],!1;var e=this.locationList.find((function(e){return e.code===t}));this.provinceList=e.children||[],this.formData.location.province="",this.setNodeName()},e.prototype.setNodeName=function(){var t,e,i=this,n=null===(t=this.locationList.find((function(t){return t.code===i.formData.location.country})))||void 0===t?void 0:t.cn,r=null===(e=this.provinceList.find((function(t){return t.code===i.formData.location.province})))||void 0===e?void 0:e.cn;this.formData.name="".concat(n||""," ").concat(r||""," ").concat(this.formData.operator)},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var i={bk_biz_id:t.formData.bk_biz_id,carrieroperator:t.formData.operator,ip:t.formData.ip,is_common:!0,name:t.formData.name,plat_id:0,location:{country:t.formData.location.country,city:t.formData.location.province}};t.createUptimeCheckNode(i)}))},e.prototype.createUptimeCheckNode=function(t){var e=this;this.loading=!0,this.$api.webMonitorCollect.createUptimeCheckNode(t).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("新增节点成功!"),e.isShow=!1,e.$emit("refresh-node")})).finally((function(){e.loading=!1}))},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataV2)?this.isShow=!1:this.$bkInfo({title:"是否放弃本次操作？",subTitle:"放弃将导致未保存信息丢失",theme:"primary",confirmFn:function(){t.isShow=!1}})},Fn([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"bkBizList",void 0),Fn([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"locationList",void 0),e=Fn([f.a],e)}(f.e),Bn=Hn,Vn=Object(u.a)(Bn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("bk-sideslider",{attrs:{width:500,"is-show":t.isShow,"before-close":t.cancel,"quick-close":!0},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("新增拨测节点")]),t._v(" "),i("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[i("bk-form",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],ref:"validateForm",staticStyle:{flex:"1"},attrs:{"label-width":110,model:t.formData,rules:t.rules,"form-type":"vertical"}},[i("bk-form-item",{attrs:{label:"选择节点",required:"",property:"ip","error-display-type":"normal"}},[i("div",{staticStyle:{display:"flex"}},[i("bk-select",{staticStyle:{width:"220px"},attrs:{searchable:"",placeholder:"请选择目标业务"},on:{change:t.changeBusiness},model:{value:t.formData.bk_biz_id,callback:function(e){t.$set(t.formData,"bk_biz_id",e)},expression:"formData.bk_biz_id"}},t._l(t.bkBizList,(function(t){return i("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1),t._v(" "),i("bk-select",{staticStyle:{width:"220px","margin-left":"20px"},attrs:{searchable:"",placeholder:"请选择目标主机"},model:{value:t.formData.ip,callback:function(e){t.$set(t.formData,"ip",e)},expression:"formData.ip"}},t._l(t.ipList,(function(e){return i("bk-option",{key:e.ip+t.$random(2),attrs:{id:e.ip,name:e.ip}})})),1)],1)]),t._v(" "),i("bk-form-item",{attrs:{label:"地区","error-display-type":"normal"}},[i("div",{staticStyle:{display:"flex"}},[i("bk-select",{staticStyle:{width:"220px"},attrs:{searchable:"",placeholder:"请选择"},on:{change:t.selectCountry},model:{value:t.formData.location.country,callback:function(e){t.$set(t.formData.location,"country",e)},expression:"formData.location.country"}},t._l(t.locationList,(function(t){return i("bk-option",{key:t.code,attrs:{id:t.code,name:t.cn}})})),1),t._v(" "),t.formData.location.country&&t.provinceList.length?i("bk-select",{staticStyle:{width:"220px","margin-left":"20px"},attrs:{searchable:"",placeholder:"请选择"},on:{change:t.setNodeName},model:{value:t.formData.location.province,callback:function(e){t.$set(t.formData.location,"province",e)},expression:"formData.location.province"}},t._l(t.provinceList,(function(t){return i("bk-option",{key:t.code,attrs:{id:t.code,name:t.cn}})})),1):t._e()],1)]),t._v(" "),i("bk-form-item",{attrs:{label:"运营商","error-display-type":"normal"}},[i("bk-radio-group",{on:{change:t.setNodeName},model:{value:t.formData.operator,callback:function(e){t.$set(t.formData,"operator",e)},expression:"formData.operator"}},t._l(t.operatorList,(function(e){return i("bk-radio",{key:e,staticClass:"mr30",attrs:{value:e}},[t._v("\n                            "+t._s(e)+"\n                        ")])})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"节点名称",required:"",property:"name","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入节点名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),t._v(" "),i("div",{staticClass:"foot-box"},[i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n                    取消\n                ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                    确认\n                ")])],1)],1)])],1)}),[],!1,null,"df0a8548",null).exports,Wn=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Gn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Un=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Wn(e,t),e.prototype.updateValue=function(t){this.$emit("input",t)},e.prototype.addRequestParamsList=function(t){t.push({key:"",value:"",desc:"",id:this.$random(5)}),this.$emit("getTest")},e.prototype.delRequestParamsList=function(t,e){t.splice(e,1)},Gn([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"value",void 0),Gn([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"requestFormColumns",void 0),e=Gn([Object(f.a)({name:"custom-request-form"})],e)}(f.e),Kn=Un,Yn=Object(u.a)(Kn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"custom-request-form"},[i("div",{staticClass:"form-header"},t._l(t.requestFormColumns,(function(e,n){return i("div",{key:n,staticClass:"cell",style:{width:e.width,flex:e.flex}},[e.label?i("span",[t._v(t._s(e.label))]):t._e()])})),0),t._v(" "),t._l(t.value,(function(e,n){return i("div",{key:e.id,staticClass:"form-list"},t._l(t.requestFormColumns,(function(r,o){return i("div",{key:o,staticClass:"cell",style:{width:r.width,flex:r.flex}},[r.label?i("bk-input",{attrs:{behavior:"simplicity",clearable:!0},model:{value:e[r.key],callback:function(i){t.$set(e,r.key,i)},expression:"item[tex.key]"}}):t._e(),t._v(" "),"operate"===r.type?i("div",{staticClass:"action-bar"},[i("bk-icon",{staticClass:"mr5",attrs:{type:"plus-circle"},on:{click:function(e){return t.addRequestParamsList(t.value)}}}),t._v(" "),t.value.length>1?i("bk-icon",{attrs:{type:"minus-circle"},on:{click:function(e){return t.delRequestParamsList(t.value,n)}}}):t._e()],1):t._e()],1)})),0)}))],2)}),[],!1,null,"6d99cadc",null).exports,Xn=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Jn=function(){return Jn=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Jn.apply(this,arguments)},Zn=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Qn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.treeFilterWord="",e.filterIp="",e.loading=!1,e.treeLoading=!1,e.customIp="",e.pagination={current:1,count:1,limit:20},e.tableLoading=!1,e.hostList=[],e.hostListV1=[],e.columns=[{label:"IP",key:"ip",align:"left",minWidth:100},{label:"Agent状态",key:"agent_status",align:"left",minWidth:100,scopedSlots:"agent_status"},{label:"云区域",key:"bk_cloud_name",align:"left",minWidth:100},{label:"操作系统",key:"bk_os_type",align:"left",minWidth:100}],e.maxHeight=365,e.options={idKey:e.genNodeId,nameKey:"bk_inst_name",childrenKey:"child"},e.bizTreeData=[],e.defaultExpandNode=[],e.activeTab="cmdb",e.panels=[{name:"cmdb",label:"从CMDB选择",tip:"不能和自定义混用",disabled:!1},{name:"custom",label:"自定义输入",tip:"不能和CMDB混用",disabled:!1}],e.selectHostList=[],e.requestHeaderData=[{type:"",content:"",id:e.$random(5)}],e.formData={name:"",protocol:"HTTP",method:"GET",bk_biz_id:"",urls:"",node_id_list:[],timeout:3e3,period:1,response_code:"",response:"",response_format:"in",insecure_skip_verify:!1,location:{country:"",province:""},port:"",total_num:3,size:68,request:"",content:"",requestParamsList:[{key:"",value:"",desc:"",id:e.$random(5)}],auth_type:"none",auth_config:{token:"",username:"",password:""},requestHeaderList:[{key:"",value:"",desc:"",id:e.$random(5)}],body_type:"default",bodyFormDataList:[{key:"",value:"",desc:"",id:e.$random(5)}],bodyXFormList:[{key:"",value:"",desc:"",id:e.$random(5)}],bodyRawType:"text",bodyRawValue:""},e.authTypeList=[{label:"无需认证",value:"none"},{label:"Bearer Token",value:"bearer_token"},{label:"Basic Auth",value:"basic_auth"}],e.bodyTypeList=[{label:"默认",value:"default"},{label:"form-data",value:"form_data"},{label:"x-www-form-urlencoded",value:"x_www_form_urlencoded"},{label:"raw",value:"raw"}],e.bodyRawTypeList=[{id:"text",name:"Text"},{id:"json",name:"JSON"},{id:"html",name:"HTML"},{id:"xml",name:"XML"}],e.validateRawSuccess=!0,e.rawErrorTipMap={json:"文本不符合JSON格式",html:"文本不符合HTML格式",xml:"文本不符合XML格式"},e.rules={name:[{required:!0,message:"必填项",trigger:"blur"}],node_id_list:[{required:!0,message:"必填项",trigger:"blur"}],protocol:[{required:!0,message:"必填项",trigger:"blur"}],method:[{required:!0,message:"必填项",trigger:"blur"}],bk_biz_id:[{required:!0,message:"必填项",trigger:"blur"}],urls:[{required:!0,message:"缺少URL协议字符，如http://",trigger:"blur",validator:function(t){return!!t.includes("http")}},{required:!0,message:"请输入正确的url地址",trigger:"blur",validator:function(t){return t.match(/(http|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/g)}}],timeout:[{required:!0,message:"必填项",trigger:"blur"},{required:!0,message:"请设置超时时间，最小值：0ms (不包含)，最大值：60000ms",trigger:"blur",validator:function(t){return t>0&&t<=6e4}}],port:[{required:!0,message:"必填项",trigger:"blur"},{required:!1,message:"请输入合法的端口",trigger:"blur",validator:function(t){return t.match(/^[1-9]\d*|0$/)&&t<=65535}}],request:[{required:!1,message:"请输入合法的十六进制请求内容",trigger:"blur",validator:function(t){return t.match(/^[A-Fa-f0-9]+$/)}}],content:[{required:!0,message:"必选项",trigger:"blur"}]},e.isUrlTrue=!0,e.isOpenHeightSetting=!1,e.requestHeaderList=[],e.nodeIdList=[],e.protocolList=[{label:"HTTP(S)",value:"HTTP"},{label:"TCP",value:"TCP"},{label:"UDP",value:"UDP"},{label:"ICMP",value:"ICMP"}],e.methodList=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"DELETE",value:"DELETE"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],e.bkBizList=[],e.periodList=[{id:1,name:"1分钟"},{id:5,name:"5分钟"}],e.responseFormatRelList=[{id:"in",name:"包含"},{id:"nin",name:"不包含"},{id:"reg",name:"正则"}],e.insecureSkipVerifyList=[{value:!0,label:"是"},{value:!1,label:"否"}],e.locationList=[],e.provinceList=[],e.currentNode="",e.agentTextMap={normal:"正常",abnormal:"异常",not_exist:"不存在"},e.requestConfigPanels=[{name:"params",label:"参数",count:0},{name:"auth",label:"认证",flag:!1},{name:"headerInfo",label:"头信息",count:0},{name:"body",label:"主体",flag:!1}],e.requestConfigActive="params",e.requestFormColumns=[{type:"check",width:"40px"},{key:"key",label:"字段",width:"130px"},{key:"value",label:"值",width:"130px"},{key:"desc",label:"描述",width:"130px"},{type:"operate",flex:1}],e}return Xn(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.operateType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableData",{get:function(){return this.hostList.slice((this.pagination.current-1)*this.pagination.limit,this.pagination.current*this.pagination.limit)},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.getBiz(),this.getCountryList(),this.getHttpHeaders(),this.getUpTimeCheckNode(),this.isAdd||this.initData()},e.prototype.setDefaultList=function(){return[{key:"",value:"",desc:"",id:this.$random(5)}]},e.prototype.validateRawValue=function(t){if("json"===this.formData.bodyRawType)this.validateRawSuccess=this.isValidJSONString(t);else if("html"===this.formData.bodyRawType){this.validateRawSuccess=/<([a-z]+)([^<]+)*(?:>(.*)<\/\1>|\s+\/>)/.test(t)}else"xml"===this.formData.bodyRawType?this.validateRawSuccess=this.isValidXml(t):this.validateRawSuccess=!0},e.prototype.isValidJSONString=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},e.prototype.isValidXml=function(t){return 0===(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("parsererror").length},e.prototype.addNode=function(){this.$refs.addNode.show()},e.prototype.filterTree=function(){this.$refs.tree.filter(this.treeFilterWord)},e.prototype.filterTableData=function(){var t=this;this.filterIp.trim().length?(this.pagination.current=1,this.hostList=this.hostListV1.filter((function(e){return-1!==e.ip.indexOf(t.filterIp.trim())})),this.pagination.count=this.hostList.length):this.hostList=JSON.parse(JSON.stringify(this.hostListV1)),this.setTableCheckStatus()},e.prototype.initData=function(){var t,e,i=this.currentData,n=i.name,r=i.protocol,o=i.config,a=i.nodes;this.formData.name=n,this.formData.protocol=r,this.selectHostList=o.hosts||[],this.formData.node_id_list=null==a?void 0:a.map((function(t){return t.id})),this.formData.timeout=o.max_rtt||o.timeout,this.formData.period=o.period,this.formData.total_num=o.total_num,this.formData.size=o.size,this.formData.urls=o.urls,this.formData.response_code=o.response_code,this.formData.response_format=o.response_format,this.formData.method=o.method,this.formData.response=o.response,this.formData.insecure_skip_verify=o.insecure_skip_verify,"HTTP"===this.formData.protocol&&(this.formData.requestHeaderList=(null===(t=o.headers)||void 0===t?void 0:t.length)?o.headers:this.setDefaultList(),this.formData.requestParamsList=(null===(e=o.query_params)||void 0===e?void 0:e.length)?o.query_params:this.setDefaultList(),this.formData.bodyRawValue=o.body.content,this.formData.bodyRawType=o.body.content_type,this.formData.body_type=o.body.data_type,"form_data"===this.formData.body_type&&o.body.params.length&&(this.formData.bodyFormDataList=o.body.params),"x_www_form_urlencoded"===this.formData.body_type&&o.body.params.length&&(this.formData.bodyXFormList=o.body.params),this.formData.auth_type=o.authorize.auth_type,this.formData.auth_config.token=o.authorize.auth_config.token||"",this.formData.auth_config.username=o.authorize.auth_config.username||"",this.formData.auth_config.password=o.authorize.auth_config.password||""),this.formData.port=o.port,this.formData.request=o.request,this.formData.content=o.request},e.prototype.changeBusiness=function(){this.hostList=[],this.getBizTree()},e.prototype.changeTab=function(t){if(t.disabled)return!1;this.activeTab=t.name,this.hostList=[],this.customIp=""},e.prototype.parseIp=function(){if(!this.customIp.trim().length)return this.$warn("请输入IP"),!1;var t={bk_biz_id:2,ip_list:this.customIp.trim().split(/\n/).map((function(t){return{ip:t}})),with_external_ips:!0};this.getHostInstanceByIp(t)},e.prototype.selectTableData=function(t,e){var i=this.selectHostList.findIndex((function(t){return t.ip===e.ip}));-1===i?this.selectHostList.push(e):this.selectHostList.splice(i,1),this.setTabStatus()},e.prototype.selectAllTableData=function(t){var e=this;0===t.length?this.selectHostList=this.selectHostList.filter((function(t){return!e.hostList.find((function(e){return t.ip===e.ip}))})):(t||[]).forEach((function(t){e.selectHostList.find((function(e){return e.ip===t.ip}))||e.selectHostList.push(t)})),this.setTabStatus()},e.prototype.setTabStatus=function(){this.selectHostList.length?(this.panels[0].disabled=!("cmdb"===this.activeTab),this.panels[1].disabled="cmdb"===this.activeTab):(this.panels[0].disabled=!1,this.panels[1].disabled=!1)},e.prototype.removeSelectHost=function(t,e){var i=this;this.selectHostList.splice(e,1),this.$nextTick((function(){i.tableData.forEach((function(e){e.ip===t.ip&&i.$refs.hostTable.toggleRowSelection(e,!1)}))}))},e.prototype.clearSelectHost=function(){this.selectHostList=[],this.$refs.hostTable.clearSelection()},e.prototype.confirm=function(){var t=this;if("HTTP"===this.formData.protocol){if(this.isUrlTrue=/(http|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/g.test(this.formData.urls),!this.isUrlTrue)return!1}this.$refs.validateForm.validate().then((function(e){if("HTTP"!==t.formData.protocol&&!t.selectHostList.length)return t.$warn("请选择主机目标"),!1;var i=t.getConfig(),n={bk_biz_id:t.formData.bk_biz_id,protocol:t.formData.protocol,node_id_list:t.formData.node_id_list,config:i,name:t.formData.name,location:{bk_state_name:t.formData.location.country,bk_province_name:t.formData.location.province}};t.isAdd||(n.id=t.currentData.id),t.operateTask(n)}))},e.prototype.getCustomRequestFormList=function(t){return t.filter((function(t){return t.key||t.desc||t.value})).map((function(t,e){return Jn(Jn({},t),{index:e})}))},e.prototype.getConfig=function(){var t={};return"HTTP"===this.formData.protocol?(t={period:this.formData.period,timeout:this.formData.timeout,response:this.formData.response||null,response_format:this.formData.response_format,method:this.formData.method,urls:this.formData.urls,request:this.formData.content||"{}",headers:this.getCustomRequestFormList(this.formData.requestHeaderList),query_params:this.getCustomRequestFormList(this.formData.requestParamsList),response_code:this.formData.response_code,body:{content:"raw"===this.formData.body_type?this.formData.bodyRawValue:"",content_type:"raw"===this.formData.body_type?this.formData.bodyRawType:"",data_type:this.formData.body_type,params:["default","raw"].includes(this.formData.body_type)?[]:this.getCustomRequestFormList("form_data"===this.formData.body_type?this.formData.bodyFormDataList:this.formData.bodyXFormList)},authorize:{auth_config:{},auth_type:this.formData.auth_type,insecure_skip_verify:this.formData.insecure_skip_verify}},"bearer_token"===this.formData.auth_type?t.authorize.auth_config={token:this.formData.auth_config.token}:"basic_auth"===this.formData.auth_type?t.authorize.auth_config={username:this.formData.auth_config.username,password:this.formData.auth_config.password}:t.authorize.auth_config={}):t="ICMP"===this.formData.protocol?{max_rtt:this.formData.timeout,period:this.formData.period,total_num:this.formData.total_num,size:this.formData.size,hosts:this.selectHostList}:{hosts:this.selectHostList,request:this.formData.request||null,period:this.formData.period,port:this.formData.port,timeout:this.formData.timeout,response:this.formData.response||null,method:this.formData.method,response_format:this.formData.response_format},t},e.prototype.operateTask=function(t){var e=this;this.loading=!0,this.$api.webMonitorCollect[this.isAdd?"createTask":"modifyTask"](t).then((function(t){var i=t.result,n=t.message;if(!i)return e.$error(n),!1;e.$success("".concat(e.isAdd?"新增":"编辑","任务成功!")),e.$emit("refresh-list")})).finally((function(){e.loading=!1}))},e.prototype.operateRequestHeader=function(t,e){"add"===t?this.requestHeaderData.push({type:"",content:"",id:this.$random(5)}):this.requestHeaderData.splice(e,1)},e.prototype.setAgentStatus=function(t){switch(t){case"normal":return{borderColor:"#e5f6ea",backgroundColor:"#3fc06d"};case"abnormal":return{borderColor:"#ffe6e6",backgroundColor:"#ea3636"};case"not_exist":return{borderColor:"#f0f1f5",backgroundColor:"#b2b5bd"}}},e.prototype.cancel=function(){this.$emit("refresh-list")},e.prototype.selectCountry=function(t){if(!t)return this.provinceList=[],!1;var e=this.locationList.find((function(e){return e.code===t}));this.provinceList=e.children||[],this.formData.location.province=""},e.prototype.nodeClick=function(t){this.currentNode=t.data;var e=[];this.getNodeIpList(this.currentNode,e);var i={bk_biz_id:this.currentNode.bk_biz_id,ip_list:e};this.getHostInstanceByIp(i)},e.prototype.getNodeIpList=function(t,e){var i=this;t.child?t.child.forEach((function(t){i.getNodeIpList(t,e)})):e.push(t)},e.prototype.genNodeId=function(t){return"".concat(t.bk_obj_id,"-").concat(t.bk_inst_id)},e.prototype.getBiz=function(){var t=this;this.$api.Server.getBizs().then((function(e){if(!e.result)return!1;t.bkBizList=e.data,t.formData.bk_biz_id=t.isAdd?e.data[0].bk_biz_id:t.currentData.bk_biz_id,t.getBizTree()}))},e.prototype.getCountryList=function(){var t=this;this.$api.webMonitorCollect.getCountryList().then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.locationList=n,t.isAdd||(t.formData.location.country=t.currentData.location.bk_state_name,t.locationList.forEach((function(e){e.code===t.formData.location.country&&(t.provinceList=e.children)})),t.formData.location.province=t.currentData.location.bk_province_name)}))},e.prototype.getHttpHeaders=function(){var t=this;this.$api.webMonitorCollect.getHttpHeaders().then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.requestHeaderList=n.map((function(t){return{id:t,name:t}}))}))},e.prototype.getUpTimeCheckNode=function(){var t=this;this.$api.webMonitorCollect.getUpTimeCheckNode().then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.nodeIdList=n.results.map((function(t){return t.showName=t.name+" "+t.ip,t}))}))},e.prototype.getBizTree=function(){var t=this;this.treeLoading=!0,this.$api.webMonitorCollect.getBizTree({bk_biz_id:this.formData.bk_biz_id}).then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.bizTreeData=[n],t.defaultExpandNode=[t.genNodeId(n)]})).finally((function(){t.treeLoading=!1}))},e.prototype.getHostInstanceByIp=function(t){var e=this;this.tableLoading=!0,this.$api.webMonitorCollect.getHostInstanceByIp(t).then((function(t){var i=t.result,n=t.data;if(!i)return!1;e.hostList=n,e.hostListV1=JSON.parse(JSON.stringify(e.hostList)),e.pagination.count=n.length,e.setTableCheckStatus()})).finally((function(){e.tableLoading=!1}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.setTableCheckStatus()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.setTableCheckStatus()},e.prototype.setTableCheckStatus=function(){var t=this;this.$nextTick((function(){t.selectHostList.length>0&&t.tableData.forEach((function(e){t.selectHostList.find((function(t){return t.ip===e.ip}))&&t.$refs.hostTable.toggleRowSelection(e,!0)}))}))},Zn([Object(f.d)({type:String,default:function(){return"add"}})],e.prototype,"operateType",void 0),Zn([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentData",void 0),e=Zn([Object(f.a)({name:"operateTask",components:{AddNode:Vn,IntroduceInfo:Vt,CustomRequestForm:Yn}})],e)}(f.e),tr=Qn,er=Object(u.a)(tr,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"operate-task"},[i("div",{staticClass:"task-header"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.cancel}}),t._v("\n        "+t._s(t.isAdd?"新建":"编辑")+"服务拨测\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isAdd,expression:"!isAdd"}],staticClass:"sub-title line"},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isAdd,expression:"!isAdd"}],staticClass:"sub-title"},[t._v(t._s(t.formData.name))])],1),t._v(" "),i("div",{staticClass:"task-content"},[i("bk-form",{ref:"validateForm",attrs:{"label-width":110,model:t.formData,rules:t.rules}},[i("bk-form-item",{attrs:{label:"任务名称",required:!0,property:"name","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入任务名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"协议",required:!0,property:"protocol","error-display-type":"normal"}},[i("bk-radio-group",{model:{value:t.formData.protocol,callback:function(e){t.$set(t.formData,"protocol",e)},expression:"formData.protocol"}},t._l(t.protocolList,(function(e){return i("bk-radio",{key:e.value,staticClass:"mr30",attrs:{value:e.value}},[t._v("\n                        "+t._s(e.label)+"\n                    ")])})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"目标业务",required:!0,property:"bk_biz_id","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"600px"},attrs:{searchable:"",placeholder:"请选择目标业务"},on:{change:t.changeBusiness},model:{value:t.formData.bk_biz_id,callback:function(e){t.$set(t.formData,"bk_biz_id",e)},expression:"formData.bk_biz_id"}},t._l(t.bkBizList,(function(t){return i("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1)],1),t._v(" "),"HTTP"===t.formData.protocol?i("bk-form-item",{attrs:{label:"目标地址",required:!0,"error-display-type":"normal"}},[i("div",{style:{display:"flex",marginBottom:t.isUrlTrue?"20px":0}},[i("bk-select",{staticStyle:{width:"90px","margin-right":"20px"},attrs:{disabled:!1,"ext-cls":"select-custom",clearable:!1,"ext-popover-cls":"select-popover-custom"},model:{value:t.formData.method,callback:function(e){t.$set(t.formData,"method",e)},expression:"formData.method"}},t._l(t.methodList,(function(t){return i("bk-option",{key:t.value,attrs:{id:t.value,name:t.label}})})),1),t._v(" "),i("bk-input",{staticStyle:{width:"490px"},attrs:{placeholder:"请输入请求URL",clearable:!0},model:{value:t.formData.urls,callback:function(e){t.$set(t.formData,"urls",e)},expression:"formData.urls"}})],1),t._v(" "),t.isUrlTrue?t._e():i("span",{staticClass:"error-tip"},[t._v("请输入合法的url地址")]),t._v(" "),i("div",{staticClass:"request-config-form"},[i("div",{staticClass:"custom-tab-header"},t._l(t.requestConfigPanels,(function(e,n){return i("div",{key:n,class:["tab-item",e.name===t.requestConfigActive&&"tab-item-active"],on:{click:function(i){t.requestConfigActive=e.name}}},[i("span",[t._v(t._s(e.label))])])})),0),t._v(" "),i("div",{staticClass:"custom-tab-content"},[i("custom-request-form",{directives:[{name:"show",rawName:"v-show",value:"params"===t.requestConfigActive,expression:"requestConfigActive === 'params'"}],ref:"customRequestForm",attrs:{"request-form-columns":t.requestFormColumns},model:{value:t.formData.requestParamsList,callback:function(e){t.$set(t.formData,"requestParamsList",e)},expression:"formData.requestParamsList"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"auth"===t.requestConfigActive,expression:"requestConfigActive === 'auth'"}]},[i("bk-radio-group",{staticClass:"mb10",model:{value:t.formData.auth_type,callback:function(e){t.$set(t.formData,"auth_type",e)},expression:"formData.auth_type"}},t._l(t.authTypeList,(function(e){return i("bk-radio",{key:e.value,staticClass:"mr30",attrs:{value:e.value}},[t._v("\n                                    "+t._s(e.label)+"\n                                ")])})),1),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:"none"===t.formData.auth_type,expression:"formData.auth_type === 'none'"}],staticClass:"tips"},[t._v("该请求不需要任何认证。")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"bearer_token"===t.formData.auth_type,expression:"formData.auth_type === 'bearer_token'"}],staticClass:"input-form"},[i("span",{staticClass:"input-label"},[t._v("Token")]),t._v(" "),i("bk-input",{attrs:{behavior:"simplicity",clearable:!0},model:{value:t.formData.auth_config.token,callback:function(e){t.$set(t.formData.auth_config,"token",e)},expression:"formData.auth_config.token"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"basic_auth"===t.formData.auth_type,expression:"formData.auth_type === 'basic_auth'"}],staticStyle:{display:"flex"}},[i("div",{staticClass:"input-form"},[i("span",{staticClass:"input-label"},[t._v("用户名")]),t._v(" "),i("bk-input",{attrs:{behavior:"simplicity",clearable:!0},model:{value:t.formData.auth_config.username,callback:function(e){t.$set(t.formData.auth_config,"username",e)},expression:"formData.auth_config.username"}})],1),t._v(" "),i("div",{staticClass:"input-form"},[i("span",{staticClass:"input-label"},[t._v("密码")]),t._v(" "),i("bk-input",{attrs:{type:"password",behavior:"simplicity",clearable:!0},model:{value:t.formData.auth_config.password,callback:function(e){t.$set(t.formData.auth_config,"password",e)},expression:"formData.auth_config.password"}})],1)])],1),t._v(" "),i("custom-request-form",{directives:[{name:"show",rawName:"v-show",value:"headerInfo"===t.requestConfigActive,expression:"requestConfigActive === 'headerInfo'"}],ref:"customRequestForm",attrs:{"request-form-columns":t.requestFormColumns},model:{value:t.formData.requestHeaderList,callback:function(e){t.$set(t.formData,"requestHeaderList",e)},expression:"formData.requestHeaderList"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"body"===t.requestConfigActive,expression:"requestConfigActive === 'body'"}]},[i("bk-radio-group",{staticClass:"mb10",model:{value:t.formData.body_type,callback:function(e){t.$set(t.formData,"body_type",e)},expression:"formData.body_type"}},t._l(t.bodyTypeList,(function(e){return i("bk-radio",{key:e.value,staticClass:"mr30",attrs:{value:e.value}},[t._v("\n                                    "+t._s(e.label)+"\n                                ")])})),1),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:"default"===t.formData.body_type,expression:"formData.body_type === 'default'"}],staticClass:"tips"},[t._v("该请求不含主体。")]),t._v(" "),i("custom-request-form",{directives:[{name:"show",rawName:"v-show",value:"form_data"===t.formData.body_type,expression:"formData.body_type === 'form_data'"}],ref:"customRequestForm",attrs:{"request-form-columns":t.requestFormColumns},model:{value:t.formData.bodyFormDataList,callback:function(e){t.$set(t.formData,"bodyFormDataList",e)},expression:"formData.bodyFormDataList"}}),t._v(" "),i("custom-request-form",{directives:[{name:"show",rawName:"v-show",value:"x_www_form_urlencoded"===t.formData.body_type,expression:"formData.body_type === 'x_www_form_urlencoded'"}],ref:"customRequestForm",attrs:{"request-form-columns":t.requestFormColumns},model:{value:t.formData.bodyXFormList,callback:function(e){t.$set(t.formData,"bodyXFormList",e)},expression:"formData.bodyXFormList"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"raw"===t.formData.body_type,expression:"formData.body_type === 'raw'"}],staticStyle:{display:"flex"}},[i("div",{staticClass:"mr10"},[i("bk-select",{staticStyle:{width:"90px"},attrs:{disabled:!1,"ext-cls":"select-custom",behavior:"simplicity",clearable:!1,"ext-popover-cls":"select-popover-custom"},on:{change:function(e){return t.validateRawValue(t.formData.bodyRawValue)}},model:{value:t.formData.bodyRawType,callback:function(e){t.$set(t.formData,"bodyRawType",e)},expression:"formData.bodyRawType"}},t._l(t.bodyRawTypeList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),i("div",{staticStyle:{flex:"1"}},[i("bk-input",{attrs:{type:"textarea",rows:6},on:{blur:t.validateRawValue},model:{value:t.formData.bodyRawValue,callback:function(e){t.$set(t.formData,"bodyRawValue",e)},expression:"formData.bodyRawValue"}}),t._v(" "),t.validateRawSuccess?t._e():i("span",{staticClass:"error-tip"},[t._v("\n                                        "+t._s(t.rawErrorTipMap[t.formData.bodyRawType])+"\n                                    ")])],1)])],1)],1)])]):t._e(),t._v(" "),"HTTP"!==t.formData.protocol?i("bk-form-item",{attrs:{label:"目标",required:!0,"error-display-type":"normal"}},[i("div",{staticClass:"host-box"},[i("div",{staticClass:"select-box"},[i("div",{staticClass:"tab-list"},t._l(t.panels,(function(e,n){return i("div",{key:e.name,class:["tab-item",t.activeTab===e.name&&"active-tab",!n&&"hide-left-border","top-middle",e.disabled&&"disabled-tab"],on:{click:function(i){return t.changeTab(e)}}},[e.disabled?i("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.tip,expression:"item.tip",modifiers:{top:!0}}]},[t._v(t._s(e.label))]):i("span",[t._v(t._s(e.label))])])})),0),t._v(" "),i("div",{staticClass:"main-content"},["cmdb"===t.activeTab?i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.treeLoading,zIndex:10},expression:"{ isLoading: treeLoading, zIndex: 10 }"}],staticClass:"tree-box"},[i("bk-input",{attrs:{placeholder:"请输入",clearable:!0},on:{change:t.filterTree},model:{value:t.treeFilterWord,callback:function(e){t.treeFilterWord=e},expression:"treeFilterWord"}}),t._v(" "),i("div",{staticClass:"tree-content-box mt10"},[i("bk-big-tree",{ref:"tree",attrs:{selectable:!0,options:t.options,"default-expanded-nodes":t.defaultExpandNode,data:t.bizTreeData,"expand-on-click":!1},on:{"node-click":t.nodeClick}})],1)],1):i("div",{staticClass:"custom-box"},[i("bk-input",{staticStyle:{flex:"1","margin-bottom":"10px"},attrs:{placeholder:"多个IP以回车作为分隔符",type:"textarea",clearable:""},model:{value:t.customIp,callback:function(e){t.customIp=e},expression:"customIp"}}),t._v(" "),i("bk-button",{attrs:{type:"submit"},on:{click:t.parseIp}},[t._v("\n                                    点击解析\n                                ")])],1),t._v(" "),i("div",{staticClass:"table-box"},[i("bk-input",{attrs:{placeholder:"请输入IP",clearable:!0},on:{enter:t.filterTableData,clear:t.filterTableData},model:{value:t.filterIp,callback:function(e){t.filterIp=e},expression:"filterIp"}}),t._v(" "),i("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"hostTable",staticClass:"mt10",attrs:{data:t.tableData,pagination:t.pagination,"max-height":t.maxHeight},on:{select:t.selectTableData,"select-all":t.selectAllTableData,"page-change":t.handlePageChange,"page-limit-change":t.limitChange}},[i("bk-table-column",{attrs:{type:"selection",width:"60"}}),t._v(" "),t._l(t.columns,(function(e){return i("bk-table-column",t._b({key:e.key,attrs:{label:e.label,prop:e.key,"column-key":e.key},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.row;return[e.scopedSlots?i("div",["agent_status"===e.scopedSlots?i("div",[i("span",{staticClass:"agent-status",style:t.setAgentStatus(r[e.key])}),t._v(" "),i("span",[t._v(t._s(t.agentTextMap[r[e.key]]||"--"))])]):t._e()]):i("div",[t._v("\n                                                "+t._s(r[e.key]||"--")+"\n                                            ")])]}}],null,!0)},"bk-table-column",e,!1))}))],2)],1)])]),t._v(" "),i("div",{staticClass:"result-box"},[i("div",{staticClass:"result-header"},[t._v("结果预览")]),t._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"info-left"},[i("span",[t._v("已选择")]),t._v(" "),i("span",{staticStyle:{color:"#659FFD"}},[t._v(t._s(t.selectHostList.length))]),t._v(" "),i("span",[t._v("台主机")])]),t._v(" "),i("div",{staticClass:"info-right",on:{click:t.clearSelectHost}},[t._v("清空")])]),t._v(" "),i("div",{staticClass:"list"},t._l(t.selectHostList,(function(e,n){return i("div",{key:e.ip,class:["list-item",n!==t.selectHostList.length-1&&"list-item-border-bottom"]},[i("span",{staticClass:"value"},[t._v(t._s(e.ip))]),t._v(" "),i("i",{staticClass:"cw-icon weops-close",on:{click:function(i){return t.removeSelectHost(e,n)}}})])})),0)])])]):t._e(),t._v(" "),["TCP","UDP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"端口",required:!0,property:"port","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入端口号"},model:{value:t.formData.port,callback:function(e){t.$set(t.formData,"port",e)},expression:"formData.port"}})],1):t._e(),t._v(" "),["UDP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"请求内容",required:!0,property:"request","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"600px"},attrs:{placeholder:"十六进制的请求内容， 如3a47534b422d644c"},model:{value:t.formData.request,callback:function(e){t.$set(t.formData,"request",e)},expression:"formData.request"}})],1):t._e(),t._v(" "),i("bk-form-item",{attrs:{label:"拨测节点",required:!0,property:"node_id_list","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"600px"},attrs:{searchable:"",multiple:"",placeholder:"请选择拨测节点"},model:{value:t.formData.node_id_list,callback:function(e){t.$set(t.formData,"node_id_list",e)},expression:"formData.node_id_list"}},[t._l(t.nodeIdList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.showName}})})),t._v(" "),i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:t.addNode},slot:"extension"},[i("i",{staticClass:"bk-icon icon-plus-circle"}),t._v("新增拨测节点\n                    ")])],2)],1),t._v(" "),i("bk-form-item",{attrs:{label:"超时设置",required:!0,property:"timeout","error-display-type":"normal"}},[i("div",{staticClass:"search-box"},[i("bk-input",{staticStyle:{width:"180px"},attrs:{type:"number",clearable:""},model:{value:t.formData.timeout,callback:function(e){t.$set(t.formData,"timeout",e)},expression:"formData.timeout"}},[i("template",{slot:"append"},[i("div",{staticClass:"group-text"},[t._v("ms")])])],2),t._v(" "),i("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:"超过该时长未正常采集数据时，系统判断该任务状态为不可用状态",expression:"'超过该时长未正常采集数据时，系统判断该任务状态为不可用状态'",modifiers:{top:!0}}],staticClass:"top-middle"},[i("bk-icon",{staticStyle:{"font-size":"13px","margin-left":"10px"},attrs:{type:"info-circle-shape"}})],1)],1),t._v(" "),i("div",{staticClass:"more-setting"},[i("span",{on:{click:function(e){t.isOpenHeightSetting=!t.isOpenHeightSetting}}},[t._v(t._s(t.isOpenHeightSetting?"隐藏":"显示")+"高级选项")])])]),t._v(" "),t.isOpenHeightSetting?i("bk-form-item",{attrs:{label:"周期","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"180px"},attrs:{searchable:"",placeholder:"请选择周期"},model:{value:t.formData.period,callback:function(e){t.$set(t.formData,"period",e)},expression:"formData.period"}},t._l(t.periodList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):t._e(),t._v(" "),t.isOpenHeightSetting&&["HTTP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"期待返回码","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"600px"},attrs:{placeholder:"HTTP返回请求码, 如200， 304， 404等",clearable:!0},model:{value:t.formData.response_code,callback:function(e){t.$set(t.formData,"response_code",e)},expression:"formData.response_code"}})],1):t._e(),t._v(" "),t.isOpenHeightSetting&&["HTTP","TCP","UDP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"期待响应信息","error-display-type":"normal"}},[i("div",{staticClass:"search-box"},[i("bk-select",{staticStyle:{width:"120px"},attrs:{clearable:!1,disabled:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},model:{value:t.formData.response_format,callback:function(e){t.$set(t.formData,"response_format",e)},expression:"formData.response_format"}},t._l(t.responseFormatRelList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v(" "),i("bk-input",{staticStyle:{width:"480px"},attrs:{clearable:!0,placeholder:"通过指定匹配内容来检查响应是否正确，为空则不做匹配检查"},model:{value:t.formData.response,callback:function(e){t.$set(t.formData,"response",e)},expression:"formData.response"}}),t._v(" "),i("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:"系统会自动创建该告警策略，响应信息匹配失败将会产生告警",expression:"'系统会自动创建该告警策略，响应信息匹配失败将会产生告警'",modifiers:{top:!0}}],staticClass:"top-middle"},[i("bk-icon",{staticStyle:{"font-size":"14px","margin-left":"10px"},attrs:{type:"info-circle-shape"}})],1)],1)]):t._e(),t._v(" "),t.isOpenHeightSetting&&["HTTP","TCP","UDP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"地理位置","error-display-type":"normal"}},[i("div",{staticStyle:{display:"flex"}},[i("bk-select",{staticStyle:{width:"180px"},attrs:{searchable:"",placeholder:"请选择"},on:{change:t.selectCountry},model:{value:t.formData.location.country,callback:function(e){t.$set(t.formData.location,"country",e)},expression:"formData.location.country"}},t._l(t.locationList,(function(t){return i("bk-option",{key:t.code,attrs:{id:t.code,name:t.cn}})})),1),t._v(" "),t.formData.location.country&&t.provinceList.length?i("bk-select",{staticStyle:{width:"180px","margin-left":"20px"},attrs:{searchable:"",placeholder:"请选择"},model:{value:t.formData.location.province,callback:function(e){t.$set(t.formData.location,"province",e)},expression:"formData.location.province"}},t._l(t.provinceList,(function(t){return i("bk-option",{key:t.code,attrs:{id:t.code,name:t.cn}})})),1):t._e()],1)]):t._e(),t._v(" "),t.isOpenHeightSetting&&["ICMP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"周期内连续探测","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"180px"},attrs:{type:"number",clearable:""},model:{value:t.formData.total_num,callback:function(e){t.$set(t.formData,"total_num",e)},expression:"formData.total_num"}})],1):t._e(),t._v(" "),t.isOpenHeightSetting&&["ICMP"].includes(t.formData.protocol)?i("bk-form-item",{attrs:{label:"探测包大小","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"180px"},attrs:{type:"number",clearable:!0},model:{value:t.formData.size,callback:function(e){t.$set(t.formData,"size",e)},expression:"formData.size"}})],1):t._e()],1),t._v(" "),i("introduce-info",{attrs:{type:"web","need-move":!1}})],1),t._v(" "),i("div",{staticClass:"task-footer"},[i("bk-button",{attrs:{disabled:t.loading},on:{click:t.cancel}},[t._v("\n            取消\n        ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n            提交\n        ")])],1),t._v(" "),i("add-node",{ref:"addNode",attrs:{"location-list":t.locationList,"bk-biz-list":t.bkBizList},on:{"refresh-node":t.getUpTimeCheckNode}})],1)}),[],!1,null,"0f8caa99",null).exports,ir=i("EUZL"),nr=i.n(ir),rr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),or=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},ar=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},sr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},lr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iframeUrl="".concat(window.HOST,"bk_monitorv3/?bizId=2#/export-import"),e.file={},e.uploadProcess=0,e.maxFileSize=100,e.accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",e.isDrap=!1,e.status="import",e.parsingRes="parsing",e.importStatus={pending:e.$t("导入中"),success:e.$t("成功"),fail:e.$t("失败")},e.downloadList=[{id:"HTTP(S)",name:"HTTP(S)",url:window.STATIC_URL+"templates/bk_monitor_http_template.xlsx",downloadName:"bk_monitor_http_template"},{id:"TCP",name:"TCP",url:window.STATIC_URL+"templates/bk_monitor_tcp_template.xlsx",downloadName:"bk_monitor_tcp_template"},{id:"UDP",name:"UDP",url:window.STATIC_URL+"templates/bk_monitor_udp_template.xlsx",downloadName:"bk_monitor_udp_template"},{id:"ICMP",name:"ICMP",url:window.STATIC_URL+"templates/bk_monitor_icmp_template.xlsx",downloadName:"bk_monitor_icmp_template"}],e.rulesMap=new Map,e.taskList=[],e.options={isShow:!1},e.businessData=[],e.business="",e}return rr(e,t),Object.defineProperty(e.prototype,"canComplete",{get:function(){return this.taskList.length&&!this.taskList.find((function(t){return"success"!==t.status}))},enumerable:!1,configurable:!0}),e.prototype.show=function(){this.options.isShow=!0,this.getBusiness()},e.prototype.getBusiness=function(){var t=this;this.$api.Server.getBizs().then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.businessData=n}))},e.prototype.handleDownload=function(t){window.open(t)},e.prototype.complete=function(){var t=this.taskList.filter((function(t){return"success"===t.status})).length;this.$bkMessage({theme:"success",message:"".concat(this.$t("恭喜你，成功导入 ")).concat(t).concat(this.$t("个")).concat(this.$t("任务"))}),this.close(),this.$emit("complete")},e.prototype.cancel=function(){this.close()},e.prototype.close=function(){this.options.isShow=!1},e.prototype.handleDrop=function(t){if(!this.business)return this.$warn("请先选择业务"),!1;this.isDrap=!1,t.preventDefault(),t.stopPropagation(),this.handleFile(t.dataTransfer.files)},e.prototype.handleFileChange=function(t){if(!this.business)return this.$warn("请先选择业务"),!1;this.handleFile(t.target.files)},e.prototype.handleFile=function(t){return ar(this,void 0,void 0,(function(){var e,i,n,r,o,a,s,l,c,u;return sr(this,(function(p){switch(p.label){case 0:return t.length?(e=t[0],this.file=e,[4,this.validateFile(this.getFileInfo(e))]):[3,7];case 1:return p.sent(),this.status="uploading",[4,this.parseFile(e)];case 2:i=p.sent(),this.status="parsing",this.parsingRes="parsing",n=this.taskList,r=i.data,o={},a={},s=function(t,e){var i;return sr(this,(function(e){switch(e.label){case 0:return o=r[t],[4,l.getRules(o[l.$t("协议（必填）")])];case 1:return(i=e.sent()).success?(a=l.getExcelRowData(i.data,o),a=l.validateExcelRowData(i.data,a),n.push(a),"pending"===a.status&&l.importTask([a]).then((function(e){var i=e.data;if(1===i.success.total)n[t].status="success";else{var r=i.failed.detail&&i.failed.detail[0];n[t].status="fail",n[t].errMsg=r.error_mes}}))):n.push({name:o[l.$t("任务名称（必填）")],protocol:o[l.$t("协议（必填）")],errMsg:i.message||l.$t("不支持该协议"),status:"fail"}),[2]}}))},l=this,c=0,u=r.length,p.label=3;case 3:return c<u?[5,s(c,u)]:[3,6];case 4:p.sent(),p.label=5;case 5:return c++,[3,3];case 6:this.parsingRes="finish",p.label=7;case 7:return[2]}}))}))},e.prototype.getFileInfo=function(t){var e=t.name,i=e.lastIndexOf("."),n=e.slice(i+1);return{name:e,originSize:t.size,size:t.size/1024,type:t.type,suffix:n,origin:t}},e.prototype.validateFile=function(t){var e=this,i={success:!0,message:""};return t.size>1024*this.maxFileSize&&(i.success=!1,i.message="".concat(this.$t("文件不能超过")).concat(this.maxFileSize).concat(this.$t("MB"))),this.fileName&&!this.fileName.test(t.name)&&(i.success=!1,i.message="".concat(this.$t("文件不能超过")).concat(this.maxFileSize).concat(this.$t("MB"))),t.type!==this.accept&&(i.success=!1,i.message=this.$t("只支持“xlsx”格式的文件")),new Promise((function(t,n){i.success?t(i):(e.$bkMessage({theme:"error",message:i.message,ellipsisLine:0}),n(i.message))}))},e.prototype.parseFile=function(t){var e=this,i={success:!0,message:"",data:[]},n=new FileReader;return new Promise((function(r,o){n.onload=function(t){try{var n=t.target.result,a=nr.a.read(n,{type:"binary"});Object.keys(a.Sheets).forEach((function(t,e){var n;0===e&&(n=i.data).push.apply(n,nr.a.utils.sheet_to_json(a.Sheets[t]))})),setTimeout((function(){r(i)}),300)}catch(t){setTimeout((function(){e.$bkMessage({theme:"error",message:t||e.$t("解析文件失败"),ellipsisLine:0}),e.parsingRes="error",o(t)}),300)}},n.onprogress=function(t){setTimeout((function(){e.uploadProcess=Number.parseInt(t.loaded/t.total*100,10)}),300)},n.readAsBinaryString(t)}))},e.prototype.getRules=function(t){return ar(this,void 0,void 0,(function(){var e,i;return sr(this,(function(n){switch(n.label){case 0:return e={success:!0,message:"",data:[]},t?this.rulesMap.has(t)?[3,2]:[4,this.requestRules(t)]:(e.success=!1,e.message=this.$t("协议不能为空"),[2,e]);case 1:return(i=n.sent()).success?(e.data=i.data,this.rulesMap.set(t,i.data)):(e.success=!1,e.message=i.message),[3,3];case 2:e.data=this.rulesMap.get(t),n.label=3;case 3:return[2,e]}}))}))},e.prototype.requestRules=function(t){var e=this;return new Promise((function(i){return e.$api.webMonitorCollect.fileParse({protocol:t}).then((function(t){t.result?i({success:!0,data:t.data}):i({success:!1,message:t.message})})).catch((function(t){i({success:!1,message:t.responseJSON.data})}))}))},e.prototype.getExcelRowData=function(t,e){var i={};return t.forEach((function(t){t.is_dict&&e[t.cnkey]?i[t.enkey]=JSON.parse(e[t.cnkey]):t.default&&!e[t.cnkey]?i[t.enkey]=t.default:i[t.enkey]=e[t.cnkey]||""})),i},e.prototype.validateExcelRowData=function(t,e){e.status="pending";for(var i=0,n=t;i<n.length;i++){var r=n[i];if(r.required){if(!e[r.enkey]){e.status="fail",e.errMsg="".concat(this.$t("字段"),"”").concat(r.cnkey,"“").concat(this.$t("必填不能为空"));break}if(r.regex&&!new RegExp(r.regex).test(e[r.enkey])){e.status="fail",e.errMsg="".concat(this.$t("字段"),"“").concat(r.cnkey,"“").concat(this.$t("正则匹配错误，正则为：")).concat(r.regex);break}}else if(r.regex&&!new RegExp(r.regex).test(e[r.enkey])){e.status="fail",e.errMsg="".concat(this.$t("字段"),"”").concat(r.cnkey,"”").concat(this.$t("正则匹配错误，正则为：")).concat(r.regex);break}}return e},e.prototype.importTask=function(t){return this.$api.webMonitorCollect.fileImportUptimeCheck({task_list:t,bk_biz_id:this.business})},e.prototype.handleHidden=function(){this.file={},this.uploadProcess=0,this.status="import",this.parsingRes="parsing",this.taskList=[],this.$refs.uploadRef&&(this.$refs.uploadRef.value="")},e.prototype.deleteFile=function(){var t=this;this.$bkInfo({type:"warning",title:this.$t("确定删除文件？"),confirmFn:function(){return t.handleHidden()}})},e=or([Object(f.a)({name:"uptime-check-import",components:{WikiIframe:vt.a},filters:{fileSizeFormat:function(t){var e=Math.pow(1024,2),i=Math.pow(1024,3),n=Math.pow(1024,4),r=Math.pow(1024,5),o="";switch(!0){case!t||isNaN(t):o="-";break;case t>=0&&t<1024:o="".concat(t,"B");break;case t>=1024&&t<e:o="".concat(Math.round(t/1024),"KB");break;case t>=e&&t<i:o="".concat(Math.round(t/e),"MB");break;case t>=i&&t<n:o="".concat(Math.round(t/i),"GB");break;case t>=n&&t<r:o="".concat(Math.round(t/n),"TB");break;default:o="".concat(Math.round(t/r),"PB")}return o}}})],e)}(f.e),cr=lr,ur=Object(u.a)(cr,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uptime-check-import"},[i("bk-sideslider",{attrs:{title:t.$t("批量导入"),width:640,"is-show":t.options.isShow},on:{"update:isShow":function(e){return t.$set(t.options,"isShow",e)},"update:is-show":function(e){return t.$set(t.options,"isShow",e)},hidden:t.handleHidden}},[i("div",{staticClass:"import-content",attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"import-content-body"},[i("bk-select",{staticStyle:{width:"250px","margin-bottom":"15px"},attrs:{disabled:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:""},model:{value:t.business,callback:function(e){t.business=e},expression:"business"}},t._l(t.businessData,(function(t){return i("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1),t._v(" "),i("div",{staticClass:"file-container"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"import"===t.status,expression:"status === 'import'"}],class:["file-wrapper",{"is-drap":t.isDrap}]},[i("bk-icon",{staticClass:"icon-monitor icon-upload-cloud upload-icon",attrs:{type:"upload"}}),t._v(" "),i("div",{staticClass:"upload-text"},[i("span",{staticClass:"drop-upload"},[t._v(" "+t._s(t.$t("拖拽到此处上传或"))+" ")]),t._v(" "),i("span",{staticClass:"click-upload"},[t._v(" "+t._s(t.$t("点击上传"))+" ")])]),t._v(" "),i("input",{ref:"uploadRef",attrs:{type:"file",accept:t.accept,title:""},on:{dragenter:function(e){t.isDrap=!0},dragleave:function(e){t.isDrap=!1},drop:function(e){return t.handleDrop(e)},change:function(e){return t.handleFileChange(e)}}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"uploading"===t.status||"parsing"===t.status,expression:"status === 'uploading' || status === 'parsing'"}],staticClass:"file-result"},[i("bk-icon",{staticClass:"icon-monitor icon-xls xlsx-icon",attrs:{type:"clipboard"}}),t._v(" "),i("div",{staticClass:"file-name"},[t._v(t._s(t.file.name))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"uploading"===t.status,expression:"status === 'uploading'"}],staticClass:"upload-process"},[i("div",{staticClass:"process-done",style:{width:t.uploadProcess+"%"}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"parsing"===t.status,expression:"status === 'parsing'"}],staticClass:"file-size"},[t._v(t._s(t._f("fileSizeFormat")(t.file.size)))]),t._v(" "),i("i",{staticClass:"bk-icon icon-close",on:{click:t.deleteFile}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"import"===t.status||"uploading"===t.status,expression:"status === 'import' || status === 'uploading'"}],staticClass:"file-desc"},[i("div",{staticClass:"file-text"},[t._v(" "+t._s(t.$t("只支持“xlsx”格式的文件"))+" ")]),t._v(" "),i("div",{staticClass:"file-download"},[i("div",{staticClass:"download-text"},[t._v(t._s(t.$t("模板下载")))]),t._v(" "),i("bk-select",{staticStyle:{width:"150px"},attrs:{value:"模板下载",clearable:!1},on:{change:t.handleDownload}},t._l(t.downloadList,(function(t){return i("bk-option",{key:t.url,attrs:{id:t.url,name:t.name}})})),1)],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"parsing"===t.status,expression:"status === 'parsing'"}],staticClass:"file-parsing"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"parsing"===t.parsingRes,expression:"parsingRes === 'parsing'"}],staticClass:"parsing-loading"},[i("svg",{staticClass:"loading-svg",attrs:{viewBox:"0 0 64 64"}},[i("g",[i("path",{attrs:{d:"M20.7,15c1.6,1.6,1.6,4.1,0,5.7s-4.1,1.6-5.7,0l-2.8-2.8c-1.6-1.6-1.6-4.1,0-5.7s4.1-1.6,5.7,0L20.7,15z"}}),t._v(" "),i("path",{attrs:{d:"M12,28c2.2,0,4,1.8,4,4s-1.8,4-4,4H8c-2.2,0-4-1.8-4-4s1.8-4,4-4H12z"}}),t._v(" "),i("path",{attrs:{d:"M15,43.3c1.6-1.6,4.1-1.6,5.7,0c1.6,1.6,1.6,4.1,0,5.7l-2.8,2.8c-1.6,1.6-4.1,1.6-5.7,0s-1.6-4.1,0-5.7L15,43.3z"}}),t._v(" "),i("path",{attrs:{d:"M28,52c0-2.2,1.8-4,4-4s4,1.8,4,4v4c0,2.2-1.8,4-4,4s-4-1.8-4-4V52z"}}),t._v(" "),i("path",{attrs:{d:"M51.8,46.1c1.6,1.6,1.6,4.1,0,5.7s-4.1,1.6-5.7,0L43.3,49c-1.6-1.6-1.6-4.1,0-5.7s4.1-1.6,5.7,0L51.8,46.1z"}}),t._v(" "),i("path",{attrs:{d:"M56,28c2.2,0,4,1.8,4,4s-1.8,4-4,4h-4c-2.2,0-4-1.8-4-4s1.8-4,4-4H56z"}}),t._v(" "),i("path",{attrs:{d:"M46.1,12.2c1.6-1.6,4.1-1.6,5.7,0s1.6,4.1,0,5.7l0,0L49,20.7c-1.6,1.6-4.1,1.6-5.7,0c-1.6-1.6-1.6-4.1,0-5.7L46.1,12.2z"}}),t._v(" "),i("path",{attrs:{d:"M28,8c0-2.2,1.8-4,4-4s4,1.8,4,4v4c0,2.2-1.8,4-4,4s-4-1.8-4-4V8z"}})])]),t._v(" "),i("span",{staticClass:"parsing-text"},[t._v(t._s(t.$t("正在解析文件"))+"...")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"error"===t.parsingRes,expression:"parsingRes === 'error'"}],staticClass:"parsing-result"},[i("i",{staticClass:"bk-icon icon-exclamation-circle-shape icon-error"}),t._v(" "),i("span",{staticClass:"error-text"},[t._v(" "+t._s(t.$t("文件已损坏"))+" ")])])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.taskList.length>0,expression:"taskList.length > 0"}],staticClass:"data-preview"},[i("div",{staticClass:"preview-title"},[t._v(" "+t._s(t.$t("数据预览"))+" ")]),t._v(" "),i("div",{staticClass:"preview-content"},[i("bk-table",{staticClass:"task-table",attrs:{data:t.taskList}},[i("bk-table-column",{attrs:{label:t.$t("任务名"),prop:"name","show-overflow-tooltip":""}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("类型"),prop:"protocol"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("创建状态")},scopedSlots:t._u([{key:"default",fn:function(e){return["fail"===e.row.status?i("bk-popover",[i("span",{class:e.row.status},[t._v("\n                                            "+t._s(t.importStatus[e.row.status])+"\n                                        ")]),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("pre",{staticClass:"hint-content"},[t._v(t._s(e.row.errMsg))])])]):i("span",{class:e.row.status},[t._v("\n                                        "+t._s(t.importStatus[e.row.status])+"\n                                    ")])]}}])})],1)],1)])],1),t._v(" "),i("div",{staticClass:"import-content-footer"},[i("bk-button",{staticClass:"button-complete",attrs:{theme:"primary",disabled:!t.canComplete},on:{click:t.complete}},[t._v(" "+t._s(t.$t("完成"))+" ")]),t._v(" "),i("bk-button",{on:{click:t.cancel}},[t._v(" "+t._s(t.$t("取消"))+" ")])],1),t._v(" "),i("wiki-iframe",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{url:t.iframeUrl,name:"monitorImport"}})],1)])],1)}),[],!1,null,"e08f71c4",null).exports,pr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),dr=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},fr=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},mr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},hr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentType="list",e.search="",e.tableLoading=!1,e.dataList=[],e.columns=[{label:"任务名称",key:"name",align:"left",minWidth:"180px"},{label:"目标地址",key:"url",align:"left",minWidth:"130px"},{label:"运行状态",key:"status",align:"left",minWidth:"100px",scopedSlots:"status"},{label:"创建者",key:"created_by",align:"left",minWidth:"150px"},{label:"操作",key:"operation",fixed:"right",align:"left",width:"140px",scopedSlots:"operation"}],e.pagination={current:1,count:1,limit:20},e.statusMap={new_draft:"未保存",running:"运行中",stoped:"未启用",starting:"启动中",stoping:"停止中",start_failed:"启动失败",stop_failed:"停止失败"},e.maxHeight="",e.operateType="add",e.currentData={},e}return pr(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-220,window.onresize=function(){t.maxHeight=window.innerHeight-220},this.getUpTimeCheckList()},e.prototype.handleDelete=function(t){return fr(this,void 0,void 0,(function(){var e=this;return mr(this,(function(i){return this.$BtnPermission(this.permissionObj)?(this.$bkInfo({title:"确认要删除该任务？",confirmLoading:!0,confirmFn:function(){return fr(e,void 0,void 0,(function(){return mr(this,(function(e){switch(e.label){case 0:return[4,this.confirmDelete(t)];case 1:return e.sent(),[2]}}))}))}}),[2]):[2]}))}))},e.prototype.confirmDelete=function(t){var e=t.id;return fr(this,void 0,void 0,(function(){var t;return mr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$api.webMonitorCollect.delTask({id:e})];case 1:return(t=i.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getUpTimeCheckList()):this.$error(t.message),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.refreshList=function(){this.currentType="list",this.getUpTimeCheckList()},e.prototype.getUpTimeCheckList=function(){var t=this;this.tableLoading=!0;var e={name:this.search,page:this.pagination.current,page_size:this.pagination.limit};this.$api.webMonitorCollect.getUpTimeCheckList(e).then((function(e){var i=e.result,n=e.data;if(!i)return!1;t.dataList=n.results,t.pagination.count=n.count})).finally((function(){t.tableLoading=!1}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getUpTimeCheckList()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getUpTimeCheckList()},e.prototype.handlerIconClick=function(){this.pagination.current=1,this.getUpTimeCheckList()},e.prototype.operateTask=function(t,e,i){this.$BtnPermission(this.permissionObj)&&(this.currentType=t,this.operateType=e,this.currentData=i)},e.prototype.importTask=function(){if(!this.$BtnPermission(this.permissionObj))return!1;console.log(111),this.$refs.importTask.show()},e=dr([Object(f.a)({components:{comTable:st.a,OperateTask:er,ImportTask:ur}})],e)}(f.e),br=hr,gr=Object(u.a)(br,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"web-site-measurement"},["list"===t.currentType?i("div",{staticClass:"show-box"},[i("div",{staticClass:"action-bar"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr20",attrs:{theme:"primary"},on:{click:function(e){return t.operateTask("operate","add")}}},[t._v("\n                新增\n            ")]),t._v(" "),i("bk-input",{staticStyle:{flex:"1"},attrs:{clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":t.handlerIconClick,enter:t.handlerIconClick,clear:t.handlerIconClick},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-box"},[i("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"comTable",attrs:{data:t.dataList,columns:t.columns,"max-height":t.maxHeight,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("span",[t._v(t._s(t.statusMap[n.status]))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.operateTask("operate","edit",n)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDelete(n)}}},[t._v("\n                        删除\n                    ")])]}}],null,!1,2872021809)})],1)]):i("operate-task",{ref:"operateTask",attrs:{"operate-type":t.operateType,"current-data":t.currentData},on:{"refresh-list":t.refreshList}}),t._v(" "),i("import-task",{ref:"importTask",on:{complete:t.refreshList}})],1)}),[],!1,null,"47d5a8d7",null).exports,yr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),vr=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},_r=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},kr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},wr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="",e.batchVaule="",e.batchList=[],e.visible=!1,e}return yr(e,t),e.prototype.showDialog=function(t,e){this.type=t,this.batchList=e,this.batchVaule="",this.visible=!0},e.prototype.handleConfirm=function(){this.$emit("confirmBtachEdit",this.type,this.batchVaule)},e.prototype.updateCredential=function(t){this.batchVaule=t.id,this.$emit("updateCredential"),this.getCredential()},e.prototype.getCredential=function(){var t;return _r(this,void 0,void 0,(function(){var e,i;return kr(this,(function(n){switch(n.label){case 0:return e={page_size:99999,page:1,name:"",module_cred_design:this.moduleCredDesign,search_type:"all"},[4,this.$api.remoteConnect.getVaultCredential(e)];case 1:return(i=n.sent()).result?(this.batchList=null===(t=i.data)||void 0===t?void 0:t.items,[2]):(this.$error(i.message),[2])}}))}))},e.prototype.handleCreate=function(){this.$refs.voucherDialog.show("add",{})},vr([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"evidenceFormParams",void 0),vr([Object(f.d)({type:Number,default:function(){return-1}})],e.prototype,"moduleCredDesign",void 0),e=vr([Object(f.a)({components:{VoucherDialog:on.a}})],e)}(f.e),xr=wr,Cr=Object(u.a)(xr,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"batch-modal"},[i("bk-dialog",{attrs:{"render-directive":"if","mask-close":!1,"header-position":"left",title:"批量修改"},on:{confirm:t.handleConfirm},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{staticClass:"operation"},[i("bk-select",{attrs:{searchable:""},model:{value:t.batchVaule,callback:function(e){t.batchVaule=e},expression:"batchVaule"}},[t._l(t.batchList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),t._v(" "),"credential"===t.type?i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(e){return t.handleCreate()}},slot:"extension"},[i("i",{staticClass:"bk-icon icon-plus-circle mr5"}),t._v("新建凭据\n                ")]):t._e()],2)],1)]),t._v(" "),i("VoucherDialog",{ref:"voucherDialog",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.updateCredential}})],1)}),[],!1,null,null,null).exports,Dr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),jr=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Or=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Lr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Tr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPageLoading=!1,e.form={task_name:"",period:1,access_point:"",instances:[]},e.initForm={},e.credentialValidate={credential:[{required:!0,message:"必填项",trigger:"blur,change"}]},e.modelValidate={model:[{required:!0,message:"必填项",trigger:"blur, change"}]},e.brandValidate={brand:[{required:!0,message:"必填项",trigger:"blur, change"}]},e.ruleValidate={task_name:[{required:!0,message:"请输入任务名称",trigger:"blur, change"}],period:[{required:!0,message:"请输入采集频率",trigger:"blur"},{required:!0,message:"请输入整数",trigger:"blur, change",validator:function(t){return parseInt(t,10)===+t}}],access_point:[{required:!0,message:"请选择接入点",trigger:"blur"}],instances:[{message:"请选择监控目标",trigger:"blur",required:!0,validator:function(t){return t.length>0}}]},e.monitorObjList=[],e.targetModal={name:"",status:!1,target:[],monitorObjId:1,monitorObjName:"",isDetail:!0,osType:0,title:"选择监控目标",objectSelectType:"list"},e.instanceFields=[],e.typeItem={},e.targetList=[],e.targetColumns=[{label:"实例名称",key:"bk_inst_name",minWidth:"100px"},{label:"管理IP",key:"ip_addr",minWidth:"100px"},{label:"品牌",key:"brand",minWidth:"140px",scopedSlots:"brand",renderHeader:function(t,i){var n=t("span",{style:{marginRight:"10px"}},"品牌"),r=t("bk-button",{props:{text:!0,icon:"edit",disabled:!e.$BtnPermission(e.permissionObj)},style:{position:"absolute",top:"-2px"},on:{click:function(){return e.showBatchModal(i)}}},"");return t("div",[n,r])}},{label:"模板",key:"model",minWidth:"140px",scopedSlots:"model",renderHeader:function(t,i){var n=t("span",{style:{marginRight:"10px"}},"模板"),r=t("bk-button",{props:{text:!0,icon:"edit",disabled:e.checkModal()},style:{position:"absolute",top:"-2px"},on:{click:function(){return e.showBatchModal(i)}}},"");return t("div",[n,r])}},{label:"凭据",key:"credential",minWidth:"140px",scopedSlots:"credential",renderHeader:function(t,i){var n=t("span",{style:{marginRight:"10px"}},"凭据"),r=t("bk-button",{props:{text:!0,icon:"edit",disabled:!e.$BtnPermission(e.permissionObj)},style:{position:"absolute",top:"-2px"},on:{click:function(){return e.showBatchModal(i)}}},"");return t("div",[n,r])}},{label:"操作",key:"operation",width:"100px",prop:"operation",scopedSlots:"operation"}],e.columns=[],e.submitLoading=!1,e.confirmLeave=!1,e.isLoading=!1,e.voucherList=[],e.brandList=[],e.moduleCredDesign=-1,e.evidenceFormParams=[],e.currentRow={},e.type="",e}return Dr(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listDisabled",{get:function(){return"group"===this.targetModal.objectSelectType&&!!this.targetList.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupDisabled",{get:function(){return"list"===this.targetModal.objectSelectType&&!!this.targetList.length},enumerable:!1,configurable:!0}),e.prototype.created=function(){return Or(this,void 0,void 0,(function(){var t,e,i,n,r=this;return Lr(this,(function(o){switch(o.label){case 0:return this.isPageLoading=!0,this.columns=[],t=this.taskInfo,e=t.bkObjId,i=t.name,n=t.monitorName,this.typeItem={name:e,nameCn:i,label:i,listUrl:"getOtherResourceList",filedUrl:"getOtherResourceFields",updateFieldUrl:"updateOtherResourceFields",batchEditUrl:"modifyOtherResourceBulk",changeRecordUrl:"getOtherSrcChange"},"add"===this.taskInfo.mode&&(this.form.task_name=n),[4,this.getCredParams()];case 1:return o.sent(),Promise.all([this.getCredential(),this.getMonitorObjList(),this.getAppCustomFields(),this.getNetworkBrand(),"modify"===this.taskInfo.mode&&this.getInitData()]).finally((function(){r.isPageLoading=!1,r.initForm=r.$copy(r.form)})),[2]}}))}))},e.prototype.checkModal=function(){var t,e=!1;if(this.$BtnPermission(this.permissionObj))if(this.targetList.some((function(t){return!t.brand})))e=!0;else{var i={};i.brand=null===(t=this.targetList.at())||void 0===t?void 0:t.brand,this.targetList.forEach((function(t){i.brand!==t.brand&&(e=!0)}))}else e=!0;return e},e.prototype.getModelList=function(t){var e;return(null===(e=this.brandList.find((function(e){return e.brand_name===t.brand})))||void 0===e?void 0:e.value)||[]},e.prototype.showBatchModal=function(t){var e=this,i=[],n=t.column.property;switch(n){case"credential":i=this.$copy(this.voucherList);break;case"brand":i=this.brandList.map((function(t){return{id:t.brand_name,name:t.brand_name}}));break;case"model":i=this.brandList.find((function(t){var i;return t.brand_name===(null===(i=e.targetList.at())||void 0===i?void 0:i.brand)})).value.map((function(t){return{id:t.id,name:t.device_model}}))}this.$refs.batchModal.showDialog(n,i)},e.prototype.confirmBtachEdit=function(t,e){var i=this;this.targetList.forEach((function(n){i.$set(n,t,e)}))},e.prototype.selectCredential=function(t){var e=this.form.instances.find((function(e){return e.bk_inst_id===t.bk_inst_id}));e&&(e.credential=t.credential)},e.prototype.getMonitorObjList=function(){var t;return Or(this,void 0,void 0,(function(){var e,i,n;return Lr(this,(function(r){switch(r.label){case 0:return[4,this.$api.monitorCollect.getAccessPoint()];case 1:return e=r.sent(),i=e.data,n=e.message,e.result?(this.monitorObjList=i.result,"add"===this.taskInfo.mode&&(this.form.access_point=(null===(t=this.monitorObjList.at())||void 0===t?void 0:t.name)||""),[2]):(this.$error(n),[2])}}))}))},e.prototype.handleCreate=function(t){this.currentRow=t,this.$refs.voucherDialog.show("add",{})},e.prototype.getCredParams=function(){return Or(this,void 0,void 0,(function(){var t,e,i;return Lr(this,(function(n){switch(n.label){case 0:return[4,this.$api.remoteConnect.getCredParams({bk_obj_id:"network"})];case 1:return t=n.sent(),e=t.data,i=t.message,t.result?(this.moduleCredDesign=e.module_cred_design,this.evidenceFormParams=e.params,[2]):(this.$error(i),[2])}}))}))},e.prototype.updateCredential=function(t){return Or(this,void 0,void 0,(function(){var e=this;return Lr(this,(function(i){switch(i.label){case 0:return[4,this.getCredential()];case 1:return i.sent(),this.targetList.forEach((function(i){i.bk_inst_id===e.currentRow.bk_inst_id&&(i.credential=t.id)})),[2]}}))}))},e.prototype.getCredential=function(){var t;return Or(this,void 0,void 0,(function(){var e,i;return Lr(this,(function(n){switch(n.label){case 0:return e={page_size:99999,page:1,name:"",module_cred_design:this.moduleCredDesign,search_type:"all"},[4,this.$api.remoteConnect.getVaultCredential(e)];case 1:return(i=n.sent()).result?(this.voucherList=null===(t=i.data)||void 0===t?void 0:t.items,[2]):(this.$error(i.message),[2])}}))}))},e.prototype.getNetworkBrand=function(){return Or(this,void 0,void 0,(function(){var t,e;return Lr(this,(function(i){switch(i.label){case 0:return t={bk_obj_id:this.typeItem.name},[4,this.$api.monitorCollect.getNetworkBrand(t)];case 1:return(e=i.sent()).result?(this.brandList=e.data,[2]):(this.$error(e.message),[2])}}))}))},e.prototype.getAppCustomFields=function(){return Or(this,void 0,void 0,(function(){var t,e;return Lr(this,(function(i){switch(i.label){case 0:return(t={}).bk_obj_id=this.typeItem.name,[4,this.$api.Resource[this.typeItem.filedUrl](t)];case 1:return(e=i.sent()).result?(this.handleAllFields(e.data.all_field),[2]):(this.$error(e.message),[2])}}))}))},e.prototype.handleAllFields=function(t){var e=this;t.forEach((function(t,i){"list"!==t.bk_property_type&&"bool"!==t.bk_property_type||("list"===t.bk_property_type&&(t.option=t.option.map((function(t){return{id:t,name:t}}))),"bool"===t.bk_property_type&&(t.option=[{id:!0,name:"是"},{id:!1,name:"否"}])),t.checked=!1,t.batchValue="",t.editStatus=!1,t.editValue="",t.editLoading=!1,t.editIconShow=!1,e.buildFieldData(t,e.instanceFields)}))},e.prototype.buildFieldData=function(t,e){var i=e.findIndex((function(e){return e.key===t.bk_property_group}));-1===i?e.push({title:t.bk_property_group_name,children:[t],key:t.bk_property_group,collapseStatus:!0,id:this.$random(3)}):e[i].children.push(t)},e.prototype.createTarget=function(){var t=this.$deepClone(this.instanceFields);t.forEach((function(t){t.children=t.children.filter((function(t){return!["录入方式","录入时间"].includes(t.bk_property_name)}))})),this.$refs.addResource.showDialog(this.typeItem,t)},e.prototype.createTargetSuccess=function(t){var e=this.$copy(t);console.log(e)},e.prototype.getInitData=function(){return Or(this,void 0,void 0,(function(){var t=this;return Lr(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getNetworkDetail({id:this.taskInfo.rowId}).then((function(e){var i,n=e.data;if(e.result){for(var r in n)t.form.hasOwnProperty(r)&&(t.form[r]=n[r],"access_point"===r&&(t.form[r]=null===(i=n[r])||void 0===i?void 0:i.name));t.targetList=t.$copy(t.form.instances);var o=t.targetList.some((function(t){return"group"===(null==t?void 0:t.object_select_type)}));t.targetModal.objectSelectType=o?"group":"list",t.columns=t.getNewColumns(t.targetModal.objectSelectType)}}))];case 1:return e.sent(),[2]}}))}))},e.prototype.selectTarget=function(){var t={objId:this.taskInfo.objId,entry:"collect-cisco"};t.panels=[{name:"list",disabled:this.listDisabled},{name:"topo",hide:!0},{name:"group",disabled:this.groupDisabled}],this.$refs.selectTargets.show(this.targetList,[],t)},e.prototype.removeTarget=function(t,e){this.targetList.splice(e,1),this.form.instances=this.targetList},e.prototype.getNewColumns=function(t){var e=this.$copy(this.targetColumns),i=[{label:"分组名称",key:"name"},{label:"Agent状态",key:"status",scopedSlots:"status"}];return"group"===t?(e.splice(0,2,i.at(),i.at(-1)),e):this.targetColumns},e.prototype.submitTarget=function(t){var e=this,i=this.$copy(t),n=i.data,r=i.type;this.targetModal.objectSelectType=r,this.columns=this.getNewColumns(r),n.forEach((function(t){t.model="",t.brand="",t.credential=""})),this.targetList.forEach((function(t){var e=n.find((function(e){return e.bk_inst_id===t.bk_inst_id}));if(e){var i=t.pk,r=t.model,o=t.brand,a=t.credential;e.pk=i,e.model=r,e.brand=o,e.credential=a}})),"group"===r&&n.forEach((function(t){t.object_select_type="group"})),this.targetList=n,this.form.instances=this.targetList,this.$nextTick((function(){e.$refs.processTable.updateColumns(e.columns)}))},e.prototype.submit=function(){var t=this,e={task_name:this.form.task_name,bk_obj_id:this.taskInfo.bkObjId,period:this.form.period,instances:this.targetList};e.access_point=this.monitorObjList.find((function(e){return e.name===t.form.access_point}))||{},this.submitLoading=!0,this.$refs.validateForm.validate().then((function(i){var n=!0;t.targetList.forEach((function(e,i){return Or(t,void 0,void 0,(function(){return Lr(this,(function(t){return this.$refs["brand".concat(i)].validate(),this.$refs["model".concat(i)].validate(),this.$refs["credential".concat(i)].validate(),e.brand&&e.model&&e.credential||(n=!1),[2]}))}))})),n?t.createProcessCollect(e):t.submitLoading=!1}),(function(e){t.submitLoading=!1}))},e.prototype.createProcessCollect=function(t){var e=this,i="add"===this.taskInfo.mode?"createNetworkCollect":"modifyNetworkCollect",n="add"===this.taskInfo.mode?"创建成功":"修改成功";"modify"===this.taskInfo.mode&&(t.id=this.taskInfo.rowId),this.$api.monitorCollect[i](t).then((function(t){if(e.submitLoading=!1,t.result)return e.confirmLeave=!0,e.$success(n),e.taskInfo.showModal=!1,void e.$emit("refreshTable");e.$error(t.message)}))},e.prototype.cancel=function(){this.taskInfo.showModal=!1},jr([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"taskInfo",void 0),e=jr([Object(f.a)({components:{TargetSelect:lt.a,AddResource:ri.a,ComTable:st.a,VoucherDialog:on.a,BatchModal:Cr,IntroduceInfo:Vt}})],e)}(f.e),Sr=Tr,Ir=Object(u.a)(Sr,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isPageLoading,zIndex:10},expression:"{ isLoading: isPageLoading, zIndex: 10 }"}],ref:"addProcess",attrs:{id:"addProcess"}},[i("div",{staticClass:"process-title"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.cancel}}),t._v("\n        "+t._s("add"===t.taskInfo.mode?"新建采集":"修改采集")+"\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskInfo.mode,expression:"taskInfo.mode === 'modify'"}],staticClass:"sub-title line"},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskInfo.mode,expression:"taskInfo.mode === 'modify'"}],staticClass:"sub-title"},[t._v(t._s(t.taskInfo.subTitle))])],1),t._v(" "),i("div",{staticClass:"content-wrap",staticStyle:{position:"relative"}},[i("bk-form",{ref:"validateForm",staticClass:"plugin-form",attrs:{id:"form",model:t.form,"label-width":110,rules:t.ruleValidate}},[i("bk-form-item",{attrs:{label:"任务名称",property:"task_name",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入任务名称"},model:{value:t.form.task_name,callback:function(e){t.$set(t.form,"task_name",e)},expression:"form.task_name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"采集频率",property:"period",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{min:1,precision:0,type:"number",disabled:""},model:{value:t.form.period,callback:function(e){t.$set(t.form,"period",e)},expression:"form.period"}}),t._v("\n                分钟\n            ")],1),t._v(" "),i("bk-form-item",{attrs:{label:"接入点",required:!0,property:"access_point","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{"ext-cls":"select-custom",placeholder:"选择采集主机",searchable:""},model:{value:t.form.access_point,callback:function(e){t.$set(t.form,"access_point",e)},expression:"form.access_point"}},t._l(t.monitorObjList,(function(t){return i("bk-option",{key:t.name,attrs:{id:t.name,name:t.ip+"（"+t.name+"）"}})})),1)],1),t._v(" "),i("bk-form-item",{staticStyle:{width:"960px"},attrs:{label:"监控目标",property:"instances","error-display-type":"normal",required:""}},[i("div",{staticClass:"target-list"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"default"},on:{click:t.selectTarget}},[t._v("\n                        选择目标\n                    ")]),t._v(" "),i("span",{staticClass:"description"},[t._v("若无监控采集目标，请先")]),t._v(" "),i("bk-button",{staticClass:"add-target",attrs:{theme:"primary",text:"",size:"small"},on:{click:t.createTarget}},[t._v("\n                        添加资产\n                    ")])],1),t._v(" "),t.targetList.length&&t.columns.length?i("div",{staticClass:"instance-table"},[i("ComTable",{ref:"processTable",attrs:{data:t.targetList,columns:t.columns},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("span",{staticStyle:{color:"#ff0000"}},[t._v(t._s(n.error_count))]),t._v(" / "),i("span",[t._v(t._s(n.all_count))])]}},{key:"credential",fn:function(e){var n=e.row,r=e.index;return[i("bk-form",{ref:"credential"+r,attrs:{model:n,"label-width":0,rules:t.credentialValidate}},[i("bk-form-item",{attrs:{label:"",property:"credential",required:""}},[i("bk-select",{attrs:{searchable:""},on:{change:function(e){return t.selectCredential(n)}},model:{value:n.credential,callback:function(e){t.$set(n,"credential",e)},expression:"row.credential"}},[t._l(t.voucherList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),t._v(" "),i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(e){return t.handleCreate(n)}},slot:"extension"},[i("i",{staticClass:"bk-icon icon-plus-circle mr5"}),t._v("新建凭据\n                                        ")])],2)],1)],1)]}},{key:"brand",fn:function(e){var n=e.row,r=e.index;return[i("bk-form",{ref:"brand"+r,attrs:{model:n,"label-width":0,rules:t.brandValidate}},[i("bk-form-item",{attrs:{label:"",property:"brand",required:""}},[i("bk-select",{attrs:{searchable:""},model:{value:n.brand,callback:function(e){t.$set(n,"brand",e)},expression:"row.brand"}},t._l(t.brandList,(function(t){return i("bk-option",{key:t.brand_name,attrs:{id:t.brand_name,name:t.brand_name}})})),1)],1)],1)]}},{key:"model",fn:function(e){var n=e.row,r=e.index;return[i("bk-form",{ref:"model"+r,attrs:{model:n,"label-width":0,rules:t.modelValidate}},[i("bk-form-item",{attrs:{label:"",property:"model",required:""}},[i("bk-select",{attrs:{searchable:""},model:{value:n.model,callback:function(e){t.$set(n,"model",e)},expression:"row.model"}},t._l(t.getModelList(n),(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.device_model}})})),1)],1)],1)]}},{key:"operation",fn:function(e){var n=e.row,r=e.index;return[i("div",[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.removeTarget(n,r)}}},[t._v("删除")])],1)]}}],null,!1,3483499271)})],1):t._e()])],1),t._v(" "),i("introduce-info",{attrs:{type:t.taskInfo.bkObjId,"need-move":!1}})],1),t._v(" "),i("div",{staticClass:"operation"},[i("bk-button",{attrs:{theme:"primary",loading:t.submitLoading},on:{click:t.submit}},[t._v("确认")]),t._v(" "),i("bk-button",{staticClass:"ml10",attrs:{theme:"default"},on:{click:t.cancel}},[t._v("取消")])],1),t._v(" "),i("target-select",{ref:"selectTargets",attrs:{"target-modal":t.targetModal,"current-node":t.taskInfo},on:{getSelectedTargets:t.submitTarget}}),t._v(" "),i("AddResource",{ref:"addResource",on:{"on-success":t.createTargetSuccess}}),t._v(" "),i("VoucherDialog",{ref:"voucherDialog",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.updateCredential}}),t._v(" "),i("BatchModal",{ref:"batchModal",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.getCredential,confirmBtachEdit:t.confirmBtachEdit}})],1)}),[],!1,null,"44c1a16e",null).exports,Pr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$r=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Mr=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Nr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Ar=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.statusData=[],e.initStatusData=[],e.columns=[{label:"实例名称",key:"bk_inst_name",minWidth:"200px"},{label:"采集主机",key:"ip_addr",minWidth:"200px"},{label:"品牌",key:"brand",minWidth:"200px"},{label:"状态",key:"status",minWidth:"200px",scopedSlots:"status"}],e}return Pr(e,t),e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-240,window.onresize=function(){t.maxHeight=window.innerHeight-240}},e.prototype.mounted=function(){return Mr(this,void 0,void 0,(function(){return Nr(this,(function(t){return this.getCollecTaskStatus(),[2]}))}))},e.prototype.handleEnter=function(){var t=this;this.statusData=this.initStatusData.filter((function(e){return e.bk_inst_name.includes(t.search)}))},e.prototype.getCollecTaskStatus=function(){return Mr(this,void 0,void 0,(function(){var t,e,i,n,r;return Nr(this,(function(o){switch(o.label){case 0:this.tableLoading=!0,t=this.getParams(),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getNetworkInstanceStatus(t)];case 2:return e=o.sent(),i=e.result,n=e.data,r=e.message,i?(this.statusData=n,this.initStatusData=n,[3,4]):(this.$error(r),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){return{instance_id:this.statusInfo.id}},e.prototype.goBack=function(){this.statusInfo.status=!1},$r([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"statusInfo",void 0),e=$r([Object(f.a)({components:{ComTable:st.a}})],e)}(f.e),Er=Ar,Rr=Object(u.a)(Er,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"status-manage"},[i("div",{staticClass:"title-box"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}}),t._v(" "),i("span",[t._v("状态")]),t._v(" "),i("span",{staticClass:"sub-title line"},[t._v(" - ")]),t._v(" "),i("span",{staticClass:"sub-title"},[t._v(t._s(t.statusInfo.taskName))])],1),t._v(" "),i("div",{staticClass:"nav-area"},[i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入实例名称",clearable:""},on:{enter:t.handleEnter,clear:t.handleEnter},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.statusData,columns:t.columns,"max-height":t.maxHeight},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("div",{class:["status-mark",n.status?"status-normal":"status-unnormal"]}),t._v(" "),i("span",[t._v(t._s(n.status?"正常":"失败"))])]}}])})],1)])}),[],!1,null,"3c9dde1e",null).exports,qr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zr=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Fr=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Hr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Br=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterCondition="",e.tableLoading=!1,e.maxHeight=0,e.tableData=[],e.columns=[{label:"任务名称",key:"task_name",minWidth:"100px"},{label:"运行状态",key:"status",minWidth:"100px",scopedSlots:"status"},{label:"目标",key:"count",minWidth:"100px"},{label:"创建者",key:"created_by",minWidth:"100px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:10},e.row={},e.taskInfo={mode:"add",showModal:!1,rowId:null,subTitle:"",bkObjId:"",name:"",objId:"",monitorName:""},e.statusInfo={},e}return qr(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&(this.taskInfo.showModal=!1,this.statusInfo.status=!1,this.searchData())},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.mounted=function(){},e.prototype.linkTostatusManage=function(t){var e=t.id,i=t.task_name;this.$BtnPermission(this.permissionObj)&&(this.statusInfo={status:!0,id:e,taskName:i})},e.prototype.changeStatus=function(){this.taskInfo.showModal=!1},e.prototype.searchData=function(){this.pagination.current=1,this.search()},e.prototype.search=function(){var t=this,e={task_name:this.filterCondition,page_size:this.pagination.limit,page:this.pagination.current,bk_obj_id:this.currentNode.bk_obj_id};this.tableLoading=!0,this.$api.monitorCollect.getNetworkCollect(e).then((function(e){if(t.tableLoading=!1,e.result)return t.tableData=e.data.items,void(t.pagination.count=e.data.count);t.$error(e.message)}))},e.prototype.addTask=function(t,e){this.$BtnPermission(this.permissionObj)&&(this.taskInfo={mode:t,showModal:!0,rowId:e.id,subTitle:e.task_name,bkObjId:this.currentNode.bk_obj_id,name:this.currentNode.bk_obj_name,objId:this.currentNode.id,monitorName:this.currentNode.bk_obj_name+"监控"+Y()().format("YYYYMMDDHHmmss")})},e.prototype.deleteTask=function(t){var e=this;this.$BtnPermission(this.permissionObj)&&this.$bkInfo({title:"删除采集任务",subTitle:"是否删除采集任务【"+t.task_name+"】?",confirmLoading:!0,confirmFn:function(){return Fr(e,void 0,void 0,(function(){var e=this;return Hr(this,(function(i){switch(i.label){case 0:return[4,this.$api.monitorCollect.deleteNetworkTask({id:t.id}).then((function(t){if(t.result)return e.$success("删除成功"),1===e.tableData.length&&(e.pagination.current-=1,0===e.pagination.current&&(e.pagination.current=1)),void e.search();e.$error(t.message)}))];case 1:return i.sent(),[2]}}))}))}})},e.prototype.handlePageLimitChange=function(t){this.pagination.limit=t,this.searchData()},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.search()},zr([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),zr([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),e=zr([Object(f.a)({components:{ComTable:st.a,AddCisco:Ir,StatusManage:Rr}})],e)}(f.e),Vr=Br,Wr=Object(u.a)(Vr,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"cisco-manage"}},[t.taskInfo.showModal||t.statusInfo.status?i("div",{staticClass:"cisco-manage-addCisco"},[t.taskInfo.showModal?i("AddCisco",{attrs:{"task-info":t.taskInfo},on:{refreshTable:t.searchData}}):t._e(),t._v(" "),t.statusInfo.status?i("StatusManage",{attrs:{"status-info":t.statusInfo}}):t._e()],1):i("div",{staticClass:"cisco-manage-list"},[i("div",{staticClass:"nav-bar"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{"ext-cls":"mr5",theme:"primary"},on:{click:function(e){return t.addTask("add",{})}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-input",{staticStyle:{width:"360px",float:"right"},attrs:{placeholder:"请输入任务名称","right-icon":"bk-icon icon-search",clearable:""},on:{"right-icon-click":t.searchData,enter:t.searchData},model:{value:t.filterCondition,callback:function(e){t.filterCondition=e},expression:"filterCondition"}})],1),t._v(" "),i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",staticClass:"table-set",attrs:{data:t.tableData,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("div",{class:["status-mark",n.status?"status-unnormal":"status-normal"]}),t._v(" "),i("bk-button",{attrs:{text:""},on:{click:function(e){return t.linkTostatusManage(n)}}},[t._v(t._s(n.status?2===n.status?"失败":"部分失败":"正常"))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.addTask("modify",n)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.deleteTask(n)}}},[t._v("\n                        删除\n                    ")])],1)]}}],null,!1,1334617778)})],1)])}),[],!1,null,"b9d7be42",null).exports,Gr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ur=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Kr=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Yr=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Xr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="",e.batchVaule="",e.batchList=[],e.visible=!1,e}return Gr(e,t),e.prototype.showDialog=function(t,e){this.type=t,this.batchList=e,this.batchVaule="",this.visible=!0},e.prototype.handleConfirm=function(){this.$emit("confirmBtachEdit",this.type,this.batchVaule)},e.prototype.updateCredential=function(t){this.batchVaule=t.id,this.$emit("updateCredential"),this.getCredential()},e.prototype.getCredential=function(){var t;return Kr(this,void 0,void 0,(function(){var e,i;return Yr(this,(function(n){switch(n.label){case 0:return e={page_size:99999,page:1,name:"",module_cred_design:this.moduleCredDesign,search_type:"all"},[4,this.$api.remoteConnect.getVaultCredential(e)];case 1:return(i=n.sent()).result?(this.batchList=null===(t=i.data)||void 0===t?void 0:t.items,[2]):(this.$error(i.message),[2])}}))}))},e.prototype.handleCreate=function(){this.$refs.voucherDialog.show("add",{})},Ur([Object(f.d)({type:Array,default:function(){return[]}})],e.prototype,"evidenceFormParams",void 0),Ur([Object(f.d)({type:Number,default:function(){return-1}})],e.prototype,"moduleCredDesign",void 0),e=Ur([Object(f.a)({components:{VoucherDialog:on.a}})],e)}(f.e),Jr=Xr,Zr=Object(u.a)(Jr,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"batch-modal"},[i("bk-dialog",{attrs:{"render-directive":"if","mask-close":!1,"header-position":"left",title:"批量修改"},on:{confirm:t.handleConfirm},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{staticClass:"operation"},[i("bk-select",{attrs:{searchable:""},model:{value:t.batchVaule,callback:function(e){t.batchVaule=e},expression:"batchVaule"}},[t._l(t.batchList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),t._v(" "),"credential"===t.type?i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(e){return t.handleCreate()}},slot:"extension"},[i("i",{staticClass:"bk-icon icon-plus-circle mr5"}),t._v("新建凭据\n                ")]):t._e()],2)],1)]),t._v(" "),i("VoucherDialog",{ref:"voucherDialog",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.updateCredential}})],1)}),[],!1,null,null,null).exports,Qr=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),to=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},eo=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},io=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},no=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPageLoading=!1,e.form={name:"",period:1,access_point:"",inst_list:[]},e.initForm={},e.credentialValidate={credential:[{required:!0,message:"必填项",trigger:"blur,change"}]},e.ruleValidate={name:[{required:!0,message:"请输入任务名称",trigger:"blur, change"}],period:[{required:!0,message:"请输入采集频率",trigger:"blur"},{required:!0,message:"请输入整数",trigger:"blur, change",validator:function(t){return parseInt(t,10)===+t}}],access_point:[{required:!0,message:"请选择接入点",trigger:"blur"}],inst_list:[{message:"请选择监控目标",trigger:"blur",required:!0,validator:function(t){return t.length>0}}]},e.monitorObjList=[],e.targetModal={name:"",status:!1,target:[],monitorObjId:1,monitorObjName:"",isDetail:!0,osType:0,title:"选择监控目标",objectSelectType:"list"},e.instanceFields=[],e.typeItem={},e.targetList=[],e.targetColumns=[{label:"实例名称",key:"bk_inst_name",minWidth:"100px"},{label:"管理IP",key:"ip_addr",minWidth:"100px"},{label:"凭据",key:"credential",minWidth:"140px",scopedSlots:"credential",renderHeader:function(t,i){var n=t("span",{style:{marginRight:"10px"}},"凭据"),r=t("bk-button",{props:{text:!0,icon:"edit",disabled:!e.$BtnPermission(e.permissionObj)},style:{position:"absolute",top:"-2px"},on:{click:function(){return e.showBatchModal(i)}}},"");return t("div",[n,r])}},{label:"操作",key:"operation",width:"100px",prop:"operation",scopedSlots:"operation"}],e.columns=[],e.submitLoading=!1,e.confirmLeave=!1,e.isLoading=!1,e.voucherList=[],e.moduleCredDesign=41,e.evidenceFormParams=[],e.currentRow={},e.type="",e}return Qr(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listDisabled",{get:function(){return"group"===this.targetModal.objectSelectType&&!!this.targetList.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupDisabled",{get:function(){return"list"===this.targetModal.objectSelectType&&!!this.targetList.length},enumerable:!1,configurable:!0}),e.prototype.created=function(){return eo(this,void 0,void 0,(function(){var t,e,i,n,r=this;return io(this,(function(o){switch(o.label){case 0:return this.isPageLoading=!0,this.columns=[],t=this.taskInfo,e=t.bkObjId,i=t.name,n=t.monitorName,this.typeItem={name:e,nameCn:i,label:i,listUrl:"getOtherResourceList",filedUrl:"getOtherResourceFields",updateFieldUrl:"updateOtherResourceFields",batchEditUrl:"modifyOtherResourceBulk",changeRecordUrl:"getOtherSrcChange"},"add"===this.taskInfo.mode&&(this.form.name=n),[4,this.getCredParams()];case 1:return o.sent(),Promise.all([this.getCredential(),this.getMonitorObjList(),this.getAppCustomFields()]).finally((function(){r.isPageLoading=!1})),"modify"===this.taskInfo.mode&&this.getInitData(),this.initForm=this.$copy(this.form),[2]}}))}))},e.prototype.showBatchModal=function(t){var e=[],i=t.column.property;"credential"===i&&(e=this.$copy(this.voucherList)),this.$refs.batchModal.showDialog(i,e)},e.prototype.confirmBtachEdit=function(t,e){var i=this;this.targetList.forEach((function(n){i.$set(n,t,e)}))},e.prototype.selectCredential=function(t){var e=this.form.inst_list.find((function(e){return e.bk_inst_id===t.bk_inst_id}));e&&(e.credential=t.credential)},e.prototype.getMonitorObjList=function(){var t;return eo(this,void 0,void 0,(function(){var e,i,n;return io(this,(function(r){switch(r.label){case 0:return[4,this.$api.monitorCollect.getAccessPoint()];case 1:return e=r.sent(),i=e.data,n=e.message,e.result?(this.monitorObjList=i.result,"add"===this.taskInfo.mode&&(this.form.access_point=(null===(t=this.monitorObjList.at())||void 0===t?void 0:t.name)||""),[2]):(this.$error(n),[2])}}))}))},e.prototype.handleCreate=function(t){this.currentRow=t,this.$refs.voucherDialog.show("add",{})},e.prototype.getCredParams=function(){return eo(this,void 0,void 0,(function(){var t,e,i;return io(this,(function(n){switch(n.label){case 0:return[4,this.$api.remoteConnect.getCredParams({bk_obj_id:"hardware"})];case 1:return t=n.sent(),e=t.data,i=t.message,t.result?(this.moduleCredDesign=e.module_cred_design,this.evidenceFormParams=e.params,[2]):(this.$error(i),[2])}}))}))},e.prototype.updateCredential=function(t){return eo(this,void 0,void 0,(function(){var e=this;return io(this,(function(i){switch(i.label){case 0:return[4,this.getCredential()];case 1:return i.sent(),this.targetList.forEach((function(i){i.bk_inst_id===e.currentRow.bk_inst_id&&(i.credential=t.id)})),[2]}}))}))},e.prototype.getCredential=function(){var t;return eo(this,void 0,void 0,(function(){var e,i;return io(this,(function(n){switch(n.label){case 0:return e={page_size:99999,page:1,name:"",module_cred_design:this.moduleCredDesign,search_type:"all"},[4,this.$api.remoteConnect.getVaultCredential(e)];case 1:return(i=n.sent()).result?(this.voucherList=null===(t=i.data)||void 0===t?void 0:t.items,[2]):(this.$error(i.message),[2])}}))}))},e.prototype.getAppCustomFields=function(){return eo(this,void 0,void 0,(function(){var t,e;return io(this,(function(i){switch(i.label){case 0:return(t={}).bk_obj_id=this.typeItem.name,[4,this.$api.Resource[this.typeItem.filedUrl](t)];case 1:return(e=i.sent()).result?(this.handleAllFields(e.data.all_field),[2]):(this.$error(e.message),[2])}}))}))},e.prototype.handleAllFields=function(t){var e=this;t.forEach((function(t,i){"list"!==t.bk_property_type&&"bool"!==t.bk_property_type||("list"===t.bk_property_type&&(t.option=t.option.map((function(t){return{id:t,name:t}}))),"bool"===t.bk_property_type&&(t.option=[{id:!0,name:"是"},{id:!1,name:"否"}])),t.checked=!1,t.batchValue="",t.editStatus=!1,t.editValue="",t.editLoading=!1,t.editIconShow=!1,e.buildFieldData(t,e.instanceFields)}))},e.prototype.buildFieldData=function(t,e){var i=e.findIndex((function(e){return e.key===t.bk_property_group}));-1===i?e.push({title:t.bk_property_group_name,children:[t],key:t.bk_property_group,collapseStatus:!0,id:this.$random(3)}):e[i].children.push(t)},e.prototype.createTarget=function(){var t=this.$deepClone(this.instanceFields);t.forEach((function(t){t.children=t.children.filter((function(t){return!["录入方式","录入时间"].includes(t.bk_property_name)}))})),this.$refs.addResource.showDialog(this.typeItem,t)},e.prototype.createTargetSuccess=function(t){var e=this.$copy(t);console.log(e)},e.prototype.getInitData=function(){var t;for(var e in this.taskInfo.row)this.form.hasOwnProperty(e)&&(this.form[e]=this.taskInfo.row[e],"access_point"===e&&(this.form[e]=null===(t=this.taskInfo.row[e])||void 0===t?void 0:t.name));this.targetList=this.$copy(this.form.inst_list||[]),this.targetModal.objectSelectType="list",this.columns=this.getNewColumns(this.targetModal.objectSelectType)},e.prototype.selectTarget=function(){var t={objId:this.taskInfo.objId,entry:"collect-hardware"};t.panels=[{name:"list",disabled:this.listDisabled},{name:"topo",hide:!0},{name:"group",disabled:this.groupDisabled,hide:!0}],this.$refs.selectTargets.show(this.targetList,[],t)},e.prototype.removeTarget=function(t,e){this.targetList.splice(e,1),this.form.inst_list=this.targetList},e.prototype.getNewColumns=function(t){var e=this.$copy(this.targetColumns),i=[{label:"分组名称",key:"name"},{label:"Agent状态",key:"status",scopedSlots:"status"}];return"group"===t?(e.splice(0,2,i.at(),i.at(-1)),e):this.targetColumns},e.prototype.submitTarget=function(t){var e=this,i=this.$copy(t),n=i.data,r=i.type;this.targetModal.objectSelectType=r,this.columns=this.getNewColumns(r),n.forEach((function(t){t.credential=""})),this.targetList.forEach((function(t){var e=n.find((function(e){return e.bk_inst_id===t.bk_inst_id}));if(e){var i=t.pk,r=t.credential;e.pk=i,e.credential=r}})),"group"===r&&n.forEach((function(t){t.object_select_type="group"})),this.targetList=n,this.form.inst_list=this.targetList,this.$nextTick((function(){e.$refs.processTable.updateColumns(e.columns)}))},e.prototype.submit=function(){var t=this,e={name:this.form.name,bk_obj_id:this.taskInfo.bkObjId,period:this.form.period,protocol:"hardware"};e.inst_list=this.targetList.map((function(t){return{bk_inst_id:t.bk_inst_id,ip_addr:t.ip_addr,credential:t.credential,bk_inst_name:t.bk_inst_name}})),e.access_point=this.monitorObjList.find((function(e){return e.name===t.form.access_point}))||{},this.submitLoading=!0,this.$refs.validateForm.validate().then((function(i){var n=!0;t.targetList.forEach((function(e,i){return eo(t,void 0,void 0,(function(){return io(this,(function(t){return this.$refs["credential".concat(i)].validate(),e.credential||(n=!1),[2]}))}))})),n?t.createProcessCollect(e):t.submitLoading=!1}),(function(e){t.submitLoading=!1}))},e.prototype.createProcessCollect=function(t){var e=this,i="add"===this.taskInfo.mode?"addHareWareTask":"modifyHareWareTask",n="add"===this.taskInfo.mode?"创建成功":"修改成功";"modify"===this.taskInfo.mode&&(t.id=this.taskInfo.rowId),this.$api.monitorCollect[i](t).then((function(t){if(e.submitLoading=!1,t.result)return e.confirmLeave=!0,e.$success(n),e.taskInfo.showModal=!1,void e.$emit("refreshTable");e.$error(t.message)}))},e.prototype.cancel=function(){this.taskInfo.showModal=!1},to([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"taskInfo",void 0),e=to([Object(f.a)({components:{TargetSelect:lt.a,AddResource:ri.a,ComTable:st.a,VoucherDialog:on.a,BatchModal:Zr,IntroduceInfo:Vt}})],e)}(f.e),ro=no,oo=Object(u.a)(ro,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isPageLoading,zIndex:10},expression:"{ isLoading: isPageLoading, zIndex: 10 }"}],ref:"addHardware",attrs:{id:"addHardware"}},[i("div",{staticClass:"process-title"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.cancel}}),t._v("\n        "+t._s("add"===t.taskInfo.mode?"新建采集":"修改采集")+"\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskInfo.mode,expression:"taskInfo.mode === 'modify'"}],staticClass:"sub-title line"},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:"modify"===t.taskInfo.mode,expression:"taskInfo.mode === 'modify'"}],staticClass:"sub-title"},[t._v(t._s(t.taskInfo.subTitle))])],1),t._v(" "),i("div",{staticClass:"content-wrap",staticStyle:{position:"relative"}},[i("bk-form",{ref:"validateForm",staticClass:"plugin-form",attrs:{id:"form",model:t.form,"label-width":110,rules:t.ruleValidate}},[i("bk-form-item",{attrs:{label:"任务名称",property:"name",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入任务名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"采集频率",property:"period",required:"","error-display-type":"normal"}},[i("bk-input",{staticStyle:{width:"500px"},attrs:{min:1,precision:0,type:"number"},model:{value:t.form.period,callback:function(e){t.$set(t.form,"period",e)},expression:"form.period"}}),t._v("\n                分钟\n            ")],1),t._v(" "),i("bk-form-item",{attrs:{label:"接入点",required:!0,property:"access_point","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"500px"},attrs:{"ext-cls":"select-custom",placeholder:"选择采集主机",searchable:""},model:{value:t.form.access_point,callback:function(e){t.$set(t.form,"access_point",e)},expression:"form.access_point"}},t._l(t.monitorObjList,(function(t){return i("bk-option",{key:t.ip+t.name,attrs:{id:t.name,name:t.ip+"（"+t.name+"）"}})})),1)],1),t._v(" "),i("bk-form-item",{staticStyle:{width:"960px"},attrs:{label:"监控目标",property:"inst_list","error-display-type":"normal",required:""}},[i("div",{staticClass:"target-list"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"default"},on:{click:t.selectTarget}},[t._v("\n                        选择目标\n                    ")]),t._v(" "),i("span",{staticClass:"description"},[t._v("若无监控采集目标，请先")]),t._v(" "),i("bk-button",{staticClass:"add-target",attrs:{theme:"primary",text:"",size:"small"},on:{click:t.createTarget}},[t._v("\n                        添加资产\n                    ")])],1),t._v(" "),t.targetList.length&&t.columns.length?i("div",{staticClass:"instance-table"},[i("ComTable",{ref:"processTable",attrs:{data:t.targetList,columns:t.columns},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("span",{staticStyle:{color:"#ff0000"}},[t._v(t._s(n.error_count))]),t._v(" / "),i("span",[t._v(t._s(n.all_count))])]}},{key:"credential",fn:function(e){var n=e.row,r=e.index;return[i("bk-form",{ref:"credential"+r,attrs:{model:n,"label-width":0,rules:t.credentialValidate}},[i("bk-form-item",{attrs:{label:"",property:"credential",required:""}},[i("bk-select",{attrs:{searchable:""},on:{change:function(e){return t.selectCredential(n)}},model:{value:n.credential,callback:function(e){t.$set(n,"credential",e)},expression:"row.credential"}},[t._l(t.voucherList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),t._v(" "),i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(e){return t.handleCreate(n)}},slot:"extension"},[i("i",{staticClass:"bk-icon icon-plus-circle mr5"}),t._v("新建凭据\n                                        ")])],2)],1)],1)]}},{key:"operation",fn:function(e){var n=e.row,r=e.index;return[i("div",[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.removeTarget(n,r)}}},[t._v("删除")])],1)]}}],null,!1,1052793841)})],1):t._e()])],1),t._v(" "),i("introduce-info",{attrs:{type:t.taskInfo.bkObjId,"need-move":!1}})],1),t._v(" "),i("div",{staticClass:"operation"},[i("bk-button",{attrs:{theme:"primary",loading:t.submitLoading},on:{click:t.submit}},[t._v("确认")]),t._v(" "),i("bk-button",{staticClass:"ml10",attrs:{theme:"default"},on:{click:t.cancel}},[t._v("取消")])],1),t._v(" "),i("target-select",{ref:"selectTargets",attrs:{"target-modal":t.targetModal,"current-node":t.taskInfo},on:{getSelectedTargets:t.submitTarget}}),t._v(" "),i("AddResource",{ref:"addResource",on:{"on-success":t.createTargetSuccess}}),t._v(" "),i("VoucherDialog",{ref:"voucherDialog",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.updateCredential}}),t._v(" "),i("BatchModal",{ref:"batchModal",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.getCredential,confirmBtachEdit:t.confirmBtachEdit}})],1)}),[],!1,null,"0feec050",null).exports,ao=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),so=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},lo=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},co=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},uo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.maxHeight=0,e.tableLoading=!1,e.statusData=[],e.initStatusData=[],e.columns=[{label:"实例名称",key:"bk_inst_name",minWidth:"200px"},{label:"采集主机",key:"ip_addr",minWidth:"200px"},{label:"品牌",key:"brand",minWidth:"200px"},{label:"状态",key:"status",minWidth:"200px",scopedSlots:"status"}],e}return ao(e,t),e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-240,window.onresize=function(){t.maxHeight=window.innerHeight-240}},e.prototype.mounted=function(){return lo(this,void 0,void 0,(function(){return co(this,(function(t){return this.getCollecTaskStatus(),[2]}))}))},e.prototype.handleEnter=function(){var t=this;this.statusData=this.initStatusData.filter((function(e){return e.bk_inst_name.includes(t.search)}))},e.prototype.getCollecTaskStatus=function(){return lo(this,void 0,void 0,(function(){var t,e,i,n,r;return co(this,(function(o){switch(o.label){case 0:this.tableLoading=!0,t=this.getParams(),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getNetworkInstanceStatus(t)];case 2:return e=o.sent(),i=e.result,n=e.data,r=e.message,i?(this.statusData=n,this.initStatusData=n,[3,4]):(this.$error(r),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){return{instance_id:this.statusInfo.id}},e.prototype.goBack=function(){this.statusInfo.status=!1},so([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"statusInfo",void 0),e=so([Object(f.a)({components:{ComTable:st.a}})],e)}(f.e),po=uo,fo=Object(u.a)(po,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"status-manage"},[i("div",{staticClass:"title-box"},[i("bk-icon",{staticClass:"mr10",attrs:{type:"arrows-left-shape"},on:{click:t.goBack}}),t._v(" "),i("span",[t._v("状态")]),t._v(" "),i("span",{staticClass:"sub-title line"},[t._v(" - ")]),t._v(" "),i("span",{staticClass:"sub-title"},[t._v(t._s(t.statusInfo.taskName))])],1),t._v(" "),i("div",{staticClass:"nav-area"},[i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入实例名称",clearable:""},on:{enter:t.handleEnter,clear:t.handleEnter},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:t.statusData,columns:t.columns,"max-height":t.maxHeight},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("div",{class:["status-mark",n.status?"status-normal":"status-unnormal"]}),t._v(" "),i("span",[t._v(t._s(n.status?"正常":"失败"))])]}}])})],1)])}),[],!1,null,"1f81ac38",null).exports,mo=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ho=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},bo=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},go=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},yo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterCondition="",e.tableLoading=!1,e.maxHeight=0,e.tableData=[],e.columns=[{label:"任务名称",key:"name",minWidth:"100px"},{label:"运行状态",key:"status",minWidth:"100px",scopedSlots:"status"},{label:"创建者",key:"created_by",minWidth:"100px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:10},e.row={},e.taskInfo={mode:"add",showModal:!1,rowId:null,subTitle:"",bkObjId:"",name:"",objId:"",monitorName:"",row:{}},e.statusInfo={},e}return mo(e,t),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onCurrentNodeChanged=function(t){(null==t?void 0:t.bk_obj_id)&&(this.taskInfo.showModal=!1,this.statusInfo.status=!1,this.searchData())},e.prototype.created=function(){var t=this;this.maxHeight=window.innerHeight-256,window.onresize=function(){t.maxHeight=window.innerHeight-256}},e.prototype.mounted=function(){},e.prototype.linkTostatusManage=function(t){t.id,t.name},e.prototype.changeStatus=function(){this.taskInfo.showModal=!1},e.prototype.searchData=function(){this.pagination.current=1,this.search()},e.prototype.search=function(){var t=this,e={name:this.filterCondition,page_size:this.pagination.limit,page:this.pagination.current,bk_obj_id:this.currentNode.bk_obj_id};this.tableLoading=!0,this.$api.monitorCollect.getHareWareTask(e).then((function(e){if(t.tableLoading=!1,e.result)return t.tableData=e.data.items,void(t.pagination.count=e.data.count);t.$error(e.message)}))},e.prototype.addTask=function(t,e){this.$BtnPermission(this.permissionObj)&&(this.taskInfo={mode:t,showModal:!0,rowId:e.id,subTitle:e.name,bkObjId:this.currentNode.bk_obj_id,name:this.currentNode.bk_obj_name,objId:this.currentNode.id,monitorName:this.currentNode.bk_obj_name+"监控"+Y()().format("YYYYMMDDHHmmss"),row:"add"===t?{}:e})},e.prototype.deleteTask=function(t){var e=this;this.$BtnPermission(this.permissionObj)&&this.$bkInfo({title:"删除采集任务",subTitle:"是否删除采集任务【"+t.name+"】?",confirmLoading:!0,confirmFn:function(){return bo(e,void 0,void 0,(function(){var e=this;return go(this,(function(i){switch(i.label){case 0:return[4,this.$api.monitorCollect.deleteHareWareTask({id:t.id}).then((function(t){if(t.result)return e.$success("删除成功"),1===e.tableData.length&&(e.pagination.current-=1,0===e.pagination.current&&(e.pagination.current=1)),void e.search();e.$error(t.message)}))];case 1:return i.sent(),[2]}}))}))}})},e.prototype.handlePageLimitChange=function(t){this.pagination.limit=t,this.searchData()},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.search()},ho([Object(f.d)({type:Object,default:function(){return{}}})],e.prototype,"currentNode",void 0),ho([Object(f.f)("currentNode",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),e=ho([Object(f.a)({components:{ComTable:st.a,AddHardware:oo,StatusManage:fo}})],e)}(f.e),vo=yo,_o=Object(u.a)(vo,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"hardware-manage"}},[t.taskInfo.showModal||t.statusInfo.status?i("div",{staticClass:"hardware-manage-addCisco"},[t.taskInfo.showModal?i("AddHardware",{attrs:{"task-info":t.taskInfo},on:{refreshTable:t.searchData}}):t._e(),t._v(" "),t.statusInfo.status?i("StatusManage",{attrs:{"status-info":t.statusInfo}}):t._e()],1):i("div",{staticClass:"hardware-manage-list"},[i("div",{staticClass:"nav-bar"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{"ext-cls":"mr5",theme:"primary"},on:{click:function(e){return t.addTask("add",{})}}},[t._v("\n                新建\n            ")]),t._v(" "),i("bk-input",{staticStyle:{width:"360px",float:"right"},attrs:{placeholder:"请输入任务名称","right-icon":"bk-icon icon-search",clearable:""},on:{"right-icon-click":t.searchData,enter:t.searchData},model:{value:t.filterCondition,callback:function(e){t.filterCondition=e},expression:"filterCondition"}})],1),t._v(" "),i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",staticClass:"table-set",attrs:{data:t.tableData,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange},scopedSlots:t._u([{key:"status",fn:function(e){var n=e.row;return[i("div",{class:["status-mark",n.status?"status-unnormal":"status-normal"]}),t._v(" "),i("bk-button",{attrs:{text:""},on:{click:function(e){return t.linkTostatusManage(n)}}},[t._v(t._s(n.status?2===n.status?"失败":"部分失败":"正常"))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.addTask("modify",n)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.deleteTask(n)}}},[t._v("\n                        删除\n                    ")])],1)]}}],null,!1,1334617778)})],1)])}),[],!1,null,"c9528dd4",null).exports,ko=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),wo=function(){return wo=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},wo.apply(this,arguments)},xo=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Co=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},Do=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},jo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.groupList=[],e.currentNode={},e.parentNode={},e.longConfig={placement:"right",width:140,content:"已监控实例数/未监控实例数"},e}return ko(e,t),e.prototype.created=function(){this.getObjGroupList({bk_obj_id:this.$route.query.bkObjId})},e.prototype.setTreeNum=function(t,e){var i=t?t.split("/"):[];if(!e)return i[e]||0;var n=i[e]-i[0];return isNaN(n)||n<=0?0:n},e.prototype.refreshTree=function(t){this.getObjGroupList(t)},e.prototype.getObjGroupList=function(t){var e;return void 0===t&&(t={}),Co(this,void 0,void 0,(function(){var i,n,r,o,a=this;return Do(this,(function(s){switch(s.label){case 0:this.loading=!0,s.label=1;case 1:return s.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getCollectTree()];case 2:return(i=s.sent()).result&&(this.groupList=i.data.map((function(t){return wo(wo({},t),{bk_obj_id:t.name,bk_obj_name:t.cn_name,sortIndex:X.findIndex((function(e){return e===t.name.toLowerCase()}))})})).sort((function(t,e){return t.sortIndex-e.sortIndex})),this.groupList.length&&(n=this.groupList.at(0),r=null===(e=n.children)||void 0===e?void 0:e.at(0),o=t.bk_obj_id||r.bk_obj_id,this.$nextTick((function(){var t,e;null===(t=a.$refs.tree)||void 0===t||t.setSelected(o),null===(e=a.$refs.tree)||void 0===e||e.setExpanded(o)})))),[3,4];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.beforeSelect=function(t){var e,i,n;if(!t.level)return!1;var r=t.data,o=t.parent;return this.currentNode=r,this.parentNode=o,null===(e=this.$refs.monitor)||void 0===e||e.changeStatus(),null===(i=this.$refs.ciscoManage)||void 0===i||i.changeStatus(),null===(n=this.$refs.hardwareManage)||void 0===n||n.changeStatus(),!0},e=xo([Object(f.a)({components:{AgentManage:$e,CommonManage:Fi,K8sManage:rn,ProcessManage:qn,WebSiteMeasurement:gr,CiscoManage:Wr,CloudManage:xn,HardwareManage:_o}})],e)}(f.e),Oo=jo,Lo=Object(u.a)(Oo,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"control-gather"},[i("div",{staticClass:"group-tree"},[t.groupList.length?i("bk-big-tree",{ref:"tree",attrs:{data:t.groupList,"enable-title-tip":"",selectable:!0,"show-checkbox":!1,"show-link-line":!1,"use-default-empty":!0,options:{idKey:"bk_obj_id",nameKey:"bk_obj_name"},"before-select":t.beforeSelect},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,r=e.data;return n.level?i("div",{staticClass:"tree-node"},[i("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"tree-node-name"},[t._v(t._s(r.bk_obj_name))]),t._v(" "),["process","uptimecheck","VMware","aliyun","qcloud","mo_server"].includes(r.bk_obj_id)?t._e():i("div",{staticClass:"tree-node-num"},[i("span",{staticClass:"monitored"},[t._v(t._s(t.setTreeNum(r.collect_info,0)))]),i("span",{staticClass:"total"},[t._v("/"+t._s(t.setTreeNum(r.collect_info,1)))]),t._v(" "),i("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.longConfig,expression:"longConfig"}],staticClass:"tips"},[i("i",{staticClass:"bk-icon icon-info-circle-shape"})])])]):t._e()}}],null,!0)}):i("bk-exception",{staticClass:"exception-wrap-item exception-part",attrs:{type:"empty",scene:"part"}})],1),t._v(" "),i("div",{staticClass:"indicator-list-wrapper"},["host"===t.currentNode.bk_obj_id?i("AgentManage"):"k8s_cluster"===t.currentNode.bk_obj_id?i("K8sManage",{attrs:{"current-node":t.currentNode}}):"cloud"===t.parentNode.id?i("CloudManage",{attrs:{"current-node":t.currentNode},on:{refreshTree:t.refreshTree}}):"process"===t.currentNode.bk_obj_id?i("ProcessManage",{attrs:{"current-node":t.currentNode}}):"uptimecheck"===t.currentNode.bk_obj_id?i("web-site-measurement"):"bk_device"===t.parentNode.id?i("CiscoManage",{ref:"ciscoManage",attrs:{"current-node":t.currentNode}}):"bk_hardware"===t.parentNode.id?i("HardwareManage",{ref:"hardwareManage",attrs:{"current-node":t.currentNode}}):i("CommonManage",{ref:"monitor",attrs:{"current-node":t.currentNode,"parent-node":t.parentNode},on:{refreshTree:t.refreshTree}})],1)])}),[],!1,null,"1d44aeea",null).exports,To=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),So=function(){return So=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},So.apply(this,arguments)},Io=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Po=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},$o=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Mo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.modal={},e.formObj={monitor_obj:"",group_name:"",id:0,confirmLoading:!1},e.formLoading=!1,e.conditionList=[{operator:"equal"}],e.monitorObjList=[],e.rules={group_name:[{message:"名称不能为空",trigger:"blur",required:!0}],monitor_obj:[{message:"关联对象不能为空",trigger:"blur",required:!0}]},e.fieldList=[],e.operatorList={equal:"等于",not_equal:"不等于",contains:"包含"},e.propertyList=[],e.groupPage={current:1,count:0,limit:20},e.groupData=[],e.isShowPreview=!1,e.tableLoading=!1,e.groupConditionLoading=!1,e.isFirstInit=!1,e.enumList=[],e.fieldMap={},e.columns=[],e.initForm={},e.initConditionList=[],e}return To(e,t),e.prototype.onCurrentNodeChanged=function(t){this.modal=this.$copy(this.groupModal),this.modal.status&&(this.isShowPreview=!1,this.modal.isAdd?(this.formObj={monitor_obj:"",group_name:"",id:0},this.conditionList=[{operator:"equal"}],this.getMonitorObjList()):this.initData())},e.prototype.initData=function(){return Po(this,void 0,void 0,(function(){return $o(this,(function(t){switch(t.label){case 0:return this.isFirstInit=!0,this.formLoading=!0,this.formObj.group_name=this.modal.row.name,[4,this.getMonitorObjList()];case 1:return t.sent(),this.conditionList=this.modal.row.condition_list,this.formObj.monitor_obj=this.modal.row.monitor_obj,this.formObj.id=this.modal.row.id,this.initConditionList=this.$copy(this.conditionList),this.initForm=this.$copy(this.formObj),this.formLoading=!1,[2]}}))}))},e.prototype.getMonitorObjList=function(){return Po(this,void 0,void 0,(function(){var t;return $o(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getAllMonitorObj()];case 1:return(t=e.sent()).result?(this.monitorObjList=t.data,this.modal.isAdd&&(this.initConditionList=this.$copy(this.conditionList),this.initForm=this.$copy(this.formObj)),[2]):(this.$error(t.message),[2])}}))}))},e.prototype.confirm=function(){var t=this;this.formObj.confirmLoading=!0,this.$refs.objGroupForm.validate().then((function(e){var i="updateDynamicGroup",n="修改成功";t.modal.isAdd&&(i="createDynamicGroup",n="创建成功");var r=t.conditionList.filter((function(t){return t.field&&t.operator&&t.value&&0!==t.value}));if(r.length){t.conditionList=r;var o=t.conditionList.map((function(t){return{field:t.field,operator:t.operator,value:t.value}})),a={id:t.formObj.id,name:t.formObj.group_name,monitor_obj:t.formObj.monitor_obj,condition_list:o};t.$api.monitorCollect[i](a).then((function(e){if(t.formObj.confirmLoading=!1,e.result)return t.$success(n),void t.$emit("submitGroup");t.$error(e.message)}))}else t.$error("不存在有效的分组条件")}))},e.prototype.cancelGroup=function(){var t=this,e=JSON.stringify(this.formObj)+JSON.stringify(this.conditionList);JSON.stringify(this.initForm)+JSON.stringify(this.initConditionList)!==e?this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){return t.groupModal.status=!1,!0}}):this.groupModal.status=!1},e.prototype.addGroup=function(){this.isShowPreview=!1,this.conditionList.push({field:"",operator:"equal",value:""})},e.prototype.removeGroup=function(t){this.conditionList.splice(t,1),this.isShowPreview=!1},e.prototype.changeMonitorObj=function(){var t=this;if(!this.formObj.monitor_obj)return this.fieldList=[],void(this.propertyList=[]);this.isFirstInit?this.isFirstInit=!1:this.conditionList=[{field:"",operator:"equal",value:""}],this.$nextTick((function(){t.groupConditionLoading=!0,t.getMonitorObjectAttribute(),t.getMonitioObjectPropertyList()}))},e.prototype.getMonitorObjectAttribute=function(){return Po(this,void 0,void 0,(function(){var t,e,i,n=this;return $o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),t=this.monitorObjList.find((function(t){return t.id===n.formObj.monitor_obj})).bk_obj_id,[4,this.$api.monitorCollect.getObjectAttribute({bk_obj_id:t})];case 1:return(e=r.sent()).result?(this.fieldList=e.data,this.enumList=e.data.filter((function(t){return"enum"===t.bk_property_type})).map((function(t){return t.id})),i={},e.data.forEach((function(t){i[t.id]=t.option})),this.fieldMap=i,[2]):(this.$error(e.message),[3,3]);case 2:return this.groupConditionLoading=!1,[7];case 3:return[2]}}))}))},e.prototype.getMonitioObjectPropertyList=function(){var t=this;this.$api.monitorCollect.getObjDisplayFields({obj_id:this.formObj.monitor_obj}).then((function(e){if(e.result)return t.propertyList=e.data,void(t.columns=t.propertyList.map((function(t){return{label:t.bk_property_name,key:t.bk_property_id}})));t.$error(e.message)}))},e.prototype.changeField=function(t,e){if(this.isFirstInit)this.isFirstInit=!0;else if(t.field){var i=this.fieldList.find((function(e){return e.id===t.field})),n=JSON.stringify(this.conditionList)===JSON.stringify(this.initConditionList);if(i&&!n){var r=So(So({},t),{value:""});this.$set(this.conditionList,e,r)}}},e.prototype.checkPreview=function(){if(this.isShowPreview)this.isShowPreview=!1;else{var t=this.conditionList.filter((function(t){return t.field&&t.operator&&t.value&&0!==t.value}));t.length?(this.conditionList=t,this.isShowPreview=!0,this.groupPage.current=1,this.getPreview()):this.$bkMessage({theme:"error",message:"不存在有效的分组条件"})}},e.prototype.getPreview=function(){return Po(this,void 0,void 0,(function(){var t,e,i,n,r=this;return $o(this,(function(o){switch(o.label){case 0:this.tableLoading=!0,o.label=1;case 1:return o.trys.push([1,,3,4]),t=this.conditionList.map((function(t){return{field:t.field,operator:t.operator,value:t.value}})),e=this.monitorObjList.find((function(t){return t.id===r.formObj.monitor_obj})).bk_obj_id,i={bk_obj_id:e,display_fields:this.propertyList,condition_list:t,page_size:this.groupPage.limit,current:this.groupPage.current},[4,this.$api.monitorCollect.getPreviewInstList(i)];case 2:return(n=o.sent()).result?(this.groupPage.count=n.data.count,this.groupData=n.data.data,[2]):(this.$error(n.message),[3,4]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.handlePageChange=function(t){this.groupPage.current=t,this.getPreview()},e.prototype.handlePageLimitChange=function(t){this.groupPage.limit=t,this.groupPage.current=1,this.getPreview()},e.prototype.changeOperator=function(){this.isShowPreview=!1},e.prototype.changeValue=function(){this.isShowPreview=!1},Io([Object(f.d)({type:Object,default:function(){return{status:!1,title:"新增动态分组",isAdd:!0}}})],e.prototype,"groupModal",void 0),Io([Object(f.f)("groupModal.status",{immediate:!0,deep:!0})],e.prototype,"onCurrentNodeChanged",null),e=Io([Object(f.a)({components:{ComTable:st.a}})],e)}(f.e),No=Mo,Ao=Object(u.a)(No,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"groupModal"}},[i("bk-sideslider",{attrs:{"is-show":t.groupModal.status,width:600,"quick-close":!0,"ext-cls":"common-dialog-wrapper","before-close":t.cancelGroup},on:{"update:isShow":function(e){return t.$set(t.groupModal,"status",e)},"update:is-show":function(e){return t.$set(t.groupModal,"status",e)}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n            "+t._s(t.groupModal.title)+"\n            "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.groupModal.isAdd,expression:"!groupModal.isAdd"}]},[t._v("-")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.groupModal.isAdd,expression:"!groupModal.isAdd"}]},[t._v(t._s(t.groupModal.subTitle))])]),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.formLoading,zIndex:100},expression:"{ isLoading: formLoading, zIndex: 100 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"objGroupForm",staticClass:"mr20",attrs:{"label-width":100,model:t.formObj,rules:t.rules,"form-type":"vertical"}},[i("bk-form-item",{attrs:{label:"分组名称",required:!0,property:"group_name","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:!0},model:{value:t.formObj.group_name,callback:function(e){t.$set(t.formObj,"group_name",e)},expression:"formObj.group_name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"对象类型",required:!0,property:"monitor_obj","error-display-type":"normal"}},[i("bk-select",{attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:"",disabled:!t.groupModal.isAdd},on:{change:t.changeMonitorObj},model:{value:t.formObj.monitor_obj,callback:function(e){t.$set(t.formObj,"monitor_obj",e)},expression:"formObj.monitor_obj"}},t._l(t.monitorObjList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.bk_obj_name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"分组条件",required:!0,property:"condition_list","error-display-type":"normal"}},t._l(t.conditionList,(function(e,n){return i("div",{key:n,staticClass:"group-condition"},[i("bk-select",{attrs:{"ext-cls":"select-custom left",searchable:"",loading:t.groupConditionLoading},on:{change:function(i){return t.changeField(e,n)}},model:{value:e.field,callback:function(i){t.$set(e,"field",i)},expression:"item.field"}},t._l(t.fieldList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v(" "),i("bk-select",{attrs:{"ext-cls":"select-custom middle",searchable:"",clearable:!1},on:{change:t.changeOperator},model:{value:e.operator,callback:function(i){t.$set(e,"operator",i)},expression:"item.operator"}},t._l(t.operatorList,(function(t,e){return i("bk-option",{key:t,attrs:{id:e,name:t}})})),1),t._v(" "),t.enumList.includes(e.field)?i("bk-select",{attrs:{"ext-cls":"select-custom right",searchable:"",loading:t.groupConditionLoading},on:{change:t.changeValue},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}},t._l(t.fieldMap[e.field],(function(t){return i("bk-option",{key:t.field+"-"+t.id,attrs:{id:t.id,name:t.name}})})),1):i("bk-input",{staticClass:"input-custom",attrs:{clearable:!0},on:{change:t.changeValue},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}}),t._v(" "),i("i",{staticClass:"bk-icon icon-plus-circle-shape ml5",on:{click:t.addGroup}}),t._v(" "),t.conditionList.length>1?i("i",{staticClass:"bk-icon icon-minus-circle-shape",on:{click:function(e){return t.removeGroup(n)}}}):t._e()],1)})),0)],1),t._v(" "),i("bk-button",{staticClass:"preview-btn",attrs:{theme:"primary",text:"",disabled:t.formLoading},on:{click:t.checkPreview}},[t._v("\n                预览\n                "),i("i",{class:["bk-icon","preview",t.isShowPreview?"icon-angle-double-up":"icon-angle-double-down"]})]),t._v(" "),t.isShowPreview?i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",staticClass:"mt10",attrs:{data:t.groupData,columns:t.columns,pagination:t.groupPage,"max-height":300},on:{"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange}}):t._e()],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",disabled:t.formLoading,loading:t.formObj.confirmLoading},on:{click:t.confirm}},[t._v("\n                确认\n            ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancelGroup}},[t._v("\n                取消\n            ")])],1)])],1)}),[],!1,null,"26e10cb4",null).exports,Eo=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ro=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},qo=function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},zo=function(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Fo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterCondition="",e.groupData=[],e.groupHeader=[{label:"分组名称",key:"name",minWidth:"200px"},{label:"对象类型",key:"monitor_obj_display",minWidth:"100px"},{label:"组成员数",key:"member_list",minWidth:"100px"},{label:"创建者",key:"created_by",minWidth:"100px",scopedSlots:"created_by"},{label:"创建时间",key:"created_at",minWidth:"200px"},{label:"操作",key:"operation",width:"200px",prop:"operation",fixed:"right",scopedSlots:"operation"}],e.groupPage={current:1,count:0,limit:20},e.formObj={display_name:"",id:0},e.groupModal={status:!1,title:"",isAdd:!0,row:{},subTitle:""},e.loading=!1,e}return Eo(e,t),Object.defineProperty(e.prototype,"maxTableHeight",{get:function(){return window.innerHeight-256},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.onFilterConditionChanged=function(t,e){e&&!t&&this.searchGroupList()},e.prototype.created=function(){this.searchGroupList()},e.prototype.initData=function(){this.initGroupPage()},e.prototype.addGroup=function(){this.$BtnPermission(this.permissionObj)&&(this.groupModal.status=!0,this.groupModal.isAdd=!0,this.groupModal.title="新建动态分组")},e.prototype.searchGroupList=function(){this.groupPage.current=1,this.initGroupPage()},e.prototype.initGroupPage=function(t){return void 0===t&&(t=""),qo(this,void 0,void 0,(function(){var e,i,n,r,o;return zo(this,(function(a){switch(a.label){case 0:e={search:this.filterCondition,page_size:this.groupPage.limit,page:this.groupPage.current},this.loading=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.monitorCollect.getDynamicGroup(e)];case 2:return i=a.sent(),n=i.data,r=i.result,o=i.message,r?(n.results.forEach((function(t){var e;t.member_list=(null===(e=t.member_list)||void 0===e?void 0:e.length)||0})),this.groupData=n.results,this.groupPage.count=n.count,"refresh"===t&&this.$success("列表已更新"),[2]):(this.$error(o),[3,4]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.modifyGroup=function(t){this.$BtnPermission(this.permissionObj)&&(this.groupModal={status:!0,isAdd:!1,row:this.$copy(t),title:"修改动态分组",subTitle:t.name})},e.prototype.deleteGroup=function(t){var e=this;this.$BtnPermission(this.permissionObj)&&this.$bkInfo({title:"删除动态分组",subTitle:"是否删除动态分组【"+t.name+"】?",confirmLoading:!0,confirmFn:function(){return qo(e,void 0,void 0,(function(){var e;return zo(this,(function(i){switch(i.label){case 0:return[4,this.$api.monitorCollect.deleteDynamicGroup({id:t.id})];case 1:return(e=i.sent()).result?(this.$success("删除成功"),this.groupPage.current>1&&1===this.groupData.length&&this.groupPage.current--,this.initGroupPage(),[2]):(this.$error(e.message),[2])}}))}))}})},e.prototype.submitGroup=function(){this.groupModal.status=!1,this.initGroupPage()},e.prototype.handlePageLimitChange=function(t){this.groupPage.limit=t,this.searchGroupList()},e.prototype.handlePageChange=function(t){this.groupPage.current=t,this.initGroupPage()},Ro([Object(f.f)("filterCondition")],e.prototype,"onFilterConditionChanged",null),e=Ro([Object(f.a)({components:{ComTable:st.a,DynamicModal:Ao}})],e)}(f.e),Ho=Fo,Bo=Object(u.a)(Ho,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"groupList"}},[i("div",{staticClass:"operation-area"},[i("bk-button",{attrs:{theme:"primary"},on:{click:t.addGroup}},[t._v("新建")]),t._v(" "),i("div",[i("bk-input",{staticClass:"operation-search",attrs:{clearable:"",placeholder:"请输入分组名称","right-icon":"bk-icon icon-search"},on:{"right-icon-click":t.searchGroupList,enter:t.searchGroupList},model:{value:t.filterCondition,callback:function(e){t.filterCondition=e},expression:"filterCondition"}}),t._v(" "),i("bk-button",{staticClass:"ml10",attrs:{disabled:t.loading,icon:t.loading?"loading":"icon-refresh"},on:{click:function(e){return t.initGroupPage("refresh")}}})],1)],1),t._v(" "),i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],ref:"table",attrs:{data:t.groupData,columns:t.groupHeader,pagination:t.groupPage,"max-height":t.maxTableHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange},scopedSlots:t._u([{key:"created_by",fn:function(e){var n=e.row;return[i("span",[t._v(t._s(n.created_by+"("+n.created_by_cn+")"))])]}},{key:"operation",fn:function(e){var n=e.row;return[i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.modifyGroup(n)}}},[t._v("修改")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary",text:""},on:{click:function(e){return t.deleteGroup(n)}}},[t._v("删除")])],1)]}}])}),t._v(" "),i("DynamicModal",{attrs:{"group-modal":t.groupModal},on:{submitGroup:t.submitGroup}})],1)}),[],!1,null,"6cdf8237",null).exports,Vo=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Wo=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},Go=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.menuList=[{label:"监控采集",name:"sql"},{label:"监控策略",name:"policy"},{label:"动态分组",name:"group"},{label:"指标管理",name:"indicator"}],e.active="sql",e}return Vo(e,t),Object.defineProperty(e.prototype,"user",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),e.prototype.created=function(){this.user.is_super||(this.menuList=this.menuList.filter((function(t){return"group"!==t.name})),this.active=this.menuList[0].name)},e.prototype.toTabMenu=function(t){this.active=t.name},e=Wo([Object(f.a)({name:"monitor-manage",components:{MenuTab:r.a,HeaderSub:o.a,IndicatorManage:at,MonitorGather:Lo,MonitorPolicy:At,DynamicGroup:Bo},beforeRouteLeave:function(t,e,i){this.$handleKeepAlive(t,e),i()}})],e)}(f.e),Uo=Go,Ko=Object(u.a)(Uo,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"monitor-manage-wrapper"},[i("header-sub",{staticClass:"monitor-manage-header"},[i("template",{slot:"title"},[i("menu-tab",{attrs:{panels:t.menuList,type:"line","active-panel":t.active},on:{click:t.toTabMenu}})],1)],2),t._v(" "),"indicator"===t.active?i("indicator-manage"):"sql"===t.active?i("monitor-gather"):"group"===t.active?i("dynamic-group"):i("monitor-policy")],1)}),[],!1,null,"94381d54",null);e.default=Ko.exports}}]);