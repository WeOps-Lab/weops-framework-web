(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"27JG":function(t,e,a){"use strict";a.r(e);var n,i=a("JnIg"),r=a("M6ge"),s=a("iTfj"),o=a("G0B5"),c=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}),l=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.row=null,e.voucher=[],e}return c(e,t),e.prototype.showTaskDialog=function(t){var e=Object(s.isArray)(t)?t:[t],a=this.$copy(e[0]);a.parameter_credentials.forEach((function(e){Object(s.isArray)(t)&&(e.value="")})),this.voucher=a.parameter_credentials,this.visible=!0,this.row=t},e.prototype.confirmSet=function(){var t=this,e=Object(s.isArray)(this.row)?this.row:[this.row];e.forEach((function(e){e.parameter_credentials=t.voucher})),this.$emit("getCreditParams",e),this.visible=!1},e=l([o.a],e)}(o.e),d=u,p=a("KHd+"),f=Object(p.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("bk-dialog",{attrs:{width:500,"mask-close":!1,"render-directive":"if",title:"参数凭证","header-position":"left",transfer:"","ext-cls":"task-dialog-wrapper"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("div",{staticClass:"task-dialog-wrapper-main"},[a("bk-form",{ref:"validateForm",attrs:{"label-width":100}},t._l(t.voucher,(function(e,n){return a("bk-form-item",{key:e.name+n,attrs:{label:e.name}},[a("bk-input",{attrs:{placeholder:"请输入"+e.name,"password-icon":[],type:e.encryption?"password":"text"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"item.value"}})],1)})),1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("bk-button",{staticClass:"mr20",attrs:{theme:"primary"},on:{click:t.confirmSet}},[t._v("\n                确定\n            ")]),t._v(" "),a("bk-button",{attrs:{theme:"default"},on:{click:function(e){t.visible=!1}}},[t._v("取消")])],1)])],1)}),[],!1,null,"3ddfa0e6",null).exports,h=a("ac6i"),m=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),b=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},v=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},g=function(t,e){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.formData={package_name:"",scan_cycle:{},next_scan_time:"",bk_obj_name:""},e.loading=!1,e.tableLoading=!1,e.scanTimer=!1,e.dataList=[],e.columns=[{label:"实例名",key:"bk_inst_name",minWidth:"120px"},{label:"所属应用",key:"bk_biz_name",minWidth:"80px"}],e.pagination={current:1,count:0,limit:20},e.userData=[],e}return m(e,t),e.prototype.onTaskRowChange=function(t,e){t&&t.id&&this.getTaskDetail({id:t.id})},e.prototype.destroyed=function(){this.dataList=[],this.formData={}},e.prototype.created=function(){this.userData=sessionStorage.getItem("allUserData")?JSON.parse(sessionStorage.getItem("allUserData")):[]},e.prototype.getReceiver=function(t){var e=this,a=[];return t.forEach((function(t){var n=e.userData.find((function(e){return e.display===t}));n&&a.push(n.displayKey)})),a.join(",")},e.prototype.showScanCycle=function(t){var e=t.value_type;return e?"timing"===e?"每天一次，在".concat(t.value):"cycle"===e?"每".concat(t.value,"小时一次"):"不开启周期扫描":"--"},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getTableList()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getTableList()},e.prototype.getTaskDetail=function(t){var e=this,a=this.$api.healthAdvisor.getTaskDetail(t),n=this.$api.healthAdvisor.getResourcesList(t);this.loading=!0,Promise.all([a,n]).then((function(t){e.dealData(t)})).finally((function(){e.loading=!1}))},e.prototype.dealData=function(t){var e=t[0],a=t[1];if(e.result&&a.result)return this.formData=e.data,void this.getTableData(a);this.$message.error(e.result?a.message:e.message)},e.prototype.getTableData=function(t){t.data.items.forEach((function(t){t.index_num=t.job_status?t.index_num:"--"})),this.dataList=t.data.items,this.pagination.count=t.data.count},e.prototype.getTableList=function(t){return void 0===t&&(t=!1),v(this,void 0,void 0,(function(){var e,a;return g(this,(function(n){switch(n.label){case 0:e={id:this.taskRow.id},this.tableLoading=!t,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getResourcesList(e)];case 2:return(a=n.sent()).result?(this.getTableData(a),[3,4]):(this.$message.error(a.message),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},b([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"taskRow",void 0),b([Object(o.f)("taskRow",{immediate:!0,deep:!0})],e.prototype,"onTaskRowChange",null),e=b([Object(o.a)({components:{comTable:i.a}})],e)}(o.e),y=_,k=Object(p.a)(y,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[a("bk-form",{ref:"validateForm",staticClass:"task-form",attrs:{"label-width":122,model:t.formData}},[a("bk-form-item",{attrs:{label:"对象名称："}},[t._v("\n            "+t._s(t.formData.bk_obj_name||"--")+"\n        ")]),t._v(" "),a("bk-form-item",{attrs:{label:"扫描包："}},[t._v("\n            "+t._s(t.formData.package_name||"--")+"\n        ")]),t._v(" "),a("bk-form-item",{attrs:{label:"邮件通知："}},[t._v("\n            "+t._s(t.formData.receiver&&t.getReceiver(t.formData.receiver)||"--")+"\n        ")]),t._v(" "),a("bk-form-item",{attrs:{label:"扫描周期："}},[t._v("\n            "+t._s(t.showScanCycle(t.formData.scan_cycle))+"\n        ")]),t._v(" "),a("bk-form-item",{attrs:{label:"下次扫描时间："}},[t._v("\n            "+t._s(t.formData.next_scan_time||"--")+"\n        ")]),t._v(" "),a("bk-form-item",{attrs:{label:"扫描资源列表："}})],1),t._v(" "),a("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"healthTable",staticClass:"base-info-table",attrs:{data:t.dataList,columns:t.columns}})],1)}),[],!1,null,"7c439012",null).exports,w=a("sxP2"),x=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),D=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},L=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},j=function(t,e){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.formData={package_name:"",scan_cycle:{},next_scan_time:"",bk_obj_name:""},e.loading=!1,e.tableLoading=!1,e.scanTimer=!1,e.dataList=[],e.columns=[{label:"实例名",key:"bk_inst_name",minWidth:"120px"},{label:"所属应用",key:"bk_biz_name",minWidth:"80px"},{label:"扫描时间",key:"scan_time",minWidth:"150px"},{label:"危险数/警告数",key:"message",scopedSlots:"message",minWidth:"108px"},{label:"检查项",key:"index_num",minWidth:"66px"},{label:"通过率",key:"pass_rate",minWidth:"70px",scopedSlots:"pass_rate"},{label:"扫描状态",key:"job_result_status_name",minWidth:"80px",scopedSlots:"job_result_status_name"},{label:"操作",key:"operation",width:"144px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:20},e.panels=[{name:"base",label:"基本信息"},{name:"preview",label:"任务概览"},{name:"list",label:"实例列表"}],e.active="preview",e}return x(e,t),e.prototype.onTaskRowChanged=function(t,e){t&&t.id&&this.getTaskDetail({id:t.id})},e.prototype.destroyed=function(){this.closeInterval(),this.dataList=[],this.formData={}},e.prototype.toTabMenu=function(t){this.active=t.name},e.prototype.isDisabled=function(t){return!t.job_status||"--"===t.job_task_record_id},e.prototype.showScanCycle=function(t){var e=t.value_type;return e?"timing"===e?"每天一次，在".concat(t.value):"cycle"===e?"每".concat(t.value,"小时一次"):"不开启周期扫描":"--"},e.prototype.getPassRate=function(t){return"--"!==t.pass_rate&&t.job_status?"".concat(t.pass_rate,"%"):"--"},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getTableList()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getTableList()},e.prototype.handleScan=function(t){return L(this,void 0,void 0,(function(){var e,a;return j(this,(function(n){switch(n.label){case 0:return this.btnForbidden?[2]:(e=t.job_task_record_id,this.$set(t,"job_status",!1),[4,this.$api.healthAdvisor.resourceJobRun({id:e})]);case 1:return(a=n.sent()).result?(this.$emit("refreshOutData"),this.getTableList(),[2]):(this.$set(t,"job_status",!0),this.$message.error(a.message),[2])}}))}))},e.prototype.handleCheck=function(t){var e=t.job_task_record_id;this.$emit("close");var a=this.dataList.filter((function(t){return"--"!==t.job_task_record_id}));this.$router.push({name:"HealthInstDetail",query:{id:e,packageName:this.formData.package_name,taskName:this.taskRow.task_name,caseList:JSON.stringify(a)}}),this.closeInterval()},e.prototype.getTaskDetail=function(t){var e=this;this.tableLoading=!0,this.$api.healthAdvisor.getResourcesList(t).then((function(t){t.result?e.getTableData(t.data):e.$message.error(t.message)})).finally((function(){e.tableLoading=!1}))},e.prototype.getTableData=function(t){t.items.forEach((function(t){t.index_num=t.job_status?t.index_num:"--"})),this.dataList=t.items,this.pagination.count=t.count,!t.items.every((function(t){return t.job_status}))&&this.refreshScanStatus()},e.prototype.getTableList=function(t){return void 0===t&&(t=!1),L(this,void 0,void 0,(function(){var e,a;return j(this,(function(n){switch(n.label){case 0:this.closeInterval(),e={id:this.taskRow.id},this.tableLoading=!t,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getResourcesList(e)];case 2:return(a=n.sent()).result?(this.getTableData(a.data),[3,4]):(this.$message.error(a.message),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.refreshScanStatus=function(){var t=this;this.closeInterval(),this.scanTimer=setInterval((function(){t.getTableList(!0)}),1e4)},e.prototype.closeInterval=function(){this.scanTimer&&clearInterval(this.scanTimer)},D([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"taskRow",void 0),D([Object(o.f)("taskRow",{deep:!0,immediate:!0})],e.prototype,"onTaskRowChanged",null),e=D([Object(o.a)({name:"instance-lsit",components:{comTable:i.a},mixins:[w.a]})],e)}(o.e),C=O,S=Object(p.a)(C,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"title"},[a("bk-icon",{staticClass:"refresh-icon",attrs:{type:"refresh"},on:{click:function(e){return t.getTableList(!1)}}})],1),t._v(" "),a("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"healthTable",attrs:{data:t.dataList,columns:t.columns},scopedSlots:t._u([{key:"message",fn:function(e){var n=e.row;return[a("span",{staticStyle:{color:"#ea3636"}},[t._v(t._s(n.job_status?n.danger_num:"--"))]),t._v("/"),a("span",{staticStyle:{color:"#ff9c01"}},[t._v(t._s(n.job_status?n.warning_num:"--"))])]}},{key:"pass_rate",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(t.getPassRate(n)))])]}},{key:"job_result_status_name",fn:function(e){var n=e.row;return[a("span",{style:["成功"===n.job_result_status_name?{color:"#3fc06d"}:{color:"#ea3636"}]},[t._v(t._s(n.job_status?n.job_result_status_name:"--"))])]}},{key:"operation",fn:function(e){var n=e.row;return[a("div",[n.job_status?a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.isDisabled(n)},on:{click:function(e){return t.handleScan(n)}}}):a("bk-button",{staticClass:"mr10",staticStyle:{color:"#575961"},attrs:{theme:"primary",text:"",icon:"loading"}},[t._v("正在扫描")]),t._v(" "),a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.isDisabled(n)},on:{click:function(e){return t.handleCheck(n)}}},[t._v("详情")])],1)]}}])})],1)}),[],!1,null,"1528eb08",null).exports,T=a("UYCs"),P=a("X55p"),R=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),I=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},$=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chart=null,e.total=0,e}return R(e,t),e.prototype.changeNavToggle=function(){var t=this;this.chart&&setTimeout((function(){t.chart.forceFit()}),200)},e.prototype.changePieData=function(t){t&&this.initChart()},e.prototype.mounted=function(){this.initChart()},e.prototype.initChart=function(){var t=this.pieData,e=document.getElementById("survey-pie");if(!e)return!1;this.total=t.reduce((function(t,e){return t+e.value}),0);var a=this.$echarts.init(e);this.chart=a;var n={tooltip:{trigger:"item"},legend:{orient:"vertical",right:document.body.clientWidth>1500?"10%":"0",bottom:document.body.clientWidth>1500?"15%":"10%",selectedMode:!1,align:"left",itemWidth:8,itemHeight:8,itemGap:20,icon:"circle",textStyle:{color:"#979BA5",lineHeight:10},formatter:function(t){return t}},graphic:[{type:"text",left:"34%",top:"42%",z:10,style:{fill:"#000",fontSize:13,text:"资源总数",font:"30px Microsoft YaHei"}},{type:"text",left:"40%",top:"56%",z:10,style:{fill:"#000",text:"".concat(this.total),fontSize:15,font:"30px Microsoft YaHei"}}],series:[{name:"扫描结果",type:"pie",right:"20%",radius:["40%","60%"],avoidLabelOverlap:!0,label:{color:"#63656E",lineHeight:18,formatter:function(t){return"".concat(t.name.slice(0,4))}},tooltip:{formatter:function(t){return"<div><b>扫描结果：</b></div>".concat(t.name.slice(0,4)," ").concat(t.value,"台")}},itemStyle:{borderRadius:0,borderColor:"#fff",borderWidth:2,normal:{color:function(t){return["#33ce90","#f55066"][t.dataIndex]}}},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:t}]};window.addEventListener("resize",(function(){a.resize()})),n&&a.setOption(n)},I([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"pieData",void 0),I([Object(o.d)({type:Number,default:240})],e.prototype,"height",void 0),I([Object(o.d)({type:Boolean,default:!1})],e.prototype,"navToggle",void 0),I([Object(o.f)("navToggle",{immediate:!0})],e.prototype,"changeNavToggle",null),I([Object(o.f)("pieData")],e.prototype,"changePieData",null),e=I([Object(o.a)({name:"survey-pie"})],e)}(o.e),N=$,A=Object(p.a)(N,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{style:{height:t.height+"px"},attrs:{id:"survey-pie"}})}),[],!1,null,null,null).exports,E=a("wOnQ"),z=a.n(E),W=a("i680"),q=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),H=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},V=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},F=function(t,e){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},J=function(t,e,a){if(a||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},G=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icons=["icon-right-shape","icon-down-shape"],e.loading=!1,e.popLoading=!1,e.survey={health_measure_value:"--"},e.dataSet=[],e.currentType="全部",e.dataSetInfo=[],e.targetList=[{className:"danger",icon:"weops-danger",keyName:"危险",desc:"危险指标",color:"#ff4334"},{className:"warning",icon:"weops-early-warning",keyName:"警告",desc:"警告指标",color:"#ff8d09"},{className:"normal",icon:"weops-complete-fill",keyName:"正常",desc:"正常指标",color:"#33ce90"}],e.indexValuelist={},e.caseList=[],e.isPreview=!1,e}return q(e,t),Object.defineProperty(e.prototype,"dataInfo",{get:function(){var t=this;return this.currentType?"全部"===this.currentType?this.dataSetInfo:this.dataSetInfo.filter((function(e){return e.index_class===t.currentType})):this.dataSetInfo},enumerable:!1,configurable:!0}),e.prototype.onTaskRowChanged=function(t){t&&t.id&&this.getPreviewDetail({id:t.id})},e.prototype.toPreview=function(){this.isPreview=!this.isPreview;var t=document.querySelector("#host-detail"),e=t&&t.style;this.isPreview?e.cssText="position: fixed;z-index: 9999;top: 0; left: 0; width: 100vw; height: 100%; background: #fff; padding: 20px; overflow-y: scroll":e.cssText="background: #fff; border-radius: 4px;"},e.prototype.toDownload=function(){var t=this,e=this.taskRow.task_name,a="".concat(e,"的任务概览"),n=document.querySelector("#host-detail");n.style.height="initial",z()(n,{dpi:144,allowTaint:!0}).then((function(e){var n=e.width,i=e.height;n&&i||this.$error("转换pdf失败，请稍后再试");var r=n/595*842,s=i,o=0,c=595/n*i,l=e.toDataURL("image/jpeg",1),u=new W.a("","pt","a4");if(s<r)u.addImage(l,"JPEG",0,0,595,c);else for(;s>0;)u.addImage(l,"JPEG",0,o,595,c),o-=842,(s-=r)>0&&u.addPage();u.save(a+".pdf"),t.toPreview()}))},e.prototype.showIndexInfo=function(t,e){return V(this,void 0,void 0,(function(){var a,n,i;return F(this,(function(r){switch(r.label){case 0:a=t.job_task_record_id,this.popLoading=!0,n={job_task_record_id:a,index_key:e.index_key},r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getOverviewIndex(n)];case 2:return(i=r.sent()).result?(this.indexValuelist=i.data,[3,4]):(this.$error(i.message),this.indexValuelist={},[2]);case 3:return this.popLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.handleConfirm=function(t,e){this.$emit("close"),this.$router.push({name:"HealthInstDetail",query:{id:t.job_task_record_id,packageName:this.taskRow.package_name,taskName:this.taskRow.task_name,caseList:JSON.stringify(this.caseList)}})},e.prototype.handleCancel=function(){},e.prototype.getPercent=function(t){var e=t["正常"]/(t["正常"]+t["警告"]+t["危险"]);return isNaN(e)?0:+(100*e).toFixed()},e.prototype.getScanValClass=function(t,e){return e.compare_result?"normal-score":"危险"===t.risk_level?"danger-score":"warning-score"},e.prototype.getColumns=function(t){var e=t.dimension_list.map((function(t){return{key:t.dimension_key||t.key,label:t.dimension_name||t.name,minWidth:"160px"}}));return J(J([],e,!0),[{key:"index_label",label:t.index_name,scopedSlots:"index_label",minWidth:"160px"}],!1)},e.prototype.getTableData=function(t){var e=t.index_value_list||[];return e&&e.length&&e.forEach((function(e){e.index_label=e.index_value+t.unit,e.dimension_list.forEach((function(t){e[t.key]=t.value}))})),e},e.prototype.goAnchor=function(t){this.$el.querySelector(t).scrollIntoView()},e.prototype.getClass=function(t){return"success"===t.compare_result?"success-bg":"danger"===t.risk_rate?"danger-bg":"warning-bg"},e.prototype.healthColor=function(t){return"number"!=typeof t?"#ddd":t<60?"#f55066":t>=60&&t<=80?"#F3C9A4":"#7BE5BB"},e.prototype.getHealthTarget=function(t){this.currentType=t.index_Name},e.prototype.getPreviewDetail=function(t){var e=this,a=this.$api.healthAdvisor.getOverview(t),n=this.$api.healthAdvisor.getResourcesList(t);this.loading=!0,Promise.all([a,n]).then((function(t){e.dealData(t)})).finally((function(){e.loading=!1}))},e.prototype.dealData=function(t){var e=t[0],a=t[1];if(e.result&&a.result)return this.caseList=a.data.items,void this.fetchData(e.data);this.$message.error(e.result?a.message:e.message)},e.prototype.fetchData=function(t){var e=this;this.survey=t.risk_level_dict||{};var a=t.index_class_dict||[];this.dataSetInfo=t.index_list||[],this.dataSet=[{index_Name:"全部",danger_num:0,warning_num:0,normal_num:0},{index_Name:"可用性",danger_num:0,warning_num:0,normal_num:0},{index_Name:"性能",danger_num:0,warning_num:0,normal_num:0},{index_Name:"安全",danger_num:0,warning_num:0,normal_num:0}],this.dataSet.forEach((function(t){var n=a[t.index_Name];n&&(t.danger_num=n["危险"],t.warning_num=n["警告"],t.normal_num=n["正常"],e.dataSet[0].danger_num+=n["危险"],e.dataSet[0].warning_num+=n["警告"],e.dataSet[0].normal_num+=n["正常"])}));var n=t.resource_dict,i=n.fail,r=n.success,s=[{value:r,name:"扫描成功 ".concat(r,"台")},{value:i,name:"扫描失败 ".concat(i,"台")}];this.survey.pieData=s},H([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"taskRow",void 0),H([Object(o.f)("taskRow",{deep:!0,immediate:!0})],e.prototype,"onTaskRowChanged",null),e=H([Object(o.a)({name:"task-preview",components:{collapse:T.a,comTable:i.a,progressCard:P.a,surveyPie:A},filters:{formatVal:function(t){return t||0===t?t:"--"}}})],e)}(o.e),B=G,M=Object(p.a)(B,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"survey-common-detail",attrs:{id:"host-survey"}},[a("div",{staticClass:"cw-icon weops-download download-btn",on:{click:t.toPreview}}),t._v(" "),a("div",{attrs:{id:"host-detail"}},[t.isPreview?a("div",{staticClass:"detail-title"},[a("h2",[t._v("\n                "+t._s(t.taskRow.task_name)+"的任务概览\n            ")])]):t._e(),t._v(" "),a("div",{staticClass:"host-survey-header"},[a("div",{staticClass:"header-nav"}),t._v(" "),a("div",{staticClass:"survey-wrapper"},[a("bk-card",{staticClass:"survey-wrapper-rate",attrs:{title:"卡片标题","show-head":!1}},[a("div",{staticClass:"title"},[t._v("健康状况")]),t._v(" "),a("div",{staticClass:"survey-card-content"},[a("div",{staticClass:"source-wrapper"},[a("div",{staticClass:"source-container"},[a("progress-card",{attrs:{type:"dashboard",unit:"%",percentage:t.getPercent(t.survey),label:"通过率"}})],1)]),t._v(" "),a("ul",{staticClass:"index-wrap"},t._l(t.targetList,(function(e){return a("li",{key:e.keyName,class:e.className},[a("i",{class:["cw-icon",e.icon],style:{color:e.color}}),t._v(" "),a("span",[t._v(t._s(e.desc))]),t._v(" "),a("b",[t._v(t._s(t._f("formatVal")(t.survey[e.keyName])))])])})),0)])]),t._v(" "),a("div",{staticClass:"survey-wrapper-resource"},[a("div",{staticClass:"title"},[t._v("资源情况")]),t._v(" "),a("survey-pie",t._b({attrs:{height:180,"pie-data":t.survey.pieData}},"survey-pie",t.$attrs,!1))],1)],1)]),t._v(" "),a("div",{staticClass:"card-wrapper",attrs:{id:"config"}},[a("bk-card",{attrs:{"collapse-icons":t.icons,"show-head":!1}},[a("div",{staticClass:"card-content"},[a("div",{staticClass:"target-option-list"},[a("ul",t._l(t.dataSet,(function(e){return a("li",{key:e.index_Name,class:[t.currentType===e.index_Name&&"active"],on:{click:function(a){return t.getHealthTarget(e)}}},[a("b",{staticClass:"option-name"},[t._v(t._s(e.index_Name))]),t._v(" "),a("span",{staticClass:"option-data"},[a("span",[t._v("危险："+t._s(t._f("formatVal")(e.danger_num)))]),t._v(" "),a("span",[t._v("警告："+t._s(t._f("formatVal")(e.warning_num)))]),t._v(" "),a("span",[t._v("正常："+t._s(t._f("formatVal")(e.normal_num)))])])])})),0)]),t._v(" "),t.dataSetInfo&&t.dataSetInfo.length>0?[t._l(t.dataInfo,(function(e,n){return a("collapse",{key:"data_"+n,attrs:{"is-show":!e.compare_result}},[a("template",{slot:"title"},[e.compare_result?a("span",{staticClass:"success-sign"},[t._v("正常")]):a("span",{class:["危险"===e.risk_level?"danger-sign":"warning-sign"]},[t._v("\n                                        "+t._s(e.risk_level)+"\n                                    ")]),t._v(" "),a("b",[t._v(t._s(e.index_class+"-"+e.index_name))])]),t._v(" "),a("template",{slot:"subTitle"},[a("div",{staticClass:"content-row mb10"},[a("span",[t._v("指标介绍：")]),t._v(" "),a("span",{staticClass:"advice"},[t._v(t._s(e.index_introduction||"--"))])])]),t._v(" "),a("template",{slot:"content"},[a("div",{staticClass:"content-row mb10"},[a("span",[t._v("健康值：")]),t._v(" "),a("span",[t._v(t._s(e.operation_name+e.index_baseline+e.unit))])]),t._v(" "),e.compare_result?t._e():a("div",{staticClass:"content-row mb10"},[a("span",[t._v("治愈建议：")]),t._v(" "),a("span",{staticClass:"advice"},[t._v(t._s(""+e.cure_advice||"--"))])]),t._v(" "),a("div",{staticClass:"content-row mb10"},[a("span",[t._v("问题资源：")]),t._v(" "),a("ul",{staticClass:"content-row-list"},t._l(e.resources,(function(n){return a("bk-popconfirm",{key:n.bk_inst_id,attrs:{trigger:"click","confirm-text":"详情",placement:"top"},on:{confirm:function(e){return t.handleConfirm(n,t.dataInfo)},cancel:t.handleCancel}},[a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.popLoading,zIndex:2100},expression:"{ isLoading: popLoading, zIndex: 2100 }"}],staticStyle:{"margin-bottom":"20px"},attrs:{slot:"content"},slot:"content"},[a("span",[t._v("当前值：")]),t._v(" "),t.indexValuelist.dimension_list&&t.indexValuelist.dimension_list.length?[a("com-table",{key:t.indexValuelist.id,staticClass:"content-row-table",staticStyle:{width:"100%","margin-top":"10px"},attrs:{"with-border":!0,data:t.getTableData(t.indexValuelist),columns:t.getColumns(t.indexValuelist),"max-height":300},scopedSlots:t._u([{key:"index_label",fn:function(e){var n=e.row;return[a("span",{class:t.getScanValClass(t.indexValuelist,n)},[t._v(t._s(n.index_label))])]}}],null,!0)})]:[t.indexValuelist.index_value_list?a("span",{class:t.getScanValClass(t.indexValuelist,t.indexValuelist)},[t._v("\n                                                            "+t._s(t.indexValuelist.index_value_list[0]&&t.indexValuelist.index_value_list[0].index_value+t.indexValuelist.unit||"--")+"\n                                                        ")]):t._e()]],2),t._v(" "),a("li",{staticClass:"list-item",on:{click:function(a){return t.showIndexInfo(n,e)}}},[t._v("\n                                                    "+t._s(n.bk_inst_name)+"\n                                                ")])])})),1)])])],2)})),t._v(" "),t.dataInfo&&0===t.dataInfo.length&&!t.loading?[a("bk-exception",{staticClass:"exception-wrap-item exception-part",attrs:{type:"empty",scene:"part"}},[a("span",[t._v("\n                                    暂无数据\n                                ")])])]:t._e()]:t._e(),t._v(" "),t.dataSetInfo&&0===t.dataSetInfo.length&&!t.loading.diff?[a("bk-exception",{staticClass:"exception-wrap-item exception-part",attrs:{type:"empty",scene:"part"}},[a("span",[t._v("\n                                暂无数据\n                            ")])])]:t._e()],2)])],1)]),t._v(" "),t.isPreview?a("div",{staticClass:"preview-button"},[a("bk-button",{staticClass:"mr20",attrs:{theme:"primary"},on:{click:t.toDownload}},[t._v("导出")]),t._v(" "),a("bk-button",{staticClass:"mr20",attrs:{theme:"default"},on:{click:t.toPreview}},[t._v("取消")])],1):t._e()])}),[],!1,null,"bc0705d6",null).exports,U=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),K=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},Y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.panels=[{name:"baseInfo",label:"基本信息"},{name:"taskPreview",label:"任务概览"},{name:"instanceLsit",label:"实例列表"}],e.active="taskPreview",e}return U(e,t),e.prototype.toTabMenu=function(t){this.active=t.name},e.prototype.handleClose=function(){this.$emit("close")},e.prototype.refreshOutData=function(){this.$emit("refreshOutData")},K([Object(o.d)({type:Number,default:function(){return null}})],e.prototype,"taskId",void 0),K([Object(o.d)({type:String,default:function(){return"--"}})],e.prototype,"taskName",void 0),K([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"taskRow",void 0),e=K([Object(o.a)({components:{menuTab:h.a,baseInfo:k,instanceLsit:S,taskPreview:M}})],e)}(o.e),X=Y,Q=Object(p.a)(X,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[a("menu-tab",{staticClass:"tap",attrs:{panels:t.panels,type:"line","active-panel":t.active},on:{click:t.toTabMenu}}),t._v(" "),a("div",{staticClass:"content"},[a(t.active,{tag:"component",attrs:{"task-row":t.taskRow},on:{refreshOutData:t.refreshOutData,close:t.handleClose}})],1)],1)}),[],!1,null,"705c6aee",null).exports,Z=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),tt=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},et=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},at=function(t,e){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},nt=function(t,e,a){if(a||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},it=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDropdownShow=!1,e.visible=!1,e.title="编辑任务",e.taskId=null,e.taskRow={},e.frequencyList=[1,2,3,4,6,8,12],e.userLoading=!1,e.userData=[],e.rules={task_name:[{required:!0,message:"请输入任务名",trigger:"blur"}],bk_obj_id:[{required:!0,message:"请选择对象名称",trigger:"blur"}],scan_package_id:[{required:!0,message:"请选择扫描包",trigger:"blur"}]},e.formData={scan_package_id:"",task_name:"",scanPeriod:"close",beginTime:"00:00",frequency:1,scan_cycle:"",bk_obj_id:"",receiver:[]},e.copyFormData={},e.tableLoading=!1,e.dataList=[],e.copyDataList=[],e.columns=[{type:"selection"},{label:"资源标识",key:"bk_inst_name",minWidth:"200px"},{label:"所属应用",key:"bk_biz_name",minWidth:"200px"},{label:"参数凭证",key:"paramsCredit",prop:"paramsCredit",minWidth:"100px",scopedSlots:"paramsCredit"},{label:"操作",key:"operation",minWidth:"100px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:12,limit:20},e.voucher=[],e.fields=[],e.selectedTableData=[],e.filterData={},e.btnLoading=!1,e.pageLoading=!1,e.isLoadingDefaultParams=!1,e.isFirstRender=!0,e.isChangePakageList=!0,e.type="",e.relatedObjList=[],e.packageList=[],e}return Z(e,t),Object.defineProperty(e.prototype,"isDetail",{get:function(){return"check"===this.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEdit",{get:function(){return"edit"===this.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isParamsDisabled",{get:function(){return this.voucher&&!this.voucher.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAddDisabled",{get:function(){return!this.formData.scan_package_id||this.isLoadingDefaultParams},enumerable:!1,configurable:!0}),e.prototype.onScanPackageIdChanged=function(t){this.packageChange(t)},e.prototype.created=function(){return et(this,void 0,void 0,(function(){return at(this,(function(t){switch(t.label){case 0:return this.getRelatedObj(),[4,this.$store.dispatch("getAllUserList")];case 1:return t.sent(),this.userData=sessionStorage.getItem("allUserData")?JSON.parse(sessionStorage.getItem("allUserData")):[],[2]}}))}))},e.prototype.relatedObjChange=function(t){this.packageList=[],this.isChangePakageList&&t&&(this.formData.scan_package_id="",this.getscanPackage({bk_obj_id:t,page_size:-1})),this.isChangePakageList=!0},e.prototype.refreshOutData=function(){this.$emit("refreshTable")},e.prototype.packageChange=function(t){t&&this.packageList&&this.packageList.length&&this.getDefaultParamsList(t),this.isFirstRender&&(this.dataList=[]),this.isFirstRender=!0},e.prototype.getConfigStyle=function(t){var e={color:"#3fc06d"};if(t.parameter_credentials){var a=t.parameter_credentials.every((function(t){return t.value||0===t.value})),n=t.parameter_credentials.some((function(t){return t.value||0===t.value}));a||(e=n?{color:"#fab5ac"}:{color:"#ea3636"})}return e},e.prototype.handleClose=function(){var t=this;JSON.stringify(this.copyFormData)+JSON.stringify(this.copyDataList)===JSON.stringify(this.formData)+JSON.stringify(this.dataList)||this.isDetail?this.commonHandleHide():this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.commonHandleHide()}})},e.prototype.commonHandleHide=function(){this.formData={scan_package_id:"",task_name:"",scanPeriod:"close",beginTime:"00:00",frequency:1,scan_cycle:"",bk_obj_id:"",receiver:[]},this.voucher=[],this.dataList=[],this.copyDataList=[],this.selectedTableData=[],this.packageList=[],this.visible=!1},e.prototype.batchDelete=function(){var t=this;this.selectedTableData.forEach((function(e){t.dataList.forEach((function(a,n){e.bk_inst_id===a.bk_inst_id&&t.dataList.splice(n,1)}))}))},e.prototype.handleConfirm=function(){var t=this,e=this.getParams();this.$refs.validateForm.validate().then((function(a){t.dataList.length?t.isAdd?t.createTaskRequest(e):t.$bkInfo({title:"提示",subTitle:"编辑后，该任务的执行记录将被清除",theme:"primary",confirmFn:function(){t.createTaskRequest(e)}}):t.$error("资源列表不能为空！")}))},e.prototype.getRelatedObj=function(){return et(this,void 0,void 0,(function(){var t;return at(this,(function(e){switch(e.label){case 0:return[4,this.$api.healthAdvisor.getRelatedObj()];case 1:return(t=e.sent()).result?(this.relatedObjList=t.data,[2]):(this.relatedObjList=[],this.$message.error(t.message),[2])}}))}))},e.prototype.getscanPackage=function(t){return et(this,void 0,void 0,(function(){var e;return at(this,(function(a){switch(a.label){case 0:this.pageLoading=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getscanPackage(t)];case 2:return(e=a.sent()).result?(this.packageList=e.data.items,this.formData.scan_package_id&&this.getDefaultParamsList(this.formData.scan_package_id),[2]):(this.packageList=[],this.$message.error(e.message),[3,4]);case 3:return this.pageLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this,e={};e.task_name=this.formData.task_name,e.scan_package_id=this.formData.scan_package_id,e.bk_obj_id=this.formData.bk_obj_id,e.receiver=this.formData.receiver;var a=this.formData.scanPeriod,n={value_type:a};switch(a){case"cycle":n.value=this.formData.frequency;break;case"timing":n.value=this.formData.beginTime;break;default:n.value=""}return e.scan_cycle=n,this.dataList.forEach((function(e){var a=t.copyDataList.find((function(t){return t.bk_inst_id===e.bk_inst_id}));a&&(e.id=a.id)})),e.resources=this.dataList,this.isEdit&&(e.id=this.taskId),e},e.prototype.createTaskRequest=function(t){return et(this,void 0,void 0,(function(){var e;return at(this,(function(a){switch(a.label){case 0:this.btnLoading=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.healthAdvisor[this.isEdit?"editTask":"createTask"](t)];case 2:return(e=a.sent()).result?(this.$message.success("操作成功"),this.visible=!1,this.refreshOutData(),[3,4]):(this.$message.error(e.message),[2]);case 3:return this.btnLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getConfig=function(t,e){var a=this.filterData=this.packageList.find((function(e){return e.id===t}));this.fields=a.show_fields,e.length?this.voucher=e:(this.voucher=a.obj_param_voucher,this.voucher.forEach((function(t){t.value=""})))},e.prototype.getCreditParams=function(t){if(Object(s.isArray)(t))this.dataList.forEach((function(e){var a=t.find((function(t){return e.bk_inst_id===t.bk_inst_id}));a&&(e=a)}));else{var e=this.dataList.findIndex((function(e){return e.bk_inst_id===t.bk_inst_id}));-1!==e&&(this.dataList[e]=t)}this.dataList=nt([],this.dataList,!0)},e.prototype.getDefaultParamsList=function(t){return et(this,void 0,void 0,(function(){var e;return at(this,(function(a){switch(a.label){case 0:this.isLoadingDefaultParams=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getDefaultParams({id:t})];case 2:return(e=a.sent()).result?(this.packageList&&this.packageList.length&&this.getConfig(t,e.data),[3,4]):(this.$message.error(e.message),[2]);case 3:return this.isLoadingDefaultParams=!1,[7];case 4:return[2]}}))}))},e.prototype.comfirmSelectResource=function(t){this.dataList=t},e.prototype.showTaskDialog=function(t,e){this.type=t,this.title="add"===t?"创建任务":"check"===t?"任务详情":"编辑任务",this.taskId=e?e.id:null,this.taskRow=e,this.copyFormData=this.$copy(this.formData),"edit"===t&&this.getTaskDetail({id:this.taskId}),this.visible=!0},e.prototype.getTaskDetail=function(t){var e=this;this.isChangePakageList=!1;var a=this.$api.healthAdvisor.getTaskDetail(t),n=this.$api.healthAdvisor.getResourcesList(t);this.pageLoading=!0,this.isFirstRender=!1,Promise.all([a,n]).then((function(t){e.dealData(t)})).catch((function(){e.pageLoading=!1}))},e.prototype.dealData=function(t){var e=this,a=t[0],n=t[1];if(a.result&&n.result){Object.assign(this.formData,a.data);var i=a.data.scan_cycle,r=i.value_type,s=i.value;switch(this.formData.scanPeriod=r,r){case"timing":this.formData.beginTime=s;break;case"cycle":this.formData.frequency=s}return n.data.items.forEach((function(t){t.parameter_credentials=t.parameter_credentials||e.voucher})),this.dataList=n.data.items,this.copyDataList=this.$copy(this.dataList),this.pagination.count=n.data.count,this.copyFormData=this.$copy(this.formData),this.formData.bk_obj_id?void this.getscanPackage({bk_obj_id:this.formData.bk_obj_id,page_size:-1}):void(this.pageLoading=!1)}this.pageLoading=!1,this.$message.error(a.result?n.message:a.message)},e.prototype.addResource=function(){var t={search_fields:this.filterData.search_fields,bk_obj_id:this.filterData.bk_obj_id,bk_os_type:this.filterData.bk_os_type};this.$refs.addResourceDialog.show(this.fields,this.dataList,this.voucher,t)},e.prototype.handlePageChange=function(t){this.pagination.current=t},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t},e.prototype.selectTableData=function(t){this.selectedTableData=t},e.prototype.selectAllTableData=function(t){this.selectedTableData=t},e.prototype.deleteResource=function(t){var e=this.dataList.findIndex((function(e){return e.bk_inst_id===t.bk_inst_id}));-1!==e&&this.dataList.splice(e,1)},e.prototype.handleSetting=function(t){this.isParamsDisabled||this.$refs.addCreditDialog.showTaskDialog(t)},tt([Object(o.d)({type:String,default:function(){return""}})],e.prototype,"maskId",void 0),tt([Object(o.f)("formData.scan_package_id",{immediate:!0,deep:!0})],e.prototype,"onScanPackageIdChanged",null),e=tt([Object(o.a)({components:{addResourceDialog:r.a,comTable:i.a,addCreditDialog:f,taskDetail:Q}})],e)}(o.e),rt=it,st=Object(p.a)(rt,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("bk-sideslider",{attrs:{"is-show":t.visible,"quick-close":!0,width:900,"ext-cls":"common-dialog-wrapper","before-close":t.handleClose},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.title)),t.isDetail?a("span",{staticClass:"sub-title"},[t._v(t._s(" - "+t.taskRow.task_name))]):t._e()]),t._v(" "),t.isDetail?a("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[a("task-detail",{attrs:{"task-name":t.taskRow.task_name,"task-id":t.taskId,"task-row":t.taskRow},on:{refreshOutData:t.refreshOutData,close:function(e){t.visible=!1}}})],1):a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[a("bk-form",{ref:"validateForm",staticClass:"task-form",attrs:{"label-width":94,model:t.formData,rules:t.rules}},[a("bk-form-item",{attrs:{label:"任务名：",required:!0,property:"task_name"}},[a("bk-input",{attrs:{placeholder:"请输入任务名称",clearable:"",disabled:t.isEdit},model:{value:t.formData.task_name,callback:function(e){t.$set(t.formData,"task_name",e)},expression:"formData.task_name"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"对象名称：",required:!0,property:"bk_obj_id"}},[a("bk-select",{attrs:{searchable:"",placeholder:"请输入选择对象名称",disabled:t.isEdit},on:{change:t.relatedObjChange},model:{value:t.formData.bk_obj_id,callback:function(e){t.$set(t.formData,"bk_obj_id",e)},expression:"formData.bk_obj_id"}},t._l(t.relatedObjList,(function(t){return a("bk-option",{key:t.bk_obj_id,attrs:{id:t.bk_obj_id,name:t.bk_obj_name}})})),1)],1),t._v(" "),t.packageList&&t.packageList.length?a("bk-form-item",{attrs:{label:"扫描包：",required:!0,property:"scan_package_id"}},[a("bk-select",{attrs:{searchable:"",placeholder:"请输入选择扫描包",disabled:t.isEdit},model:{value:t.formData.scan_package_id,callback:function(e){t.$set(t.formData,"scan_package_id",e)},expression:"formData.scan_package_id"}},t._l(t.packageList,(function(t){return a("bk-option",{key:t.id,attrs:{id:t.id,name:t.package_name}})})),1)],1):t._e(),t._v(" "),a("bk-form-item",{attrs:{label:"邮件通知：",required:!1,property:"receiver"}},[a("bk-select",{staticStyle:{width:"100%"},attrs:{multiple:"",searchable:"","id-key":"key",list:t.userData,disabled:t.userLoading,"enable-virtual-scroll":"","search-placeholder":"请输入选择邮件通知人","display-key":"displayKey","search-with-pinyin":!0,"ext-popover-cls":"select-popover-custom","popover-options":{appendTo:"parent"}},model:{value:t.formData.receiver,callback:function(e){t.$set(t.formData,"receiver",e)},expression:"formData.receiver"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"扫描周期：",required:!0}},[a("bk-radio-group",{model:{value:t.formData.scanPeriod,callback:function(e){t.$set(t.formData,"scanPeriod",e)},expression:"formData.scanPeriod"}},[a("div",{staticClass:"radio-item"},[a("bk-radio",{attrs:{value:"timing"}},[t._v("每天一次，在\n                                "),a("bk-time-picker",{staticStyle:{"margin-left":"4px"},attrs:{clearable:!1,placeholder:"选择时间",transfer:"","ext-popover-cls":"custom-popover-cls",format:"HH:mm"},model:{value:t.formData.beginTime,callback:function(e){t.$set(t.formData,"beginTime",e)},expression:"formData.beginTime"}})],1)],1),t._v(" "),a("div",{staticClass:"radio-item"},[a("bk-radio",{attrs:{value:"cycle"}},[t._v("每")]),t._v(" "),a("bk-select",{staticStyle:{width:"64px",margin:"0 4px"},attrs:{clearable:!1,placeholder:"请选择"},model:{value:t.formData.frequency,callback:function(e){t.$set(t.formData,"frequency",e)},expression:"formData.frequency"}},t._l(t.frequencyList,(function(t){return a("bk-option",{key:"option"+t,attrs:{id:t,name:t}})})),1),a("span",{staticStyle:{"font-size":"14px"}},[t._v("小时一次")])],1),t._v(" "),a("div",{staticClass:"radio-item"},[a("bk-radio",{attrs:{value:"close"}},[t._v("不开启周期扫描")])],1)])],1),t._v(" "),a("bk-form-item",{attrs:{label:"资源选择：",required:!0}},[a("bk-button",{attrs:{theme:"primary",disabled:t.isAddDisabled},on:{click:t.addResource}},[t._v("\n                        新增\n                    ")]),t._v(" "),a("bk-dropdown-menu",{ref:"dropdown",attrs:{disabled:!t.selectedTableData.length},on:{show:function(e){t.isDropdownShow=!0},hide:function(e){t.isDropdownShow=!1}}},[a("div",{staticClass:"dropdown-trigger-btn",staticStyle:{"padding-left":"19px"},attrs:{slot:"dropdown-trigger"},slot:"dropdown-trigger"},[a("span",[t._v("批量操作")]),t._v(" "),a("i",{class:["bk-icon icon-angle-down",{"icon-flip":t.isDropdownShow}]})]),t._v(" "),a("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[a("li",[a("a",{class:t.isParamsDisabled&&"params-disabled",on:{click:function(e){return t.handleSetting(t.selectedTableData)}}},[t._v("配置参数")])]),t._v(" "),a("li",[a("a",{on:{click:t.batchDelete}},[t._v("移除")])])])])],1)],1),t._v(" "),a("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"healthTable",attrs:{data:t.dataList,columns:t.columns},on:{select:t.selectTableData,"select-all":t.selectAllTableData},scopedSlots:t._u([{key:"paramsCredit",fn:function(e){var n=e.row;return[a("bk-button",{staticClass:"mr10",style:t.getConfigStyle(n),attrs:{theme:"primary",text:"",disabled:t.isParamsDisabled},on:{click:function(e){return t.handleSetting(n)}}},[t._v("配置")])]}},{key:"operation",fn:function(e){var n=e.row;return[a("div",[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.deleteResource(n)}}},[t._v("移除")])],1)]}}])})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[t.isDetail?t._e():a("bk-button",{staticClass:"mr20",attrs:{theme:"primary",loading:t.btnLoading,disabled:t.pageLoading},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleConfirm.apply(null,arguments)}}},[t._v("\n                确定\n            ")]),t._v(" "),t.isDetail?a("bk-button",{attrs:{theme:"default"},on:{click:function(e){t.visible=!1}}},[t._v("关闭")]):a("bk-button",{attrs:{theme:"default"},on:{click:t.handleClose}},[t._v("取消")])],1)]),t._v(" "),a("add-resource-dialog",{ref:"addResourceDialog",on:{addHostNextStep:t.comfirmSelectResource}}),t._v(" "),a("add-credit-dialog",{ref:"addCreditDialog",on:{getCreditParams:t.getCreditParams}})],1)}),[],!1,null,"525ee3cd",null),ot=st.exports,ct=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),lt=function(t,e,a,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,a,s):i(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s},ut=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},dt=function(t,e){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},pt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scanPackageList=[],e.packageIds=[],e.tableLoading=!1,e.dataList=[],e.columns=[{label:"任务名称",key:"task_name",minWidth:"180px"},{label:"扫描包",key:"package_name",minWidth:"180px"},{label:"创建人",key:"chname",minWidth:"100px"},{label:"资源数量",key:"resource_num",minWidth:"80px"},{label:"检查项",key:"index_num",minWidth:"60px"},{label:"危险数/警告数",key:"dangerAndWarnCount",scopedSlots:"dangerAndWarnCount",minWidth:"120px"},{label:"通过率",key:"pass_rate",minWidth:"80px",scopedSlots:"pass_rate",sortable:"custom"},{label:"最近扫描时间",key:"last_scan_time",minWidth:"180px",sortable:"custom"},{label:"操作",key:"operation",width:"220px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:20},e.sortParams={reverse:"true"},e.scanTimer=null,e.maskId="",e.maxHeight="",e}return ct(e,t),e.prototype.beforeRouteLeave=function(t,e,a){this.$handleKeepAlive(t,e),a()},e.prototype.mounted=function(){var t=this;this.getScanPackageList(),this.getScanTask();this.maxHeight=window.innerHeight-238,window.onresize=function(){t.maxHeight=window.innerHeight-238}},e.prototype.destroyed=function(){this.closeInterval()},e.prototype.isDisabled=function(t){return!t.task_status},e.prototype.getPassRate=function(t){return"--"!==t.pass_rate&&t.task_status?"".concat(t.pass_rate,"%"):"--"},e.prototype.sortChange=function(t){var e=t.prop,a=t.order;this.pagination.current=1,this.sortParams.order=e,this.sortParams.reverse="ascending"!==a,this.getScanTask()},e.prototype.getScanPackageList=function(){return ut(this,void 0,void 0,(function(){var t;return dt(this,(function(e){switch(e.label){case 0:return[4,this.$api.healthAdvisor.getscanPackage({page_size:-1})];case 1:return(t=e.sent()).result&&(this.scanPackageList=t.data.items),[2]}}))}))},e.prototype.getScanTask=function(t){return void 0===t&&(t=!1),ut(this,void 0,void 0,(function(){var e,a;return dt(this,(function(n){switch(n.label){case 0:this.closeInterval(),e=this.getParams(),this.tableLoading=!t,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getScanTask(e)];case 2:return(a=n.sent()).result?(this.dataList=a.data.items,this.pagination.count=a.data.count,!a.data.items.every((function(t){return t.task_status}))&&this.refreshScanStatus(),[3,4]):(this.$error(a.message),this.dataList=[],[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this.pagination,e={page_size:t.limit,page:t.current,scan_package:this.packageIds.join(",")};return Object.assign(e,this.sortParams),e},e.prototype.taskOperation=function(t,e){void 0===e&&(e={}),this.btnForbidden&&"check"!==t||this.$refs.taskDialog.showTaskDialog(t,e)},e.prototype.handleDelete=function(t){var e=this;this.btnForbidden||this.$bkInfo({title:"确定删除该任务？",subTitle:"删除后无法恢复",theme:"primary",confirmFn:function(){e.confirmDeleteTask(t)}})},e.prototype.confirmDeleteTask=function(t){var e=t.id;return ut(this,void 0,void 0,(function(){var t;return dt(this,(function(a){switch(a.label){case 0:return this.tableLoading=!0,[4,this.$api.healthAdvisor.deleteTask({id:e})];case 1:return(t=a.sent()).result?(this.$message.success("删除成功"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getScanTask(),[2]):(this.$message.error(t.message),this.tableLoading=!1,[2])}}))}))},e.prototype.handleScan=function(t){return ut(this,void 0,void 0,(function(){var e,a;return dt(this,(function(n){switch(n.label){case 0:return this.btnForbidden?[2]:(this.$set(t,"task_status",!1),e=t.id,[4,this.$api.healthAdvisor.scanTaskRun({id:e})]);case 1:return(a=n.sent()).result?(this.getScanTask(),[2]):(this.$set(t,"task_status",!0),this.$message.error(a.message),[2])}}))}))},e.prototype.refreshScanStatus=function(){var t=this;this.closeInterval(),this.scanTimer=setInterval((function(){t.getScanTask(!0)}),1e4)},e.prototype.closeInterval=function(){this.scanTimer&&clearInterval(this.scanTimer)},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getScanTask()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getScanTask()},e=lt([Object(o.a)({name:"health-advisor",components:{comTable:i.a,taskDialog:ot},mixins:[w.a]})],e)}(o.e),ft=pt,ht=Object(p.a)(ft,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"base-line-scan"},[a("div",{staticClass:"nav-area"},[a("bk-select",{staticStyle:{width:"250px"},attrs:{disabled:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",placeholder:"请选择扫描包",searchable:"",multiple:""},on:{change:function(e){return t.getScanTask(!1)}},model:{value:t.packageIds,callback:function(e){t.packageIds=e},expression:"packageIds"}},t._l(t.scanPackageList,(function(t){return a("bk-option",{key:t.id,attrs:{id:t.id,name:t.package_name}})})),1),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.taskOperation("add")}}},[t._v("\n            创建任务\n        ")])],1),t._v(" "),a("div",{staticClass:"table-area"},[a("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"healthTable",staticClass:"common-table-max-height",attrs:{data:t.dataList,columns:t.columns,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange,"sort-change":t.sortChange},scopedSlots:t._u([{key:"pass_rate",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(t.getPassRate(n)))])]}},{key:"dangerAndWarnCount",fn:function(e){var n=e.row;return[a("span",{staticStyle:{color:"#ea3636"}},[t._v(t._s(n.task_status?n.danger_num:"--"))]),t._v("/"),a("span",{staticStyle:{color:"#ff9c01"}},[t._v(t._s(n.task_status?n.warning_num:"--"))])]}},{key:"operation",fn:function(e){var n=e.row;return[a("div",{staticStyle:{display:"flex"}},[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:"--"===n.last_scan_time},on:{click:function(e){return t.taskOperation("check",n)}}},[t._v("详情")]),t._v(" "),t.isDisabled(n)?a("div",[a("bk-spin",{attrs:{size:"mini"}}),t._v(" "),a("bk-button",{staticClass:"mr10",staticStyle:{color:"#575961"},attrs:{theme:"primary",text:""}},[t._v("正在扫描")])],1):a("div",[a("span",{staticStyle:{display:"inline-block",width:"16px",height:"16px"}}),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleScan(n)}}},[t._v("\n                            立即扫描\n                        ")])],1),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.isDisabled(n)},on:{click:function(e){return t.taskOperation("edit",n)}}},[t._v("\n                        编辑\n                    ")]),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.isDisabled(n)},on:{click:function(e){return t.handleDelete(n)}}},[t._v("\n                        删除\n                    ")])],1)]}}])})],1),t._v(" "),a("task-dialog",{ref:"taskDialog",attrs:{"package-list":t.scanPackageList,"mask-id":t.maskId},on:{refreshTable:function(e){return t.getScanTask(!1)}}})],1)}),[],!1,null,"56ffca73",null);e.default=ht.exports}}]);