(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"6DX3":function(e,t,n){"use strict";n.r(t);var o,i=n("rEAq"),a=n("G0B5"),r=(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.icons=["icon-right-shape","icon-down-shape"],t.infoData=[],t.appResourceData=JSON.parse(sessionStorage.getItem("appResourceData")),t.customFields="",t.baseInfoLoading=!1,t.subApplicationMapField=[{before:"biz_maintainer",after:"bk_biz_maintainer"},{before:"biz_productor",after:"bk_biz_productor"},{before:"biz_tester",after:"bk_biz_tester"},{before:"biz_developer",after:"bk_biz_developer"},{before:"bk_inst_name",after:"bk_biz_name"}],t.userLoading=!1,t.cycleEdit=!1,t.isExpand=!1,t.tagColor={1:"warning",2:"success",3:"danger"},t.userData=[],t}return r(t,e),Object.defineProperty(t.prototype,"lifeCycle",{get:function(){return!!this.customFields&&this.customFields.find((function(e){return"life_cycle"===e.bk_property_id}))},enumerable:!1,configurable:!0}),t.prototype.destroyed=function(){this.$bus.$off("updateCycle")},t.prototype.mounted=function(){var e=this;this.$bus.$on("updateCycle",(function(t){e.appResourceData=JSON.parse(sessionStorage.getItem("appResourceData")),e.handleFieldData()})),sessionStorage.getItem("customFields")?(this.customFields=JSON.parse(sessionStorage.getItem("customFields")),this.handleFieldData()):this.getAppCustomFields(),this.userData=sessionStorage.getItem("allUserData")?JSON.parse(sessionStorage.getItem("allUserData")):[]},t.prototype.expand=function(){this.isExpand=!this.isExpand,this.$bus.$emit("getAppHeight")},t.prototype.getShowValue=function(e){return e.showValue?e.option&&e.option.length>0?this.getEnumerateValue(e):e.showValue:"--"},t.prototype.getAppCustomFields=function(){var e=this;this.baseInfoLoading=!0,this.$api.Resource.getApplyCustomFields().then((function(t){t.result&&(sessionStorage.setItem("customFields",JSON.stringify(t.data.all_field)),e.customFields=t.data.all_field,e.handleFieldData())})).finally((function(){e.baseInfoLoading=!1}))},t.prototype.handleFieldData=function(){var e=this;this.customFields.forEach((function(t){var n=e.infoData.findIndex((function(e){return e.title===t.bk_property_group_name}));e.$set(t,"isEditStatus",!1),e.$set(t,"showValue",e.appResourceData[t.bk_property_id]),e.$set(t,"editValue",""),-1===n?e.infoData.push({title:t.bk_property_group_name,children:[t]}):e.infoData[n].children.push(t)}))},t.prototype.handleInfoData=function(e,t){this.infoData.forEach((function(n){n.children&&n.children.length&&n.children.forEach((function(n){"objuser"===n.bk_property_type&&("error"===e?n.editable=!1:n.userData=t.data.items.filter((function(e){return e.bk_username})).map((function(e){return{key:e.bk_username,display:e.bk_username}})))}))}))},t.prototype.getEnumerateValue=function(e){return e.option.find((function(t){return t.id===e.showValue})).name},t.prototype.goAppTopology=function(){this.$router.push({name:"AppTopology",query:{type:"app",bizId:this.$route.query.appId}})},t.prototype.editInfo=function(e,t){var n=this;if(this.cycleEdit=!1,"edit"===t)this.$set(e,"isEditStatus",!0),"objuser"===e.bk_property_type?this.$set(e,"editValue",e.showValue?e.showValue.split(","):""):this.$set(e,"editValue",e.showValue);else if("confirm"===t){this.$set(e,"isEditStatus",!0),this.baseInfoLoading=!0;var o="",i="",a="";if(o="objuser"===e.bk_property_type?e.editValue?e.editValue.join(","):"":"int"===e.bk_property_type?e.editValue&&Number(e.editValue):e.editValue,this.$route.query.parentName){a="modifyOtherSrcDetail";var r=this.subApplicationMapField.find((function(t){return t.after===e.bk_property_id}));i=r?r.before:e.bk_property_id}else a="modifyAppDetail",i=e.bk_property_id;var s={bk_biz_id:this.appResourceData.bk_biz_id,bk_obj_id:this.appResourceData.bk_obj_id,bk_inst_id:this.appResourceData.bk_inst_id,body:{data:[{key:i,value:o,type:e.bk_property_type}]}};this.$api.Resource[a](s).then((function(t){if(t.result)for(var a in n.$success("修改成功"),n.appResourceData)a===i&&(n.$set(e,"isEditStatus",!1),n.appResourceData[a]=o,n.$set(e,"showValue",o),sessionStorage.setItem("appResourceData",JSON.stringify(n.appResourceData)));else n.$error(t.message)})).finally((function(){n.baseInfoLoading=!1,n.$set(e,"isEditStatus",!1),n.$set(e,"editValue","")}))}else this.$set(e,"isEditStatus",!1),this.$set(e,"editValue","")},t=s([Object(a.a)({name:"app-base-info",components:{timezone:i.a}})],t)}(a.e),l=c,p=n("KHd+"),d=Object(p.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.baseInfoLoading,zIndex:10},expression:"{ isLoading: baseInfoLoading, zIndex: 10 }"}],staticClass:"app-base-info",style:{paddingBottom:e.isExpand?0:"12px"},attrs:{id:"appBaseInfo"}},[n("div",{staticClass:"application-card-wrapper"},[n("div",{staticClass:"content-box-title"},[n("span",{staticClass:"title"},[e._v("\n                "+e._s(e.$route.query.appName)+"\n            ")]),e._v(" "),e.lifeCycle?[e.cycleEdit?n("div",{staticClass:"life-cycle-edit"},[n("bk-select",{staticStyle:{width:"98px",display:"inline-block"},attrs:{clearable:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},model:{value:e.lifeCycle.editValue,callback:function(t){e.$set(e.lifeCycle,"editValue",t)},expression:"lifeCycle.editValue"}},e._l(e.lifeCycle.option,(function(e){return n("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),n("span",{staticClass:"confirm-or-cancel"},[n("bk-icon",{staticClass:"operate-icon-left",staticStyle:{"font-size":"20px",color:"#3A84FF"},attrs:{type:"check-1"},on:{click:function(t){return t.stopPropagation(),e.editInfo(e.lifeCycle,"confirm")}}}),e._v(" "),n("bk-icon",{staticClass:"operate-icon-right",staticStyle:{"font-size":"20px",color:"#3A84FF"},attrs:{type:"close"},on:{click:function(t){return t.stopPropagation(),e.editInfo(e.lifeCycle,"cancel")}}})],1)],1):[n("bk-tag",{attrs:{theme:e.tagColor[e.lifeCycle.showValue]}},[e._v(e._s(e.getShowValue(e.lifeCycle)))])]]:e._e(),e._v(" "),n("bk-button",{on:{click:e.goAppTopology}},[e._v("应用拓扑")])],2),e._v(" "),e.isExpand?e._l(e.infoData,(function(t,o){return n("div",{key:o,staticClass:"info-box"},[n("div",{staticClass:"info-body"},[t.children&&t.children.length>0?n("div",[0===o?n("div",{staticClass:"info-body-list"},[n("span",{staticClass:"label"},[e._v("拓扑信息:")]),e._v(" "),n("div",{staticClass:"no-edit-status"},[n("span",{staticClass:"value"},[e._v("\n                                    "+e._s(e.$route.query.parentName?e.$route.query.parentName+">"+e.appResourceData.bk_biz_name:e.appResourceData.bk_biz_name)+"\n                                ")])])]):e._e(),e._v(" "),e._l(t.children,(function(o,i){return n("div",{key:i,class:["info-body-list",i+1===t.children.length&&"no-border"]},[n("span",{staticClass:"label"},[e._v(e._s(o.bk_property_name+":"))]),e._v(" "),o.isEditStatus?e._e():n("div",{staticClass:"no-edit-status"},[n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"value"},[e._v("\n                                    "+e._s(e.getShowValue(o))+"\n                                ")]),e._v(" "),o.editable?n("span",{staticClass:"edit-span"},[n("bk-icon",{staticClass:"operate-icon-edit",attrs:{title:"编辑",type:"edit2"},on:{click:function(t){return e.editInfo(o,"edit")}}})],1):e._e()]),e._v(" "),o.isEditStatus&&o.editable?n("div",{staticClass:"edit-status"},["date"===o.bk_property_type?n("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择日期时间",type:"datetime"},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}}):"time"===o.bk_property_type?n("bk-time-picker",{attrs:{placeholder:"选择时间",transfer:"","ext-popover-cls":"custom-popover-cls"},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}}):["enum","list"].includes(o.bk_property_type)?n("bk-select",{staticStyle:{width:"100px"},attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:""},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}},e._l(o.option,(function(e){return n("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1):"bool"===o.bk_property_type?n("bk-switcher",{attrs:{theme:"primary"},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}}):"timezone"===o.bk_property_type?n("timezone",{staticStyle:{width:"100px"},attrs:{placeholder:o.placeholder},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}}):"objuser"===o.bk_property_type?n("bk-select",{staticStyle:{width:"100px"},attrs:{multiple:"",searchable:"","id-key":"key",list:e.userData,disabled:e.userLoading,"enable-virtual-scroll":"","search-placeholder":"请输入","ext-cls":"select-custom","display-key":"display","search-with-pinyin":!0,"ext-popover-cls":"select-popover-custom"},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}}):n("bk-input",{attrs:{clearable:!0,type:["int","float"].includes(o.bk_property_type)?"number":"text",precision:"int"===o.bk_property_type?0:2},model:{value:o.editValue,callback:function(t){e.$set(o,"editValue",t)},expression:"tex.editValue"}}),e._v(" "),n("span",{staticClass:"confirm-or-cancel"},[n("bk-icon",{staticClass:"operate-icon-left",staticStyle:{"font-size":"20px",color:"#3A84FF"},attrs:{type:"check-1"},on:{click:function(t){return e.editInfo(o,"confirm")}}}),e._v(" "),n("bk-icon",{staticClass:"operate-icon-right",staticStyle:{"font-size":"20px",color:"#3A84FF"},attrs:{type:"close"},on:{click:function(t){return e.editInfo(o,"cancel")}}})],1)],1):e._e()])}))],2):e._e()])])})):e._e()],2)])}),[],!1,null,"a0010f00",null).exports,u=n("7L1V"),f=n("3Sh2"),b=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeLoading=!1,t.infoLoading=!1,t.groupTypeList=[],t.groupArr=[],t.formData={},t.isEditModel=!1,t.nodeData="",t.userData=[],t.userLoading=!1,t.rules={},t.objId="",t.instId="",t.parentId="",t}return b(t,e),Object.defineProperty(t.prototype,"isBlueKing",{get:function(){return[1,2].includes(+this.$route.query.appId)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.meta.activeMenu,type:"operateAuth"}},enumerable:!1,configurable:!0}),t.prototype.mounted=function(){this.userData=sessionStorage.getItem("allUserData")?JSON.parse(sessionStorage.getItem("allUserData")):[]},t.prototype.editNodeInfo=function(){var e=this;if(!this.$BtnPermission(this.powerParams))return!1;this.isEditModel?this.$refs.validateForm.validate().then((function(t){var n=e.$deepClone(e.formData),o=function(t){var o=e.groupArr.find((function(e){return e.bk_property_id===t}));o&&"objuser"===o.bk_property_type&&n[t]&&(n[t]=n[t].join(",")),o&&["int","float"].includes(o.bk_property_type)&&n[t]&&(n[t]=Number(n[t]))};for(var i in n)o(i);var a={bk_biz_id:e.$route.query.appId,data:{bk_obj_id:e.objId,bk_parent_id:e.parentId,bk_node_id:e.instId,obj_attr:{}}};for(var r in n)n[r]!==e.nodeData[r]&&"topology"!==r&&(a.data.obj_attr[r]="[object Date]"===Object.prototype.toString.call(n[r])?e.$formatDate(n[r]):n[r]);e.nodeLoading=!0,e.$api.Resource.modifyNodeAttr(a).then((function(t){if(!t.result)return e.$error(t.message),!1;if(e.getNodeDetail(e.objId,e.instId),e.isEditModel=!1,e.$success("信息修改成功！"),e.instId===Number(e.$route.query.appId)&&a.data.obj_attr.life_cycle){var n=JSON.parse(sessionStorage.getItem("appResourceData"));n.life_cycle=a.data.obj_attr.life_cycle,sessionStorage.setItem("appResourceData",JSON.stringify(n)),e.$bus.$emit("updateCycle",n)}e.$emit("refreshTree","".concat(e.objId,"-").concat(e.instId))})).finally((function(){e.nodeLoading=!1}))})):(this.isEditModel=!this.isEditModel,this.handleObjUserData("string"))},t.prototype.handleObjUserData=function(e){var t=function(t){var o=n.groupArr.find((function(e){return e.bk_property_id===t}));o&&"objuser"===o.bk_property_type&&n.formData[t]&&(n.formData[t]="string"===e?n.formData[t].split(",").map((function(e){return e.split("(")[0]})):n.formData[t].join(","))},n=this;for(var o in this.formData)t(o)},t.prototype.deleteNode=function(){var e=this;if(!this.$BtnPermission(this.powerParams))return!1;this.isEditModel?(this.handleObjUserData("array"),this.isEditModel=!this.isEditModel):this.$bkInfo({title:"是否删除该节点",confirmLoading:!0,confirmFn:function(){var t={bk_biz_id:e.$route.query.appId,data:{bk_obj_id:e.objId,bk_parent_id:e.parentId,bk_node_id:e.instId}};e.nodeLoading=!0,e.$api.Resource.deleteBusinessNode(t).then((function(t){if(!t.result)return e.$error(t.message),!1;e.isEditModel=!1,e.$success("删除成功！"),e.$emit("refreshTree")})).finally((function(){e.nodeLoading=!1}))}})},t.prototype.getShowValue=function(e){return"time"===e.bk_property_type?this.$FormatTime("yyyy-MM-dd hh:mm:ss",this.nodeData[e.bk_property_id]):"enum"===e.bk_property_type?this.getEnumValue(this.nodeData[e.bk_property_id],e):"bool"===e.bk_property_type?this.nodeData[e.bk_property_id]?"是":"否":this.nodeData[e.bk_property_id]||"--"},t.prototype.getEnumValue=function(e,t){return e?"bool"===t.bk_property_type?t.option.find((function(t){return t.id===String(e)})).name||"--":e?t.option.find((function(t){return t.id===e})).name:"--":"--"},t.prototype.getBoolValue=function(e){return"true"===e},t.prototype.getNodeInfo=function(e,t,n){this.objId=e,this.instId=t,this.parentId=n||"",this.isEditModel=!1,Promise.all([this.getNodeDetail(e,t),this.getModelAttributeList(e)])},t.prototype.getNodeDetail=function(e,t){var n=this,o={bk_obj_id:e,bk_inst_id:t};this.nodeData="",this.formData={},this.infoLoading=!0,this.$api.Resource.getOtherResDetail(o).then((function(e){if(!e.result)return!1;n.nodeData=e.data,n.formData=n.$deepClone(e.data)})).finally((function(){n.infoLoading=!1}))},t.prototype.getModelAttributeList=function(e){var t=this;this.groupTypeList=[],this.groupArr=[],this.rules={},this.nodeLoading=!0,this.$api.modelSetting.getModelAttributeList({bk_obj_id:e}).then((function(e){if(!e.result)return!1;e.data.forEach((function(e){e.data.forEach((function(e){t.groupArr.push(e),"list"===e.bk_property_type&&(e.option=e.option.map((function(e){return{id:e,name:e}}))),t.isBlueKing&&"bk_biz_name"===e.bk_property_id&&(e.editable=!1),t.$buildRules(e,t.rules)}))})),t.groupTypeList=e.data})).finally((function(){t.nodeLoading=!1}))},h([Object(a.d)({type:String,default:function(){return""}})],t.prototype,"nodePath",void 0),t=h([Object(a.a)({name:"node-detail",components:{timezone:i.a}})],t)}(a.e),m=_,y=Object(p.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.nodeLoading||e.infoLoading,zIndex:10},expression:"{ isLoading: nodeLoading || infoLoading, zIndex: 10 }"}],staticClass:"node-detail"},[n("div",{staticClass:"info-box cw-card"},[n("bk-card",{staticStyle:{"margin-bottom":"10px"},attrs:{border:!1,"is-collapse":!0,"collapse-icons":["icon-right-shape","icon-down-shape"]}},[n("div",{staticClass:"content-box-title",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("拓扑信息")])]),e._v(" "),n("div",{staticClass:"topology-info"},[e._v("\n                "+e._s(e.nodePath||"--")+"\n            ")])]),e._v(" "),n("bk-form",{ref:"validateForm",attrs:{"label-width":78,model:e.formData,rules:e.rules}},e._l(e.groupTypeList,(function(t){return n("bk-card",{key:t.id,attrs:{border:!1,"is-collapse":!0,"collapse-icons":["icon-right-shape","icon-down-shape"]}},[n("div",{staticClass:"content-box-title",attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(t.bk_property_group_name))])]),e._v(" "),n("div",{staticClass:"list-box"},e._l(t.data,(function(t){return n("div",{key:t.bk_property_id+t.bk_property_name,staticClass:"list-box-item"},[e.isEditModel?n("bk-form-item",{attrs:{label:t.bk_property_name+" :",desc:"项目名称",property:t.bk_property_id}},[["date","time"].includes(t.bk_property_type)?n("bk-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:!t.editable,placeholder:"选择日期时间",type:"datetime"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):["enum","list"].includes(t.bk_property_type)?n("bk-select",{attrs:{disabled:!t.editable,"popover-options":{appendTo:"parent"},"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:""},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}},e._l(t.option,(function(e){return n("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1):"bool"===t.bk_property_type?n("bk-switcher",{attrs:{disabled:!t.editable,theme:"primary"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):"timezone"===t.bk_property_type?n("timezone",{attrs:{placeholder:t.placeholder},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):"objuser"===t.bk_property_type?n("bk-select",{staticStyle:{width:"100%"},attrs:{disabled:!t.editable||e.userLoading,multiple:"",searchable:"","id-key":"key","popover-options":{appendTo:"parent"},list:e.userData,"enable-virtual-scroll":"","search-placeholder":"请输入","ext-cls":"select-custom","display-key":"display","search-with-pinyin":!0,"ext-popover-cls":"select-popover-custom"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):n("bk-input",{attrs:{disabled:!t.editable,clearable:!0,type:["int","float"].includes(t.bk_property_type)?"number":"text"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}})],1):n("div",{staticClass:"show-model"},[n("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"label hide-text"},[e._v(e._s(t.bk_property_name))]),e._v(" "),n("div",{staticClass:"mr10"},[e._v(":")]),e._v(" "),n("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"value hide-text"},[e._v(e._s(e.getShowValue(t)))])])],1)})),0)])})),1)],1),e._v(" "),n("div",{staticClass:"footer"},["空闲机"!==e.nodeData.bk_module_name?n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticStyle:{"margin-right":"12px"},attrs:{theme:"primary"},on:{click:e.editNodeInfo}},[e._v("\n            "+e._s(e.isEditModel?"保存":"编辑")+"\n        ")]):e._e(),e._v(" "),"空闲机"===e.nodeData.bk_module_name||"biz"===e.objId&&!e.isEditModel?e._e():n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],attrs:{theme:"default"},on:{click:e.deleteNode}},[e._v("\n            "+e._s(e.isEditModel?"取消":"删除")+"\n        ")])],1)])}),[],!1,null,"fcd7b3ac",null).exports,v=n("Hn4h"),g=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),k=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},x=function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((o=o.apply(e,t||[])).next())}))},w=function(e,t){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.icons=["icon-right-shape","icon-down-shape"],t.visible=!1,t.fields=[],t.loading=!1,t.formData={},t.rules={},t.userData=[],t.userLoading=!1,t.node="",t.groupTypeList=[],t.groupArr=[],t.obkIdMap={biz:"application",application:"set",set:"module"},t.nodeType="",t.formDataV2={},t}return g(t,e),t.prototype.mounted=function(){this.userData=sessionStorage.getItem("allUserData")?JSON.parse(sessionStorage.getItem("allUserData")):[]},t.prototype.showDialog=function(e,t){return x(this,void 0,void 0,(function(){var n,o=this;return w(this,(function(i){return this.visible=!0,this.node=e,this.loading=!0,this.groupTypeList=[],this.groupArr=[],this.formData={},n=t.find((function(e){return e.bk_obj_id===o.node.data.bk_obj_id})),this.nodeType=n.bk_next_obj,this.$api.modelSetting.getModelAttributeList({bk_obj_id:this.nodeType}).then((function(e){if(!e.result)return!1;e.data.forEach((function(e){e.data.forEach((function(e){o.$set(o.formData,e.bk_property_id,""),o.groupArr.push(e),"list"===e.bk_property_type&&(e.option=e.option.map((function(e){return{id:e,name:e}}))),o.$buildRules(e,o.rules)}))})),o.formDataV2=JSON.parse(JSON.stringify(o.formData)),o.groupTypeList=e.data})).finally((function(){o.loading=!1})),[2]}))}))},t.prototype.beforeCloseDialog=function(){var e=this;this.$compareFormData(this.formData,this.formDataV2)?this.visible=!1:this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){return e.visible=!1,!0}})},t.prototype.getBoolValue=function(e){return"true"===e},t.prototype.handleSubmit=function(){var e=this;this.$refs.addResourceForm.validate().then((function(t){return x(e,void 0,void 0,(function(){var e,t,n,o,i,a,r=this;return w(this,(function(s){for(o in e=this.$deepClone(this.formData),t=function(t){var o=n.groupArr.find((function(e){return e.bk_property_id===t}));o&&"objuser"===o.bk_property_type&&(e[t]=e[t]?e[t].join(","):""),o&&["int","float"].includes(o.bk_property_type)&&(e[t]=e[t]&&Number(e[t]))},n=this,e)t(o);for(a in i={bk_biz_id:this.$route.query.appId,data:{bk_obj_id:this.nodeType,bk_parent_id:this.node.data.bk_inst_id,obj_attr:{}}},e)""!==e[a]&&(i.data.obj_attr[a]="[object Date]"===Object.prototype.toString.call(e[a])?this.$formatDate(e[a]):e[a]);return this.loading=!0,this.$api.Resource.createBusinessNode(i).then((function(e){if(!e.result)return r.$error(e.message),!1;r.$success("创建节点成功！"),r.$emit("refreshTree","".concat(e.data.bk_obj_id,"-").concat(e.data.bk_inst_id),e.data),r.visible=!1})).finally((function(){r.loading=!1})),[2]}))}))}),(function(e){console.log(e)}))},t=k([Object(a.a)({name:"add-node",components:{timezone:i.a}})],t)}(a.e),C=D,I=Object(p.a)(C,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"add-node"},[n("bk-sideslider",{attrs:{width:640,"is-show":e.visible,"before-close":e.beforeCloseDialog,"quick-close":!0},on:{"update:isShow":function(t){e.visible=t},"update:is-show":function(t){e.visible=t}}},[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("新增节点")]),e._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"content-box"},[n("bk-form",{ref:"addResourceForm",attrs:{"label-width":300,"form-type":"vertical",rules:e.rules,model:e.formData}},e._l(e.groupTypeList,(function(t){return n("bk-card",{key:t.id,staticStyle:{"margin-bottom":"10px"},attrs:{"is-collapse":!0,"collapse-icons":e.icons}},[n("div",{staticClass:"content-box-title",attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(t.bk_property_group_name))])]),e._v(" "),n("div",{staticClass:"list"},e._l(t.data,(function(t){return n("bk-form-item",{key:t.bk_property_id,attrs:{label:t.bk_property_name+(t.editable?"":"(添加后不可编辑)"),property:t.bk_property_id,required:t.isrequired,rules:e.rules[t.bk_property_id],"error-display-type":"normal"}},[["date","time"].includes(t.bk_property_type)?n("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择日期时间",type:"datetime"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):["enum","list"].includes(t.bk_property_type)?n("bk-select",{attrs:{"ext-cls":"select-custom","popover-options":{appendTo:"parent"},"ext-popover-cls":"select-popover-custom",searchable:""},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}},e._l(t.option,(function(e){return n("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1):"bool"===t.bk_property_type?n("bk-switcher",{attrs:{theme:"primary"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):"timezone"===t.bk_property_type?n("timezone",{attrs:{placeholder:t.placeholder},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):"objuser"===t.bk_property_type?n("bk-select",{staticStyle:{width:"100%"},attrs:{multiple:"",searchable:"",disabled:e.userLoading,"id-key":"key",list:e.userData,"enable-virtual-scroll":"","search-placeholder":"请输入","ext-cls":"select-custom","display-key":"display","popover-options":{appendTo:"parent"},"search-with-pinyin":!0,"ext-popover-cls":"select-popover-custom"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}}):n("bk-input",{attrs:{clearable:!0,type:["int","float"].includes(t.bk_property_type)?"number":"text"},model:{value:e.formData[t.bk_property_id],callback:function(n){e.$set(e.formData,t.bk_property_id,n)},expression:"formData[tex.bk_property_id]"}})],1)})),1)])})),1)],1)]),e._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticStyle:{"margin-left":"24px","margin-right":"8px"},attrs:{disabled:e.loading,theme:"primary"},on:{click:e.handleSubmit}},[e._v("保存")]),e._v(" "),n("bk-button",{attrs:{disabled:e.loading},on:{click:e.beforeCloseDialog}},[e._v("关闭")])],1)])],1)}),[],!1,null,"e609fd22",null).exports,j=n("JnIg"),$=n("P6H+"),S=n("iTfj"),N=n("EcEN"),O=n.n(N),L=n("5Vuv"),E=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),P=function(){return P=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},P.apply(this,arguments)},R=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},T=function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((o=o.apply(e,t||[])).next())}))},z=function(e,t){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isExpandAll=!1,t.searchKey="",t.processName="",t.activeRadio="instance",t.isMoudle=!1,t.nodeInfo={},t.selectedData=[],t.columns=[{type:"selection"},{type:"expand",scopedSlots:"expand"},{label:"实例名称",key:"name",align:"left",minWidth:"200",scopedSlots:"name"},{label:"进程数量",key:"process_instances",align:"left",minWidth:"100",scopedSlots:"process_instances"},{label:"操作",key:"operation",align:"left",width:"200px",scopedSlots:"operation"}],t.childColumns=[{label:"进程名称",key:"bk_process_name",align:"left",minWidth:"100",scopedSlots:"bk_process_name"},{label:"进程别名",key:"bk_func_name",align:"left",minWidth:"100"},{label:"进程启动参数",key:"bk_start_param_regex",align:"left",minWidth:"100"},{label:"绑定信息",key:"bind_info",align:"left",minWidth:"100",scopedSlots:"bind_info"},{label:"操作",key:"operation",align:"left",width:"200px",scopedSlots:"operation"}],t.processColumns=[{type:"expand",scopedSlots:"expand"},{label:"进程名称",key:"bk_process_name",align:"left",minWidth:"200"},{label:"实例数量",key:"instance_account",align:"left",minWidth:"100",scopedSlots:"instance_account"}],t.processChildrencolumns=[{type:"selection"},{label:"所属实例",key:"service_inst_name",align:"left",minWidth:"100",scopedSlots:"service_inst_name"},{label:"进程名称",key:"bk_process_name",align:"left",minWidth:"100"},{label:"进程启动参数",key:"bk_start_param_regex",align:"left",minWidth:"100"},{label:"绑定信息",key:"bind_info",align:"left",minWidth:"100",scopedSlots:"bind_info"},{label:"操作",key:"operation",align:"left",width:"120px",scopedSlots:"operation"}],t.tableLoading=!1,t.loading=!1,t.maxHeight="",t.dataList=[],t.expandKeys=[],t.copyDataList=[],t.processDataList=[],t.pagination={current:1,count:1,limit:20},t}return E(t,e),Object.defineProperty(t.prototype,"isInstance",{get:function(){return"instance"===this.activeRadio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlueKing",{get:function(){return[1,2].includes(+this.$route.query.appId)},enumerable:!1,configurable:!0}),t.prototype.onNodeChanged=function(e){e&&this.fetchData(e)},t.prototype.mounted=function(){var e=this;this.maxHeight=window.innerHeight-374,window.onresize=function(){e.maxHeight=window.innerHeight-374}},t.prototype.getBindInfo=function(e){return(e||[]).reduce((function(e,t){return e+"".concat("1"===t.protocol?"TCP":"UDP"," ").concat(t.ip+t.port," ")}),"")||"--"},t.prototype.linkToAddInstance=function(){this.btnForbidden||this.$router.push({name:"AddInstance",query:P(P({},this.$route.query),{bk_inst_id:this.nodeInfo.bk_inst_id})})},t.prototype.confirmEditName=function(e,t){return T(this,void 0,void 0,(function(){var n,o,i,a,r;return z(this,(function(s){switch(s.label){case 0:return e.showInput=!1,this.$set(this.dataList,t,e),n=e.bk_biz_id,o=e.id,i=e.name,a={bk_biz_id:n,data:[{service_instance_id:o,update:{name:i}}]},[4,this.$api.serviceInstance.editInstanceName(a)];case 1:return(r=s.sent()).result?(this.$success("修改成功"),this.getServiceInstance(),[2]):(this.$error(r.message),[2])}}))}))},t.prototype.copyIp=function(){var e=document.createElement("input");document.body.appendChild(e),e.value=this.selectedData.reduce((function(e,t){return e+t.name}),""),e.focus(),e.select(),document.execCommand("copy")&&document.execCommand("copy"),e.blur(),this.$success("复制成功"),document.body.removeChild(e)},t.prototype.deleteInstance=function(e,t){var n=this;void 0===t&&(t=""),this.btnForbidden||this.$bkInfo({title:"instance"===t?"确定删除服务实例？":"确定删除进程？",theme:"primary",confirmFn:function(){n.confirmDeleteInstance(e,t)}})},t.prototype.confirmDeleteInstance=function(e,t){return T(this,void 0,void 0,(function(){var n,o,i,a,r;return z(this,(function(s){switch(s.label){case 0:return n=Object(S.isArray)(e)?e:[e],o=n.reduce((function(e,t){return e+(t.id||t.bk_process_id)+","}),"").slice(0,-1),i="process"===t?"deleteProcess":"deleteInstance",a={bk_biz_id:n[0].bk_biz_id,service_instance_ids:o},"process"===t&&(a={bk_biz_id:n[0].bk_biz_id,process_instance_ids:o}),[4,this.$api.serviceInstance[i](a)];case 1:return(r=s.sent()).result?(this.$success("删除成功"),this.getServiceInstance(),[2]):(this.$error(r.message),[2])}}))}))},t.prototype.cancelEditName=function(e,t){var n=this.copyDataList.find((function(t){return t.id===e.id}));n&&(e.name=n.name),e.showInput=!1,this.$set(this.dataList,t,e)},t.prototype.editName=function(e,t){this.btnForbidden||(e.showInput=!0,e.isEdit=!1,this.$set(this.dataList,t,e))},t.prototype.rowMouseEnter=function(e,t,n){n.showInput||(n.isEdit=!0,this.$set(this.dataList,e,n))},t.prototype.rowMouseLeave=function(e,t,n){n.isEdit=!1,this.$set(this.dataList,e,n)},t.prototype.showProcessDialog=function(e,t,n){this.btnForbidden&&"check"!==e||this.$refs.processDialog.show(e,t,n)},t.prototype.selectTableData=function(e,t){this.selectedData=e,this.handleSelect()},t.prototype.selectAllTableData=function(e,t){this.selectedData=e,this.handleSelect()},t.prototype.handleSelect=function(){var e=this;this.isInstance||this.processDataList.forEach((function(t,n){e.selectedData.forEach((function(o){if(!t.process_ids.includes(o.bk_process_id)){var i=e.$refs["processChildTable".concat(n)];i&&i.clearSelection()}}))}))},t.prototype.getChildData=function(e){return e?e.map((function(e){return e.process})):[]},t.prototype.fetchData=function(e){this.isMoudle="module"===e.bk_obj_id,this.nodeInfo=e,this.isMoudle&&this.getServiceInstance()},t.prototype.handleExpand=function(e){this.isInstance?this.expandKeys=e?this.dataList.map((function(e){return e.id})):[]:this.expandKeys=e?this.processDataList.map((function(e){return e.id})):[]},t.prototype.getServiceInstance=function(){return T(this,void 0,void 0,(function(){var e,t,n,o,i,a;return z(this,(function(r){switch(r.label){case 0:this.tableLoading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),e=this.pagination,t=e.current,n=e.limit,o={page:t,page_size:n,bk_biz_id:+this.$route.query.appId,bk_module_id:this.nodeInfo.bk_inst_id},this.isInstance?o.name=this.searchKey:o.process_name=this.searchKey,i=this.isInstance?"getInstDetail":"getProcessListByModule",[4,this.$api.serviceInstance[i](o)];case 2:return(a=r.sent()).result?(this.isInstance?(this.dataList=a.data.info,this.copyDataList=this.$copy(a.data.info)):(a.data.info.forEach((function(e){e.id=O()()})),this.processDataList=a.data.info),this.pagination.count=a.data.count,[3,4]):(this.$error(a.message),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},t.prototype.changeRadio=function(){this.pagination.current=1,this.pagination.limit=20,this.isExpandAll=!1,this.searchKey="",this.selectedData=[],this.getServiceInstance()},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getServiceInstance()},t.prototype.limitChange=function(e){this.pagination.limit=e,this.pagination.current=1,this.getServiceInstance()},t.prototype.setCurrentMode=function(){return""},R([Object(a.d)({type:Object,default:function(){}})],t.prototype,"currentNode",void 0),R([Object(a.f)("currentNode",{deep:!0})],t.prototype,"onNodeChanged",null),R([Object(a.b)("setCurrentMode")],t.prototype,"setCurrentMode",null),t=R([Object(a.a)({components:{ComTable:j.a,ProcessDialog:$.a}})],t)}(L.a),V=A,F=Object(p.a)(V,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],staticClass:"service-instance"},[e.isMoudle?n("div",{staticClass:"show-instance"},[n("div",{staticClass:"nav-area"},[e.isBlueKing?e._e():n("div",{staticClass:"nav-area-left"},[e.isInstance?n("div",{staticClass:"instance"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary"},on:{click:e.linkToAddInstance}},[e._v("\n                        新增\n                    ")]),e._v(" "),n("bk-dropdown-menu",{ref:"dropdown",staticStyle:{height:"32px"}},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],attrs:{slot:"dropdown-trigger",theme:"default","icon-right":"icon-angle-down",disabled:!e.selectedData.length},slot:"dropdown-trigger"},[e._v("\n                            实例操作\n                        ")]),e._v(" "),n("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[n("li",[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],attrs:{text:"",size:"small",disabled:!e.selectedData.length},on:{click:function(t){return e.deleteInstance(e.selectedData,"instance")}}},[e._v("\n                                    批量删除\n                                ")])],1)])],1)],1):n("div",{staticClass:"process"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"default",disabled:!e.selectedData.length},on:{click:function(t){return e.deleteInstance(e.selectedData,"process")}}},[e._v("\n                        删除\n                    ")])],1)]),e._v(" "),n("div",{staticClass:"nav-area-right"},[n("bk-checkbox",{staticClass:"expand-all mr10",on:{change:e.handleExpand},model:{value:e.isExpandAll,callback:function(t){e.isExpandAll=t},expression:"isExpandAll"}},[e._v("\n                    全部展开\n                ")]),e._v(" "),e.isInstance?e._e():n("bk-input",{staticClass:"search",attrs:{clearable:!0,placeholder:e.isInstance?"请输入实例名称":"请输入进程名称"},on:{enter:e.getServiceInstance},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}}),e._v(" "),n("bk-radio-group",{staticClass:"ml10 active-radio",on:{change:e.changeRadio},model:{value:e.activeRadio,callback:function(t){e.activeRadio=t},expression:"activeRadio"}},[n("bk-radio-button",{attrs:{value:"instance"}},[e._v("\n                        实例\n                    ")]),e._v(" "),n("bk-radio-button",{attrs:{value:"process"}},[e._v("\n                        进程\n                    ")])],1)],1)]),e._v(" "),e.isInstance?n("ComTable",{ref:"instanceTable",attrs:{data:e.dataList,columns:e.columns,pagination:e.pagination,"max-height":e.maxHeight,"row-key":"id","expand-row-keys":e.expandKeys},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange,select:e.selectTableData,"select-all":e.selectAllTableData,"row-mouse-enter":e.rowMouseEnter,"row-mouse-leave":e.rowMouseLeave},scopedSlots:e._u([{key:"expand",fn:function(t){var o=t.row;return[n("ComTable",{ref:"comTable",attrs:{data:e.getChildData(o.process_instances),columns:e.childColumns},scopedSlots:e._u([{key:"bk_process_name",fn:function(t){return[n("span",{staticStyle:{color:"#3A84FF",cursor:"pointer"},on:{click:function(n){return e.showProcessDialog("check",o,t.row)}}},[e._v("\n                            "+e._s(t.row.bk_process_name)+"\n                        ")])]}},{key:"bind_info",fn:function(t){return[n("span",[e._v(e._s(e.getBindInfo(t.row.bind_info)))])]}},{key:"operation",fn:function(t){return[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(n){return e.showProcessDialog("edit",o,t.row)}}},[e._v("\n                            编辑\n                        ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(n){return e.deleteInstance(t.row,"process")}}},[e._v("\n                            删除\n                        ")])]}}],null,!0)})]}},{key:"process_instances",fn:function(t){var o=t.row;return[o.process_instances&&o.process_instances.length?n("span",[e._v("\n                    "+e._s(o.process_instances.length)+"\n                ")]):n("div",[n("bk-icon",{staticStyle:{color:"#ff9c01","font-size":"14px"},attrs:{type:"exclamation-circle"}}),e._v(" "),n("span",[e._v("未添加进程，")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary",disabled:e.isBlueKing,text:""},on:{click:function(t){return e.showProcessDialog("add",o)}}},[e._v("\n                        立即添加\n                    ")])],1)]}},{key:"name",fn:function(t){var o=t.row,i=t.index;return[n("div",[o.showInput?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("bk-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入实例名称"},model:{value:o.name,callback:function(t){e.$set(o,"name",t)},expression:"row.name"}}),e._v(" "),n("bk-button",{staticStyle:{margin:"0 4px"},attrs:{theme:"primary",text:""},on:{click:function(t){return e.confirmEditName(o,i)}}},[e._v("\n                            确定\n                        ")]),e._v(" "),n("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(t){return e.cancelEditName(o,i)}}},[e._v("\n                            取消\n                        ")])],1):n("span",[e._v("\n                        "+e._s(o.name)+"\n                        "),o.isEdit&&!e.isBlueKing?n("i",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"cw-icon weops-edit edit-icon",on:{click:function(t){return e.editName(o,i)}}}):e._e()])])]}},{key:"operation",fn:function(t){var o=t.row;return[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(t){return e.showProcessDialog("add",o)}}},[e._v("\n                    添加进程\n                ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(t){return e.deleteInstance(o,"instance")}}},[e._v("\n                    删除\n                ")])]}}],null,!1,1459591564)}):n("div",[n("ComTable",{ref:"processTable",attrs:{data:e.processDataList,columns:e.processColumns,pagination:e.pagination,"max-height":e.maxHeight,"row-key":"id","expand-row-keys":e.expandKeys},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"instance_account",fn:function(t){var o=t.row;return[n("span",[e._v(e._s(o.process_ids.length))])]}},{key:"expand",fn:function(t){var o=t.row,i=t.index;return[n("ComTable",{ref:"processChildTable"+i,attrs:{data:o.process_list,columns:e.processChildrencolumns},on:{select:e.selectTableData,"select-all":e.selectAllTableData},scopedSlots:e._u([{key:"service_inst_name",fn:function(t){return[n("a",{staticStyle:{color:"#3A84FF"},on:{click:function(n){return e.showProcessDialog("check",o,t.row)}}},[e._v("\n                                "+e._s(t.row.service_inst_name)+"\n                            ")])]}},{key:"bind_info",fn:function(t){return[n("span",[e._v(e._s(e.getBindInfo(t.row.bind_info)))])]}},{key:"operation",fn:function(t){return[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(n){return e.showProcessDialog("edit",o,t.row)}}},[e._v("\n                                编辑\n                            ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(n){return e.deleteInstance(t.row,"process")}}},[e._v("\n                                删除\n                            ")])]}}],null,!0)})]}}],null,!1,872361487)})],1)],1):n("div",{staticClass:"no-process"},[n("bk-icon",{staticClass:"icon",staticStyle:{"font-size":"18px"},attrs:{type:"info-circle"}}),e._v("非业务模块，无服务实例，请选择业务模块查看\n    ")],1),e._v(" "),n("ProcessDialog",{ref:"processDialog",on:{refreshTable:e.getServiceInstance}})],1)}),[],!1,null,"0ed53084",null).exports,M=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),B=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},H=function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((o=o.apply(e,t||[])).next())}))},K=function(e,t){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.activeRadio="hostList",t.nodeData=[],t.treeLoading=!1,t.options={idKey:t.genNodeId,nameKey:"bk_inst_name",childrenKey:"child"},t.defaultExpandNode=[],t.defaultSelectedNode="",t.currentNode={},t.hostConfig={name:"host",nameCn:"主机",label:"主机列表",listUrl:"getHostList",filedUrl:"getHostCustomFields",updateFieldUrl:"updateHostCustomFields",batchEditUrl:"modifyHostsBulk",changeRecordUrl:"getHostChangeRecord"},t.freeModule={},t.topHeight=0,t.nodePath="",t}return M(t,e),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.meta.activeMenu,type:"operateAuth"}},enumerable:!1,configurable:!0}),t.prototype.mounted=function(){var e=this;this.getBusinessTopology(),this.topHeight=288+document.getElementById("appBaseInfo").clientHeight,this.$bus.$on("getAppHeight",(function(){e.$nextTick((function(){e.topHeight=288+document.getElementById("appBaseInfo").clientHeight}))}))},t.prototype.handlerChange=function(e){var t=this;"serviceInstance"===e&&this.$nextTick((function(){t.$refs.instance.fetchData(t.currentNode)}))},t.prototype.refreshTree=function(e,t){this.getBusinessTopology(e,t)},t.prototype.enterNode=function(e,t,n){if("module"===t.bk_obj_id)return!1;"enter"===n?e.target.children[e.target.children.length-1].style.display="block":e.target.children[e.target.children.length-1].style.display="none"},t.prototype.createNode=function(e,t){return H(this,void 0,void 0,(function(){var n,o,i,a;return K(this,(function(r){switch(r.label){case 0:return this.$BtnPermission(this.powerParams)?[4,this.$api.modelSetting.getMainLineList()]:[2,!1];case 1:return n=r.sent(),o=n.result,i=n.data,a=n.message,o?[4,this.$refs.addNode.showDialog(e,i)]:(this.$error(a),[2,!1]);case 2:return r.sent(),t.stopPropagation(),[2]}}))}))},t.prototype.nodeClick=function(e){var t;this.nodePath=this.getTopologicalPath(e,[]).join(" / "),this.currentNode=e.data,["set","module"].includes(null===(t=this.currentNode)||void 0===t?void 0:t.bk_obj_id)||"relatedInfo"!==this.activeRadio||(this.activeRadio="hostList"),this.getNodeInfo(e.data.bk_obj_id,e.data.bk_inst_id,e.parent?e.parent.data.bk_inst_id:""),this.$refs.host.getNodeHostList(this.currentNode)},t.prototype.getTopologicalPath=function(e,t){var n=t;return n.unshift(e.data.bk_inst_name),e.parent&&this.getTopologicalPath(e.parent,n),n},t.prototype.getBusinessTopology=function(e,t){var n=this;this.treeLoading=!0,this.$api.Resource.getBusinessTopology({bk_biz_id:this.$route.query.appId}).then((function(o){if(!o.result)return!1;n.nodeData=[o.data],e||(n.$route.query.subId?o.data.child.forEach((function(e){e.bk_inst_id===Number(n.$route.query.subId)&&(n.currentNode=e),"空闲模块"===e.bk_inst_name&&(n.freeModule=e)})):n.currentNode=o.data,o.data.child.forEach((function(e){"空闲模块"===e.bk_inst_name&&(n.freeModule=e)}))),t&&(n.currentNode=t),n.getNodeInfo(n.currentNode.bk_obj_id,n.currentNode.bk_inst_id),n.$nextTick((function(){var t=n.$refs.tree.getNodeById("".concat(n.currentNode.bk_obj_id,"-").concat(n.currentNode.bk_inst_id));n.nodePath=n.getTopologicalPath(t,[]).join(" / "),n.$refs.tree.setSelected(e||n.defaultSelectedNode),n.$refs.host.getNodeHostList(n.currentNode)})),n.defaultExpandNode=[n.genNodeId(n.currentNode)],n.defaultSelectedNode=n.genNodeId(n.currentNode)})).finally((function(){n.treeLoading=!1}))},t.prototype.getNodeInfo=function(e,t,n){this.$refs.nodeDetail&&this.$refs.nodeDetail.getNodeInfo(e,t,n)},t.prototype.genNodeId=function(e){return"".concat(e.bk_obj_id,"-").concat(e.bk_inst_id)},t=B([Object(a.a)({name:"node-info",components:{nodeDetail:y,relatedInfo:v.a,addNode:I,serviceInstance:F,host:u.a}})],t)}(a.e),U=q,J=Object(p.a)(U,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"node-info"},[n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.treeLoading,zIndex:10},expression:"{ isLoading: treeLoading, zIndex: 10 }"}],staticClass:"node-tree"},[n("bk-big-tree",{ref:"tree",attrs:{selectable:!0,options:e.options,"default-expanded-nodes":e.defaultExpandNode,"default-selected-node":e.defaultSelectedNode,data:e.nodeData,"expand-on-click":!1},on:{"node-click":e.nodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.data,i=t.node;return n("div",{},[n("div",{staticClass:"custom-node",on:{mouseenter:function(t){return e.enterNode(t,o,"enter")},mouseleave:function(t){return e.enterNode(t,o,"leave")}}},[n("span",[e._v(e._s(o.bk_inst_name))]),e._v(" "),n("span",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"top-middle",staticStyle:{display:"none"}},[n("i",{staticClass:"cw-icon weops-add",on:{click:function(t){return t.stopPropagation(),e.createNode(i,t)}}})])])])}}])})],1),e._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.treeLoading,zIndex:10},expression:"{ isLoading: treeLoading, zIndex: 10 }"}],staticClass:"other-info"},[n("bk-radio-group",{on:{change:e.handlerChange},model:{value:e.activeRadio,callback:function(t){e.activeRadio=t},expression:"activeRadio"}},[n("bk-radio-button",{attrs:{value:"hostList"}},[e._v("\n                主机列表\n            ")]),e._v(" "),n("bk-radio-button",{attrs:{value:"serviceInstance"}},[e._v("\n                服务实例\n            ")]),e._v(" "),n("bk-radio-button",{attrs:{value:"nodeDetail"}},[e._v("\n                节点详情\n            ")]),e._v(" "),e.currentNode&&["set","module"].includes(e.currentNode.bk_obj_id)?n("bk-radio-button",{attrs:{value:"relatedInfo"}},[e._v("\n                关联关系\n            ")]):e._e()],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"nodeDetail"===e.activeRadio,expression:"activeRadio === 'nodeDetail'"}],staticClass:"show-box"},[n("node-detail",{ref:"nodeDetail",attrs:{"node-path":e.nodePath},on:{refreshTree:e.refreshTree}})],1),e._v(" "),"serviceInstance"===e.activeRadio?n("div",{staticClass:"host-box"},[n("service-instance",{ref:"instance",attrs:{"current-node":e.currentNode}})],1):e._e(),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"hostList"===e.activeRadio,expression:"activeRadio === 'hostList'"}],staticClass:"host-box"},[n("host",{ref:"host",attrs:{"free-module":e.freeModule,"need-next-tick":!0,"type-item":e.hostConfig,"top-height":e.topHeight}})],1),e._v(" "),"relatedInfo"===e.activeRadio?n("div",{staticClass:"host-box"},[n("related-info",{key:e.currentNode.bk_inst_id,attrs:{"type-item":{bk_inst_id:e.currentNode.bk_inst_id,name:e.currentNode.bk_obj_id},"instance-id":String(e.currentNode.bk_inst_id)}})],1):e._e()],1),e._v(" "),n("add-node",{ref:"addNode",on:{refreshTree:e.refreshTree}})],1)}),[],!1,null,"34ab1f4a",null).exports,W=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.panels=[{name:"nodeInfo",label:"节点信息"},{name:"changeLog",label:"变更记录"}],t.currentExpend=!0,t.tabList=[{name:"host",nameCn:"主机",label:"主机列表",listUrl:"getHostList",filedUrl:"getHostCustomFields",updateFieldUrl:"updateHostCustomFields",batchEditUrl:"modifyHostsBulk",changeRecordUrl:"getHostChangeRecord"},{name:"changeLog",label:"变更记录"}],t.active="hostList",t.logData=[],t.logDataLoading=!1,t}return W(t,e),t.prototype.onActiveChanged=function(e){"changeLog"===e&&this.getAppChangeRecord(7)},t.prototype.mounted=function(){this.getAppChangeRecord(7)},t.prototype.toggleExpendStatus=function(){this.currentExpend=!this.currentExpend},t.prototype.getAppChangeRecord=function(e,t){var n=this;this.logDataLoading=!0,this.logData=[];var o={bk_biz_id:this.$route.query.appId,body:{start_time:"".concat(t?t[0]:this.$DateDisplay(e).startTime," 00:00:00"),end_time:"".concat(t?t[1]:this.$DateDisplay(e).endTime," 23:59:59")}};this.$api.Resource.getAppChangeRecord(o).then((function(e){if(!e.result)return n.$error(e.message),n.logData=[],!1;n.logData=e.data})).finally((function(){n.logDataLoading=!1}))},G([Object(a.f)("active",{immediate:!0,deep:!0})],t.prototype,"onActiveChanged",null),t=G([Object(a.a)({name:"application-details",components:{appBaseInfo:d,host:u.a,changeLog:f.a,nodeInfo:J}})],t)}(a.e),Q=X,Y=Object(p.a)(Q,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"application-details"},[n("app-base-info",{staticClass:"info-box"}),e._v(" "),n("div",{staticClass:"main-info"},[n("bk-tab",{attrs:{active:e.active,type:"unborder-card"},on:{"update:active":function(t){e.active=t}}},e._l(e.panels,(function(t,o){return n("bk-tab-panel",e._b({key:o},"bk-tab-panel",t,!1),[e.active===t.name?n(t.name,{tag:"component",attrs:{"need-next-tick":!0,"type-item":t,"top-height":220,"log-data":e.logData,"log-type":"app","log-data-loading":e.logDataLoading},on:{getLogData:e.getAppChangeRecord}}):e._e()],1)})),1)],1)],1)}),[],!1,null,"c82934b0",null);t.default=Y.exports}}]);