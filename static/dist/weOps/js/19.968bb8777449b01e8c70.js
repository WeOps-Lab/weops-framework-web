(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{xAGj:function(e,t,n){"use strict";n.r(t);var i,o=n("WC3J"),r=n("Hn4h"),a=n("3Sh2"),s=n("G0B5"),c=n("JnIg"),l=n("ac6i"),u=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.formData={versionNumber:"",versionIntroduce:"",uploadFiles:""},t.rules={versionNumber:[{required:!0,message:"必填项",trigger:"blur"}],versionIntroduce:[{required:!0,message:"必填项",trigger:"blur"}],uploadFiles:[{required:!0,message:"必填项",trigger:"blur"}]},t.loading=!1,t.uploadFile={},t}return u(t,e),t.prototype.show=function(){this.isShow=!0,this.formData={versionNumber:"",versionIntroduce:"",uploadFiles:""}},t.prototype.handleUpload=function(e){this.formData.uploadFiles=e.fileList[0].name,this.uploadFile=e.fileList[0]},t.prototype.deleteFile=function(){this.formData.uploadFiles=""},t.prototype.confirm=function(){var e=this;this.$refs.validateForm.validate().then((function(t){var n={bk_inst_id:e.fileData.bk_inst_id,version:e.formData.versionNumber,profile_name:e.formData.uploadFiles,describe:e.formData.versionIntroduce,profile:e.uploadFile.origin,resource_name:e.fileData.profile_name,bk_inst_name:e.$route.query.bkInstName||"",bk_classification_name:e.$route.query.nameCn||""},i=new FormData;for(var o in n)i.append(o,n[o]);e.loading=!0,e.$api.configFile.uploadConfigFile(i).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("上传成功!"),e.$emit("refresh"),e.cancel()})).finally((function(){e.loading=!1}))}))},t.prototype.cancel=function(){this.isShow=!1},p([Object(s.d)({type:Object,default:function(){return{}}})],t.prototype,"fileData",void 0),t=p([Object(s.a)({name:"upload-file"})],t)}(s.e),d=f,h=n("KHd+"),m=Object(h.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bk-sideslider",{attrs:{width:600,"is-show":e.isShow,"quick-close":!0},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("上传")]),e._v(" "),n("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[n("bk-form",{ref:"validateForm",staticStyle:{flex:"1"},attrs:{"label-width":90,model:e.formData,rules:e.rules}},[n("bk-form-item",{attrs:{label:"版本号",required:!0,property:"versionNumber"}},[n("bk-input",{attrs:{placeholder:"请输入版本号"},model:{value:e.formData.versionNumber,callback:function(t){e.$set(e.formData,"versionNumber",t)},expression:"formData.versionNumber"}})],1),e._v(" "),n("bk-form-item",{attrs:{label:"版本说明",required:!0,property:"versionIntroduce"}},[n("bk-input",{attrs:{placeholder:"请输入版本说明",type:"textarea"},model:{value:e.formData.versionIntroduce,callback:function(t){e.$set(e.formData,"versionIntroduce",t)},expression:"formData.versionIntroduce"}})],1),e._v(" "),n("bk-form-item",{attrs:{label:"上传文件",required:!0,property:"uploadFiles"}},[n("bk-upload",{attrs:{url:"0",limit:1,"ext-cls":"upload-sec",multiple:!1,"with-credentials":!0,size:10240,"custom-request":e.handleUpload}})],1),e._v(" "),e.formData.uploadFiles?n("bk-form-item",[n("div",{staticClass:"upload-file-list"},[n("bk-icon",{staticStyle:{"font-size":"36px"},attrs:{type:"file"}}),e._v(" "),n("div",{staticClass:"file-info"},[n("div",{staticClass:"base-info"},[n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"hide-text"},[e._v(e._s(e.formData.uploadFiles))]),e._v(" "),n("span",[e._v("上传完毕")])]),e._v(" "),n("bk-progress",{attrs:{theme:"success",percent:1,size:"small","show-text":!1}})],1),e._v(" "),n("bk-icon",{staticClass:"close-icon",attrs:{type:"close"},on:{click:e.deleteFile}})],1)]):e._e()],1),e._v(" "),n("div",{staticClass:"foot-box"},[n("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:e.cancel}},[e._v("\n                取消\n            ")]),e._v(" "),n("bk-button",{staticClass:"mr10",attrs:{loading:e.loading,disabled:e.loading,theme:"primary"},on:{click:e.confirm}},[e._v("\n                确认\n            ")])],1)],1)])}),[],!1,null,"208742d6",null).exports,b=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),g=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.formData={versionNumber:"",versionIntroduce:""},t.rules={versionNumber:[{required:!0,message:"必填项",trigger:"blur"}],versionIntroduce:[{required:!0,message:"必填项",trigger:"blur"}]},t.loading=!1,t.file="",t}return b(t,e),t.prototype.show=function(e){this.file=e,this.isShow=!0,this.formData.versionNumber=this.file.version,this.formData.versionIntroduce=this.file.describe},t.prototype.confirm=function(){var e=this;this.$refs.validateForm.validate().then((function(t){var n={id:e.file.id,body:{describe:e.formData.versionIntroduce,version:e.formData.versionNumber,resource_name:e.fileData.bk_inst_name,bk_inst_name:e.$route.query.bkInstName||"",bk_classification_name:e.$route.query.nameCn||""}};e.loading=!0,e.$api.configFile.editConfigFile(n).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("修改成功!"),e.$emit("refresh"),e.cancel()})).finally((function(){e.loading=!1}))}))},t.prototype.cancel=function(){this.isShow=!1},g([Object(s.d)({type:Object,default:function(){return{}}})],t.prototype,"fileData",void 0),t=g([Object(s.a)({name:"edit-file"})],t)}(s.e),v=y,_=Object(h.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bk-sideslider",{attrs:{width:600,"is-show":e.isShow,"quick-close":!0},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("修改")]),e._v(" "),n("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[n("bk-form",{ref:"validateForm",staticStyle:{flex:"1"},attrs:{"label-width":90,model:e.formData,rules:e.rules}},[n("bk-form-item",{attrs:{label:"版本号",required:!0,property:"versionNumber"}},[n("bk-input",{attrs:{placeholder:"请输入版本号",disabled:""},model:{value:e.formData.versionNumber,callback:function(t){e.$set(e.formData,"versionNumber",t)},expression:"formData.versionNumber"}})],1),e._v(" "),n("bk-form-item",{attrs:{label:"版本说明",required:!0,property:"versionIntroduce"}},[n("bk-input",{attrs:{placeholder:"请输入版本说明",type:"textarea"},model:{value:e.formData.versionIntroduce,callback:function(t){e.$set(e.formData,"versionIntroduce",t)},expression:"formData.versionIntroduce"}})],1)],1),e._v(" "),n("div",{staticClass:"foot-box"},[n("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:e.cancel}},[e._v("\n                取消\n            ")]),e._v(" "),n("bk-button",{staticClass:"mr10",attrs:{loading:e.loading,disabled:e.loading,theme:"primary"},on:{click:e.confirm}},[e._v("\n                确认\n            ")])],1)],1)])}),[],!1,null,"6e2f3a80",null).exports,w=n("zBjk"),k=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),D=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.loading=!1,t.file="",t.dataList=[],t.showNotPreview=!0,t}return k(t,e),t.prototype.show=function(e){this.isShow=!0,this.file=e,this.showNotPreview=!0,this.getFilePreview()},t.prototype.getFilePreview=function(){var e=this;this.loading=!0,this.$api.configFile.getFilePreview({id:this.file.id}).then((function(t){if(!t.result)return e.$error(t.message),!1;Array.isArray(t.data.content)?(e.showNotPreview=!1,e.$nextTick((function(){e.dataList=t.data.content,e.$refs.logDetail.setListData(e.dataList)}))):e.showNotPreview=!0})).finally((function(){e.loading=!1}))},t=D([Object(s.a)({name:"preview-file",components:{logDetail:w.a}})],t)}(s.e),O=x,I=Object(h.a)(O,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bk-sideslider",{attrs:{width:600,"is-show":e.isShow,"quick-close":!0},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("预览")]),e._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"mb10"},[n("span",[e._v("版本号:")]),e._v(" "),n("span",[e._v(e._s(e.file.version))])]),e._v(" "),n("div",{staticClass:"mb10"},[n("span",[e._v("版本说明:")]),e._v(" "),n("span",[e._v(e._s(e.file.describe))])]),e._v(" "),e.showNotPreview?n("div",{staticClass:"not-preview"},[n("bk-exception",{staticClass:"exception-wrap-item exception-part",class:{"exception-gray":!1},attrs:{type:"500",scene:"part"}},[e._v("\n                非文档文件不支持预览\n            ")])],1):n("log-detail",{ref:"logDetail",attrs:{title:"文件详情","is-allow-down":!1}})],1)])}),[],!1,null,"6c6ef6a3",null).exports,$=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),j=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},L=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},P=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.searchKey="",t.tableLoading=!1,t.maxHeight="",t.dataList=[],t.pagination={current:1,count:1,limit:20},t.columns=[{label:"版本号",key:"version",align:"left",minWidth:"130px",disabled:!0},{label:"文件名称",key:"profile_name",align:"left",minWidth:"130px",disabled:!0},{label:"创建者",key:"created_by",align:"left",minWidth:"130px",disabled:!0},{label:"上传时间",key:"updated_at",align:"left",minWidth:"130px",disabled:!0},{label:"操作",key:"operation",align:"left",width:"200px",scopedSlots:"operation"}],t}return $(t,e),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.query.formPage,type:"configFileManage"}},enumerable:!1,configurable:!0}),t.prototype.mounted=function(){var e=this;this.maxHeight=window.innerHeight-205,window.onresize=function(){e.maxHeight=window.innerHeight-205},this.getVersionList()},t.prototype.refreshList=function(){this.$emit("refreshList"),this.getVersionList()},t.prototype.preview=function(e){this.$refs.previewFile.show(e)},t.prototype.deleteFile=function(e){var t=this;if(!this.$BtnPermission(this.powerParams))return!1;s.e.prototype.$bkInfo({title:"确认要删除该上传文件？",confirmLoading:!0,confirmFn:function(){return L(t,void 0,void 0,(function(){return P(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return L(this,void 0,void 0,(function(){var t;return P(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.configFile.deleteConfigFile({id:e.id,body:{resource_name:this.fileData.profile_name,bk_inst_name:this.$route.query.bkInstName||"",bk_classification_name:this.$route.query.nameCn||""}})];case 1:return(t=n.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.$emit("refreshList"),this.getVersionList()):this.$error(t.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.edit=function(e){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.editFile.show(e)},t.prototype.upload=function(){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.uploadFile.show()},t.prototype.download=function(e){this.$api.configFile.downloadSaveLog({profile_name:e.profile_name,resource_name:this.fileData.profile_name,bk_inst_name:this.$route.query.bkInstName||"",bk_classification_name:this.$route.query.nameCn||""}),window.open(e.profile)},t.prototype.getVersionList=function(){var e=this,t={bk_inst_id:this.fileData.bk_inst_id,version:this.searchKey,page_size:this.pagination.limit,page:this.pagination.current};this.tableLoading=!0,this.$api.configFile.getVersionList(t).then((function(t){if(!t.result)return e.$error(t.message),e.dataList=[],!1;e.dataList=t.data.items,e.pagination.count=t.data.count})).finally((function(){e.tableLoading=!1}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getVersionList()},t.prototype.limitChange=function(e){this.pagination.limit=e,this.pagination.current=1,this.getVersionList()},j([Object(s.d)({type:Object,default:function(){}})],t.prototype,"fileData",void 0),t=j([Object(s.a)({components:{ComTable:c.a,uploadFile:m,editFile:_,previewFile:I}})],t)}(s.e),F=C,S=Object(h.a)(F,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"action-bar"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],attrs:{theme:"primary"},on:{click:e.upload}},[e._v("\n            上传\n        ")]),e._v(" "),n("bk-input",{staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"请输入版本号","right-icon":"bk-icon icon-search"},on:{enter:e.getVersionList,clear:e.getVersionList,"right-icon-click":e.getVersionList},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1),e._v(" "),n("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"sourceTable",staticClass:"com-table",attrs:{id:"center_table",data:e.dataList,columns:e.columns,"max-height":e.maxHeight,pagination:e.pagination},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"operation",fn:function(t){var i=t.row;return[n("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.download(i)}}},[e._v("\n                下载\n            ")]),e._v(" "),n("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.preview(i)}}},[e._v("\n                预览\n            ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.edit(i)}}},[e._v("\n                修改\n            ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.deleteFile(i)}}},[e._v("\n                删除\n            ")])]}}])}),e._v(" "),n("upload-file",{ref:"uploadFile",attrs:{"file-data":e.fileData},on:{refresh:e.refreshList}}),e._v(" "),n("edit-file",{ref:"editFile",attrs:{"file-data":e.fileData},on:{refresh:e.refreshList}}),e._v(" "),n("preview-file",{ref:"previewFile"})],1)}),[],!1,null,"d124f99c",null).exports,N=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),R=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.fileData={},t.menuList=[{label:"基础信息",name:"baseInfo"},{label:"版本列表",name:"versionList"},{label:"变更记录",name:"changeLog"}],t.active="versionList",t.instanceFields="",t.typeItem="",t.logDataLoading=!1,t.logData=[],t}return N(t,e),t.prototype.show=function(e,t,n){this.isShow=!0,this.fileData=e,this.instanceFields=t,this.typeItem=n,this.active="versionList"},t.prototype.toTabMenu=function(e){this.active=e.name,"changeLog"===this.active&&this.getInstanceChangeRecord(7)},t.prototype.refreshList=function(){this.$emit("refresh")},t.prototype.getInstanceChangeRecord=function(e,t){var n=this;this.logDataLoading=!0,this.logData=[],this.$api.Resource.getOtherSrcChange({bk_host_id:this.fileData.bk_inst_id,bk_obj_id:"profile",body:{start_time:"".concat(t?t[0]:this.$DateDisplay(e).startTime," 00:00:00"),end_time:"".concat(t?t[1]:this.$DateDisplay(e).endTime," 23:59:59")}}).then((function(e){if(!e.result)return n.$error(e.message),n.logData=[],!1;n.logData=e.data})).finally((function(){n.logDataLoading=!1}))},t.prototype.updateInstanceData=function(e){for(var t in this.fileData)t===e.key&&(this.fileData[t]=e.value);this.$emit("refresh")},t=R([Object(s.a)({components:{menuTab:l.a,versionList:S,baseInfo:o.a,changeLog:a.a}})],t)}(s.e),q=T,E=Object(h.a)(q,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bk-sideslider",{attrs:{width:1e3,"is-show":e.isShow,"quick-close":!0},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("配置文件"),e.fileData.profile_name?n("span",[e._v("-"+e._s(e.fileData.profile_name))]):e._e()]),e._v(" "),n("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[n("menu-tab",{attrs:{panels:e.menuList,type:"line","active-panel":e.active},on:{click:e.toTabMenu}}),e._v(" "),n(e.active,{tag:"component",staticClass:"show-box",attrs:{"log-type":"other","file-data":e.fileData,"log-data":e.logData,"log-data-loading":e.logDataLoading,"instance-data":e.fileData,"instance-fields":e.instanceFields,"is-config-file":!0,"type-item":e.typeItem,"date-picker-transfer":!0},on:{updateInstanceData:e.updateInstanceData,getLogData:e.getInstanceChangeRecord,refreshList:e.refreshList}})],1)])}),[],!1,null,"8bd7d81e",null).exports,z=n("jAee"),A=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),K=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},H=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},B=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.searchKey="",t.createConfigLoading=!1,t.tableLoading=!1,t.maxHeight="",t.dataList=[],t.pagination={current:1,count:1,limit:20},t.columns=[{label:"配置文件名称",key:"profile_name",align:"left",minWidth:"130px",disabled:!0},{label:"最新版本",key:"version",align:"left",minWidth:"130px",disabled:!0},{label:"维护人",key:"operator",align:"left",minWidth:"130px",disabled:!0},{label:"更新时间",key:"updated_at",align:"left",minWidth:"130px",disabled:!0},{label:"操作",key:"operation",align:"left",width:"150px",scopedSlots:"operation"}],t.instanceFields=[],t.batchEditRules=[],t.typeItem={batchEditUrl:"modifyOtherResourceBulk",bk_classification_id:"",changeRecordUrl:"getOtherSrcChange",filedUrl:"getOtherResourceFields",label:"配置文件",listUrl:"getOtherResourceList",name:"profile",nameCn:"配置文件",updateFieldUrl:"updateOtherResourceFields"},t}return A(t,e),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.query.formPage,type:"configFileManage"}},enumerable:!1,configurable:!0}),t.prototype.mounted=function(){var e=this;this.maxHeight=window.innerHeight-282,window.onresize=function(){e.maxHeight=window.innerHeight-282},this.getInstanceProfile(),this.getOtherResourceFields()},t.prototype.getOtherResourceFields=function(){var e=this;this.createConfigLoading=!0,this.$api.Resource.getOtherResourceFields({bk_obj_id:"profile"}).then((function(t){if(!t.result)return!1;e.handleAllFields(t.data.all_field)})).finally((function(){e.createConfigLoading=!1}))},t.prototype.createConfigFile=function(){if(!this.$BtnPermission(this.powerParams))return!1;var e=s.e.prototype.$deepClone(this.instanceFields);e.forEach((function(e){e.children=e.children.filter((function(e){return!["录入方式","录入时间"].includes(e.bk_property_name)}))})),this.$refs.addResource.showDialog(this.typeItem,e)},t.prototype.handleAllFields=function(e){var t=this;e.forEach((function(e,n){"list"!==e.bk_property_type&&"bool"!==e.bk_property_type||("list"===e.bk_property_type&&(e.option=e.option.map((function(e){return{id:e,name:e}}))),"bool"===e.bk_property_type&&(e.option=[{id:!0,name:"是"},{id:!1,name:"否"}])),e.checked=!1,e.batchValue="",e.editStatus=!1,e.editValue="",e.editLoading=!1,e.editIconShow=!1,"bk_inst_name"!==e.bk_property_id&&t.buildFieldData(e,t.instanceFields)}))},t.prototype.buildFieldData=function(e,t){var n=t.findIndex((function(t){return t.title===e.bk_property_group_name}));-1===n?t.push({title:e.bk_property_group_name,children:[e],collapseStatus:!0,id:s.e.prototype.$random(3)}):t[n].children.push(e)},t.prototype.deleteProfile=function(e){var t=this;if(!this.$BtnPermission(this.powerParams))return!1;s.e.prototype.$bkInfo({title:"确认要删除该配置文件？",confirmLoading:!0,confirmFn:function(){return H(t,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return H(this,void 0,void 0,(function(){var t;return B(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.configFile.deleteProfile({id:e.bk_inst_id,body:{resource_name:e.bk_inst_name,bk_asst_obj_id:this.$route.query.otherType}})];case 1:return(t=n.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getInstanceProfile()):this.$error(t.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.checkDetail=function(e){this.$refs.fileDetail.show(e,this.instanceFields,this.typeItem)},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getInstanceProfile()},t.prototype.limitChange=function(e){this.pagination.limit=e,this.pagination.current=1,this.getInstanceProfile()},t.prototype.getInstanceProfile=function(){var e=this,t={bk_obj_id:"profile",bk_asst_obj_id:this.$route.query.otherType,bk_inst_id:"host"===this.$route.query.otherType?this.instanceData.bk_host_id:this.instanceData.bk_inst_id,bk_inst_name:this.searchKey};this.tableLoading=!0,this.$api.configFile.getInstanceProfile(t).then((function(t){if(!t.result)return e.$error(t.message),e.dataList=[],!1;e.dataList=t.data.data,e.pagination.count=t.data.count})).finally((function(){e.tableLoading=!1}))},K([Object(s.d)({type:Object,default:function(){}})],t.prototype,"instanceData",void 0),K([Object(s.d)({type:Object,default:function(){}})],t.prototype,"configInfo",void 0),t=K([Object(s.a)({components:{ComTable:c.a,configFileDetail:E,addResource:z.a}})],t)}(s.e),V=W,M=Object(h.a)(V,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"action-bar"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],attrs:{theme:"primary",loading:e.createConfigLoading},on:{click:e.createConfigFile}},[e._v("\n            新建\n        ")]),e._v(" "),n("bk-input",{staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"请输入配置文件名称","right-icon":"bk-icon icon-search"},on:{enter:e.getInstanceProfile,clear:e.getInstanceProfile,"right-icon-click":e.getInstanceProfile},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1),e._v(" "),n("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"sourceTable",staticClass:"com-table",attrs:{id:"center_table",data:e.dataList,columns:e.columns,"max-height":e.maxHeight,pagination:e.pagination},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"operation",fn:function(t){var i=t.row;return[n("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.checkDetail(i)}}},[e._v("详情")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:!i.delete},on:{click:function(t){return e.deleteProfile(i)}}},[e._v("\n                删除\n            ")])]}}])}),e._v(" "),n("config-file-detail",{ref:"fileDetail",on:{refresh:e.getInstanceProfile}}),e._v(" "),n("add-resource",{ref:"addResource",attrs:{"config-info":e.configInfo,"custom-create":!0,"instance-data":e.instanceData},on:{"on-success":e.getInstanceProfile}})],1)}),[],!1,null,"9126e60a",null).exports,U=n("Fa2A"),G=n("P6H+"),J=n("iTfj"),Q=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),X=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Y=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},Z=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isExpandAll=!1,t.searchKey="",t.processName="",t.activeRadio="instance",t.nodeInfo={},t.selectedData=[],t.isBlueKing=!1,t.columns=[{type:"selection"},{type:"expand",scopedSlots:"expand"},{label:"实例名称",key:"name",align:"left",minWidth:"200",scopedSlots:"name"},{label:"进程数量",key:"process_instances",align:"left",minWidth:"100",scopedSlots:"process_instances"},{label:"拓扑信息",key:"topo",align:"left",minWidth:"100"},{label:"操作",key:"operation",align:"left",width:"200px",scopedSlots:"operation"}],t.childColumns=[{label:"进程名称",key:"bk_process_name",align:"left",minWidth:"100",scopedSlots:"bk_process_name"},{label:"进程别名",key:"bk_func_name",align:"left",minWidth:"100"},{label:"进程启动参数",key:"bk_start_param_regex",align:"left",minWidth:"100"},{label:"绑定信息",key:"bind_info",align:"left",minWidth:"100",scopedSlots:"bind_info"},{label:"操作",key:"operation",align:"left",width:"200px",scopedSlots:"operation"}],t.tableLoading=!1,t.loading=!1,t.maxHeight="",t.dataList=[],t.expandKeys=[],t.copyDataList=[],t.processDataList=[],t.pagination={current:1,count:1,limit:20},t}return Q(t,e),Object.defineProperty(t.prototype,"isInstance",{get:function(){return"instance"===this.activeRadio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"permissionObj",{get:function(){return{id:this.$route.query.formPage||this.$route.name,type:"serviceInstanceManage"}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"btnForbidden",{get:function(){return!this.$BtnPermission(this.permissionObj)},enumerable:!1,configurable:!0}),t.prototype.onRouteChanged=function(e){e&&(this.isBlueKing=[1,2].includes(+e.query.bkbizId))},t.prototype.mounted=function(){var e=this;this.maxHeight=window.innerHeight-260,window.onresize=function(){e.maxHeight=window.innerHeight-260},this.fetchData()},t.prototype.getBindInfo=function(e){return(e||[]).reduce((function(e,t){return e+"".concat("1"===t.protocol?"TCP":"UDP"," ").concat(t.ip+t.port," ")}),"")||"--"},t.prototype.confirmEditName=function(e,t){return Y(this,void 0,void 0,(function(){var n,i,o,r,a;return Z(this,(function(s){switch(s.label){case 0:return e.showInput=!1,this.$set(this.dataList,t,e),n=e.bk_biz_id,i=e.id,o=e.name,r={bk_biz_id:n,data:[{service_instance_id:i,update:{name:o}}]},[4,this.$api.serviceInstance.editInstanceName(r)];case 1:return(a=s.sent()).result?(this.$success("修改成功"),this.getServiceInstance(),[2]):(this.$error(a.message),[2])}}))}))},t.prototype.copyIp=function(){var e=document.createElement("input");document.body.appendChild(e),e.value=this.selectedData.reduce((function(e,t){return e+t.name}),""),e.focus(),e.select(),document.execCommand("copy")&&document.execCommand("copy"),e.blur(),this.$success("复制成功"),document.body.removeChild(e)},t.prototype.deleteInstance=function(e,t){var n=this;void 0===t&&(t=""),this.btnForbidden||this.$bkInfo({title:"instance"===t?"确定删除服务实例？":"确定删除进程？",theme:"primary",confirmFn:function(){n.confirmDeleteInstance(e,t)}})},t.prototype.confirmDeleteInstance=function(e,t){return Y(this,void 0,void 0,(function(){var n,i,o,r,a;return Z(this,(function(s){switch(s.label){case 0:return n=Object(J.isArray)(e)?e:[e],i=n.reduce((function(e,t){return e+(t.id||t.bk_process_id)+","}),"").slice(0,-1),o="process"===t?"deleteProcess":"deleteInstance",r={bk_biz_id:n[0].bk_biz_id,service_instance_ids:i},"process"===t&&(r={bk_biz_id:n[0].bk_biz_id,process_instance_ids:i}),[4,this.$api.serviceInstance[o](r)];case 1:return(a=s.sent()).result?(this.$success("删除成功"),this.getServiceInstance(),[2]):(this.$error(a.message),[2])}}))}))},t.prototype.cancelEditName=function(e,t){var n=this.copyDataList.find((function(t){return t.id===e.id}));n&&(e.name=n.name),e.showInput=!1,this.$set(this.dataList,t,e)},t.prototype.editName=function(e,t){this.btnForbidden||(e.showInput=!0,e.isEdit=!1,this.$set(this.dataList,t,e))},t.prototype.rowMouseEnter=function(e,t,n){n.showInput||(n.isEdit=!0,this.$set(this.dataList,e,n))},t.prototype.rowMouseLeave=function(e,t,n){n.isEdit=!1,this.$set(this.dataList,e,n)},t.prototype.showProcessDialog=function(e,t,n){this.btnForbidden&&"check"!==e||this.$refs.processDialog.show(e,t,n)},t.prototype.selectTableData=function(e,t){this.selectedData=e,this.handleSelect()},t.prototype.selectAllTableData=function(e,t){this.selectedData=e,this.handleSelect()},t.prototype.handleSelect=function(){var e=this;this.isInstance||this.processDataList.forEach((function(t,n){e.selectedData.forEach((function(i){if(!t.process_ids.includes(i.bk_process_id)){var o=e.$refs["processChildTable".concat(n)];o&&o.clearSelection()}}))}))},t.prototype.getChildData=function(e){return e?e.map((function(e){return e.process})):[]},t.prototype.fetchData=function(){this.getServiceInstance()},t.prototype.handleExpand=function(e){this.isInstance?this.expandKeys=e?this.dataList.map((function(e){return e.id})):[]:this.expandKeys=e?this.processDataList.map((function(e){return e.id})):[]},t.prototype.getServiceInstance=function(){return Y(this,void 0,void 0,(function(){var e,t,n,i,o;return Z(this,(function(r){switch(r.label){case 0:this.tableLoading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),e=this.pagination,t=e.current,n=e.limit,i={page:t,page_size:n,bk_biz_id:+this.$route.query.bkbizId,bk_host_id:+this.$route.query.bkHostId,name:this.searchKey},[4,this.$api.serviceInstance.getInstDetail(i)];case 2:return(o=r.sent()).result?(this.dataList=o.data.info,this.copyDataList=this.$copy(o.data.info),this.pagination.count=o.data.count,[3,4]):(this.$error(o.message),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getServiceInstance()},t.prototype.limitChange=function(e){this.pagination.limit=e,this.pagination.current=1,this.getServiceInstance()},X([Object(s.d)({type:Object,default:function(){}})],t.prototype,"instanceData",void 0),X([Object(s.d)({type:Object,default:function(){}})],t.prototype,"currentNode",void 0),X([Object(s.f)("$route",{immediate:!0,deep:!0})],t.prototype,"onRouteChanged",null),t=X([Object(s.a)({components:{ComTable:c.a,ProcessDialog:G.a}})],t)}(s.e),te=ee,ne=Object(h.a)(te,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],staticClass:"service-instance"},[n("div",{staticClass:"show-instance"},[n("div",{staticClass:"nav-area"},[e.isBlueKing?e._e():n("div",{staticClass:"nav-area-left"},[n("div",{staticClass:"instance"},[n("bk-dropdown-menu",{ref:"dropdown",staticStyle:{height:"32px"}},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],attrs:{slot:"dropdown-trigger",theme:"default","icon-right":"icon-angle-down",disabled:!e.selectedData.length},slot:"dropdown-trigger"},[e._v("\n                            实例操作\n                        ")]),e._v(" "),n("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[n("li",[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],attrs:{text:"",size:"small",disabled:!e.selectedData.length},on:{click:function(t){return e.deleteInstance(e.selectedData,"instance")}}},[e._v("\n                                    批量删除\n                                ")])],1)])],1)],1)]),e._v(" "),n("div",{staticClass:"nav-area-right"},[n("bk-checkbox",{staticClass:"expand-all mr10",on:{change:e.handleExpand},model:{value:e.isExpandAll,callback:function(t){e.isExpandAll=t},expression:"isExpandAll"}},[e._v("\n                    全部展开\n                ")])],1)]),e._v(" "),n("ComTable",{ref:"instanceTable",attrs:{data:e.dataList,columns:e.columns,pagination:e.pagination,"max-height":e.maxHeight,"row-key":"id","expand-row-keys":e.expandKeys},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange,select:e.selectTableData,"select-all":e.selectAllTableData,"row-mouse-enter":e.rowMouseEnter,"row-mouse-leave":e.rowMouseLeave},scopedSlots:e._u([{key:"expand",fn:function(t){var i=t.row;return[n("ComTable",{ref:"comTable",attrs:{data:e.getChildData(i.process_instances),columns:e.childColumns},scopedSlots:e._u([{key:"bk_process_name",fn:function(t){return[n("span",{staticStyle:{color:"#3A84FF",cursor:"pointer"},on:{click:function(n){return e.showProcessDialog("check",i,t.row)}}},[e._v("\n                            "+e._s(t.row.bk_process_name)+"\n                        ")])]}},{key:"bind_info",fn:function(t){return[n("span",[e._v(e._s(e.getBindInfo(t.row.bind_info)))])]}},{key:"operation",fn:function(t){return[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(n){return e.showProcessDialog("edit",i,t.row)}}},[e._v("\n                            编辑\n                        ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(n){return e.deleteInstance(t.row,"process")}}},[e._v("\n                            删除\n                        ")])]}}],null,!0)})]}},{key:"process_instances",fn:function(t){var i=t.row;return[i.process_instances&&i.process_instances.length?n("span",[e._v("\n                    "+e._s(i.process_instances.length)+"\n                ")]):n("div",[n("bk-icon",{staticStyle:{color:"#ff9c01","font-size":"14px"},attrs:{type:"exclamation-circle"}}),e._v(" "),n("span",[e._v("未添加进程，")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(t){return e.showProcessDialog("add",i)}}},[e._v("\n                        立即添加\n                    ")])],1)]}},{key:"name",fn:function(t){var i=t.row,o=t.index;return[n("div",[i.showInput?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("bk-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入实例名称"},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"row.name"}}),e._v(" "),n("bk-button",{staticStyle:{margin:"0 4px"},attrs:{theme:"primary",text:""},on:{click:function(t){return e.confirmEditName(i,o)}}},[e._v("\n                            确定\n                        ")]),e._v(" "),n("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(t){return e.cancelEditName(i,o)}}},[e._v("\n                            取消\n                        ")])],1):n("span",[e._v("\n                        "+e._s(i.name)+"\n                        "),i.isEdit&&!e.isBlueKing?n("i",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"cw-icon weops-edit edit-icon",on:{click:function(t){return e.editName(i,o)}}}):e._e()])])]}},{key:"operation",fn:function(t){var i=t.row;return[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(t){return e.showProcessDialog("add",i)}}},[e._v("\n                    添加进程\n                ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.isBlueKing},on:{click:function(t){return e.deleteInstance(i,"instance")}}},[e._v("\n                    删除\n                ")])]}}])})],1),e._v(" "),n("ProcessDialog",{ref:"processDialog",on:{refreshTable:e.getServiceInstance}})],1)}),[],!1,null,"6387b4ad",null).exports,ie=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),oe=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.active="detailInfo",t.tabList=[{name:"detailInfo",label:"详细信息"},{name:"service",label:"服务实例"},{name:"relatedInfo",label:"关联信息"},{name:"changeLog",label:"变更记录"}],t.logData=[],t.logDataLoading=!1,t.instanceData={},t.instanceFields=[],t.pageLoading=!1,t.configInfo="",t.isBlueKing=!1,t}return ie(t,e),Object.defineProperty(t.prototype,"isPermission",{get:function(){var e=this.$store.getters.getUser;return"host"===this.$route.query.instanceType&&((null==e?void 0:e.applications)||[]).includes("senior_resource")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.query.formPage,type:"hostManage"}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"belongModule",{get:function(){return this.$store.state.permission.user.applications},enumerable:!1,configurable:!0}),t.prototype.onActiveChanged=function(e){"changeLog"===e&&this.getInstanceChangeRecord(7)},t.prototype.on$routeChanged=function(e){if(e&&"host"!==e.query.instanceType){var t=this.tabList.findIndex((function(e){return"service"===e.name}));this.tabList.splice(t,1)}},t.prototype.beforeDestroy=function(){sessionStorage.getItem("instanceData")&&sessionStorage.removeItem("instanceData"),sessionStorage.getItem("instanceFields")&&sessionStorage.removeItem("instanceFields")},t.prototype.mounted=function(){this.active=this.$route.params.tabName||"detailInfo",this.getOriginData()},t.prototype.getObjectAssociation=function(){var e=this;this.$api.configFile.getObjectAssociation().then((function(t){if(!t.result)return!1;var n=t.data.find((function(t){return t.bk_asst_obj_id===e.$route.query.otherType}));n&&!e.tabList.find((function(e){return"configFile"===e.name}))&&(e.configInfo=n,e.tabList.push({name:"configFile",label:"配置文件"}))}))},t.prototype.remoteConnect=function(){var e=this.$copy(this.instanceData);if(e.bk_biz_id=this.$route.query.bkbizId,!this.$BtnPermission(this.powerParams))return!1;this.$refs.remoteConnect.show(e)},t.prototype.getOriginData=function(e){var t=this;this.pageLoading=!0,Promise.all([this.getInstanceData(),this.getInstanceFields()]).finally((function(){t.pageLoading=!1,e||t.getObjectAssociation()}))},t.prototype.getUserList=function(){var e=this;this.$api.Server.getBkUsers({page:1,page_size:1e5}).then((function(t){if(500===t.code)return e.handleInfoData("error",t),!1;t.result&&e.handleInfoData("success",t)}))},t.prototype.handleInfoData=function(e,t,n){this.instanceFields.forEach((function(i){(i.children||[]).forEach((function(i){"objuser"===i.bk_property_type&&("error"===e?i.editable=!1:i.userData=n?JSON.parse(sessionStorage.getItem("allUserData")):t.data.items.filter((function(e){return e.bk_username})).map((function(e){return{key:e.bk_username,display:e.bk_username}})))}))}))},t.prototype.getInstanceData=function(){var e=this,t={bk_obj_id:this.$route.query.otherType,bk_inst_id:this.$route.query.instanceId};this.$api.Resource.getOtherResDetail(t).then((function(t){t.result&&(e.instanceData=t.data)}))},t.prototype.getInstanceFields=function(){var e=this,t={bk_obj_id:this.$route.query.otherType},n="host"===this.$route.query.otherType?"getHostCustomFields":"getOtherResourceFields";this.$api.Resource[n](t).then((function(t){t.result&&e.handleAllFields(t.data.all_field)}))},t.prototype.handleAllFields=function(e){var t=this;e.forEach((function(e){if(["list","bool"].includes(e.bk_property_type)){if(e.option.length>0){var n=e.option.map((function(e){return{id:e,name:e}}));e.option=n}"boolean"==typeof e.option&&(e.option=[{id:"true",name:"是"},{id:"false",name:"否"}])}e.checked=!1,e.batchValue="",e.editStatus=!1,e.editValue="",e.editLoading=!1,t.buildFieldData(e,t.instanceFields)}))},t.prototype.buildFieldData=function(e,t){var n=t.findIndex((function(t){return t.title===e.bk_property_group_name}));-1===n?t.push({title:e.bk_property_group_name,children:[e],collapseStatus:!0,id:this.$random(3)}):t[n].children.push(e)},t.prototype.getInstanceChangeRecord=function(e,t){var n=this;this.logDataLoading=!0,this.logData=[],this.$api.Resource["host"===this.$route.query.instanceType?"getHostChangeRecord":"getOtherSrcChange"]({bk_host_id:this.$route.query.instanceId,bk_obj_id:this.$route.query.otherType,body:{start_time:"".concat(t?t[0]:this.$DateDisplay(e).startTime," 00:00:00"),end_time:"".concat(t?t[1]:this.$DateDisplay(e).endTime," 23:59:59")}}).then((function(e){if(!e.result)return n.$error(e.message),n.logData=[],!1;n.logData=e.data})).finally((function(){n.logDataLoading=!1}))},t.prototype.updateInstanceData=function(e){for(var t in this.instanceData)t===e.key&&(this.instanceData[t]=e.value)},oe([Object(s.f)("active",{immediate:!0,deep:!0})],t.prototype,"onActiveChanged",null),oe([Object(s.f)("$route",{immediate:!0,deep:!0})],t.prototype,"on$routeChanged",null),t=oe([Object(s.a)({name:"instance-details",components:{detailInfo:o.a,relatedInfo:r.a,changeLog:a.a,remoteConnect:U.a,configFile:M,service:ne}})],t)}(s.e),ae=re,se=Object(h.a)(ae,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"instance-details"},[n("bk-tab",{attrs:{active:e.active,type:"unborder-card"},on:{"update:active":function(t){e.active=t}}},e._l(e.tabList,(function(t,i){return n("bk-tab-panel",e._b({key:i},"bk-tab-panel",t,!1),[e.active===t.name?n(t.name,{ref:t.name,refInFor:!0,tag:"component",attrs:{"log-data":e.logData,"log-type":"host"===e.$route.query.instanceType?"host":"other","log-data-loading":e.logDataLoading,"instance-data":e.instanceData,"instance-fields":e.instanceFields,"page-loading":e.pageLoading,"config-info":e.configInfo,"date-picker-transfer":!0},on:{getLogData:e.getInstanceChangeRecord,updateInstanceData:e.getInstanceData}}):e._e()],1)})),1),e._v(" "),e.isPermission&&e.belongModule.includes("senior_resource")?n("span",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"remote-connect",on:{click:e.remoteConnect}},[e._v("\n        远程连接\n    ")]):e._e(),e._v(" "),n("remote-connect",{ref:"remoteConnect"})],1)}),[],!1,null,"1a7d3a6c",null);t.default=se.exports}}]);