(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{OlKl:function(t,e,o){"use strict";o.r(e);var n,i=o("oCYn"),a=o("G0B5"),r=o("qz1i"),s=o("JnIg"),l=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r},u=function(t,e,o,n){return new(o||(o=Promise))((function(i,a){function r(t){try{l(n.next(t))}catch(t){a(t)}}function s(t){try{l(n.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,s)}l((n=n.apply(t,e||[])).next())}))},p=function(t,e){var o,n,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],n=0}finally{o=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.columns=[{label:"文件名称",key:"name",minWidth:"80px"},{label:"文件大小",key:"originSize",minWidth:"80px",scopedSlots:"originSize"},{label:"操作",key:"operation",width:"144px",prop:"operation",scopedSlots:"operation"}],e.activeName=["list"],e.accountList=["system","root"],e.pathList=["C:\\Windows\\TEMP","/tmp"],e.visible=!1,e.formData={ip:"",account:"",path:"",dataList:[]},e.formDataCopy={},e.romoteDetial={},e.rules={account:[{required:!0,message:"请选择执行账号",trigger:"blur"}],path:[{required:!0,message:"请选择目标路径",trigger:"blur"}]},e.loading=!1,e.jobQueue=[],e.timer=null,e.remoteConfig={},e.remoteConfigLoading=!1,e}return l(e,t),Object.defineProperty(e.prototype,"isDefaultVal",{get:function(){return["1","2"].includes(this.romoteDetial.bkOsType)},enumerable:!1,configurable:!0}),e.prototype.beforeDestroy=function(){this.clearTimer()},e.prototype.getRemoteConfig=function(){var t=this;this.remoteConfigLoading=!0,this.$api.remoteConnect.getRemoteConfig().then((function(e){var o=e.data;if(!e.result)return!1;t.remoteConfig=o})).finally((function(){t.remoteConfigLoading=!1}))},e.prototype.getOriginSize=function(t){var e=1e3*t.size/1024,o=e>=1024,n=o?(e/1024).toFixed(2):e.toFixed(2);return"本地文件（".concat(n).concat(o?"MB":"KB","）")},e.prototype.handleUpload=function(t){var e=this,o=t.fileList.findIndex((function(t){return 1e3*t.size/1024/1024>e.remoteConfig.max_push_size}));-1!==o&&(t.fileList.splice(o,1),this.$error("上传的文件不能超过".concat(this.remoteConfig.max_push_size,"M！"))),this.$set(this.formData,"dataList",t.fileList)},e.prototype.handleDeleteFile=function(t,e){this.formData.dataList.splice(e,1)},e.prototype.removeFiles=function(){this.$refs.uploadFiles.fileList=[],this.formData.dataList=[]},e.prototype.show=function(t){this.visible=!0,this.romoteDetial=t;var e=t.bkOsType,o=t.name;this.formData.ip=o,this.getRemoteConfig(),"1"===e?(this.formData.account=this.accountList[1],this.formData.path=this.pathList[1]):"2"===e&&(this.formData.account=this.accountList[0],this.formData.path=this.pathList[0]),this.formDataCopy=this.$copy(this.formData)},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var o=t.romoteDetial,n=o.name,i=o.bkCloudId,a=o.bkBizId,r=t.formData,s=r.account,l=r.path,c=r.dataList,u=new FormData;u.append("bk_biz_id",a),u.append("bk_cloud_id",i),u.append("ip",n),u.append("account",s),u.append("upload_path",l),c.forEach((function(t){u.append("upload_files",t.origin)})),t.uploadFiles(u)}))},e.prototype.uploadFiles=function(t){return u(this,void 0,void 0,(function(){var e,o,n,i;return p(this,(function(a){switch(a.label){case 0:this.loading=!0,this.clearTimer(),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.$api.Resource.uploadFiles(t)];case 2:return(e=a.sent()).result?(o=e.data,n=o.file_name,i=o.job_instance_id,this.jobQueue.push({fileName:n,jobId:i}),this.getUploadStatus(),[3,4]):(this.$error(e.message),this.loading=!1,[2]);case 3:return a.sent(),this.loading=!1,[3,4];case 4:return[2]}}))}))},e.prototype.getUploadStatus=function(){var t=this;this.clearTimer(),this.timer=setInterval((function(){for(var e=0,o=t.jobQueue;e<o.length;e++){var n=o[e],i={bk_biz_id:t.romoteDetial.bkBizId,job_instance_id:n.jobId,file_name:n.fileName};t.getUploadStatusRequest(i,n.jobId)}}),2e3)},e.prototype.getUploadStatusRequest=function(t,e){return u(this,void 0,void 0,(function(){var o,n,i,a,r;return p(this,(function(s){switch(s.label){case 0:return this.clearTimer(),[4,this.$api.Resource.getUploadStatus(t)];case 1:return o=s.sent(),n=o.result,i=o.data,a=o.message,(n&&i.finished||!n)&&(r=this.jobQueue.findIndex((function(t){return t.jobId===e})),this.jobQueue.splice(r,1),n?this.$success(i.message):this.$error(a),this.loading=!1,this.initData()),this.getUploadStatus(),[2]}}))}))},e.prototype.clearTimer=function(){this.timer&&clearInterval(this.timer)},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataCopy)?this.initData():this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.initData()}})},e.prototype.initData=function(){for(var t in this.visible=!1,this.loading=!1,this.jobQueue=[],this.formData){if("dataList"===t)return void(this.formData[t]=[]);this.formData[t]=""}},e.prototype.handleIframeFocus=function(){return""},c([Object(a.b)("handleIframeFocus")],e.prototype,"handleIframeFocus",null),e=c([Object(a.a)({components:{ComTable:s.a}})],e)}(a.e),f=d,h=o("KHd+"),m=Object(h.a)(f,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("bk-sideslider",{attrs:{width:500,"is-show":t.visible,"quick-close":!0,"ext-cls":"common-dialog-wrapper",title:"文件上传",transfer:!1,"before-close":t.cancel},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e},hidden:t.handleIframeFocus}},[o("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.remoteConfigLoading,zIndex:10},expression:"{ isLoading: remoteConfigLoading, zIndex: 10 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[o("bk-form",{ref:"validateForm",attrs:{"label-width":94,model:t.formData,rules:t.rules}},[o("bk-form-item",{attrs:{label:"目标服务器",required:!0}},[o("bk-input",{attrs:{disabled:!0,placeholder:"请输入唯一标识"},model:{value:t.formData.ip,callback:function(e){t.$set(t.formData,"ip",e)},expression:"formData.ip"}})],1),t._v(" "),o("bk-form-item",{attrs:{label:"执行账号",required:!0,property:"account"}},[o("bk-select",{attrs:{clearable:!1,placeholder:"请选择执行账号",disabled:t.isDefaultVal},model:{value:t.formData.account,callback:function(e){t.$set(t.formData,"account",e)},expression:"formData.account"}},t._l(t.accountList,(function(t){return o("bk-option",{key:t,attrs:{id:t,name:t}})})),1)],1),t._v(" "),o("bk-form-item",{attrs:{label:"目标路径",required:!0,property:"path"}},[t.remoteConfig.enable_push_path?o("bk-input",{attrs:{placeholder:"请输入目标路径"},model:{value:t.formData.path,callback:function(e){t.$set(t.formData,"path",e)},expression:"formData.path"}}):o("bk-select",{attrs:{clearable:!1,placeholder:"请选择目标路径",disabled:t.isDefaultVal},model:{value:t.formData.path,callback:function(e){t.$set(t.formData,"path",e)},expression:"formData.path"}},t._l(t.pathList,(function(t){return o("bk-option",{key:t,attrs:{id:t,name:t}})})),1)],1),t._v(" "),o("bk-form-item",{attrs:{label:"源文件",required:!0}},[o("bk-upload",{ref:"uploadFiles",attrs:{theme:"button","with-credentials":!0,"custom-request":t.handleUpload,files:t.formData.dataList,url:"",multiple:!1,"ext-cls":"upload-sec",size:102400,tip:"最大上传"+t.remoteConfig.max_push_size+"(Mb)的文件"}})],1)],1),t._v(" "),t.formData.dataList&&t.formData.dataList.length?o("div",[o("bk-collapse",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("bk-collapse-item",{staticClass:"collapse-item",attrs:{name:"list"}},[t._v("\n                        已选择"+t._s(t.formData.dataList.length)+"个本地文件\n                        "),t._v(" "),o("div",{staticClass:"f13",staticStyle:{"margin-bottom":"10px"},attrs:{slot:"content"},slot:"content"},[o("ComTable",{attrs:{data:t.formData.dataList,columns:t.columns},scopedSlots:t._u([{key:"originSize",fn:function(e){var n=e.row;return[o("span",[t._v(t._s(t.getOriginSize(n)))])]}},{key:"operation",fn:function(e){var n=e.row,i=e.index;return[o("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDeleteFile(n,i)}}},[t._v("\n                                        删除\n                                    ")])]}}],null,!1,4023997710)})],1)])],1)],1):t._e()],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                确认\n            ")]),t._v(" "),o("bk-button",{on:{click:t.cancel}},[t._v("\n                取消\n            ")])],1)])],1)}),[],!1,null,"550ba66a",null).exports,b=o("WC3J"),g=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),y=function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r},v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.instanceFields=[],e.instanceData={},e.pageLoading=!1,e}return g(e,t),e.prototype.show=function(){this.isShow=!0,this.instanceFields=[],this.instanceData={},this.getOriginData()},e.prototype.getOriginData=function(){var t=this;this.pageLoading=!0,Promise.all([this.getRemoteHostDetail(),this.getInstanceFields()]).finally((function(){t.pageLoading=!1}))},e.prototype.getRemoteHostDetail=function(){var t=this;this.$api.remoteConnect.getRemoteHostDetail({ip:this.currentNode.name,bk_biz_id:this.currentNode.bkBizId,bk_cloud_id:this.currentNode.bkCloudId}).then((function(e){var o=e.data;if(!e.result)return!1;t.instanceData=o}))},e.prototype.getInstanceFields=function(){var t=this;this.$api.Resource.getHostCustomFields({bk_obj_id:"host"}).then((function(e){e.result&&t.handleAllFields(e.data.all_field)}))},e.prototype.handleAllFields=function(t){var e=this;t.forEach((function(t){if(["list","bool"].includes(t.bk_property_type)){if(t.option.length>0){var o=t.option.map((function(t){return{id:t,name:t}}));t.option=o}"boolean"==typeof t.option&&(t.option=[{id:"true",name:"是"},{id:"false",name:"否"}])}t.checked=!1,t.batchValue="",t.editStatus=!1,t.editValue="",t.editLoading=!1,e.buildFieldData(t,e.instanceFields)}))},e.prototype.buildFieldData=function(t,e){var o=e.findIndex((function(e){return e.title===t.bk_property_group_name}));-1===o?e.push({title:t.bk_property_group_name,children:[t],collapseStatus:!0,id:this.$random(3)}):e[o].children.push(t)},e.prototype.handleIframeFocus=function(){return""},y([Object(a.d)({type:Object,default:function(){}})],e.prototype,"currentNode",void 0),y([Object(a.b)("handleIframeFocus")],e.prototype,"handleIframeFocus",null),e=y([Object(a.a)({name:"detail-info",components:{ShowList:b.a}})],e)}(a.e),_=v,w=Object(h.a)(_,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("bk-sideslider",{attrs:{"is-show":t.isShow,"quick-close":!0,width:600},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e},hidden:t.handleIframeFocus}},[o("div",{attrs:{slot:"header"},slot:"header"},[o("span",[t._v("主机信息")]),t._v(" "),o("span",{staticStyle:{"font-size":"13px",color:"#c4c6cc"}},[t._v("\n            -\n            "+t._s(t.currentNode.name)+"\n        ")])]),t._v(" "),o("div",{staticClass:"p20 content-box",attrs:{slot:"content"},slot:"content"},[o("show-list",{attrs:{"instance-data":t.instanceData,"instance-fields":t.instanceFields,"page-loading":t.pageLoading}})],1)])}),[],!1,null,"4b5e969d",null).exports,k=o("A823"),D=o.n(k),C=o("ADgQ"),S=o("Fa2A"),L=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),I=function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r},F=function(t,e,o,n){return new(o||(o=Promise))((function(i,a){function r(t){try{l(n.next(t))}catch(t){a(t)}}function s(t){try{l(n.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,s)}l((n=n.apply(t,e||[])).next())}))},x=function(t,e){var o,n,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],n=0}finally{o=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.columns=[{label:"内网IP",key:"bk_host_innerip",minWidth:"80px"},{label:"主机名称",key:"bk_host_name",minWidth:"80px"},{label:"所属应用",key:"belong_app",minWidth:"80px"},{label:"操作",key:"operation",width:"140px",prop:"operation",scopedSlots:"operation"}],e.visible=!1,e.tableLoading=!1,e.hostList=[],e.searchSelectData=[],e.belongAppList=[],e.searchFilterParams=[],e.appName="",e.configList={label:"hostList",listUrl:"getHostList",name:"host",nameCn:"主机",filedUrl:"getHostCustomFields",updateFieldUrl:"updateHostCustomFields",batchEditUrl:"modifyHostsBulk",changeRecordUrl:"getHostChangeRecord",bk_classification_id:"host"},e.pagination={current:1,count:1,limit:20},e.maxHeight="",e}return L(e,t),e.prototype.created=function(){this.getAppCustomFields(),this.getAppList()},e.prototype.mounted=function(){var t=this;this.maxHeight=window.innerHeight-200,window.onresize=function(){t.maxHeight=window.innerHeight-200}},e.prototype.show=function(){this.visible=!0,this.initData()},e.prototype.cancel=function(){this.appName="",this.searchFilterParams=[],this.visible=!1},e.prototype.isLink=function(t){return!!JSON.parse(sessionStorage.getItem("remoteConnectMsg")||"[]").find((function(e){return+e.id===t.bk_host_id}))},e.prototype.handleSearch=function(t){this.searchData("search",t)},e.prototype.handleChange=function(t){this.searchData("change",t)},e.prototype.initData=function(){this.pagination.current=1,this.getTableData()},e.prototype.confirmConnect=function(t){this.cancel(),this.$emit("updateIpList",t)},e.prototype.handleConnect=function(t){this.$refs.remoteConnect.show(t)},e.prototype.searchData=function(t,e){var o=this;if(this.pagination.current=1,(null==e?void 0:e.length)>0){var n=e.filter((function(t){return t.type})).map((function(t){return{field:t.id,value:t.value,type:t.type}}));this.searchFilterParams=n}else this.searchFilterParams=[];"change"!==t?this.getTableData():setTimeout((function(){o.getTableData()}),240)},e.prototype.getAppCustomFields=function(){return F(this,void 0,void 0,(function(){var t,e,o,n,i;return x(this,(function(a){switch(a.label){case 0:return[4,this.$api.Resource[this.configList.filedUrl]()];case 1:return t=a.sent(),e=t.result,o=t.message,n=t.data,e?(i=n.all_field.filter((function(t){return["bk_host_innerip","bk_host_name"].includes(t.bk_property_id)})),this.searchSelectData=i.map((function(t){return{name:t.bk_property_name,id:t.bk_property_id,type:t.bk_property_type}})),[2]):(this.$error(o),[2])}}))}))},e.prototype.getAppList=function(){return F(this,void 0,void 0,(function(){var t,e,o;return x(this,(function(n){switch(n.label){case 0:return[4,this.$api.Resource.getAppListMap()];case 1:return t=n.sent(),e=t.data,o=t.message,t.result?(this.belongAppList=e.map((function(t){return{id:t.bk_biz_id,name:t.bk_biz_name}})),[2]):(this.$error(o),[2])}}))}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getTableData()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getTableData()},e.prototype.getTableData=function(){var t,e=this;t={query_list:JSON.stringify(this.searchFilterParams),conditions:{},page:this.pagination.current,page_size:this.pagination.limit,order:"",bk_biz_id:this.appName,biz_type:"biz",bk_obj_id:"",bk_inst_id:""},this.tableLoading=!0,this.$api.Resource[this.configList.listUrl](t).then((function(t){if(!t.result)return e.$error(t.message),e.hostList=[],!1;e.hostList=t.data.info,e.pagination.count=t.data.count})).finally((function(){e.tableLoading=!1}))},e.prototype.handleIframeFocus=function(){return""},I([Object(a.b)("handleIframeFocus")],e.prototype,"handleIframeFocus",null),e=I([Object(a.a)({components:{ComTable:s.a,SelectInput:C.a,RemoteConnect:S.a}})],e)}(a.e),j=O,N=Object(h.a)(j,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("bk-sideslider",{attrs:{width:700,"is-show":t.visible,"quick-close":!0,"ext-cls":"common-dialog-wrapper",title:"选择主机",transfer:!1,"before-close":t.cancel},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e},hidden:t.handleIframeFocus}},[o("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[o("div",{staticClass:"nav-area"},[o("bk-select",{staticStyle:{width:"200px"},attrs:{searchable:"",placeholder:"请选择应用名称"},on:{change:t.initData},model:{value:t.appName,callback:function(e){t.appName=e},expression:"appName"}},t._l(t.belongAppList,(function(t){return o("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v(" "),o("SelectInput",{staticClass:"search-select",attrs:{data:t.searchSelectData},on:{search:t.handleSearch,change:t.handleChange}})],1),t._v(" "),o("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"hostTable",attrs:{columns:t.columns,data:t.hostList,pagination:t.pagination,"max-height":t.maxHeight},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"operation",fn:function(e){var n=e.row;return[o("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.isLink(n)},on:{click:function(e){return t.handleConnect(n)}}},[t._v("\n                        "+t._s(t.isLink(n)?"已连接":"远程连接")+"\n                    ")])]}}])})],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("bk-button",{on:{click:t.cancel}},[t._v("\n                关闭\n            ")])],1)]),t._v(" "),o("RemoteConnect",{ref:"remoteConnect",attrs:{"is-link":!0},on:{confirmConnect:t.confirmConnect}})],1)}),[],!1,null,"1bc7cfcb",null).exports,$=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),z=function(){return z=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},z.apply(this,arguments)},P=function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};i.default.use(D.a);var R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iframeUrl="",e.isFullScreen=!1,e.isCollapsed=!1,e.remoteData={},e.btnWidth="",e.ipList=[],e.currentNode={},e.isNodata=!1,e}return $(e,t),e.prototype.created=function(){if(this.remoteData=z({},this.$route.query),!sessionStorage.getItem("remoteConnectMsg")){var t=[z(z({id:this.remoteData.hostId,name:this.remoteData.ip,url:window.remote_url+"?connectCode="+this.remoteData.connectCode},this.remoteData),{children:[]})];sessionStorage.setItem("remoteConnectMsg",JSON.stringify(t))}},e.prototype.mounted=function(){var t=this;this.getIpList();var e=document.querySelector(".container-content");e&&(e.style.padding=0);var o=document.querySelector("#frame-box");o&&(o.style.overflow="auto"),this.setBtnLocation(),window.onresize=function(){t.setBtnLocation()}},e.prototype.beforeDestroy=function(){window.onresize=null},e.prototype.handleCollapse=function(){this.isCollapsed=!this.isCollapsed},e.prototype.checkInfo=function(){this.$refs.detailInfo.show()},e.prototype.selectHost=function(){this.$refs.hostDialog.show()},e.prototype.updateIpList=function(t){sessionStorage.removeItem("ipList"),this.isNodata=!1;var e=JSON.parse(sessionStorage.getItem("remoteConnectMsg")||"[]"),o=window.remote_url+"?connectCode="+t.connectCode,n=z(z({id:t.hostId,name:t.ip,url:o},t),{children:[]});e.push(n),sessionStorage.setItem("remoteConnectMsg",JSON.stringify(e)),this.getIpList(n)},e.prototype.deleteNode=function(t){var e=this;this.$bkInfo({title:"确定删除该远程连接吗？",subTitle:"删除后需要重新创建",theme:"primary",confirmFn:function(){var o=JSON.parse(sessionStorage.getItem("remoteConnectMsg")||"[]"),n=o.findIndex((function(e){return e.hostId===t.hostId}));-1!==n&&(o.splice(n,1),sessionStorage.setItem("remoteConnectMsg",JSON.stringify(o)),e.getIpList(),e.handleIframeFocus())},cancelFn:function(){e.handleIframeFocus()}})},e.prototype.getIpList=function(t){var e,o=this;if(void 0===t&&(t={}),this.ipList=JSON.parse(sessionStorage.getItem("remoteConnectMsg")||"[]"),!this.ipList.length)return sessionStorage.setItem("ipList","nodata"),void(this.isNodata="nodata"===sessionStorage.getItem("ipList"));var n=this.ipList.at(0),i=null===(e=n.children)||void 0===e?void 0:e.at(0),a=t.id||(null==i?void 0:i.id)||n.id;this.$nextTick((function(){o.$refs.tree.setSelected(a),o.$refs.tree.setExpanded(a)}))},e.prototype.beforeSelect=function(t){var e=t.data.url;return this.currentNode=t.data,this.iframeUrl=e,this.setBtnLocation(),!0},e.prototype.setBtnLocation=function(){var t=220+this.currentNode.location-document.body.offsetWidth<=0?this.currentNode.location+220:document.body.offsetWidth;this.btnWidth=.9*t+"px",this.handleIframeFocus()},e.prototype.handleIframeFocus=function(){var t=document.querySelector("#frame-box");t&&t.contentWindow.focus()},e.prototype.handleUpload=function(){this.$refs.uploadDialog.show(this.currentNode)},e.prototype.handleFullScreen=function(){var t=this;this.isFullScreen=!this.isFullScreen,setTimeout((function(){t.handleIframeFocus()}),100)},e.prototype.onLoaded=function(){var t,e=null===(t=document.querySelector("#frame-box"))||void 0===t?void 0:t.contentWindow.document.querySelector("#display");e&&(e.style.cursor="default")},e=P([Object(a.a)({components:{WikiIframe:r.a,UploadDialog:m,DetailInfo:w,HostDialog:N}})],e)}(a.e),T=R,U=Object(h.a)(T,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("fullscreen",{staticClass:"remote-connect",attrs:{fullscreen:t.isFullScreen,"page-only":!1,"fullscreen-class":"fullscreen",teleport:!1},on:{"update:fullscreen":function(e){t.isFullScreen=e}}},[o("div",{staticClass:"remote-upload",on:{click:t.handleIframeFocus}},[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.isFullScreen,expression:"!isFullScreen"}],class:["ip-list",t.isCollapsed?"tree-hide":"tree-open"]},[o("bk-big-tree",{ref:"tree",attrs:{data:t.ipList,"enable-title-tip":"",selectable:!0,"show-checkbox":!1,"show-link-line":!1,"use-default-empty":!0,options:{idKey:"id",nameKey:"name"},"before-select":t.beforeSelect},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return o("div",{staticClass:"tree-node"},[o("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"tree-node-name"},[t._v(t._s(n.name))]),t._v(" "),o("i",{staticClass:"close-ip bk-icon icon-close-circle-shape",on:{click:function(e){return e.stopPropagation(),t.deleteNode(n)}}})])}}])}),t._v(" "),o("bk-button",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapsed,expression:"!isCollapsed"}],staticClass:"add-connect",attrs:{theme:"primary","icon-right":"arrows-right"},on:{click:t.selectHost}},[t._v("\n                新建远程连接\n            ")])],1),t._v(" "),t.isNodata?o("div",{staticClass:"no-data"},[o("bk-exception",{attrs:{type:"empty"}},[o("span",[t._v("暂无远程连接")])])],1):o("iframe",{attrs:{src:t.iframeUrl,frameborder:"0",width:"100%",height:"100%",id:"frame-box"},on:{load:t.onLoaded}}),t._v(" "),t.isNodata?t._e():o("div",{staticClass:"btn-area",style:{left:t.btnWidth}},[o("span",[o("i",{staticClass:"cw-icon weops-zhu-ji",on:{click:t.checkInfo}})]),t._v(" "),o("span",[o("i",{staticClass:"cw-icon weops-folder",on:{click:t.handleUpload}})]),t._v(" "),o("span",[o("i",{class:["cw-icon",t.isFullScreen?"weops-exit-full-screen":"weops-full-view"],on:{click:t.handleFullScreen}})])]),t._v(" "),o("i",{directives:[{name:"show",rawName:"v-show",value:!t.isFullScreen,expression:"!isFullScreen"}],class:["resize-collapse","bk-icon",t.isCollapsed?"icon-angle-right":"icon-angle-left",t.isCollapsed?"is-collapsed":"is-opened"],on:{click:t.handleCollapse}})]),t._v(" "),o("UploadDialog",{ref:"uploadDialog",on:{handleIframeFocus:t.handleIframeFocus}}),t._v(" "),o("detail-info",{ref:"detailInfo",attrs:{"current-node":t.currentNode},on:{handleIframeFocus:t.handleIframeFocus}}),t._v(" "),o("HostDialog",{ref:"hostDialog",on:{handleIframeFocus:t.handleIframeFocus,updateIpList:t.updateIpList}})],1)}),[],!1,null,"49c20178",null);e.default=U.exports}}]);