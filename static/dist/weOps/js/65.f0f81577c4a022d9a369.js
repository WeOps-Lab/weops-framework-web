(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{uZQN:function(t,e,n){"use strict";n.r(e);var a,i=n("eZSr"),r=n("yn4b"),o=n("JnIg"),s=n("G0B5"),l=n("TMgX"),c=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t,e,n,a){var i,r=arguments.length,o=r<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,a);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o},h=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{l(a.next(t))}catch(t){r(t)}}function s(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}l((a=a.apply(t,e||[])).next())}))},p=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bizLoading=!1,e.bizOptions=[],e.bizId="all",e.searchVal="",e.totalData=[{name:"活动告警数",count:0,key:"unnormal_event_num",max:0},{name:"可用率低于100%",count:0,key:"available",than:"less",max:100},{name:"平均响应时长大于1秒",count:0,key:"task_duration",max:1e3}],e.pagination={current:1,count:1,limit:10},e.levelObj={fatal:"致命",warning:"预警",remain:"提醒"},e.levelColor={fatal:"#EA3636",warning:"#FF8000",remain:"#FACF59"},e.data=[],e.loading=!1,e.order="descending",e.search={field:"name",value:""},e.activeCard={},e.timer=null,e.filterParams={},e.taskStatusMap=l.p,e.taskStatusColorMap=l.o,e}return c(e,t),Object.defineProperty(e.prototype,"resultData",{get:function(){var t=(this.pagination.current-1)*this.pagination.limit;t>=this.data.length&&(t=0);var e=this.pagination.current*this.pagination.limit;return e>=this.data.length&&(e=this.data.length),this.handleData().slice(t,e)},enumerable:!1,configurable:!0}),e.prototype.destroyed=function(){this.clearTimer()},e.prototype.created=function(){this.columns=JSON.parse(JSON.stringify(l.n)),this.getBizList(),this.getTaskList(),this.setTimer()},e.prototype.getBizList=function(){return h(this,void 0,void 0,(function(){var t,e,n,a;return p(this,(function(i){switch(i.label){case 0:this.bizLoading=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.$api.monitorAlarm.getBizList()];case 2:return(t=i.sent()).result?(e=t.data,n=[{bk_biz_id:"all",bk_biz_name:"全部"}],this.bizOptions=n.concat(e),a=parseInt(this.$route.params.bizId),this.bizId=a||this.bizOptions[0].bk_biz_id,[3,4]):(this.bizOptions=[],[2,this.$error(t.message)]);case 3:return this.bizLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getTaskList=function(t){return h(this,void 0,void 0,(function(){var e,n=this;return p(this,(function(a){switch(a.label){case 0:this.loading=!t,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.monitorAlarm.getTaskList({},{cancelPrevious:!0})];case 2:return(e=a.sent()).result?(this.data=e.data.items,this.totalData.forEach((function(t){t.count=n.getLen(t.key,t.max,"available"===t.key?"less":"greater")})),t&&this.handleSortData(),[3,4]):(this.data=[],this.pagination.count=0,[2,this.$error(e.message)]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.toRefresh=function(){this.setTimer(),this.getBizList(),this.getTaskList(),this.setTimer()},e.prototype.setTimer=function(){var t=this;this.timer=setInterval((function(){t.getTaskList(!0)}),6e4)},e.prototype.clearTimer=function(){this.timer&&clearInterval(this.timer)},e.prototype.getLen=function(t,e,n){return this.handleData().filter((function(a){return"less"===n?a[t]<e:a[t]>e})).length},e.prototype.colorStripe=function(t){return t?100===t?"success":t<80?"danger":"warning":"warning"},e.prototype.handleLimitChange=function(t){this.pagination.current=1,this.pagination.limit=t},e.prototype.handlePageChange=function(t){this.pagination.current=t},e.prototype.handleFilterChange=function(t){this.pagination.current=1,this.filterParams=t},e.prototype.handleSortChange=function(t){t.column;var e=t.prop,n=t.order;this.order=n,this.orderProp=e,this.handleSortData()},e.prototype.handleSortData=function(){var t=this.order,e=this.orderProp,n=function(t){return t&&"--"!==t?t:0};t&&e&&this.data.sort((function(a,i){return"descending"===t?n(i[e])-n(a[e]):n(a[e])-n(i[e])}))},e.prototype.toTabType=function(t,e){this.activeCard={flag:t,key:e.key},this.toSearch()},e.prototype.toSearch=function(){this.pagination.current=1},e.prototype.toChangeBiz=function(){var t=this;this.pagination.current=1;var e=this.data;"all"!==this.bizId&&(e=e.filter((function(e){return e.bk_biz_id===t.bizId})));this.totalData.forEach((function(t){var n,a,i;t.count=(n=t.key,a=t.max,i="available"===t.key?"less":"greater",e.filter((function(t){return"less"===i?t[n]<a:t[n]>a})).length)}))},e.prototype.handleData=function(){var t=this,e=this.data.filter((function(e){return(e[t.search.field]||"").indexOf(t.search.value)>=0}));if("all"!==this.bizId&&(e=e.filter((function(e){return e.bk_biz_id===t.bizId}))),this.filterParams&&Object.keys(this.filterParams).length&&Object.values(this.filterParams)[0].length&&(e=e.filter((function(e){return Object.values(t.filterParams)[0].includes(e[Object.keys(t.filterParams)[0]])}))),this.activeCard.flag){var n=this.totalData.find((function(e){return e.key===t.activeCard.key}));n&&(e=e.filter((function(t){return"less"===n.than?t[n.key]<n.max:t[n.key]>n.max})))}return this.pagination.count=e.length,e},e.prototype.getAlarmCount=function(t){return(t||[]).reduce((function(t,e){return t+e.count}),0)},e.prototype.checkDetail=function(t,e){this.$refs.webMonitorDetail.show(t,e)},e=u([Object(s.a)({components:{TypeCard:i.a,taskDetail:r.a,WebsiteTable:o.a}})],e)}(s.e),d=f,b=n("KHd+"),v=Object(b.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"monitor-common-container",attrs:{id:"website-monitor"}},[1!==t.bizOptions.length||t.bizLoading?[n("div",{staticClass:"header-sub-title mb15"},[n("bk-select",{staticStyle:{width:"250px"},attrs:{searchable:"",clearable:!1,loading:t.bizLoading,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},on:{change:t.toChangeBiz},model:{value:t.bizId,callback:function(e){t.bizId=e},expression:"bizId"}},t._l(t.bizOptions,(function(t){return n("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1),t._v(" "),n("div",{staticClass:"header-icon"},[n("bk-icon",{attrs:{type:"refresh"},on:{click:t.toRefresh}})],1)],1),t._v(" "),n("type-card",{attrs:{lists:t.totalData},on:{click:t.toTabType}}),t._v(" "),n("div",{staticClass:"website-monitor-wrapper mt20"},[n("div",{staticClass:"search-container"},[n("bk-select",{staticStyle:{width:"160px"},attrs:{clearable:!1},model:{value:t.search.field,callback:function(e){t.$set(t.search,"field",e)},expression:"search.field"}},[n("bk-option",{attrs:{id:"name",name:"任务名称"}}),t._v(" "),n("bk-option",{attrs:{id:"url",name:"目标地址"}})],1),t._v(" "),n("bk-input",{staticClass:"search-input",staticStyle:{width:"270px"},attrs:{clearable:!0,placeholder:"请输入"},on:{change:t.toSearch},model:{value:t.search.value,callback:function(e){t.$set(t.search,"value",e)},expression:"search.value"}})],1),t._v(" "),n("website-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:11},expression:"{ isLoading: loading, zIndex: 11 }"}],staticClass:"mt10",attrs:{size:"medium",data:t.resultData,"none-border":!0,columns:t.columns,pagination:t.pagination},on:{"filter-change":t.handleFilterChange,"sort-change":t.handleSortChange,"page-change":t.handlePageChange,"page-limit-change":t.handleLimitChange},scopedSlots:t._u([{key:"name",fn:function(e){var a=e.row;return[n("div",{staticClass:"column-flex"},[n("bk-button",{attrs:{text:""},on:{click:function(e){return t.checkDetail(a)}}},[t._v("\n                            "+t._s(a.name||"--")+"\n                        ")]),t._v(" "),n("p",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"mb0 mt0"},[t._v("\n                            "+t._s(a.url||"--")+"\n                        ")])],1)]}},{key:"status",fn:function(e){var a=e.row;return[n("span",{staticClass:"alarm-status",style:{background:t.taskStatusColorMap[a.status]}}),t._v("\n                    "+t._s(t.taskStatusMap[a.status])+"\n                ")]}},{key:"alarmCount",fn:function(e){var a=e.row;return[n("bk-popover",{attrs:{placement:"right"}},[a.unnormal_event_num?n("span",{class:["alarm-count","unresolve"],on:{click:function(e){return t.checkDetail(a,"alarm")}}},[t._v("\n                            "+t._s(a.unnormal_event_num)+"\n                        ")]):t._e(),t._v(" "),n("div",{attrs:{slot:"content"},slot:"content"},t._l(a.status_count,(function(e,a){return n("p",{key:a,staticClass:"alarm-count-row"},[n("span",{style:{background:t.levelColor[a]}}),t._v("\n                                "+t._s(t.levelObj[a])+"("+t._s(e)+")\n                            ")])})),0)]),t._v(" "),a.unnormal_event_num?t._e():n("span",{staticClass:"alarm-count",on:{click:function(e){return t.checkDetail(a,"alarm")}}},[t._v("\n                        "+t._s(a.unnormal_event_num)+"\n                    ")])]}},{key:"duration",fn:function(e){var a=e.row;return[n("span",[t._v("\n                        "+t._s(a.task_duration?a.task_duration+"ms":"--")+"\n                    ")])]}},{key:"available",fn:function(e){var a=e.row;return[n("p",{staticClass:"mt0 mb5"},[a.available||0===a.available?[t._v("\n                            "+t._s(a.available)+"%\n                        ")]:[t._v("--")]],2),t._v(" "),n("bk-progress",{attrs:{percent:a.available/100,"show-text":!1,theme:t.colorStripe(a.available)}})]}}])})],1)]:n("div",{staticClass:"exception-wrap"},[n("bk-exception",{staticClass:"exception-wrap-item",attrs:{type:"403"}},[n("span",[t._v("无业务权限")]),t._v(" "),n("div",{staticClass:"text-subtitle"},[t._v("\n                你没有相应业务的访问权限，请前往申请相关业务权限\n            ")])])],1),t._v(" "),n("task-detail",{ref:"webMonitorDetail"})],2)}),[],!1,null,"2cb3f40a",null);e.default=v.exports}}]);