(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{"Y/+9":function(t,e,i){"use strict";i.r(e);var n,a=i("wd/R"),o=i.n(a),r=i("ac6i"),s=i("uMZD"),l=i("jJsG"),c=i("B6a/"),u=i("G0B5"),p=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=function(t,e,i,n){var a,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,i,r):a(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShowEllipsis=!0,e.baseUsage={content:e.value,showOnInit:!0,placements:["top-start"]},e}return p(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.outerShellWidth+"px"},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.$refs.txt.offsetWidth>this.outerShellWidth&&(this.isShowEllipsis=!1)},e.prototype.toClick=function(){this.$emit("click")},h([Object(u.d)({type:String,default:""})],e.prototype,"value",void 0),h([Object(u.d)({type:Number,default:1})],e.prototype,"outerShellWidth",void 0),e=h([Object(u.a)({name:"text-ellipsis"})],e)}(u.e),b=d,f=i("KHd+"),v=Object(f.a)(b,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"text-ellipsis"},on:{click:t.toClick}},[i("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.baseUsage,expression:"baseUsage"}],staticClass:"content-cls",style:{width:t.width},attrs:{disabled:t.isShowEllipsis,delay:[0,0]}},[i("label",{ref:"txt"},[t._v(t._s(t.value))])])])}),[],!1,null,"4ef507e0",null).exports,m=i("yn4b"),g=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),y=function(){return y=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},y.apply(this,arguments)},_=function(t,e,i,n){var a,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,i,r):a(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},k=function(t,e,i,n){return new(i||(i=Promise))((function(a,o){function r(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,s)}l((n=n.apply(t,e||[])).next())}))},w=function(t,e){var i,n,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],n=0}finally{i=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.totalData=[{name:"活动告警",count:0,key:"count"},{name:"致命",count:0,key:"fatal"},{name:"预警",count:0,key:"warning"},{name:"提醒",count:0,key:"remain"}],e.panels=[{name:"host",label:"主机",count:0}],e.activeType="",e.active="host",e.bizLoading=!1,e.bizId="",e.bizName="",e.bizOptions=[],e.loading=!1,e.taskList=[],e.taskCount=0,e.objList=[],e.viewDetail={},e.viewTime=null,e.taskContentHeight=0,e.countLoading=!0,e.page=1,e.total=-1,e.bottomLoadingOptions={size:"small",isLoading:!1},e.alarmData=[],e}return g(e,t),Object.defineProperty(e.prototype,"menuPanels",{get:function(){return this.panels.filter((function(t){return t.count}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeAlarmData",{get:function(){var t=this.$deepClone(this.totalData);return t.shift(),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topDistanceHeight",{get:function(){return this.taskContentHeight+310},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxHeight",{get:function(){return document.body.clientHeight-350},enumerable:!1,configurable:!0}),e.prototype.created=function(){this.loading=!0,this.statusMap={fatal:"致命",warning:"预警",remain:"提醒",normal:"正常"},this.getMonitorAllTab(),this.getBizList()},e.prototype.getBizList=function(){return k(this,void 0,void 0,(function(){var t,e,i;return w(this,(function(n){switch(n.label){case 0:this.bizLoading=!0,t=parseInt(this.$route.query.appId),n.label=1;case 1:return n.trys.push([1,,4,5]),[4,this.$api.monitorAlarm.getBizList()];case 2:return(e=n.sent()).result?(this.bizOptions=e.data,i=this.bizOptions.find((function(e){return e.bk_biz_id===t})),this.bizName=t?i.bk_biz_name:e.data[0].bk_biz_name,this.bizId=t||e.data[0].bk_biz_id,[4,this.getAlarmStatistics()]):(this.bizOptions=[],[2,this.$error(e.message)]);case 3:return n.sent(),[3,5];case 4:return this.bizLoading=!1,[7];case 5:return[2]}}))}))},e.prototype.getTaskListByBiz=function(){return k(this,void 0,void 0,(function(){var t,e,i,n=this;return w(this,(function(a){switch(a.label){case 0:this.loading=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.monitorAlarm.getTaskListByBiz({bk_biz_id:this.bizId})];case 2:return(t=a.sent()).result?(e=t.data,i=t.count,this.taskList=e,this.taskCount=i,[3,4]):(this.taskList=[],this.taskCount=0,[2,this.$error(t.message)]);case 3:return this.loading=!1,this.$nextTick((function(){var t=document.querySelector(".website-monitor-container");n.taskContentHeight=(null==t?void 0:t.clientHeight)+20||0})),[7];case 4:return[2]}}))}))},e.prototype.getMonitorAllTab=function(){return k(this,void 0,void 0,(function(){var t,e;return w(this,(function(i){switch(i.label){case 0:return[4,this.$api.monitorAlarm.getMonitorAllTab()];case 1:return(t=i.sent()).result&&(e=t.data.map((function(t){return{name:t.group_id,label:t.group_name,count:0}})),this.panels=this.panels.concat(e)),[2]}}))}))},e.prototype.getInstCount=function(){return k(this,void 0,void 0,(function(){var t;return w(this,(function(e){switch(e.label){case 0:return e.trys.push([0,,2,3]),[4,this.$api.monitorAlarm.getInstCount({bk_biz_id:this.bizId})];case 1:return(t=e.sent()).result&&(this.panels.forEach((function(e){e.count=t.data[e.name]})),this.active=this.menuPanels[0].name),[3,3];case 2:return this.countLoading=!1,[7];case 3:return[2]}}))}))},e.prototype.getAlarmStatistics=function(){var t;return k(this,void 0,void 0,(function(){var e,i,n,a,o,r=this;return w(this,(function(s){switch(s.label){case 0:return[4,this.$api.monitorAlarm.getActivesAlarmStatistics({bk_biz_id:this.bizId})];case 1:return(e=s.sent()).result?(i=e.data,n=0,Object.keys(i).forEach((function(t){n+=i[t],r.totalData.find((function(e){return e.key===t})).count=i[t]})),this.totalData.find((function(t){return"count"===t.key})).count=n,(a=this.$deepClone(this.totalData)).shift(),o=a.findIndex((function(t){return t.count})),this.activeType=(null===(t=a[o])||void 0===t?void 0:t.key)||"",[4,this.getAlarmList()]):[2,this.$error(e.message)];case 2:return s.sent(),[2]}}))}))},e.prototype.changeAlarmTab=function(t){return!!t.count&&(this.activeType===t.key?(this.activeType="",!1):(this.total=-1,this.alarmData=[],this.page=1,this.activeType=t.key,void this.getAlarmList(t.key)))},e.prototype.getAlarmList=function(){var t,e;return k(this,void 0,void 0,(function(){var i;return w(this,(function(n){switch(n.label){case 0:if(!this.activeType)return[2];if(this.total===this.alarmData.length)return[2];this.bottomLoadingOptions.isLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.monitorAlarm.getActiveAlarm({page:this.page,size:50,query:{level:[this.activeType],bk_biz_id:this.bizId}})];case 2:return(i=n.sent()).result&&(this.total=null===(t=i.data)||void 0===t?void 0:t.count,this.alarmData=this.alarmData.concat(null===(e=i.data)||void 0===e?void 0:e.items)),[3,4];case 3:return this.page+=1,this.bottomLoadingOptions.isLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.cellClick=function(t){var e;null===(e=this.$refs.alarmDetail)||void 0===e||e.showSlider(t)},e.prototype.refreshAlarmList=function(){this.total=-1,this.alarmData=[],this.page=1,this.getAlarmList(this.activeType)},e.prototype.toRefresh=function(){var t=this;this.getBizList(),this.$nextTick((function(){var e;null===(e=t.$refs.resTable)||void 0===e||e.fetchInitTime()}))},e.prototype.toChangeBiz=function(t){var e=this;this.bizName=this.bizOptions.find((function(e){return e.bk_biz_id===t})).bk_biz_name,this.getInstCount(),this.getAlarmStatistics(),this.getTaskListByBiz(),this.$nextTick((function(){var t;null===(t=e.$refs.resTable)||void 0===t||t.resetPage()})),this.refreshAlarmList()},e.prototype.toTabMenu=function(t){var e;this.active=t.name,"host"!==t.name?this.getMonitorGroup(t):null===(e=this.$refs.resTable)||void 0===e||e.fetchInitTime()},e.prototype.getMonitorGroup=function(t){return k(this,void 0,void 0,(function(){var e,i,n=this;return w(this,(function(a){switch(a.label){case 0:return[4,this.$api.monitorAlarm.getMonitorGroup({group_id:t.name})];case 1:return(e=a.sent()).result&&(i=e.data,this.objList=i),this.$nextTick((function(){var t;null===(t=n.$refs.resTable)||void 0===t||t.fetchInitTime()})),[2]}}))}))},e.prototype.colorBg=function(t){return{fatal:"#F43B2C",warning:"#FF9326",remain:"#FFEC99",normal:"#27C274"}[t]},e.prototype.checkDetail=function(t){this.viewTime=[],this.$refs.webMonitorDetail.show(y({bk_biz_id:this.bizId},t))},e.prototype.handleTaskDetail=function(t,e){var i=e.time_range.split(" "),n=i[1].split("-"),a=i[0];if("00:00"===n[1].slice(0,5)){var r=new Date(i[0]);a=o()(r.setDate(r.getDate()+1)).format("YYYY-MM-DD")}this.viewTime=[i[0]+" "+n[0].slice(0,5),a+" "+n[1].slice(0,5)],this.$refs.webMonitorDetail.show(y({bk_biz_id:this.bizId},t))},e.prototype.handleCheckMore=function(){this.$router.push({name:"WebsiteMonitor",params:{bizId:this.bizId}})},e=_([Object(u.a)({components:{MenuTab:r.a,HeaderSub:s.a,TextEllipsis:v,ResourceTable:l.a,TaskDetail:m.a,AlarmDetail:c.a}})],e)}(u.e),C=z,x=Object(f.a)(C,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"application"}},[t.bizOptions.length||t.bizLoading?t._e():i("div",{staticClass:"exception-wrap"},[i("bk-exception",{staticClass:"exception-wrap-item",attrs:{type:"403"}},[i("span",[t._v("无业务权限")]),t._v(" "),i("div",{staticClass:"text-subtitle"},[t._v("\n                你没有相应业务的访问权限，请前往申请相关业务权限\n            ")])])],1),t._v(" "),i("div",{directives:[{name:"elsemonirtor",rawName:"v-elsemonirtor"}],staticClass:"application-container"},[i("div",{staticClass:"application-left-content"},[i("div",{staticClass:"header-sub-title mb15"},[i("bk-select",{staticStyle:{width:"250px"},attrs:{searchable:"",clearable:!1,loading:t.bizLoading,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},on:{change:t.toChangeBiz},model:{value:t.bizId,callback:function(e){t.bizId=e},expression:"bizId"}},t._l(t.bizOptions,(function(t){return i("bk-option",{key:t.bk_biz_id,attrs:{id:t.bk_biz_id,name:t.bk_biz_name}})})),1),t._v(" "),i("div",{staticClass:"header-icon"},[i("bk-icon",{attrs:{title:"刷新",type:"refresh"},on:{click:t.toRefresh}})],1)],1),t._v(" "),t.taskList.length&&!t.loading?i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:11},expression:"{ isLoading: loading, zIndex: 11 }"}],staticClass:"website-monitor-container"},[i("div",{staticClass:"task-content-container"},[t._m(0),t._v(" "),i("div",{staticClass:"task-content-wrapper"},[t._l(t.taskList,(function(e){return i("div",{key:e.name,staticClass:"task-row"},[i("div",{staticClass:"task-title"},[i("text-ellipsis",{attrs:{"outer-shell-width":130,value:e.name},on:{click:function(i){return t.checkDetail(e)}}}),t._v(" "),i("text-ellipsis",{attrs:{"outer-shell-width":200,value:e.url}})],1),t._v(" "),i("div",{staticClass:"task-content bg"},[i("bk-container",{attrs:{gutter:4,margin:2,flex:!0}},[i("bk-row",t._l(e.available_list,(function(n,a){return i("bk-col",{key:a},[i("bk-popover",{attrs:{placement:"right","tippy-options":{interactive:!1}}},[i("span",{staticClass:"col",style:{background:t.colorBg(n.level)},on:{click:function(i){return t.handleTaskDetail(e,n)}}}),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"pb15"},[i("p",[t._v(t._s(n.time_range))]),t._v(" "),i("ul",{staticClass:"tip-content-ul"},t._l(Object.keys(n.value),(function(e){return i("li",{key:e},[i("span",{staticClass:"tip-content-span",style:{background:t.colorBg(e)}}),t._v("\n                                                                "+t._s(t.statusMap[e])+" ("+t._s(n.value[e])+")\n                                                            ")])})),0)])])])],1)})),1)],1)],1)])})),t._v(" "),t.taskCount>10?i("div",{staticClass:"more-button",on:{click:t.handleCheckMore}},[t._v("\n                            查看更多\n                        ")]):t._e()],2)])]):t._e(),t._v(" "),t.loading?i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:11},expression:"{ isLoading: loading, zIndex: 11 }"}],staticStyle:{"min-height":"200px","margin-bottom":"20px"}}):t._e(),t._v(" "),t.menuPanels.length?[i("h3",{staticClass:"mt0 pl10"},[t._v("应用资产")]),t._v(" "),i("div",{staticClass:"application-resource-wrapper"},[i("resource-table",{key:t.bizId+t.active,ref:"resTable",attrs:{active:t.active,"biz-id":t.bizId,"open-slot":!0,"biz-name":t.bizName,"obj-list":t.objList,init:"host"===t.active,"top-distance-height":t.topDistanceHeight}},[t.countLoading?t._e():i("template",{slot:"extContent"},[i("menu-tab",{attrs:{type:"text",panels:t.menuPanels,"active-panel":t.active},on:{click:t.toTabMenu}})],1)],2)],1)]:t._e(),t._v(" "),t.taskList.length||t.menuPanels.length||t.loading?t._e():[i("bk-exception",{staticClass:"exception-wrap-item",attrs:{type:"empty"}},[i("span",[t._v("该应用暂未接入任何资产")])])]],2),t._v(" "),i("div",{staticClass:"application-right-content"},[i("h3",[t._v("活动告警")]),t._v(" "),i("ul",t._l(t.activeAlarmData,(function(e){return i("div",{key:e.key},[i("li",{staticClass:"alarm-type-li",on:{click:function(i){return t.changeAlarmTab(e)}}},[i("bk-icon",{directives:[{name:"show",rawName:"v-show",value:e.count,expression:"item.count"}],attrs:{type:t.activeType===e.key?"down-shape":"right-shape"}}),t._v(" "),i("span",{class:["type-text",e.key]},[t._v(t._s(e.name))]),t._v(" "),i("span",{staticClass:"count"},[t._v(t._s(e.count))])],1),t._v(" "),t.activeType===e.key?i("div",[1===t.page&&t.bottomLoadingOptions.isLoading?i("div",{staticStyle:{"text-align":"center",margin:"10px 0"}},[i("bk-spin",{attrs:{theme:"default"}})],1):i("bk-table",{staticClass:"alarm-table",attrs:{"show-header":!1,"max-height":t.maxHeight,"col-border":!1,"row-border":!1,"outer-border":!1,data:t.alarmData,"scroll-loading":t.bottomLoadingOptions},on:{"scroll-end":t.getAlarmList}},[i("bk-table-column",{attrs:{label:"告警名称",prop:"name","show-overflow-tooltip":""}}),t._v(" "),i("bk-table-column",{attrs:{label:"操作",width:"70px",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[i("span",{staticStyle:{color:"#1272FF",cursor:"pointer"},on:{click:function(e){return t.cellClick(n)}}},[t._v("\n                                        详情\n                                    ")])]}}],null,!0)})],1)],1):t._e()])})),0)])]),t._v(" "),i("task-detail",{ref:"webMonitorDetail",attrs:{"view-time":t.viewTime}}),t._v(" "),i("alarm-detail",{ref:"alarmDetail",on:{refresh:t.refreshAlarmList}})],1)}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("h3",{staticClass:"mt0 pl10"},[t._v("\n                        网站监测"),i("span",[t._v("-24小时状态")])])}],!1,null,"6398acb2",null);e.default=x.exports}}]);