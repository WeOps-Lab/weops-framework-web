(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{"4WWS":function(t,e,n){"use strict";n.r(e);var i,r=n("G0B5"),a=n("qz1i"),o=n("pXDs"),s=n("iwDU"),c=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(t,e,n,i){var r,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(a<3?r(o):a>3?r(e,n,o):r(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o},u=function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((i=i.apply(t,e||[])).next())}))},f=function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.articleInfo={},e}return c(e,t),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.getArticleDetial()},e.prototype.downLoad=function(t){Object(s.e)(t.link,t.name)},e.prototype.deleteArticle=function(t){return void 0===t&&(t={}),u(this,void 0,void 0,(function(){var e=this;return f(this,(function(n){return this.$BtnPermission({id:this.$route.meta.activeMenu,type:this.userInfo.username===this.articleInfo.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"})?(this.$bkInfo({title:"提示",subTitle:"确定删除该文章吗？",theme:"primary",confirmFn:function(){e.confirmDelete(t.id)}}),[2]):[2,!1]}))}))},e.prototype.confirmDelete=function(t){return u(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:this.loading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.lore.deleteAricle({id:t})];case 2:return(e=n.sent()).result?(this.$success("删除成功"),this.$router.push({name:"lore"}),[3,4]):(this.$error(e.message),[2]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.linkToTemplate=function(t){if(!this.$BtnPermission({id:this.$route.meta.activeMenu,type:this.userInfo.username===this.articleInfo.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"}))return!1;var e=this.$route.query.draftId;this.$router.push({name:"AticleOperation",query:{articleId:t.id,subName:t.title,draftId:e}})},e.prototype.handleCollect=function(t){return u(this,void 0,void 0,(function(){var e,n,i,r,a;return f(this,(function(o){switch(o.label){case 0:return e=t.id,n=t.collect,i=n?"cancelCollect":"collect",r=n?"已取消收藏":"收藏成功",[4,this.$api.lore[i]({id:e})];case 1:return(a=o.sent()).result?(this.getArticleDetial(),this.$success(r),[2]):(this.$error(a.message),[2])}}))}))},e.prototype.getArticleDetial=function(){return u(this,void 0,void 0,(function(){var t,e,n,i,r;return f(this,(function(a){switch(a.label){case 0:t=this.$route.query.id,this.loading=!0,a.label=1;case 1:return a.trys.push([1,,4,5]),[4,this.$api.lore.getArticleDetial({id:t})];case 2:return(e=a.sent()).result?(n=e.data.images,e.data.body.forEach((function(t){"photo"===t.type&&(t.content=n[t.id])})),i=this.getImageIdsOrMarkDownLists(e.data),[4,this.$api.lore.getImages({images:i})]):(this.$error(e.message),[2]);case 3:return(r=a.sent()).result?(e.data.body=this.getImageIdsOrMarkDownLists(e.data,r.data),this.articleInfo=e.data,[3,5]):(this.$error(e.message),this.articleInfo=e.data,[2]);case 4:return this.loading=!1,[7];case 5:return[2]}}))}))},e.prototype.getImageIdsOrMarkDownLists=function(t,e){var n=this.$copy(t),i=n.body||n,r=n.body?i.reduce((function(e,n){var i,r;return"photo"===n.type&&(null===(i=t.images)||void 0===i?void 0:i[n.id])&&e.push(t.images[n.id]),"file"===n.type&&(null===(r=n.content)||void 0===r?void 0:r.length)&&e.push.apply(e,n.content.map((function(t){return t.fileName}))),e}),[]):[];return i.forEach((function(n){if("markDown"===n.type){var i=n.content.replace(/\!\[.*\]\((.*?)\).*/gi,(function(t,n){return r.push(n),e?"![image.png](".concat(e[n]||n,")"):t}));n.content=i.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,(function(t,n){return r.push(n),e?'<img src="'.concat(e[n]||n,'" />'):t}))}"photo"===n.type&&e&&t.images&&(n.content=e[t.images[n.id]]),"file"===n.type&&e&&n.content.forEach((function(t){t.link=e[t.fileName]}))})),e?i:r},e=l([Object(r.a)({components:{WikiIframe:a.a,MarkDownEditor:o.a}})],e)}(r.e),p=d,h=n("KHd+"),m=Object(h.a)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"article-detail"},[n("div",{staticClass:"article-detail-main"},[n("div",{staticClass:"article-detail-main-title"},[n("bk-icon",{class:["collect-icon",t.articleInfo.collect&&"active"],attrs:{type:t.articleInfo.collect?"star-shape":"star"},on:{click:function(e){return t.handleCollect(t.articleInfo)}}}),t._v(" "),n("span",[t._v(t._s(t.articleInfo.title))])],1),t._v(" "),n("ul",{staticClass:"article-detail-main-tags"},t._l(t.articleInfo.labels,(function(e){return n("li",{key:e.id,staticClass:"tags-item"},[n("bk-tag",{attrs:{radius:"20px"}},[t._v(t._s(e.label_name))])],1)})),0),t._v(" "),n("div",{staticClass:"article-detail-main-description"},[n("div",{staticClass:"description-left"},[n("div",{staticClass:"create"},[t._v("本文章由 "+t._s(t.articleInfo.created_by)+" 创建于 "+t._s(t.articleInfo.create_time))]),t._v(" "),t.articleInfo.create_time!==t.articleInfo.update_time?n("div",[t._v("\n                    最后一次由 "+t._s(t.articleInfo.updated_by||"--")+" 修改于 "+t._s(t.articleInfo.update_time)+"\n                ")]):t._e()]),t._v(" "),t.articleInfo.created_by?n("div",{staticClass:"description-right"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:t.$route.meta.activeMenu,type:t.userInfo.username===t.articleInfo.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"},expression:"{\n                        id: $route.meta.activeMenu,\n                        type: userInfo.username === articleInfo.username ? 'manageMyArticlesAuth' : 'manageAllArticlesAuth',\n                        secondAuth: 'manageAllArticlesAuth'\n                    }"}],staticClass:"mr10",attrs:{text:"",theme:"default",icon:"edit"},on:{click:function(e){return t.linkToTemplate(t.articleInfo)}}},[t._v("\n                    编辑\n                ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:t.$route.meta.activeMenu,type:t.userInfo.username===t.articleInfo.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"},expression:"{\n                        id: $route.meta.activeMenu,\n                        type: userInfo.username === articleInfo.username ? 'manageMyArticlesAuth' : 'manageAllArticlesAuth',\n                        secondAuth: 'manageAllArticlesAuth'\n                    }"}],attrs:{text:"",theme:"default",icon:"delete"},on:{click:function(e){return t.deleteArticle(t.articleInfo)}}},[t._v("\n                    删除\n                ")])],1):t._e()])]),t._v(" "),t._l(t.articleInfo.body,(function(e){return n("div",{key:e.id},["markDown"===e.type?n("MarkDownEditor",{attrs:{"is-preview":!0,configs:{toolbarsFlag:!1,boxShadow:!1,subfield:!1,previewBackground:"#ffffff",defaultOpen:"preview",transition:!1}},model:{value:e.content,callback:function(n){t.$set(e,"content",n)},expression:"item.content"}}):"photo"===e.type?n("div",{staticClass:"photo"},[n("img",{attrs:{src:e.content,alt:"图片加载失败"}})]):"file"===e.type?n("ul",{staticClass:"file"},t._l(e.content,(function(e){return n("li",{key:e.fileName,staticClass:"file-item"},[n("span",{staticClass:"file-item-link",on:{click:function(n){return t.downLoad(e)}}},[n("i",{staticClass:"cw-icon weops-link link-icon"}),t._v(" "),n("span",[t._v(t._s(e.name)+t._s(e.fileSize))])])])})),0):n("wiki-iframe",{style:{height:e.height},attrs:{url:e.content,name:"article"}})],1)}))],2)}),[],!1,null,"fb7e9954",null);e.default=m.exports}}]);