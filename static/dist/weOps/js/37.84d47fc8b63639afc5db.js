(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"GJ/F":function(t,e,n){"use strict";n.r(e);var a,r=n("UYCs"),s=n("JnIg"),i=n("X55p"),o=n("G0B5"),c=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(t,e,n,a){var r,s=arguments.length,i=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,a);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i},u=function(t,e,n,a){return new(n||(n=Promise))((function(r,s){function i(t){try{c(a.next(t))}catch(t){s(t)}}function o(t){try{c(a.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,o)}c((a=a.apply(t,e||[])).next())}))},d=function(t,e){var n,a,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&s[0]?a.return:s[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,s[1])).done)return r;switch(a=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},p=function(t,e,n){if(n||2===arguments.length)for(var a,r=0,s=e.length;r<s;r++)!a&&r in e||(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))},_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icons=["icon-right-shape","icon-down-shape"],e.loading=!1,e.survey={health_measure_value:"--"},e.dataSet=[],e.currentType="全部",e.dataSetInfo=[],e.targetList=[{className:"danger",icon:"weops-danger",keyName:"danger_num",desc:"危险指标",color:"#ff4334"},{className:"warning",icon:"weops-early-warning",keyName:"warning_num",desc:"警告指标",color:"#ff8d09"},{className:"normal",icon:"weops-complete-fill",keyName:"normal_num",desc:"正常指标",color:"#33ce90"}],e}return c(e,t),Object.defineProperty(e.prototype,"dataInfo",{get:function(){var t=this;return this.currentType?"全部"===this.currentType?this.dataSetInfo:this.dataSetInfo.filter((function(e){return e.index_class===t.currentType})):this.dataSetInfo},enumerable:!1,configurable:!0}),e.prototype.onCaseIdChanged=function(t){t&&this.fetchData(t)},e.prototype.created=function(){this.packageName=this.$route.query.packageName},e.prototype.getPercent=function(t){return"--"===t?0:t?+t:0},e.prototype.getScanValClass=function(t,e){return e.compare_result?"normal-score":"危险"===t.risk_level?"danger-score":"warning-score"},e.prototype.getColumns=function(t){var e=t.dimension_list.map((function(t){return{key:t.dimension_key||t.key,label:t.dimension_name||t.name}}));return p(p([],e,!0),[{key:"index_label",label:t.index_name,scopedSlots:"index_label"}],!1)},e.prototype.getTableData=function(t){var e=t.index_data||[];return e&&e.length&&e.forEach((function(e){e.index_label=e.index_value+t.unit,e.dimension_list.forEach((function(t){e[t.key]=t.value}))})),e},e.prototype.goAnchor=function(t){this.$el.querySelector(t).scrollIntoView()},e.prototype.getClass=function(t){return"success"===t.compare_result?"success-bg":"danger"===t.risk_rate?"danger-bg":"warning-bg"},e.prototype.healthColor=function(t){return"number"!=typeof t?"#ddd":t<60?"#f55066":t>=60&&t<=80?"#F3C9A4":"#7BE5BB"},e.prototype.getHealthTarget=function(t){this.currentType=t.index_Name},e.prototype.fetchData=function(t){return u(this,void 0,void 0,(function(){var e,n,a=this;return d(this,(function(r){switch(r.label){case 0:this.loading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getResourceReport({id:t})];case 2:return(e=r.sent()).result?(n=e.data.statistics,this.survey=n||{},this.dataSetInfo=e.data.index_list||[],this.dataSet=[{index_Name:"全部",danger_num:0,warning_num:0,normal_num:0},{index_Name:"可用性",danger_num:0,warning_num:0,normal_num:0},{index_Name:"性能",danger_num:0,warning_num:0,normal_num:0},{index_Name:"安全",danger_num:0,warning_num:0,normal_num:0}],this.dataSetInfo.forEach((function(t){var e=a.dataSet.find((function(e){return e.index_Name===t.index_class}));if(e){if(!t.compare_result)return void a.dealItem(e,"警告"===t.risk_level?"warning_num":"danger_num");a.dealItem(e,"normal_num")}})),[3,4]):(this.$error(e.message),this.survey={},this.dataSetInfo=[],this.dataSet=[],[2]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.dealItem=function(t,e){t[e]++,this.dataSet[0][e]++},l([Object(o.f)("caseId",{deep:!0,immediate:!0})],e.prototype,"onCaseIdChanged",null),e=l([Object(o.a)({name:"host-survey",components:{collapse:r.a,comTable:s.a,progressCard:i.a},filters:{formatVal:function(t){return t||0===t?t:"--"}},props:{caseId:{type:[Number,String],default:0},isPreview:{type:Boolean,default:!1}}})],e)}(o.e),f=_,v=n("KHd+"),m=Object(v.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"survey-common-detail",attrs:{id:"host-survey"}},[n("div",{staticClass:"host-survey-header"},[n("div",{staticClass:"header-nav"},[t._v("\n            "+t._s(t.packageName)+"\n        ")]),t._v(" "),n("bk-card",{attrs:{title:"卡片标题","show-head":!1}},[n("div",{staticClass:"survey-card-content"},[n("div",{staticClass:"source-wrapper"},[n("div",{staticClass:"source-container"},[n("progress-card",{attrs:{type:"dashboard",unit:"%",percentage:t.getPercent(t.survey.pass_rate),label:"通过率"}})],1)]),t._v(" "),n("ul",{staticClass:"index-wrap"},t._l(t.targetList,(function(e){return n("li",{key:e.keyName,class:e.className},[n("i",{class:["cw-icon",e.icon],style:{color:e.color}}),t._v(" "),n("span",[t._v(t._s(e.desc))]),t._v(" "),n("b",[t._v(t._s(t._f("formatVal")(t.survey[e.keyName])))])])})),0)])])],1),t._v(" "),n("div",{staticClass:"card-wrapper",attrs:{id:"config"}},[n("bk-card",{attrs:{"collapse-icons":t.icons,"show-head":!1}},[n("div",{staticClass:"card-content"},[n("div",{staticClass:"target-option-list"},[n("ul",t._l(t.dataSet,(function(e){return n("li",{key:e.index_Name,class:[t.currentType===e.index_Name&&"active"],on:{click:function(n){return t.getHealthTarget(e)}}},[n("b",{staticClass:"option-name"},[t._v(t._s(e.index_Name))]),t._v(" "),n("span",{staticClass:"option-data"},[n("span",[t._v("危险："+t._s(t._f("formatVal")(e.danger_num)))]),t._v(" "),n("span",[t._v("警告："+t._s(t._f("formatVal")(e.warning_num)))]),t._v(" "),n("span",[t._v("正常："+t._s(t._f("formatVal")(e.normal_num)))])])])})),0)]),t._v(" "),t.dataSetInfo&&t.dataSetInfo.length>0?[t._l(t.dataInfo,(function(e,a){return n("collapse",{key:"data_"+a,attrs:{"is-show":!e.compare_result||t.isPreview}},[n("template",{slot:"title"},[e.compare_result?n("span",{staticClass:"success-sign"},[t._v("正常")]):n("span",{class:["危险"===e.risk_level?"danger-sign":"warning-sign"]},[t._v("\n                                    "+t._s(e.risk_level)+"\n                                ")]),t._v(" "),n("b",[t._v(t._s(e.index_class+"-"+e.index_name))])]),t._v(" "),n("template",{slot:"subTitle"},[n("div",{staticClass:"content-row mb10"},[n("span",[t._v("指标介绍：")]),t._v(" "),n("span",{staticClass:"advice"},[t._v(t._s(e.index_introduction||"--"))])])]),t._v(" "),n("template",{slot:"content"},[n("div",{staticClass:"content-row mb10"},[n("span",[t._v("健康值：")]),t._v(" "),n("span",[t._v(t._s(e.operation_name+e.baseline+e.unit))])]),t._v(" "),n("div",{staticClass:"content-row mb10"},[n("span",[t._v("扫描值：")]),t._v(" "),e.dimension_list&&e.dimension_list.length?[n("com-table",{staticClass:"content-row-table",attrs:{"with-border":!0,data:t.getTableData(e),columns:t.getColumns(e)},scopedSlots:t._u([{key:"index_label",fn:function(a){var r=a.row;return[n("span",{class:t.getScanValClass(e,r)},[t._v(t._s(r.index_label))])]}}],null,!0)})]:[n("span",{class:t.getScanValClass(e,e),staticStyle:{"font-weight":"600"}},[t._v("\n                                            "+t._s(e.index_data[0]&&e.index_data[0].index_value+e.unit||"--")+"\n                                        ")])]],2),t._v(" "),e.compare_result?t._e():n("div",{staticClass:"content-row mb10"},[n("span",[t._v("治愈建议：")]),t._v(" "),n("span",{staticClass:"advice"},[t._v(t._s(""+e.cure_advice||"--"))])])])],2)})),t._v(" "),t.dataInfo&&0===t.dataInfo.length&&!t.loading?[n("bk-exception",{staticClass:"exception-wrap-item exception-part",attrs:{type:"empty",scene:"part"}},[n("span",[t._v("\n                                暂无数据\n                            ")])])]:t._e()]:t._e(),t._v(" "),t.dataSetInfo&&0===t.dataSetInfo.length&&!t.loading.diff?[n("bk-exception",{staticClass:"exception-wrap-item exception-part",attrs:{type:"empty",scene:"part"}},[n("span",[t._v("\n                            暂无数据\n                        ")])])]:t._e()],2)])],1)])}),[],!1,null,"25acdc53",null).exports,h=n("uMZD"),y=n("wOnQ"),b=n.n(y),g=n("i680"),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),k=function(t,e,n,a){var r,s=arguments.length,i=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,a);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i},x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPreview=!1,e.caseList=[],e.caseId="",e}return w(e,t),Object.defineProperty(e.prototype,"baseSurvey",{get:function(){var t=this;return this.caseList.find((function(e){return e.job_task_record_id===t.caseId}))||{}},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.initHeadData()},e.prototype.nextAndBack=function(t){var e=this.getCurrentIndex(t);this.caseId=this.caseList[e].job_task_record_id},e.prototype.isForbidden=function(t){var e=this.getCurrentIndex(t);return!this.caseList[e]},e.prototype.getCurrentIndex=function(t){var e=this,n=this.caseList.findIndex((function(t){return t.job_task_record_id===e.caseId}));return-1!==n&&("next"===t?n++:n--),n},e.prototype.initHeadData=function(){var t=this.$route.query,e=t.caseList,n=t.id,a=JSON.parse(e);a.forEach((function(t){t.bk_inst_name=t.bk_inst_name||"--"})),this.caseList=a,this.caseId=+n},e.prototype.toPreview=function(){this.isPreview=!this.isPreview;var t=document.getElementById("survey"),e=t&&t.style;this.isPreview?e.cssText="position: fixed;z-index: 9999;top: 0; left: 0; width: 100vw; height: 100%; background: #fff; padding: 20px; overflow-y: scroll":e.cssText="background: #fff; padding: 20px; border-radius: 4px;"},e.prototype.toDownload=function(){var t=this,e=this.$route.query.taskName,n="".concat(e,"的").concat(this.baseSurvey.bk_inst_name,"扫描报告"),a=document.querySelector("#survey");a.style.height="initial",b()(a,{dpi:144,allowTaint:!0}).then((function(e){var a=e.width,r=e.height;a&&r||this.$error("转换pdf失败，请稍后再试");var s=a/595*842,i=r,o=0,c=595/a*r,l=e.toDataURL("image/jpeg",1),u=new g.a("","pt","a4");if(i<s)u.addImage(l,"JPEG",0,0,595,c);else for(;i>0;)u.addImage(l,"JPEG",0,o,595,c),o-=842,(i-=s)>0&&u.addPage();u.save(n+".pdf"),t.toPreview()}))},e=k([Object(o.a)({name:"host-index",components:{headerSub:h.a,instSurvey:m},filters:{formatLocalTime:function(t){return t?t.substring(0,19):"--"}}})],e)}(o.e),C=x,I=Object(v.a)(C,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"host-detail"}},[n("header-sub",{attrs:{"is-back":!1}},[n("template",{slot:"title"},[n("div",{staticClass:"host-detail-title"},[n("div",[n("bk-select",{staticStyle:{width:"200px"},attrs:{searchable:"",clearable:!1},model:{value:t.caseId,callback:function(e){t.caseId=e},expression:"caseId"}},t._l(t.caseList,(function(t){return n("bk-option",{key:t.id,attrs:{id:t.job_task_record_id,name:t.bk_inst_name}})})),1),t._v(" "),n("div",{staticClass:"mt10 row"},[t._v("\n                        上次扫描时间："+t._s(t._f("formatLocalTime")(t.baseSurvey.scan_time))+"\n                    ")]),t._v(" "),n("div",[t._v("\n                        "+t._s(t.baseSurvey.bk_biz_name||"--")+"\n                    ")])],1),t._v(" "),n("div",{staticClass:"next-and-return"},[n("bk-button",{staticClass:"mr20",attrs:{text:!0,title:"primary","hover-theme":"primary",disabled:t.isForbidden("back")},on:{click:function(e){return t.nextAndBack("back")}}},[t._v("\n                        上一个\n                    ")]),t._v(" "),n("bk-button",{attrs:{title:"primary",text:!0,"hover-theme":"primary",disabled:t.isForbidden("next")},on:{click:function(e){return t.nextAndBack("next")}}},[t._v("\n                        下一个\n                    ")]),t._v(" "),n("div",{staticClass:"cw-icon weops-download download-btn",on:{click:t.toPreview}})],1)])])],2),t._v(" "),n("div",{staticClass:"host-detail-container",attrs:{id:"survey"}},[t.isPreview?n("div",{staticClass:"detail-title"},[n("h2",[t._v("\n                "+t._s(t.baseSurvey.bk_inst_name)+"扫描报告\n            ")]),t._v(" "),n("p",[n("span",[t._v("\n                    上次扫描时间："+t._s(t.baseSurvey.scan_time)+"\n                ")]),t._v(" "),n("span",[t._v("\n                    业务名："+t._s(t.baseSurvey.bk_biz_name||"--")+"\n                ")])])]):t._e(),t._v(" "),n("inst-survey",{attrs:{"case-id":t.caseId,"is-preview":t.isPreview}})],1),t._v(" "),t.isPreview?n("div",{staticClass:"preview-button"},[n("bk-button",{staticClass:"mr20",attrs:{theme:"primary"},on:{click:t.toDownload}},[t._v("导出")]),t._v(" "),n("bk-button",{staticClass:"mr20",attrs:{theme:"default"},on:{click:t.toPreview}},[t._v("取消")])],1):t._e()],1)}),[],!1,null,"0bbad1be",null);e.default=I.exports}}]);