(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{d6Lo:function(t,e,i){"use strict";i.r(e);var n,o=i("G0B5"),r=i("/gAG"),a=i("iwDU"),s=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),l=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.methodMap={gte:">=",gt:">",lte:"<=",lt:"<",eq:"=",neq:"!="},e.algorithm=null,e.threshold=[],e.ceil=!1,e.floor=!1,e.all=!1,e}return s(e,t),e.prototype.onConfigChanged=function(t){this.algorithm=Object(a.d)(t),"Threshold"===this.type?this.handleThreshold():this.handleAdvancedLength()},e.prototype.handleAdvancedLength=function(){this.ceil=!!this.algorithmConfig.ceil,this.floor=!!this.algorithmConfig.floor,this.all=this.floor&&this.ceil},e.prototype.handleThreshold=function(){var t=this;this.threshold=[],this.algorithm.forEach((function(e){e.condition&&t.threshold.push(e.condition),t.threshold.push(t.methodMap[e.method]),t.threshold.push(e.threshold)}))},l([Object(o.d)({type:String})],e.prototype,"type",void 0),l([Object(o.d)({type:[Object,Array]})],e.prototype,"algorithmConfig",void 0),l([Object(o.d)({type:[String,Number]})],e.prototype,"unit",void 0),l([Object(o.f)("algorithmConfig",{immediate:!0})],e.prototype,"onConfigChanged",null),e=l([Object(o.a)({components:{}})],e)}(o.e),u=c,d=i("KHd+"),p=Object(d.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",["Threshold"===t.type?i("div",{staticClass:"algorithms-content"},[t._v("\n        当前值 "),t._l(t.threshold,(function(e,n){return i("span",{key:n,staticClass:"bold-span"},[t._v(t._s(e)+" ")])})),t._v("\n        时触发告警\n    ")],2):["AdvancedYearRound","AdvancedRingRatio"].includes(t.type)?i("div",{staticClass:"algorithms-content"},[t._v(" 较前 "),t.ceil||t.all?i("span",[i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.ceilInterval))]),t._v(" "),"AdvancedYearRound"===t.type?i("span",[t._v(" 天同一时刻绝对值的均值上升 ")]):"AdvancedRingRatio"===t.type?i("span",[t._v(" 个时间点的均值上升 ")]):t._e(),t._v(" "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.ceil)+"%")])]):t._e(),t._v(" "),t.all?i("span",[t._v("，或较前 ")]):t._e(),t._v(" "),t.floor||t.all?i("span",[i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.floorInterval))]),t._v(" "),"AdvancedYearRound"===t.type?i("span",[t._v(" 天同一时刻绝对值的均值下降 ")]):"AdvancedRingRatio"===t.type?i("span",[t._v(" 个时间的均值下降 ")]):t._e(),t._v(" "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.floor)+"%")])]):t._e(),t._v(" 时触发告警\n    ")]):["SimpleYearRound","SimpleRingRatio"].includes(t.type)?i("div",{staticClass:"algorithms-content"},[t.ceil||t.all?i("span",["SimpleYearRound"===t.type?i("span",[t._v(" 当前值较上周同一时刻上升 ")]):"SimpleRingRatio"===t.type?i("span",[t._v(" 当前值较上一个时刻上升 ")]):t._e(),t._v(" "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.ceil)+"%")])]):t._e(),t._v(" "),t.all?i("span",[t._v(" 或 ")]):t._e(),t._v(" "),t.floor||t.all?i("span",["SimpleYearRound"===t.type?i("span",[t._v(" 当前值较上周同一时刻下降 ")]):"SimpleRingRatio"===t.type?i("span",[t._v(" 当前值较上一个时刻下降 ")]):t._e(),t._v(" "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.floor)+"%")])]):t._e(),t._v(" 时触发告警\n    ")]):"PartialNodes"===t.type?i("div",{staticClass:"algorithms-content"},[t._v("\n        满足以上条件的拨测节点数>= "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.count))]),t._v(" 时触发告警\n    ")]):["YearRoundAmplitude","YearRoundRange","RingRatioAmplitude"].includes(t.type)?i("div",{staticClass:"algorithms-content"},[i("span",["YearRoundAmplitude"===t.type?i("span",[t._v("当前值 "),i("span",{staticClass:"bold-span"},[t._v("−")]),t._v(" 前一时刻值 "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.methodMap[t.algorithm.method]))]),t._v(" 过去 "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.days))])]):"YearRoundRange"===t.type?i("span",[t._v("当前值 "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.methodMap[t.algorithm.method]))]),t._v(" 过去 "),i("span",{staticClass:"bold-span"},[t._v(t._s(t.algorithm.days))])]):"RingRatioAmplitude"===t.type?i("span",[t._v("当前值与前一时刻值 "),i("span",{staticClass:"bold-span"},[t._v(">="+t._s(t.algorithm.threshold))])]):t._e()]),t._v(" "),i("span",["YearRoundAmplitude"===t.type?i("span",[t._v(" 天内任意一天同时刻差值 ")]):"YearRoundRange"===t.type?i("span",[t._v(" 天内同时刻绝对值 ")]):"RingRatioAmplitude"===t.type?i("span",[t._v("且，之间差值 "),i("span",{staticClass:"bold-span"},[t._v(">=")]),t._v(" 前一时刻 "),i("span",{staticClass:"bold-span"})]):t._e()]),t._v(" "),i("span",{staticClass:"bold-span"},[t._v("× "+t._s(t.algorithm.ratio)+" + "+t._s(t.algorithm.shock))])]):t._e()])}),[],!1,null,"21e8a49c",null).exports,m=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),h=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hover=!1,e.instance=null,e}return m(e,t),Object.defineProperty(e.prototype,"isCanAdd",{get:function(){return("log"===this.dataTypeLabel||"REAL_TIME"===this.aggMethod)&&0===this.alarmData.length||"log"!==this.dataTypeLabel&&"REAL_TIME"!==this.aggMethod&&this.alarmData.length<8},enumerable:!1,configurable:!0}),e.prototype.onTypeChanged=function(t){t&&this.instance&&this.handleDestroyInstance()},e.prototype.beforeDestroy=function(){this.handleDestroyInstance()},e.prototype.handlePanelChange=function(t,e){this.$emit("panel-change",t,e.level)},e.prototype.handleAddAlgorithm=function(){this.isCanAdd&&this.$emit("add-algorithm",this.typeItem.type,this.typeItem)},e.prototype.handleEditItem=function(t,e){this.$emit("edit-algorithm",this.typeItem.type,t,e)},e.prototype.handleDeleteItem=function(t,e){this.$emit("delete-algorithm",this.typeItem.type,t,e)},e.prototype.handleMouseEnter=function(t){this.instance||(this.instance=this.$bkPopover(t.target,{arrow:!0,content:"检测算法已全部添加，无算法可选"})),this.instance&&this.instance.show(100)},e.prototype.handleMouseLeave=function(){this.instance&&this.instance.hide(100)},e.prototype.handleDestroyInstance=function(){this.instance&&(this.instance.hide(0),this.instance.destroy(),this.instance=null)},h([Object(o.d)({type:Boolean,default:!0})],e.prototype,"isEdit",void 0),h([Object(o.d)({type:Object,required:!0})],e.prototype,"typeItem",void 0),h([Object(o.d)({type:[String,Number],required:!0})],e.prototype,"typeId",void 0),h([Object(o.d)({type:Boolean})],e.prototype,"expand",void 0),h([Object(o.d)({type:String,default:""})],e.prototype,"unit",void 0),h([Object(o.d)({type:String,default:""})],e.prototype,"dataTypeLabel",void 0),h([Object(o.d)({type:String,default:""})],e.prototype,"aggMethod",void 0),h([Object(o.d)({type:Array,required:!0})],e.prototype,"alarmData",void 0),h([Object(o.f)("isCanAdd")],e.prototype,"onTypeChanged",null),e=h([Object(o.a)({components:{AlgorithmsItem:p}})],e)}(o.e),v=f,y=Object(d.a)(v,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"algorithm-panel"},[i("span",{staticClass:"panel-mark",class:t.typeItem.type+"-color"}),t._v(" "),i("div",{staticClass:"panel-title"},[t._v("\n        "+t._s(t.typeItem.name)+"\n    ")]),t._v(" "),t.alarmData.length?i("ul",{staticClass:"wrap-list"},[t._l(t.alarmData,(function(e,n){return i("li",{key:n,staticClass:"wrap-list-item",on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1}}},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"item-title-name"},[t._v(t._s(e.title))]),t._v(" "),e.hover&&t.isEdit?i("i",{staticClass:"cw-icon weops-edit ml5",staticStyle:{color:"#3a84ff",cursor:"pointer"},on:{click:function(i){return t.handleEditItem(e,n)}}}):t._e(),t._v(" "),e.hover&&t.isEdit?i("i",{staticClass:"bk-icon icon-close",on:{click:function(i){return t.handleDeleteItem(e,n)}}}):t._e()]),t._v(" "),i("AlgorithmsItem",{attrs:{unit:e.algorithmUnit,"algorithm-config":e.config,type:e.type}})],1)})),t._v(" "),t.isEdit?i("div",{key:"wrap-list-add",staticClass:"wrap-list-add",class:{"check-all":!t.isCanAdd},on:{mouseenter:function(e){!t.isCanAdd&&t.handleMouseEnter(e)},mouseleave:function(e){!t.isCanAdd&&t.handleMouseLeave(e)},click:t.handleAddAlgorithm}},[i("i",{staticClass:"bk-icon icon-plus-circle"}),t._v("添加检测算法\n        ")]):t._e()],2):t._e(),t._v(" "),!t.alarmData.length&&t.isEdit?i("div",{staticClass:"panel-add",on:{click:t.handleAddAlgorithm}},[t._v("\n        添加检测算法\n    ")]):t._e()])}),[],!1,null,"4a2c8c1e",null).exports,b=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),g=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return b(e,t),e.prototype.handleAddClick=function(t){this.setAdd(t)},e.prototype.setAdd=function(t){return t},g([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"monitorEnumList",void 0),g([Object(o.d)({type:Number,default:function(){return 0}})],e.prototype,"alarmConditionListIndex",void 0),g([Object(o.d)({type:String,default:function(){return"common"},validator:function(t){return["common","character"].includes(t)}})],e.prototype,"addType",void 0),g([Object(o.d)({type:String,default:function(){return"点击添加"}})],e.prototype,"addTitle",void 0),g([Object(o.d)({type:String,default:function(){return""}})],e.prototype,"addDesc",void 0),g([Object(o.b)("set-add")],e.prototype,"setAdd",null),e=g([Object(o.a)({components:{}})],e)}(o.e),j=_,k=Object(d.a)(j,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",["common"===t.addType?i("span",{key:"preAdd",staticClass:"input-add",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleAddClick.apply(null,arguments)}}},[i("i",{staticClass:"bk-icon icon-plus"})]):i("span",{staticClass:"input-title",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleAddClick.apply(null,arguments)}}},[t._v("\n        "+t._s(t.addTitle)+"\n        "),i("span",{staticClass:"input-title-desc"},[t._v(t._s(t.addDesc))])])])}),[],!1,null,"0b888a0c",null),O=k.exports,w=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),C=function(){return C=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},C.apply(this,arguments)},I=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultValue=null,e.popoverInstance=null,e.unWatch=null,e.filterList=[],e.isItemClick=!1,e.select={id:"",name:""},e.inputValue="",e.monitorEnumValue="",e}return w(e,t),e.prototype.onValueChanged=function(t){var e;this.defaultValue=t,this.select=Object.assign(((e={})[this.idKey]="",e[this.displayKey]="",e),this.select,t)},e.prototype.onListChanged=function(t){this.filterList=this.list||[],this.filterList.forEach((function(t){t.show=void 0===t.show||!!t.show}))},Object.defineProperty(e.prototype,"isMonitorEnum",{get:function(){return"请输入数字"===this.placeholder&&this.monitorEnumList.length},enumerable:!1,configurable:!0}),e.prototype.created=function(){this.unWatch=this.$watch("inputValue",this.handleSelectChange)},e.prototype.mounted=function(){this.isMonitorEnum?this.monitorEnumValue=this.value.id:(this.defaultFocus&&this.$refs["input-"+this.keyId].focus(),this.inputValue=this.select[this.displayKey],this.handleSetInputValue(this.inputValue))},e.prototype.beforeDestroy=function(){this.unWatch&&this.unWatch(),this.popoverInstance&&(this.popoverInstance.hide(),this.popoverInstance.destroy(),this.popoverInstance=null)},e.prototype.changeMonitorEnum=function(){this.$emit("set-value",{id:this.monitorEnumValue,name:this.monitorEnumValue}),this.$emit("item-select",{id:this.monitorEnumValue,name:this.monitorEnumValue})},e.prototype.initPopover=function(){this.popoverInstance=this.$bkPopover(this.$refs["input-"+this.keyId],{content:this.$refs.setList,arrow:!1,trigger:"manul",placement:"bottom-start",theme:"light set-input-list",maxWidth:520,duration:[200,0],distance:2,onHidden:function(){}})},e.prototype.handlePaste=function(t){var e=this,i="".concat(t).replace(/\s/gim,""),n=Array.from(new Set("".concat(i).split(",").map((function(t){return t.trim()})))),o=[];return n.forEach((function(t){e.list.some((function(e){return e.id===t}))?!e.defaultValue.some((function(e){return e===t}))&&e.defaultValue.push(t):(e.defaultValue.push(t),o.push({id:t,name:t,show:!0}))})),o},e.prototype.handleTagChange=function(t){this.$emit("set-value",t)},e.prototype.handleSetClick=function(){var t=this;this.handleSetInputValue(""),this.inputValue="",this.popoverInstance||this.initPopover();var e="".concat(this.select[this.displayKey]).length>0;if(this.unique){var i=this.list.some((function(t){return t.show}));(!i&&e||i)&&this.$nextTick().then((function(){t.popoverInstance.show(100)}))}else{var n=this.list.length>0;(!n&&e&&this.isKey||n>0)&&this.$nextTick().then((function(){t.popoverInstance.show(100)}))}},e.prototype.handleSetItemClick=function(t,e){var i=this;if(this.select[this.idKey]&&this.unique){var n=this.list.find((function(t){return t[i.idKey]===i.select[i.idKey]}));n&&(n.show=!0)}this.select=C({},e),this.handleSetInputValue(e[this.displayKey]),this.isItemClick=!0,this.inputValue=e[this.displayKey],this.unique&&(e.show=!1),this.popoverInstance.hide(100),this.$emit("item-select",C({},e))},e.prototype.handleRemoveClick=function(){var t=this;if(this.select[this.idKey]&&this.unique){var e=this.list.find((function(e){return e[t.idKey]===t.select[t.idKey]}));e&&(e.show=!0)}this.$emit("remove")},e.prototype.handleInputChange=function(t){this.inputValue=t.target.innerText,this.$emit("change",t,t.target.innerText)},e.prototype.handleSetInputValue=function(t){var e=this;this.$refs["input-"+this.keyId]?this.$refs["input-"+this.keyId].innerText=t:this.$nextTick().then((function(){e.$refs["input-"+e.keyId]&&(e.$refs["input-"+e.keyId].innerText=t)}))},e.prototype.handleSelectChange=function(t){var e=this;this.filterList=this.list.filter((function(i){return-1!=="".concat(i[e.displayKey]).indexOf(t)})),this.filterList.length?!this.isItemClick&&this.popoverInstance&&!this.popoverInstance.state.isVisible&&this.list.length&&this.popoverInstance&&this.popoverInstance.show(100):this.popoverInstance&&this.popoverInstance.hide(100)},e.prototype.handleSetEnter=function(t){this.handleSetBlur(t)},e.prototype.handleSetBlur=function(){var t=this;if(this.inputValue="".concat(this.inputValue),this.inputValue.trim()){if(this.inputValue!==this.select[this.displayKey]){var e=this.list.find((function(e){return e[t.displayKey]===t.inputValue.trim()}));if(e){if(this.select=C({},e),this.unique){e.show=!1;var i=this.list.find((function(e){return e[t.displayKey]===t.select[t.idKey]}));i&&(i.show=!0)}this.$emit("item-select",C({},e))}else{if(this.isMethod||this.isCondition)return this.inputValue=this.select[this.displayKey],void this.handleSetInputValue(this.inputValue);if(this.onlySelect&&this.isKey)return this.inputValue=this.select[this.displayKey],void this.handleSetInputValue(this.inputValue);var n=this.inputValue.trim();if("number"===this.inputType&&isNaN(n))return this.inputValue=this.select[this.displayKey],void this.handleSetInputValue(this.inputValue);this.select={id:this.inputValue.trim(),name:this.inputValue.trim(),show:!0},this.$emit("set-value",{id:this.inputValue.trim(),name:this.inputValue.trim()}),this.$emit("item-select",{id:this.inputValue.trim(),name:this.inputValue.trim()})}}}else this.select[this.displayKey]?(this.inputValue=this.select[this.displayKey],this.handleSetInputValue(this.inputValue)):this.isKey&&this.$emit("set-hide");this.isItemClick=!1},e.prototype.getInput=function(){return this.$refs["input-"+this.keyId]},I([Object(o.d)({type:String,default:function(){return"text"},validator:function(t){return["text","number"].includes(t)}})],e.prototype,"inputType",void 0),I([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"monitorEnumList",void 0),I([Object(o.d)({type:Array,required:!0})],e.prototype,"list",void 0),I([Object(o.d)({type:Boolean})],e.prototype,"isKey",void 0),I([Object(o.d)({type:Boolean})],e.prototype,"isCondition",void 0),I([Object(o.d)({type:Boolean})],e.prototype,"isMethod",void 0),I([Object(o.d)({type:Boolean})],e.prototype,"defaultFocus",void 0),I([Object(o.d)({type:String,default:"请选择值"})],e.prototype,"placeholder",void 0),I([Object(o.d)({type:[Object,Array],required:!0})],e.prototype,"value",void 0),I([Object(o.d)({type:[String,Number],default:98})],e.prototype,"listMinWidth",void 0),I([Object(o.d)({type:[String,Number],default:100})],e.prototype,"width",void 0),I([Object(o.d)({type:String,default:"id"})],e.prototype,"idKey",void 0),I([Object(o.d)({type:String,default:"name"})],e.prototype,"displayKey",void 0),I([Object(o.d)({type:Boolean})],e.prototype,"unique",void 0),I([Object(o.d)({type:Boolean,default:!1})],e.prototype,"readonly",void 0),I([Object(o.d)({type:Boolean,default:!0})],e.prototype,"onlySelect",void 0),I([Object(o.d)({type:Boolean,default:!1})],e.prototype,"multiple",void 0),I([Object(o.d)({type:Boolean,default:!0})],e.prototype,"allowCreate",void 0),I([Object(o.d)({type:Boolean,default:!0})],e.prototype,"allowAutoMatch",void 0),I([Object(o.d)({type:Number,default:0})],e.prototype,"keyId",void 0),I([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"editData",void 0),I([Object(o.f)("value",{immediate:!0,deep:!0})],e.prototype,"onValueChanged",null),I([Object(o.f)("list",{immediate:!0})],e.prototype,"onListChanged",null),e=I([Object(o.a)({components:{}})],e)}(o.e),R=x,A=Object(d.a)(R,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"set-input-wrapper"},[t.isMonitorEnum?i("div",{staticStyle:{margin:"2px 10px 0 10px"}},[i("bk-select",{staticStyle:{width:"150px"},attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},on:{change:t.changeMonitorEnum},model:{value:t.monitorEnumValue,callback:function(e){t.monitorEnumValue=e},expression:"monitorEnumValue"}},t._l(t.monitorEnumList,(function(t){return i("bk-option",{key:t.key,attrs:{id:t.key,name:t.key+"("+t.value+")"}})})),1)],1):t._e(),t._v(" "),t.multiple||t.isMonitorEnum?t.multiple&&!t.isMonitorEnum?i("div",{staticClass:"set-tag"},[i("bk-tag-input",{staticClass:"set-tag-select",attrs:{trigger:"focus",placeholder:"请输入",value:t.defaultValue,list:t.list,disabled:t.readonly,"allow-create":t.allowCreate,"allow-auto-match":t.allowAutoMatch,"paste-fn":t.handlePaste},on:{change:t.handleTagChange}})],1):t._e():i("div",{ref:"input-"+t.keyId,staticClass:"set-input",class:{"is-condition":t.isCondition||t.isMethod,"is-method":t.isMethod,"input-placeholder":!t.inputValue.length&&!(t.select[t.displayKey]+"").length},style:{"min-width":t.width+"px"},attrs:{"data-placeholder":t.placeholder,contenteditable:!t.readonly},on:{input:t.handleInputChange,click:function(e){e.stopPropagation(),!t.readonly&&t.handleSetClick(e)},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSetEnter.apply(null,arguments)},blur:t.handleSetBlur}}),t._v(" "),t.multiple?t._e():i("div",{staticStyle:{display:"none"}},[t._t("list",(function(){return[i("div",{ref:"setList",staticClass:"set-list-wrapper"},[i("ul",{staticClass:"set-list",style:{"min-width":t.listMinWidth+"px"}},t._l(t.filterList,(function(e,n){return i("li",{directives:[{name:"show",rawName:"v-show",value:t.unique?!(+t.unique^+e.show):e.show,expression:"unique ? !(+unique ^ +item.show) : item.show"}],key:n,staticClass:"set-list-item",class:{"is-condition":t.isCondition||t.isMethod},attrs:{"data-set-item":"setListItem","data-item-index":n},on:{mousedown:function(i){return t.handleSetItemClick(i,e)}}},[t._v("\n                        "+t._s(e[t.displayKey])+"\n                    ")])})),0),t._v(" "),t.isKey&&(t.select[t.displayKey]+"").length?i("div",{staticClass:"set-remove",on:{mousedown:t.handleRemoveClick}},[i("i",{staticClass:"bk-icon icon-close-circle"}),t._v("\n                    "+t._s(t.isMethod?"":"删除")+"\n                ")]):t._e()])]}))],2)])}),[],!1,null,"eff88910",null),S=A.exports,L=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$=function(){return $=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},$.apply(this,arguments)},M=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},E=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function s(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},F=function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.alarmConditionList=[],e}return L(e,t),e.prototype.onAlarmConditionListChanged=function(t){this.change(Object(a.a)(this.getValue()))},e.prototype.created=function(){this.handleSetDefaultValue()},e.prototype.getDefaultMethod=function(){return{list:[{id:"gt",name:">"},{id:"gte",name:">="},{id:"lt",name:"<"},{id:"lte",name:"<="},{id:"eq",name:"="},{id:"neq",name:"!="}],value:{id:"gte",name:">="},width:"32","list-min-width":"30","is-method":!0,component:"set-input",show:!0,type:"method",compKey:Object(a.c)(10),isKey:!0}},e.prototype.getDefaultValue=function(){return{list:[],value:{id:"",name:""},component:"set-input",show:!0,type:"value","input-type":"number",placeholder:"请输入数字",compKey:Object(a.c)(10)}},e.prototype.getDefaultCondition=function(t){return void 0===t&&(t=!1),{list:[{id:"and",name:"AND",show:!0},{id:"or",name:"OR",show:!0}],value:t?{id:"or",name:"OR"}:{id:"and",name:"AND"},width:"40","list-min-width":"38","is-condition":!0,component:"set-input",show:!0,type:"condition",compKey:Object(a.c)(10),unique:!1,readonly:!1}},e.prototype.getDefaultAdd=function(){return{component:"set-add",show:!1,addEvent:!0,type:"add",compKey:Object(a.c)(10)}},e.prototype.handleSetAdd=function(t,e,i){var n=this;t.preventDefault(),e.show=!!this.monitorEnumList.length,this.alarmConditionList.length>2?this.alarmConditionList.splice(i,0,this.handleSetCondition(),this.getDefaultMethod(),this.getDefaultValue()):this.alarmConditionList.splice(i,0,this.getDefaultMethod(),this.getDefaultValue()),this.$nextTick().then((function(){n.$refs["component-".concat(n.alarmConditionList.length-2)][0].getInput().focus()}))},e.prototype.handleItemSelect=function(t,e,i){return E(this,void 0,void 0,(function(){return F(this,(function(n){return this.curActive=i,e.value.id===t.id&&e.value.name===t.name||(e.value=$({},t),"value"===e.type&&(this.alarmConditionList[this.alarmConditionList.length-1].show=!0)),[2]}))}))},e.prototype.handleSetHide=function(t,e){t.show=!1,this.alarmConditionList[e-1].show=!0},e.prototype.handleSetValue=function(t,e){t.show=!0,e.list.unshift(t)},e.prototype.handleSetDefaultValue=function(){var t=this;this.alarmConditionList=[],this.value.length&&this.value.forEach((function(e,i){i>0&&t.alarmConditionList.push(t.handleSetCondition("or"===e.condition));var n=t.getDefaultMethod();n.value.id=e.method,n.value.name=(n.list.find((function(t){return t.id===e.method}))||{}).name,t.alarmConditionList.push(n);var o=t.getDefaultValue();o.value.id=e.value,o.value.name=e.value,o.list.unshift({id:e.value,name:e.value}),t.alarmConditionList.push(o)}));var e=this.getDefaultAdd();this.alarmConditionList.push(e),e.show=!0},e.prototype.handleItemRemove=function(t,e){var i=this.alarmConditionList[e+2];if("condition"===i.type)this.alarmConditionList.splice(e,3);else if("add"===i.type){var n=this.alarmConditionList[e-1];this.alarmConditionList.splice(n?e-1:e,n?3:2),i.show=!0}var o=this.alarmConditionList.filter((function(t){return"condition"===t.type}));1===o.length&&o[0].list.forEach((function(t){return t.show=!0}))},e.prototype.handleSetCondition=function(t){return void 0===t&&(t=!1),this.getDefaultCondition(t)},e.prototype.getValue=function(){var t=[];if(this.alarmConditionList.length){var e={};this.alarmConditionList.forEach((function(i){var n=i.type;["method","value","condition"].includes(n)&&("condition"===n?(t.push($({},e)),e={condition:i.value.id}):e[n]=i.value.id)})),Object.keys(e).length&&t.push(e)}return t},e.prototype.change=function(t){return t},M([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"dimensionList",void 0),M([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"conditions",void 0),M([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"value",void 0),M([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"monitorEnumList",void 0),M([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"editData",void 0),M([Object(o.f)("alarmConditionList",{deep:!0})],e.prototype,"onAlarmConditionListChanged",null),M([Object(o.b)("change")],e.prototype,"change",null),e=M([Object(o.a)({components:{SetAdd:O,SetInput:S}})],e)}(o.e),D=V,T=Object(d.a)(D,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"strategy-set-input"},t._l(t.alarmConditionList,(function(e,n){return i(e.component,t._b({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"item.show"}],key:e.type+"-"+e.compKey,ref:"component-"+n,refInFor:!0,tag:"component",attrs:{"key-id":n,list:e.list,"monitor-enum-list":t.monitorEnumList,"edit-data":t.editData,"alarm-condition-list-index":n},on:{click:function(e){t.curActive=n},remove:function(i){return t.handleItemRemove(e,n)},"set-hide":function(i){return t.handleSetHide(e,n)},"set-value":function(i){return t.handleSetValue(i,e,n)},"item-select":function(i){return t.handleItemSelect(i,e,n)},"set-add":function(i){e.addEvent&&t.handleSetAdd(i,e,n)}}},"component",e,!1))})),1)}),[],!1,null,"2ef4255c",null).exports,P=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),q=function(){return q=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},q.apply(this,arguments)},Y=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},N=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function s(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},B=function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.active="",e.options=[{id:"Threshold",name:"静态阈值",show:!0},{id:"AdvancedYearRound",name:"同比策略（高级）",show:!0},{id:"AdvancedRingRatio",name:"环比策略（高级）",show:!0},{id:"SimpleYearRound",name:"同比策略（简易）",show:!0},{id:"SimpleRingRatio",name:"环比策略（简易）",show:!0},{id:"YearRoundAmplitude",name:"同比振幅",show:!0},{id:"RingRatioAmplitude",name:"环比振幅",show:!0},{id:"YearRoundRange",name:"同比区间",show:!0}],e.methods=[{id:"gt",name:">"},{id:"gte",name:">="},{id:"lt",name:"<"},{id:"lte",name:"<="},{id:"eq",name:"="}],e.loading=!1,e.unitMap={},e.unitList=[],e.algorithmUnit="",e.monitorEnumValue="",e}return P(e,t),Object.defineProperty(e.prototype,"curItem",{get:function(){return this[this.active]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curOption",{get:function(){var t=this;return this.options.find((function(e){return e.id===t.active}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dialogWidth",{get:function(){return"YearRoundAmplitude"===this.active||"RingRatioAmplitude"===this.active?856:"YearRoundRange"===this.active?770:700},enumerable:!1,configurable:!0}),e.prototype.onDialogShowChanged=function(t){return N(this,void 0,void 0,(function(){var e,i=this;return B(this,(function(n){return t?(this.options.forEach((function(t){var e=t;e.show="PartialNodes"!==e.id&&!i.selectedAlgorithms.includes(e.id)})),this.active&&0!==this.selectedAlgorithms.length&&!this.selectedAlgorithms.includes(this.active)||this.options.find((function(t){return t.show}))&&(this.active=this.options.find((function(t){return t.show})).id)):(e=this.getDefaultData(),Object.keys(e).forEach((function(t){i[t]=e[t]})),this.active=""),this.algorithmUnit=this.value?this.value.algorithmUnit:this.unitSuffixId,[2]}))}))},e.prototype.onValueChanged=function(t){return N(this,void 0,void 0,(function(){var e=this;return B(this,(function(i){return t&&"edit"===this.mode&&(this.active=t.type,"Threshold"===t.type?this.Threshold.value=t.config.map((function(t){var e=t.method,i=t.threshold,n=t.condition,o={method:e,value:i};return n&&(o.condition=n),o})):Object.keys(t.config).forEach((function(i){e.curItem[i]=t.config[i]}))),[2]}))}))},e.prototype.beforeDestroy=function(){this.handleCancel()},e.prototype.getDefaultData=function(){return{Threshold:{value:[]},AdvancedYearRound:{ceil_interval:"",ceil:"",floor_interval:"",floor:""},AdvancedRingRatio:{ceil_interval:"",ceil:"",floor_interval:"",floor:""},SimpleRingRatio:{ceil:"",floor:""},SimpleYearRound:{ceil:"",floor:""},PartialNodes:{count:1},YearRoundAmplitude:{method:"gte",days:"",ratio:"",shock:""},RingRatioAmplitude:{threshold:"",ratio:"",shock:""},YearRoundRange:{method:"gte",days:"",ratio:"",shock:""},validate:!0,uptimeCheckMap:{available:"Threshold",task_duration:"Threshold",message:"PartialNodes",response_code:"PartialNodes"}}},e.prototype.handleCancel=function(){this.$emit("hide-dialog",!1)},e.prototype.handleConfirm=function(){if(this.validate=!1,"Threshold"===this.active)this.validate=!!this.curItem.value.length&&this.curItem.value.every((function(t){return"".concat(t.value).trim().length>0}));else if("AdvancedYearRound"===this.active||"AdvancedRingRatio"===this.active){var t=this.curItem.ceil_interval,e=this.curItem.ceil,i=this.curItem.floor_interval,n=this.curItem.floor;this.validate=""===t&&""===e&&Object(a.b)(i)&&""!==n&&n>=0||""===i&&""===n&&Object(a.b)(t)&&""!==e&&e>=0||Object(a.b)(i)&&""!==n&&n>=0&&Object(a.b)(t)&&""!==e&&e>=0}else if("SimpleRingRatio"===this.active||"SimpleYearRound"===this.active){e=this.curItem.ceil,n=this.curItem.floor;this.validate=""!==e&&e>=0&&""===n||""!==n&&n>=0&&""===e||""!==n&&""!==e&&e>=0&&n>=0}else if("PartialNodes"===this.active)this.validate=this.curItem.count>=1;else if("YearRoundAmplitude"===this.active||"YearRoundRange"===this.active){var o=this.curItem,r=o.days,s=o.ratio,l=o.shock;this.validate=r>=1&&""!==s&&""!==l}else if("RingRatioAmplitude"===this.active){var c=this.curItem,u=c.threshold;s=c.ratio,l=c.shock;this.validate=""!==u&&""!==s&&""!==l}if(this.validate){var d=this.handleTransformValue();this.$emit("confirm-dialog",!1,d)}},e.prototype.handleThresholdChange=function(t){this.curItem.value=t},e.prototype.handleValueChange=function(){this.validate=!0},e.prototype.handleTransformValue=function(){var t={type:this.active,title:this.curOption.name,algorithmUnit:this.algorithmUnit};return"Threshold"===this.active?(t.config=this.curItem.value.map((function(t){var e=t.method,i=t.value,n=t.condition,o={method:e,threshold:i};return n&&(o.condition=n),o})),t):(t.config=this.curItem,t)},e.prototype.hanldeInputNumber=function(t){var e=this;this.$nextTick().then((function(){e.PartialNodes.count=+"".concat(t).replace(/\.[0-9e]*/,"")}))},Y([Object(o.d)({type:String,required:!0,validator:function(t){return["add","edit","delete"].includes(t)}})],e.prototype,"mode",void 0),Y([Object(o.d)({type:Boolean})],e.prototype,"dialogShow",void 0),Y([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"selectedAlgorithms",void 0),Y([Object(o.d)({type:Object,default:function(){return{type:"Threshold",config:[]}}})],e.prototype,"value",void 0),Y([Object(o.d)({type:[String,Number],default:function(){return"NONE"}})],e.prototype,"unitSuffixId",void 0),Y([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"unitSuffixList",void 0),Y([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"monitorEnumList",void 0),Y([Object(o.f)("dialogShow",{immediate:!0})],e.prototype,"onDialogShowChanged",null),Y([Object(o.f)("value",{immediate:!0})],e.prototype,"onValueChanged",null),e=Y([Object(o.a)({components:{StrategyAlgorithmInput:T},data:function(){var t=this.getDefaultData();return q({},t)}})],e)}(o.e),K=z,G=Object(d.a)(K,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-dialog",{attrs:{value:t.dialogShow,theme:"primary",width:t.dialogWidth,position:{top:120},"esc-close":!1,"mask-close":!1,"header-position":"left",title:"添加检测算法","ok-text":"添加","auto-close":!1},on:{cancel:t.handleCancel,confirm:t.handleConfirm}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading},expression:"{ isLoading: loading }"}]},[i("div",{staticClass:"dialog-header"},[i("bk-select",{staticStyle:{width:"180px"},attrs:{searchable:!0,clearable:!1,disabled:"add"!==t.mode},on:{change:t.handleValueChange},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.options,(function(t,e){return i("bk-option",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"option.show"}],key:e,attrs:{disabled:!!t.disabled,id:t.id,name:t.name}})})),1),t._v(" "),t.unitSuffixList&&t.unitSuffixList.length?i("span",{staticClass:"title-unit"},[t._v("\n                单位：\n                "),i("bk-select",{staticClass:"unit-select",attrs:{searchable:!0,clearable:!1},model:{value:t.algorithmUnit,callback:function(e){t.algorithmUnit=e},expression:"algorithmUnit"}},t._l(t.unitSuffixList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):t._e()],1),t._v(" "),"Threshold"===t.active?i("div",[i("div",{staticClass:"dialog-defualt"},[i("div",{staticClass:"dialog-defualt-title"},[t._v(" 当前值满足以下条件时触发")]),t._v(" "),i("strategy-algorithm-input",{attrs:{"monitor-enum-list":t.monitorEnumList,value:t.curItem.value,"edit-data":t.value},on:{change:t.handleThresholdChange}})],1)]):t._e(),t._v(" "),"AdvancedYearRound"===t.active?[i("div",{staticClass:"dialog-other"},[i("div",{staticClass:"dialog-other-row"},[t._v(" 较前\n                    "),i("bk-input",{staticClass:"input-top",attrs:{clearable:!0,type:"number",placeholder:"输入整数",min:1,precision:0},model:{value:t.AdvancedYearRound.ceil_interval,callback:function(e){t.$set(t.AdvancedYearRound,"ceil_interval",e)},expression:"AdvancedYearRound.ceil_interval"}}),t._v("\n                    天同一时刻绝对值的均值\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{type:"number",placeholder:"输入数字",min:0},model:{value:t.AdvancedYearRound.ceil,callback:function(e){t.$set(t.AdvancedYearRound,"ceil",e)},expression:"AdvancedYearRound.ceil"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#2dcb56"}},[t._v(" 上升")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")],1),t._v(" "),i("div",{staticClass:"dialog-other-row",staticStyle:{"margin-top":"20px"}},[t._v(" 较前\n                    "),i("bk-input",{staticClass:"input-top",attrs:{clearable:!0,type:"number",placeholder:"输入整数",min:1,precision:0},model:{value:t.AdvancedYearRound.floor_interval,callback:function(e){t.$set(t.AdvancedYearRound,"floor_interval",e)},expression:"AdvancedYearRound.floor_interval"}}),t._v("\n                    天同一时刻绝对值的均值\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{min:0,type:"number",placeholder:"输入数字"},model:{value:t.AdvancedYearRound.floor,callback:function(e){t.$set(t.AdvancedYearRound,"floor",e)},expression:"AdvancedYearRound.floor"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#ea3636"}},[t._v(" 下降")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")],1),t._v(" "),i("div",{staticClass:"dialog-icon"},[t._v("或")])])]:"AdvancedRingRatio"===t.active?[i("div",{staticClass:"dialog-other"},[i("div",{staticClass:"dialog-other-row"},[t._v(" 较前\n                    "),i("bk-input",{staticClass:"input-top",attrs:{clearable:!0,type:"number",placeholder:"输入整数",min:1,precision:0},model:{value:t.AdvancedRingRatio.ceil_interval,callback:function(e){t.$set(t.AdvancedRingRatio,"ceil_interval",e)},expression:"AdvancedRingRatio.ceil_interval"}}),t._v("\n                    个时间点的均值\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{min:0,type:"number",placeholder:"输入数字"},model:{value:t.AdvancedRingRatio.ceil,callback:function(e){t.$set(t.AdvancedRingRatio,"ceil",e)},expression:"AdvancedRingRatio.ceil"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#2dcb56"}},[t._v(" 上升")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")],1),t._v(" "),i("div",{staticClass:"dialog-other-row",staticStyle:{"margin-top":"20px"}},[t._v(" 较前\n                    "),i("bk-input",{staticClass:"input-top",attrs:{clearable:!0,type:"number",placeholder:"输入整数",min:1,precision:0},model:{value:t.AdvancedRingRatio.floor_interval,callback:function(e){t.$set(t.AdvancedRingRatio,"floor_interval",e)},expression:"AdvancedRingRatio.floor_interval"}}),t._v("\n                    个时间点的均值\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{min:0,type:"number",placeholder:"输入数字"},model:{value:t.AdvancedRingRatio.floor,callback:function(e){t.$set(t.AdvancedRingRatio,"floor",e)},expression:"AdvancedRingRatio.floor"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#ea3636"}},[t._v(" 下降")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")],1),t._v(" "),i("div",{staticClass:"dialog-icon"},[t._v("或")])])]:"SimpleRingRatio"===t.active?[i("div",{staticClass:"dialog-other"},[i("div",{staticClass:"dialog-other-row"},[t._v(" 当前值较前一时刻\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{type:"number",min:0,placeholder:"输入数字"},model:{value:t.SimpleRingRatio.ceil,callback:function(e){t.$set(t.SimpleRingRatio,"ceil",e)},expression:"SimpleRingRatio.ceil"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#2dcb56"}},[t._v(" 上升")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")]),t._v(" "),i("div",{staticClass:"dialog-other-row",staticStyle:{"margin-top":"20px"}},[t._v(" 当前值较前一时刻\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{type:"number",min:0,placeholder:"输入数字"},model:{value:t.SimpleRingRatio.floor,callback:function(e){t.$set(t.SimpleRingRatio,"floor",e)},expression:"SimpleRingRatio.floor"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#ea3636"}},[t._v(" 下降")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")]),t._v(" "),i("div",{staticClass:"dialog-icon"},[t._v("或")])])]:"SimpleYearRound"===t.active?[i("div",{staticClass:"dialog-other"},[i("div",{staticClass:"dialog-other-row"},[t._v(" 当前值较上周同一时刻\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{min:0,type:"number",placeholder:"输入数字"},model:{value:t.SimpleYearRound.ceil,callback:function(e){t.$set(t.SimpleYearRound,"ceil",e)},expression:"SimpleYearRound.ceil"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#2dcb56"}},[t._v(" 上升")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")]),t._v(" "),i("div",{staticClass:"dialog-other-row",staticStyle:{"margin-top":"20px"}},[t._v(" 当前值较上周同一时刻\n                    "),i("div",[i("bk-input",{staticStyle:{width:"151px"},attrs:{min:0,type:"number",placeholder:"输入数字"},model:{value:t.SimpleYearRound.floor,callback:function(e){t.$set(t.SimpleYearRound,"floor",e)},expression:"SimpleYearRound.floor"}},[i("template",{slot:"prepend"},[i("div",{staticClass:"input-text",staticStyle:{color:"#ea3636"}},[t._v(" 下降")])]),t._v(" "),i("template",{slot:"append"},[i("div",{staticClass:"input-symbol symbol-append"},[t._v("%")])])],2)],1),t._v("\n                    时触发告警\n                ")]),t._v(" "),i("div",{staticClass:"dialog-icon"},[t._v("或")])])]:"PartialNodes"===t.active?[i("div",{staticClass:"dialog-uptime"},[t._v("\n                满足以上条件的拨测节点数>=\n                "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{min:1,type:"number",placeholder:"输入整数",precision:0},on:{input:t.hanldeInputNumber},model:{value:t.PartialNodes.count,callback:function(e){t.$set(t.PartialNodes,"count",e)},expression:"PartialNodes.count"}}),t._v("\n                时触发告警\n            ")],1)]:"YearRoundAmplitude"===t.active?[i("div",{staticClass:"dialog-uptime"},[t._v(" 当前值 "),i("span",{staticClass:"method-span need-margin"},[t._v("-")]),t._v(" 前一时刻值\n                "),i("bk-select",{staticClass:"dialog-uptime-input",attrs:{searchable:!0,clearable:!1},model:{value:t.YearRoundAmplitude.method,callback:function(e){t.$set(t.YearRoundAmplitude,"method",e)},expression:"YearRoundAmplitude.method"}},t._l(t.methods,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v("\n                过去\n                "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{clearable:!1,min:1,precision:0,type:"number"},model:{value:t.YearRoundAmplitude.days,callback:function(e){t.$set(t.YearRoundAmplitude,"days",e)},expression:"YearRoundAmplitude.days"}}),t._v("\n                天内任意一天同时刻差值 "),i("span",{staticClass:"method-span",staticStyle:{"margin-left":"5px"}},[t._v("×")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{type:"number",clearable:!1},model:{value:t.YearRoundAmplitude.ratio,callback:function(e){t.$set(t.YearRoundAmplitude,"ratio",e)},expression:"YearRoundAmplitude.ratio"}}),t._v(" "),i("span",{staticClass:"method-span"},[t._v("+")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{type:"number",clearable:!1},model:{value:t.YearRoundAmplitude.shock,callback:function(e){t.$set(t.YearRoundAmplitude,"shock",e)},expression:"YearRoundAmplitude.shock"}})],1)]:"RingRatioAmplitude"===t.active?[i("div",{key:"RingRatioAmplitude",staticClass:"dialog-uptime"},[t._v(" 当前值与前一时刻值 "),i("span",{staticClass:"method-span",staticStyle:{"margin-left":"5px"}},[t._v(">=")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{clearable:!1,type:"number"},model:{value:t.RingRatioAmplitude.threshold,callback:function(e){t.$set(t.RingRatioAmplitude,"threshold",e)},expression:"RingRatioAmplitude.threshold"}}),t._v("\n                且，之间差值 "),i("span",{staticClass:"method-span need-margin"},[t._v(">=")]),t._v(" 前一时刻 "),i("span",{staticClass:"method-span",staticStyle:{"margin-left":"5px"}},[t._v("×")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{clearable:!1,type:"number","show-controls":!0},model:{value:t.RingRatioAmplitude.ratio,callback:function(e){t.$set(t.RingRatioAmplitude,"ratio",e)},expression:"RingRatioAmplitude.ratio"}}),t._v(" "),i("span",{staticClass:"method-span"},[t._v("+")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{clearable:!1,type:"number"},model:{value:t.RingRatioAmplitude.shock,callback:function(e){t.$set(t.RingRatioAmplitude,"shock",e)},expression:"RingRatioAmplitude.shock"}})],1)]:"YearRoundRange"===t.active?[i("div",{key:"YearRoundRange",staticClass:"dialog-uptime"},[t._v(" 当前值\n                "),i("bk-select",{staticClass:"dialog-uptime-input",attrs:{searchable:!0,clearable:!1},model:{value:t.YearRoundRange.method,callback:function(e){t.$set(t.YearRoundRange,"method",e)},expression:"YearRoundRange.method"}},t._l(t.methods,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v("\n                过去\n                "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{min:1,precision:0,clearable:!1,type:"number"},model:{value:t.YearRoundRange.days,callback:function(e){t.$set(t.YearRoundRange,"days",e)},expression:"YearRoundRange.days"}}),t._v("\n                天内同时刻绝对值 "),i("span",{staticClass:"method-span",staticStyle:{"margin-left":"5px"}},[t._v("×")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{clearable:!1,type:"number","show-controls":!0},model:{value:t.YearRoundRange.ratio,callback:function(e){t.$set(t.YearRoundRange,"ratio",e)},expression:"YearRoundRange.ratio"}}),t._v(" "),i("span",{staticClass:"method-span"},[t._v("+")]),t._v(" "),i("bk-input",{staticClass:"dialog-uptime-input",attrs:{clearable:!1,type:"number"},model:{value:t.YearRoundRange.shock,callback:function(e){t.$set(t.YearRoundRange,"shock",e)},expression:"YearRoundRange.shock"}})],1)]:t._e(),t._v(" "),i("div",{staticClass:"validate-message",style:{visibility:t.validate?"hidden":"visible"}},[t._v(" 检测算法填写不完整，请完善后添加\n        ")])],2)])}),[],!1,null,"c2c0fcee",null).exports,U=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),W=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},H=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function s(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},J=function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},X=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.business="",e.isShow=!1,e.allowCreate=!0,e.monitorMethodList=[{name:"=",id:"eq"},{name:"!=",id:"neq"},{name:"include",id:"include"},{name:"exclude",id:"exclude"},{name:"regex",id:"reg"}],e.conditionList=[{id:"and",name:"AND"},{id:"or",name:"OR"}],e.conditionArr=[],e.tableId="",e.dimensionList=[],e.allAvaliableObj={},e.first=!0,e.isLoading=!1,e}return U(e,t),Object.defineProperty(e.prototype,"emptyTag",{get:function(){return!this.isEdit&&!this.conditionArr.length&&(!this.showBusiness||this.showBusiness&&this.business)},enumerable:!1,configurable:!0}),e.prototype.onMonitorChanged=function(t){var e=this;if(this.conditionArr=[],this.dimensionList=t.dimension_list,this.tableId=t.table_id,this.business="",this.showBusiness||this.getVariableValue(),this.first){this.isLoading=!0,this.first=!1;var i=this.selectedMonitor.agg_condition||[];this.showBusiness?(this.isLoading=!1,this.$nextTick((function(){e.conditionArr=i.slice(1).map((function(t){return{condition:[t.condition],key:t.key,method:[t.method],value:t.value}}))})),i[0]&&(this.business=i[0].value[0])):i.length&&setTimeout((function(){e.conditionArr=i.map((function(t){return{condition:[t.condition],key:t.key,method:[t.method],value:t.value}}))}),3e3)}},e.prototype.onConditionArrChanged=function(t){this.emitChange()},e.prototype.changeMinotorWay=function(t){t.value=[]},e.prototype.changeBusiness=function(){return H(this,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return this.allAvaliableObj={},this.conditionArr=[],this.business?[4,this.getVariableValue(!0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.emitChange(),[2]}}))}))},e.prototype.getVariableValue=function(t){return H(this,void 0,void 0,(function(){var e,i=this;return J(this,(function(n){switch(n.label){case 0:return e={table_id:this.tableId,bk_biz_id:this.business,bk_obj_id:this.selectedMonitor.bk_obj_id},t||(e={bk_obj_id:this.selectedMonitor.bk_obj_id,table_id:this.tableId,metric_field:this.selectedMonitor.field_name.split(".").slice(-1)[0],dimension_list:this.selectedMonitor.dimension_list.map((function(t){return t.key}))}),[4,this.$api.monitorCollect.getVariableValue(e).then((function(t){if(t.result){var e=t.data,n={};return e.forEach((function(t){n[t.dimension]=t.list})),void(i.allAvaliableObj=n)}i.$error({theme:"error",message:t.message})}))];case 1:return n.sent(),setTimeout((function(){i.isLoading=!1}),2e3),[2]}}))}))},e.prototype.changeCondition=function(t,e){t.length&&["and","or"].includes(t[0])||(e.condition=["and"])},e.prototype.changeMethod=function(t,e){var i=this.monitorMethodList.map((function(t){return t.id}));t.length&&i.includes(t[0])||(e.method=["eq"])},e.prototype.handleDelete=function(t){this.conditionArr.splice(t,1),this.conditionArr[0]&&this.conditionArr[0].condition&&"or"===this.conditionArr[0].condition[0]&&(this.conditionArr[0].condition=["and"])},e.prototype.addCondition=function(){this.conditionArr.push({condition:["and"],key:"",method:["eq"],value:[]})},e.prototype.emitChange=function(){var t=this.conditionArr.filter((function(t){return t.value.length})).map((function(t,e){return{key:t.key,condition:t.condition[0],value:t.value,method:t.method[0]}}));this.business&&t.unshift({key:"bk_biz_id",value:[this.business],method:"eq"}),this.change(t)},e.prototype.getMethod=function(t){return this.monitorMethodList.find((function(e){return e.id===t})).name},e.prototype.handleTag=function(t){var e=t.value.join("、"),i=this.dimensionList.find((function(e){return e.key===t.key})).name;return"".concat(i," ").concat(this.getMethod(t.method[0])," ").concat(e)},e.prototype.handleBusiness=function(){var t=this;if(this.business){var e=this.businessLists.find((function(e){return e.id===t.business})).name;return"业务:".concat(e)}},e.prototype.handleCondition=function(t){return this.conditionList.find((function(e){return e.id===t[0]})).name},e.prototype.change=function(t){return t},W([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"selectedMonitor",void 0),W([Object(o.d)({type:Boolean,default:function(){return!1}})],e.prototype,"showBusiness",void 0),W([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"businessLists",void 0),W([Object(o.d)({type:Boolean,default:function(){return!0}})],e.prototype,"isEdit",void 0),W([Object(o.f)("selectedMonitor")],e.prototype,"onMonitorChanged",null),W([Object(o.f)("conditionArr",{deep:!0})],e.prototype,"onConditionArrChanged",null),W([Object(o.b)("change")],e.prototype,"change",null),e=W([Object(o.a)({components:{}})],e)}(o.e),Q=X,Z=Object(d.a)(Q,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading,size:"mini",zIndex:10,theme:"primary"},expression:"{ isLoading: isLoading, size: 'mini', zIndex: 10, theme: 'primary' }"}],staticClass:"wrap"},[t.isEdit?[t.showBusiness||t.conditionArr.length?t._e():i("div",{staticStyle:{display:"inline-block","margin-bottom":"4px",cursor:"pointer","font-size":"12px"},on:{click:t.addCondition}},[i("span",{staticStyle:{color:"#3a84ff"}},[t._v("点击添加")]),t._v(" "),i("span",{staticStyle:{color:"#c4c6cc"}},[t._v("（对数据进行筛选过滤）")])]),t._v(" "),t.showBusiness?[i("bk-select",{staticStyle:{"min-width":"160px",display:"inline-block","margin-bottom":"4px"},attrs:{searchable:"",clearable:!1,placeholder:"请选择业务"},on:{change:t.changeBusiness},model:{value:t.business,callback:function(e){t.business=e},expression:"business"}},t._l(t.businessLists,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:"业务:"+t.name}})})),1)]:t._e(),t._v(" "),i("bk-button",{directives:[{name:"show",rawName:"v-show",value:!t.conditionArr.length&&t.business,expression:"!conditionArr.length && business"}],staticClass:"mr10",staticStyle:{"margin-left":"4px",color:"#3a84ff",background:"#f0f1f5","border-width":"0",display:"inline-block","margin-bottom":"4px"},attrs:{theme:"default",icon:"plus"},on:{click:t.addCondition}}),t._v(" "),t._l(t.conditionArr,(function(e,n){return[i("bk-tag-input",{directives:[{name:"show",rawName:"v-show",value:t.showBusiness||!t.showBusiness&&0!==n,expression:"showBusiness || !showBusiness && index !== 0"}],key:n+"_1",staticClass:"bk-custom-condition",staticStyle:{display:"inline-block","margin-bottom":"4px"},attrs:{disabled:0===n,list:t.conditionList,placeholder:"请输入","max-data":1,clearable:!1,trigger:"focus","allow-next-focus":!1},on:{change:function(i){return t.changeCondition(e.condition,e)}},model:{value:e.condition,callback:function(i){t.$set(e,"condition",i)},expression:"item.condition"}}),t._v(" "),i("bk-select",{key:n+"_2",staticStyle:{width:"120px",display:"inline-block","margin-bottom":"4px"},attrs:{searchable:"",clearable:!1},on:{change:function(i){return t.changeMinotorWay(e)}},model:{value:e.key,callback:function(i){t.$set(e,"key",i)},expression:"item.key"}},[t._l(t.dimensionList,(function(t){return i("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),t._v(" "),i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(e){return t.handleDelete(n)}},slot:"extension"},[i("i",{staticClass:"bk-icon icon-close-circle"}),t._v(" 删除\n                ")])],2),t._v(" "),e.key?i("bk-tag-input",{key:n+"_3",staticClass:"bk-custom-selector",staticStyle:{display:"inline-block"},attrs:{list:t.monitorMethodList,"max-data":1,clearable:!1,trigger:"focus"},on:{change:function(i){return t.changeMethod(e.method,e)}},model:{value:e.method,callback:function(i){t.$set(e,"method",i)},expression:"item.method"}}):t._e(),t._v(" "),e.key?i("bk-tag-input",{key:n+"_4",staticStyle:{"min-width":"120px",display:"inline-block","margin-bottom":"4px",overflow:"hidden"},attrs:{list:t.allAvaliableObj[e.key],placeholder:"请输入","save-key":"value","display-key":"label","search-key":"label",trigger:"focus","allow-create":!0,"allow-auto-match":!0},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}}):t._e(),t._v(" "),i("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.key&&e.value.length&&n===t.conditionArr.length-1,expression:"item.key && item.value.length && index === conditionArr.length - 1"}],key:n+"_5",staticClass:"mr10",staticStyle:{"margin-left":"4px",color:"#3a84ff",background:"#f0f1f5","border-width":"0",display:"inline-block"},attrs:{theme:"default",icon:"plus"},on:{click:t.addCondition}})]}))]:[t.showBusiness?i("bk-tag",[t._v("\n            "+t._s(t.handleBusiness())+"\n        ")]):t._e(),t._v(" "),t._l(t.conditionArr,(function(e,n){return[t.showBusiness&&t.conditionArr.length||!t.showBusiness&&n?i("bk-tag",{key:n+"_1"},[t._v("\n                "+t._s(t.handleCondition(e.condition))+"\n            ")]):t._e(),t._v(" "),i("bk-tag",{key:n},[t._v("\n                "+t._s(t.handleTag(e))+"\n            ")])]})),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.emptyTag,expression:"emptyTag"}]},[t._v("--")])]],2)}),[],!1,null,"5b85f60c",null).exports,tt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),et=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},it=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allDimensionList=[],e.conditionArr=[],e.isShow=!1,e.keyCount=0,e}return tt(e,t),e.prototype.onSelectedMonitorChanged=function(t){this.conditionArr=[],this.allDimensionList=t.dimension_list.map((function(t){return t})),t.agg_dimension&&(this.conditionArr=t.agg_dimension.map((function(t){return{value:t}})))},e.prototype.onConditionArrChanged=function(t){var e=this.conditionArr.filter((function(t){return t.value})).map((function(t){return t.value}));this.change(e)},e.prototype.handleDelete=function(t){this.conditionArr.splice(t,1),this.keyCount++},e.prototype.addCondition=function(){this.conditionArr.push({value:""})},e.prototype.handleSelectList=function(t){var e=this.conditionArr.map((function(t){return t.value}));return this.allDimensionList.filter((function(i){return!e.includes(i.key)||i.key===t.value}))},e.prototype.change=function(t){return t},et([Object(o.d)({type:Object,default:function(){return{}}})],e.prototype,"selectedMonitor",void 0),et([Object(o.d)({type:Boolean,default:function(){return!0}})],e.prototype,"isEdit",void 0),et([Object(o.f)("selectedMonitor")],e.prototype,"onSelectedMonitorChanged",null),et([Object(o.f)("conditionArr",{deep:!0})],e.prototype,"onConditionArrChanged",null),et([Object(o.b)("change")],e.prototype,"change",null),e=et([Object(o.a)({components:{}})],e)}(o.e),nt=it,ot=Object(d.a)(nt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{key:t.keyCount,staticClass:"monitor-dimension"},[t.conditionArr.length?t._e():i("div",{staticStyle:{display:"inline-block",cursor:"pointer","font-size":"12px"},on:{click:t.addCondition}},[t.isEdit?i("span",{staticStyle:{color:"#3a84ff"}},[t._v("点击添加")]):t._e(),t._v(" "),t.isEdit?i("span",{staticStyle:{color:"#c4c6cc"}},[t._v("（选择数据汇聚的维度）")]):i("span",[t._v("--")])]),t._v(" "),t._l(t.conditionArr,(function(e,n){return i("bk-select",{key:n,staticStyle:{"min-width":"120px",float:"left",margin:"0 4px 4px 0"},attrs:{searchable:"",clearable:!1,disabled:!t.isEdit},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}},[t._l(t.handleSelectList(e),(function(t){return i("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),t._v(" "),i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(e){return t.handleDelete(n)}},slot:"extension"},[i("i",{staticClass:"bk-icon icon-close-circle"}),t._v(" 删除\n        ")])],2)})),t._v(" "),i("bk-button",{directives:[{name:"show",rawName:"v-show",value:t.conditionArr.length&&t.conditionArr[t.conditionArr.length-1].value&&t.isEdit,expression:"conditionArr.length && conditionArr[conditionArr.length - 1].value && isEdit"}],staticClass:"mr10",staticStyle:{"margin-left":"4px",color:"#3a84ff",background:"#f0f1f5","border-width":"0",float:"left"},attrs:{theme:"default",icon:"plus"},on:{click:t.addCondition}})],2)}),[],!1,null,"48f414c7",null).exports,rt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),at=function(){return at=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},at.apply(this,arguments)},st=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},lt=function(t,e,i){if(i||2===arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},ct=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curMetricItem={},e.itemForm={item_name:"",monitor_item_type:"metric",no_data_config:{is_enabled:!1,continuous:5},trigger_config:{check_window:5,count:1},recovery_config:{check_window:5},config_obj:{deadly:[],warning:[],remind:[]},description:"",alarm_level:1,agg_method:"AVG",agg_interval:1,agg_interval_unit:"min"},e.panel=[{expand:!0,level:1,type:"deadly",name:"致命"},{expand:!1,level:2,type:"warning",name:"预警"},{expand:!1,level:3,type:"remind",name:"提醒"}],e.header={typeId:"service_module",groupId:"services",sourceType:"BKMONITOR",strategyName:""},e.algorithm={show:!1,mode:"add",type:"",editData:null,eventLevel:0},e.monitorList=[],e.aggMethodList=[{name:"SUM",value:"SUM"},{name:"AVG",value:"AVG"},{name:"MAX",value:"MAX"},{name:"MIN",value:"MIN"},{name:"COUNT",value:"COUNT"}],e.rules={item_name:[{message:"监控项不能为空",trigger:"blur",required:!0}],agg_method:[{required:!0,message:"汇聚方式不能为空",trigger:"blur",validator:function(t){return t.length>0}}],agg_interval:[{required:!0,message:"汇聚周期不能为空",trigger:"blur",validator:function(t){return+t>0}},{required:!0,message:"请输入整数",trigger:"blur, change",validator:function(t){return parseInt(t,10)===+t}},{required:!0,message:"汇聚周期不得小于10秒",trigger:"blur, change",validator:function(t){return!("sec"===e.itemForm.agg_interval_unit&&+t<10)}}],alarm_level:[{required:!0,message:"告警等级不能为空",trigger:"blur",validator:function(t){return+t>0}}],config_obj:[{required:!0,message:"检测算法不能为空",trigger:"blur, change",validator:function(t){return lt(lt(lt([],t.deadly,!0),t.remind,!0),t.warning,!0).length>0}}]},e.selectedMonitor={},e.timeList=[10,15,20,30],e.monitorEnumList=[],e}return rt(e,t),e.prototype.onStatusChanged=function(t){var e,i=this;if(this.itemObj.status)if(this.itemObj.isAdd){var n=null===(e=this.$route.query)||void 0===e?void 0:e.field_name,o=!this.formSelectMetric.some((function(t){return t.item_name===n}))&&n;this.itemForm={item_name:o?n:"",monitor_item_type:"metric",no_data_config:{is_enabled:!1,continuous:5},trigger_config:{check_window:5,count:1},recovery_config:{check_window:5},config_obj:{deadly:[],warning:[],remind:[]},agg_interval_unit:"min",agg_interval:1},o&&this.$nextTick((function(){i.changeMonitorItem()})),this.monitorList=this.monitorItemList,this.curMetricItem={}}else this.itemForm=this.$Copy(this.itemObj.data),this.changeMonitorList(this.itemObj.data.monitor_item_type,!0),this.$nextTick((function(){i.changeMonitorItem()}))},e.prototype.checkDisabled=function(){return!this.itemObj.isVirtualization&&"host"!==this.itemObj.bkObjId},e.prototype.changeInterval=function(t){this.itemForm.agg_interval=t,this.$refs.popover.hideHandler()},e.prototype.changeUnit=function(){"sec"===this.itemForm.agg_interval_unit&&(this.itemForm.agg_interval=this.itemForm.agg_interval>=10?this.itemForm.agg_interval:10)},e.prototype.changeMonitorList=function(t,e){this.$refs.strategyGroupForm&&this.$refs.strategyGroupForm.clearError(),!0!==e&&(this.itemForm.item_name=""),"event"===t?this.monitorList=this.eventItemList:"metric"===t&&(this.monitorList=this.monitorItemList)},e.prototype.cancelItem=function(){this.handleCancelItem()},e.prototype.submitItem=function(){var t=this;"event"===this.itemForm.monitor_item_type?(this.itemForm.config_obj={deadly:[],warning:[],remind:[]},this.itemForm.agg_interval=null,this.itemForm.agg_method=""):"metric"===this.itemForm.monitor_item_type&&(this.itemForm.alarm_level=null),this.$refs.strategyGroupForm.validate().then((function(e){t.handleSubmitItem({data:t.itemForm,isAdd:t.itemObj.isAdd,curMetricItem:t.curMetricItem})}))},e.prototype.changeMonitorItem=function(t){var e=this,i=this.monitorList.find((function(e){return e.field_name===t}));if(this.monitorEnumList=(null==i?void 0:i.enum_list)||[],""!==this.itemForm.item_name){if(this.curMetricItem=this.monitorList.filter((function(t){return t.field_name===e.itemForm.item_name}))[0],!this.curMetricItem)return this.curMetricItem={},void(this.itemForm.item_name="");this.itemForm.description=this.curMetricItem.description,"event"!==this.itemForm.monitor_item_type&&(this.itemForm.item_name&&(this.selectedMonitor=this.monitorItemList.find((function(t){return t.field_name===e.itemForm.item_name})),this.selectedMonitor.dimension_list=this.selectedMonitor.dimension_list||[],this.itemObj.isAdd?this.selectedMonitor=at(at({},this.selectedMonitor),{bk_obj_id:this.itemObj.bkObjId,agg_condition:this.itemForm.agg_condition,agg_dimension:this.selectedMonitor.dimension_list.map((function(t){return t.key}))||[]}):this.selectedMonitor=at(at({},this.selectedMonitor),{bk_obj_id:this.itemObj.bkObjId,agg_condition:this.itemForm.agg_condition,agg_dimension:this.itemForm.agg_dimension||[]})),this.curMetricItem.unit_suffix_list=this.curMetricItem.unit_suffix_list.filter((function(t){return"x100%"!==t.id})),"x100%"===this.curMetricItem.unit_suffix_id&&(this.curMetricItem.unit_suffix_id="%"))}},e.prototype.handleGetAlarmData=function(t){return this.itemForm.config_obj[t.type]},e.prototype.handleEditAlgorithm=function(t,e){this.algorithm.mode="edit",this.algorithm.type=t,this.algorithm.editData=this.$Copy(e),this.algorithm.show=!0},e.prototype.handleDeleteAlgorithm=function(t,e,i){this.algorithm.mode="delete",this.algorithm.type=t,this.algorithm.editData=null,this.algorithm.show=!1,this.itemForm.config_obj[t].splice(i,1),this.$refs.strategyGroupForm.validateField("config_obj")},e.prototype.handleAddAlgorithm=function(t,e){this.algorithm.type=e.type,this.algorithm.mode="add",this.algorithm.editData=null,this.algorithm.show=!0},e.prototype.handlePanelChange=function(t,e){this.panel.forEach((function(i){i.expand=i.level===e&&t}))},e.prototype.curAlgorithmItem=function(){return this.curMetricItem&&this.algorithm.type?this.curMetricItem.algorithm[this.algorithm.type]:[]},e.prototype.selectedAlgorithms=function(){return this.itemForm.config_obj[this.algorithm.type]&&this.itemForm.config_obj[this.algorithm.type].length?this.itemForm.config_obj[this.algorithm.type].map((function(t){return t.type})):[]},e.prototype.handleDialogChange=function(){this.algorithm.show=!1},e.prototype.handleDialogConfirm=function(t,e){if("add"===this.algorithm.mode)e.hover=!1,this.itemForm.config_obj[this.algorithm.type].push(e);else if("edit"===this.algorithm.mode){var i=this.itemForm.config_obj[this.algorithm.type].find((function(t){return t.type===e.type}));i&&Object.keys(e).forEach((function(t){i[t]=e[t]}))}this.$refs.strategyGroupForm.validateField("config_obj"),this.algorithm.show=!1},e.prototype.changeTriggerMax=function(){var t=this;this.$nextTick((function(){parseInt(t.itemForm.trigger_config.check_window)<parseInt(t.itemForm.trigger_config.count)&&(t.itemForm.trigger_config.count=t.$Copy(t.itemForm.trigger_config.check_window))}))},e.prototype.changeCondition=function(t){this.itemForm.agg_condition=t},e.prototype.changeDimension=function(t){this.itemForm.agg_dimension=t},e.prototype.handleSubmitItem=function(t){return t},e.prototype.handleCancelItem=function(){return""},st([Object(o.d)({type:Object,default:function(){return{status:!1,title:[],monitorObjId:0,bkObjId:""}}})],e.prototype,"itemObj",void 0),st([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"monitorItemList",void 0),st([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"eventItemList",void 0),st([Object(o.d)({type:Array,default:function(){return[]}})],e.prototype,"formSelectMetric",void 0),st([Object(o.f)("itemObj.status")],e.prototype,"onStatusChanged",null),st([Object(o.b)("submitItem")],e.prototype,"handleSubmitItem",null),st([Object(o.b)("cancelItem")],e.prototype,"handleCancelItem",null),e=st([Object(o.a)({components:{AlgorithmsPanelItem:y,StrategyConfigAlgorithm:G,MonirorConditionSelect:Z,MonitorDimension:ot},data:function(){return{isSecond:window.IS_SUPPORT_SEC_LEVEL}}})],e)}(o.e),ut=ct,dt=Object(d.a)(ut,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"strategyItem"}},[i("bk-sideslider",{attrs:{"is-show":t.itemObj.status,title:t.itemObj.title,width:800,"ext-cls":"common-dialog-wrapper"},on:{"update:isShow":function(e){return t.$set(t.itemObj,"status",e)},"update:is-show":function(e){return t.$set(t.itemObj,"status",e)}}},[i("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"strategyGroupForm",attrs:{rules:t.rules,model:t.itemForm}},[i("bk-form-item",{attrs:{"error-display-type":"normal",label:"监控项",required:!0,property:"item_name"}},[i("bk-select",{staticStyle:{width:"200px",float:"left"},attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:"",clearable:!1,disabled:t.checkDisabled()},on:{change:t.changeMonitorList},model:{value:t.itemForm.monitor_item_type,callback:function(e){t.$set(t.itemForm,"monitor_item_type",e)},expression:"itemForm.monitor_item_type"}},[i("bk-option",{key:"metric",attrs:{id:"metric",name:"指标"}}),t._v(" "),i("bk-option",{key:"event",attrs:{id:"event",name:"事件"}})],1),t._v(" "),i("bk-select",{staticStyle:{width:"calc(100% - 200px)",float:"left"},attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:""},on:{change:t.changeMonitorItem},model:{value:t.itemForm.item_name,callback:function(e){t.$set(t.itemForm,"item_name",e)},expression:"itemForm.item_name"}},t._l(t.monitorList,(function(e,n){return i("bk-option",{key:t.itemForm.monitor_item_type+"_"+n,attrs:{id:e.field_name,name:t.itemObj.isVirtualization||["k8s_pod","bk_node"].includes(t.$route.query.bkObjId)?e.description:e.description+"("+e.table_id+")"}})})),1)],1),t._v(" "),"metric"===t.itemForm.monitor_item_type?[t.itemObj.isVirtualization?t._e():i("bk-form-item",{attrs:{"error-display-type":"normal",label:"汇聚方式",required:!0,property:"agg_method"}},[i("bk-select",{attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:"",clearable:!1},model:{value:t.itemForm.agg_method,callback:function(e){t.$set(t.itemForm,"agg_method",e)},expression:"itemForm.agg_method"}},t._l(t.aggMethodList,(function(t){return i("bk-option",{key:t.value,attrs:{id:t.value,name:t.name}})})),1)],1),t._v(" "),t.itemObj.isVirtualization?t._e():i("bk-form-item",{staticClass:"agg-interval",attrs:{"error-display-type":"normal",label:"汇聚周期",required:!0,property:"agg_interval"}},[i("bk-popover",{ref:"popover",attrs:{arrow:"false",trigger:"click",disabled:"min"===t.itemForm.agg_interval_unit,theme:"light","ext-cls":"input-select-popover",width:"524",placement:"bottom-start"}},[i("div",{attrs:{slot:"content"},slot:"content"},t._l(t.timeList,(function(e){return i("div",{key:e,staticClass:"list-item",class:{active:e===+t.itemForm.agg_interval},on:{click:function(i){return t.changeInterval(e)}}},[t._v(t._s(e))])})),0),t._v(" "),i("bk-input",{staticStyle:{width:"524px"},attrs:{min:"sec"===t.itemForm.agg_interval_unit?10:1,type:"number",precision:0},model:{value:t.itemForm.agg_interval,callback:function(e){t.$set(t.itemForm,"agg_interval",e)},expression:"itemForm.agg_interval"}})],1),t._v(" "),i("bk-select",{staticClass:"unit-select",attrs:{clearable:!1},on:{change:t.changeUnit},model:{value:t.itemForm.agg_interval_unit,callback:function(e){t.$set(t.itemForm,"agg_interval_unit",e)},expression:"itemForm.agg_interval_unit"}},[i("bk-option",{attrs:{id:"min",name:"分钟"}}),t._v(" "),t.isSecond?i("bk-option",{attrs:{id:"sec",name:"秒"}}):t._e()],1)],1),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"检测算法",required:!0,property:"config_obj"}},t._l(t.panel,(function(e,n){return i("algorithms-panel-item",{key:n+"-"+t.curMetricItem.field_name,attrs:{"type-item":e,"type-id":t.header.typeId,"alarm-data":t.handleGetAlarmData(e),"data-type-label":t.curMetricItem.dataTypeLabel,"agg-method":t.curMetricItem.aggMethod,unit:t.curMetricItem.unit},on:{"edit-algorithm":t.handleEditAlgorithm,"delete-algorithm":t.handleDeleteAlgorithm,"add-algorithm":t.handleAddAlgorithm,"panel-change":t.handlePanelChange}})})),1)]:i("bk-form-item",{attrs:{"error-display-type":"normal",label:"告警等级",property:"alarm_level"}},[i("bk-radio-group",{model:{value:t.itemForm.alarm_level,callback:function(e){t.$set(t.itemForm,"alarm_level",e)},expression:"itemForm.alarm_level"}},[i("bk-radio",{attrs:{value:1}},[t._v("致命")]),t._v(" "),i("bk-radio",{staticStyle:{"margin-left":"5px"},attrs:{value:2}},[t._v("预警")]),t._v(" "),i("bk-radio",{staticStyle:{"margin-left":"5px"},attrs:{value:3}},[t._v("提醒")])],1)],1),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"触发条件",required:!0}},[t._v("\n                    在\n                    "),i("bk-input",{staticClass:"strategy-number",attrs:{max:60,min:1,precision:0,size:"small",type:"number"},on:{change:t.changeTriggerMax},model:{value:t.itemForm.trigger_config.check_window,callback:function(e){t.$set(t.itemForm.trigger_config,"check_window",e)},expression:"itemForm.trigger_config.check_window"}}),t._v("\n                    个周期内满足\n                    "),i("bk-input",{staticClass:"strategy-number",attrs:{max:+t.itemForm.trigger_config.check_window,min:1,precision:0,size:"small",type:"number"},model:{value:t.itemForm.trigger_config.count,callback:function(e){t.$set(t.itemForm.trigger_config,"count",e)},expression:"itemForm.trigger_config.count"}}),t._v("\n                    次检测算法触发告警通知\n                ")],1),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"恢复条件",required:!0}},[t._v("\n                    连续\n                    "),i("bk-input",{staticClass:"strategy-number",attrs:{max:60,min:1,precision:0,size:"small",type:"number"},model:{value:t.itemForm.recovery_config.check_window,callback:function(e){t.$set(t.itemForm.recovery_config,"check_window",e)},expression:"itemForm.recovery_config.check_window"}}),t._v("\n                    个周期内不满足条件表示恢复\n                ")],1),t._v(" "),"metric"!==t.itemForm.monitor_item_type||t.itemObj.isVirtualization?t._e():i("bk-form-item",{attrs:{label:"监控维度"}},[i("bk-input",{directives:[{name:"show",rawName:"v-show",value:!t.itemForm.item_name,expression:"!itemForm.item_name"}],staticStyle:{width:"120px"},attrs:{placeholder:"请先选择监控项",disabled:""}}),t._v(" "),i("MonitorDimension",{directives:[{name:"show",rawName:"v-show",value:t.itemForm.item_name,expression:"itemForm.item_name"}],attrs:{"selected-monitor":t.selectedMonitor},on:{change:t.changeDimension}})],1),t._v(" "),"metric"!==t.itemForm.monitor_item_type||t.itemObj.isVirtualization?t._e():i("bk-form-item",{attrs:{label:"监控条件"}},[i("bk-input",{directives:[{name:"show",rawName:"v-show",value:!t.itemForm.item_name,expression:"!itemForm.item_name"}],staticStyle:{width:"120px"},attrs:{placeholder:"请先选择监控项",disabled:""}}),t._v(" "),i("moniror-condition-select",{directives:[{name:"show",rawName:"v-show",value:t.itemForm.item_name,expression:"itemForm.item_name"}],attrs:{"selected-monitor":t.selectedMonitor,"show-business":!1},on:{change:t.changeCondition}})],1)],2)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:function(e){return t.submitItem()}}},[t._v("\n                确认\n            ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{theme:"default"},on:{click:function(e){return t.cancelItem()}}},[t._v("取消")])],1)]),t._v(" "),i("strategy-config-algorithm",{attrs:{"dialog-show":t.algorithm.show,"selected-algorithms":t.selectedAlgorithms(),"unit-suffix-id":t.curMetricItem.unit_suffix_id,"unit-suffix-list":t.curMetricItem.unit_suffix_list,mode:t.algorithm.mode,value:t.algorithm.editData,"monitor-enum-list":t.monitorEnumList},on:{"hide-dialog":t.handleDialogChange,"confirm-dialog":t.handleDialogConfirm}})],1)}),[],!1,null,"02169067",null).exports,pt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),mt=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},ht=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function s(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},ft=function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},vt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.validateItemError=!1,e.validateObjError=!1,e.isFirst=!1,e.itemObj={status:!1,monitorObjId:0,title:"添加监控项配置",isAdd:!0,index:-1,bkObjId:""},e.noticeGroupList=[],e.formObj={name:"",is_enabled:!0,monitor_object:"",object_inst_ids:[],notice_groups:[],strategy_type:1,alarm_interval:120,send_recovery_alarm:!1,monitor_item:[],brand:"",network_classification_id:"",object_select_type:"list"},e.initformObj={},e.monitorItemList=[],e.eventItemList=[],e.allEventItemList=[],e.selectedItemList=[],e.allMonitorItemList=[],e.monitorObjList=[],e.propertyData=[],e.rules={name:[{message:"策略组名称不能为空",trigger:"blur",required:!0}],monitor_object:[{message:"监控对象未选择",trigger:"blur",required:!0}],alarm_interval:[{message:"通知间隔不能为空",trigger:"blur",required:!0}],notice_groups:[{message:"告警组不能为空",trigger:"blur",required:!0}],classification_id:[{message:"监控模板不能为空",trigger:"blur",required:!0,validator:function(){return!!e.formObj.network_classification_id}}]},e.loading=!1,e.confirmLeave=!1,e.requireObjectInstListFlag=!0,e.confirmLoading=!1,e.curMetricItem={},e.policyData={},e.allBrandList=[],e}return pt(e,t),Object.defineProperty(e.prototype,"isEdit",{get:function(){return"monitor-strategyGroupModify"===this.$route.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modelList",{get:function(){var t,e=this;return(null===(t=this.allBrandList.find((function(t){return t.id===e.formObj.brand})))||void 0===t?void 0:t.children)||[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isVirtualization",{get:function(){return["vm","storage","esxi"].includes(this.$route.query.bkObjId)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showTopo",{get:function(){return["Operating_System","SQL","middleware"].includes(this.$route.query.parentNodeId)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWeb",{get:function(){return"bk_device"===this.$route.query.parentNodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listDisabled",{get:function(){return"group"===this.formObj.object_select_type&&!!this.formObj.object_inst_ids.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupDisabled",{get:function(){return"list"===this.formObj.object_select_type&&!!this.formObj.object_inst_ids.length},enumerable:!1,configurable:!0}),e.prototype.onMonitorItemChanged=function(t){this.judgeTargetSelect()},e.prototype.created=function(){return ht(this,void 0,void 0,(function(){var t,e=this;return ft(this,(function(i){switch(i.label){case 0:return this.loading=!0,this.getMonitorObjList(),this.getMonitorItem(),this.isWeb?[4,this.getNetworkClassificationList()]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.isVirtualization?[3,4]:[4,this.getObjPropertyList()];case 3:i.sent(),i.label=4;case 4:return[4,this.getNoticeGroupList()];case 5:return i.sent(),this.isEdit?(this.isFirst=!0,this.policyData=JSON.parse(sessionStorage.getItem("policyModifyData")||"{}"),[4,this.initMonitorStrategy(this.policyData)]):[3,7];case 6:return i.sent(),[3,8];case 7:this.formObj.name=this.$route.query.bkObjName,this.formObj.object_inst_ids=JSON.parse(this.$route.query.targetIds||"[]").map((function(t){return{bk_inst_id:t}})),this.$route.query.formOrigin&&"metric"===this.$route.query.formOrigin&&(t=sessionStorage.getItem("metricMinorList"))&&JSON.parse(t).forEach((function(t){e.submitItem(t)})),i.label=8;case 8:return this.isVirtualization&&this.formObj.object_inst_ids.length?[4,this.getVmwareIdInstances()]:[3,10];case 9:i.sent(),i.label=10;case 10:return this.loading=!1,this.initformObj=this.$copy(this.formObj),[2]}}))}))},e.prototype.getNetworkClassificationList=function(){return ht(this,void 0,void 0,(function(){var t,e,i,n;return ft(this,(function(o){switch(o.label){case 0:return[4,this.$api.monitorAlarm.getNetworkClassificationList({bk_obj_id:this.$route.query.bkObjId})];case 1:return t=o.sent(),e=t.result,i=t.data,n=t.message,e?(this.allBrandList=i,[2]):(this.$error(n),[2])}}))}))},e.prototype.handleBrandChange=function(){this.isFirst||(this.formObj.network_classification_id="")},e.prototype.handleClassificationChange=function(){this.isFirst||this.getMonitorItemList(),this.isFirst=!1},e.prototype.judgeTargetSelect=function(){var t=this,e=this.formObj.monitor_item;if(this.allMonitorItemList.length)if(e.length>0){var i=e.filter((function(t){return"event"===t.monitor_item_type})),n=e.filter((function(t){return"metric"===t.monitor_item_type})),o=!0;if(this.$refs.strategyGroupAddForm.clearError(),n.length){var r=n.find((function(e){var i=t.allMonitorItemList.find((function(t){return t.description===e.description}));return!0===(null==i?void 0:i.require_object_inst_list)}));o=Boolean(r)}i.length&&(o=!0),this.requireObjectInstListFlag=o}else this.$refs.strategyGroupAddForm.clearError()},e.prototype.initMonitorStrategy=function(t){var e,i;return ht(this,void 0,void 0,(function(){var n,o,r,a,s;return ft(this,(function(l){switch(l.label){case 0:return n={id:t.id,type:this.isVirtualization?"VMware":"other"},[4,this.$api.monitorCollect.getStrategyDataInstance(n)];case 1:if(!(o=l.sent()).result)return this.$error(o.message),[2];for(r in t)this.formObj.hasOwnProperty(r)&&"monitor_object"!==r&&(this.formObj[r]=t[r]);return this.isVirtualization?(t.created_by=o.data.created_by,this.formObj.object_inst_ids=o.data.cloud_resource_targets.map((function(t){return{bk_inst_id:t}})),(s=Object.values(o.data.alarm_strategies)[0]).forEach((function(t){t.config_obj=t.strategy_config.config_obj,t.trigger_config=t.strategy_config.trigger_config,t.recovery_config=t.strategy_config.recovery_config,t.monitor_item_type=t.item_type,t.item_name=t.item.name,t.agg_interval_unit=t.item.unit,t.agg_method=t.item.metric,t.description=t.item.description,t.metric=t.item.metric,t.unit_suffix_id=t.item.unit_suffix_id,t.unit_suffix_list=t.item.unit_suffix_list})),this.formObj.monitor_item=s,this.selectedItemList=this.formObj.monitor_item.map((function(t){return t.item_name}))):(this.formObj.monitor_item=o.data.monitor_item,this.selectedItemList=this.formObj.monitor_item.map((function(t){return t.item_name})),this.formObj.object_select_type=(null===(e=o.data.strategy_obj)||void 0===e?void 0:e.object_select_type)||"list",this.isWeb&&(a=o.data.network_classification_id,this.formObj.network_classification_id=a||"",a&&(this.formObj.brand=(null===(i=this.allBrandList.find((function(t){return t.children.map((function(t){return t.id})).includes(a)})))||void 0===i?void 0:i.id)||""))),this.getMonitorItemList(o.data),[2]}}))}))},e.prototype.getMonitorObjList=function(){var t=this.$route.query,e=t.bkObjId,i=t.name;this.monitorObjList=[{id:e,bk_obj_name:i}],this.formObj.monitor_object=e},e.prototype.getNoticeGroupList=function(){return ht(this,void 0,void 0,(function(){var t=this;return ft(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getNotice({page:1,page_size:2e3}).then((function(e){e.result?t.noticeGroupList=e.data:t.$error(e.message)}))];case 1:return e.sent(),[2]}}))}))},e.prototype.getVmwareIdInstances=function(){return ht(this,void 0,void 0,(function(){var t,e=this;return ft(this,(function(i){switch(i.label){case 0:return t=this.formObj.object_inst_ids.map((function(t){return t.bk_inst_id||t.id})),[4,this.$api.monitorCollect.getVmwareIdInstances({ids:t}).then((function(t){t.result?t.data.forEach((function(t){var i=e.formObj.object_inst_ids.find((function(e){return e.bk_inst_id===t.id}));i&&(i.bk_inst_name=t.bk_inst_name)})):e.$error(t.message)}))];case 1:return i.sent(),[2]}}))}))},e.prototype.getMonitorItem=function(){this.formObj.object_inst_ids=[],this.formObj.monitor_item=[],this.isEdit||this.getMonitorItemList(),this.getMonitorItemEventList()},e.prototype.getMonitorItemList=function(t){return ht(this,void 0,void 0,(function(){var e,i=this;return ft(this,(function(n){return e={bk_obj_id:this.$route.query.bkObjId,network_classification_id:this.formObj.network_classification_id},this.$api.monitorCollect.getCloudResourceMetrics(e).then((function(e){if(e.result)return i.monitorItemList=e.data,i.allMonitorItemList=i.$copy(e.data),void(t&&i.judgeTargetSelect());i.$error(e.message)})),[2]}))}))},e.prototype.getMonitorItemEventList=function(t){var e=this,i={cloud_type:"other",cloud_resource_type:this.$route.query.id};this.isVirtualization&&(i.cloud_type="VMware",i.cloud_resource_type=this.$route.query.bkObjId),this.$api.monitorCollect.getCloudResourceEvents(i).then((function(t){t.result?(e.eventItemList=t.data,e.allEventItemList=e.$copy(t.data)):e.$error(t.message)}))},e.prototype.handleTargetAdd=function(){var t=this.$route.query,e=t.bkObjId,i=t.type,n=t.id,o=this.isVirtualization?{type:i,bk_obj_id:e}:this.propertyData,r={objId:n,entry:this.isVirtualization?"policy-isVirtualization":"policy-others"};r.panels=[{name:"list",disabled:this.listDisabled},{name:"topo",disabled:this.listDisabled,hide:!this.showTopo},{name:"group",hide:this.isVirtualization,disabled:this.groupDisabled}],this.$refs.selectTargets.show(this.formObj.object_inst_ids,o,r)},e.prototype.getObjPropertyList=function(){return ht(this,void 0,void 0,(function(){var t;return ft(this,(function(e){switch(e.label){case 0:return[4,this.$api.monitorCollect.getObjPropertyList({monitor_obj_id:this.$route.query.id})];case 1:return(t=e.sent()).result?(this.propertyData=t.data,[2]):(this.$error(t.message),[2])}}))}))},e.prototype.submitTarget=function(t){var e=t.data,i=t.type;this.formObj.object_inst_ids=e,this.formObj.object_select_type=i,this.validateObjError=!this.requireObjectInstListFlag||0===this.formObj.object_inst_ids.length},e.prototype.submitForm=function(){var t=this;this.validateObjError=!!this.requireObjectInstListFlag&&0===this.formObj.object_inst_ids.length,this.validateItemError=0===this.formObj.monitor_item.length,this.confirmLoading=!0,this.$refs.strategyGroupAddForm.validate().then((function(e){if(t.validateItemError||t.validateObjError)t.confirmLoading=!1;else{var i="createMonitorTask",n=t.$copy(t.formObj);if(t.isEdit&&(i="updateMonitorTask",n.id=t.$route.query.taskId,t.isVirtualization&&(n.created_by=t.policyData.created_by)),t.formObj.monitor_item.forEach((function(t){t.no_data_config&&(t.no_data_config.is_enabled=!1)})),n.monitor_item=t.$copy(t.formObj.monitor_item),n.bk_obj_id=t.$route.query.bkObjId,n.monitor_object=t.$route.query.id,n.create_type=t.isVirtualization?"VMware":"Template",n.notice_groups=[],n.type="cloud_resource",t.isVirtualization){n.cloud_targets=[],n.cloud_type="VMware",n.cloud_resource_targets=n.object_inst_ids=n.object_inst_ids.map((function(t){return t.id||t.bk_inst_id}));var o={};o["esxi"===n.bk_obj_id?"host":n.bk_obj_id]=n.monitor_item.map((function(e){return{name:"".concat(n.name,"#").concat(t.$route.query.name,"#").concat(e.description),item:{metric:e.metric,name:e.item_name,description:e.description,unit:e.agg_interval_unit,unit_suffix_id:e.unit_suffix_id,unit_suffix_list:e.unit_suffix_list,mapping:{VMware:{alias:e.metric,namespace:t.$route.query.bkObjId}},hide:!1},id:e.id,cloud_resource_type:t.$route.query.bkObjId,cloud_type:"VMware",item_type:e.monitor_item_type,strategy_config:{config_obj:e.config_obj,trigger_config:e.trigger_config,recovery_config:e.recovery_config}}})),n.monitor_item=o}t.$api.monitorCollect[i](n).then((function(e){t.confirmLoading=!1,e.result?(t.confirmLeave=!0,t.$success(t.isEdit?"编辑成功":"新建成功"),t.$router.go(-1)):t.$error(e.message)}))}}),(function(e){t.confirmLoading=!1}))},e.prototype.addItem=function(){var t=this;this.monitorItemList=this.allMonitorItemList.filter((function(e){return!t.selectedItemList.includes(e.field_name)})),this.eventItemList=this.allEventItemList.filter((function(e){return!t.selectedItemList.includes(e.field_name)})),this.itemObj.status=!0,this.itemObj.monitorObjId=this.formObj.monitor_object,this.itemObj.bkObjId=this.monitorObjList.find((function(e){return e.id===t.formObj.monitor_object})).id,this.itemObj.title="添加监控项配置",this.itemObj.isAdd=!0,this.itemObj.isVirtualization=this.isVirtualization},e.prototype.modifyItem=function(t,e){var i=this;this.monitorItemList=this.allMonitorItemList.filter((function(e){return e.field_name===t.item_name||!i.selectedItemList.includes(e.field_name)})),this.eventItemList=this.allEventItemList.filter((function(e){return e.field_name===t.item_name||!i.selectedItemList.includes(e.field_name)})),this.itemObj={status:!0,isAdd:!1,title:"修改监控项配置",monitorObjId:this.formObj.monitor_object,bkObjId:this.monitorObjList.find((function(t){return t.id===i.formObj.monitor_object})).id,data:this.$copy(t),index:e,isVirtualization:this.isVirtualization}},e.prototype.deleteItem=function(t,e){"metric"===e.monitor_item_type?this.monitorItemList.push(this.allMonitorItemList.filter((function(t){return t.field_name===e.item_name}))[0]):"event"===e.monitor_item_type&&this.eventItemList.push(this.allEventItemList.filter((function(t){return t.field_name===e.item_name}))[0]),this.formObj.monitor_item.splice(t,1),this.selectedItemList=this.selectedItemList.filter((function(t){return t!==e.item_name})),this.validateItemError=0===this.formObj.monitor_item.length,this.judgeTargetSelect()},e.prototype.cancelItem=function(){this.itemObj.status=!1},e.prototype.submitItem=function(t){this.itemObj.status=!1,this.isVirtualization&&(t.data.metric=t.curMetricItem.metric,t.data.unit_suffix_id=t.curMetricItem.unit_suffix_id,t.data.unit_suffix_list=t.curMetricItem.unit_suffix_list),t.isAdd?(this.formObj.monitor_item.push(t.data),this.selectedItemList.push(t.data.item_name)):this.$set(this.formObj.monitor_item,this.itemObj.index,this.$copy(t.data)),this.judgeTargetSelect(),this.$forceUpdate(),this.validateItemError=0===this.formObj.monitor_item.length},e.prototype.cancel=function(){this.$router.go(-1)},mt([Object(o.f)("formObj.monitor_item",{deep:!0})],e.prototype,"onMonitorItemChanged",null),e=mt([Object(o.a)({components:{StrategyItem:dt,MonitorTargetSelect:r.a},data:function(){return{isShowNotify:window.IS_NOTIFY}},beforeRouteLeave:function(t,e,i){var n=this,o=this.$compareFormData(this.formObj,this.initformObj);this.confirmLeave||o?i():this.$bkInfo({title:"确认离开当前页？",subTitle:"离开后将会导致未保存信息丢失",confirmFn:function(){n.confirmLeave=!0,i()},cancelFn:function(){i(!1)}})}})],e)}(o.e),yt=vt,bt=Object(d.a)(yt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"strategyGroupAdd",staticClass:"padding-20",attrs:{id:"strategyGroupAdd"}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"strategy-group-add"},[i("bk-form",{ref:"strategyGroupAddForm",staticClass:"width710",staticStyle:{"padding-right":"20px"},attrs:{id:"form","label-width":110,model:t.formObj,rules:t.rules}},[i("bk-form-item",{attrs:{"error-display-type":"normal",label:"策略名称",required:!0,property:"name"}},[i("bk-input",{model:{value:t.formObj.name,callback:function(e){t.$set(t.formObj,"name",e)},expression:"formObj.name"}})],1),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"监控对象",required:!0,property:"monitor_object"}},[i("bk-select",{attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:"",disabled:""},model:{value:t.formObj.monitor_object,callback:function(e){t.$set(t.formObj,"monitor_object",e)},expression:"formObj.monitor_object"}},t._l(t.monitorObjList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.bk_obj_name}})})),1)],1),t._v(" "),t.isWeb?i("bk-form-item",{attrs:{"error-display-type":"normal",label:"监控模板",required:"",property:"classification_id"}},[i("div",{staticStyle:{display:"flex"}},[i("bk-select",{staticClass:"mr10",staticStyle:{width:"150px",background:"#fff"},attrs:{searchable:"",disabled:t.isEdit},on:{change:t.handleBrandChange},model:{value:t.formObj.brand,callback:function(e){t.$set(t.formObj,"brand",e)},expression:"formObj.brand"}},t._l(t.allBrandList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v(" "),i("bk-select",{staticStyle:{width:"150px",background:"#fff"},attrs:{searchable:"",disabled:t.isEdit},on:{change:t.handleClassificationChange},model:{value:t.formObj.network_classification_id,callback:function(e){t.$set(t.formObj,"network_classification_id",e)},expression:"formObj.network_classification_id"}},t._l(t.modelList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1)]):t._e(),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"监控项配置",required:!0}},[t.formObj.monitor_item.length?i("div",[t._l(t.formObj.monitor_item,(function(e,n){return i("div",{key:n,staticClass:"add-plugin-wrap"},[i("div",{staticClass:"add-plugin-item",on:{click:function(i){return t.modifyItem(e,n)}}},[t._v(t._s(e.description))]),t._v(" "),i("i",{staticClass:"close-item bk-icon icon-close-circle-shape",on:{click:function(i){return t.deleteItem(n,e)}}})])})),t._v(" "),i("div",{staticClass:"plus-item",on:{click:t.addItem}},[t._v("+")])],2):i("bk-button",{attrs:{text:"",size:"small",disabled:t.isWeb&&!t.formObj.network_classification_id},on:{click:t.addItem}},[t._v("\n                    添加监控项配置\n                ")]),t._v(" "),t.validateItemError?i("p",{staticClass:"form-error-tip"},[t._v("监控项配置不能为空")]):t._e()],1),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"监控目标",required:t.requireObjectInstListFlag}},[t.formObj.object_inst_ids.length?[i("span",{staticStyle:{color:"#63656e"}},[t._v("\n                        "+t._s(t.formObj.object_inst_ids.length)+"个"+t._s("list"===t.formObj.object_select_type?"对象实例":"动态分组")+"\n                    ")])]:t._e(),t._v(" "),i("bk-button",{style:{marginLeft:t.formObj.object_inst_ids.length?"10px":"0"},on:{click:t.handleTargetAdd}},[t._v("\n                    "+t._s(t.formObj.object_inst_ids.length?"修改目标":"点击选择")+"\n                ")]),t._v(" "),t.requireObjectInstListFlag?t._e():i("span",[i("bk-icon",{staticClass:"info-icon",attrs:{type:"info-circle-shape"}}),t._v("\n                    当前设置的监控项配置支持不选择监控目标，策略范围为监控项配置中的“监控条件”，若“监控条件”为空，则生效于所有已监控的实例\n                ")],1),t._v(" "),t.validateObjError&&t.requireObjectInstListFlag?i("p",{staticClass:"form-error-tip"},[t._v("监控目标不能为空")]):t._e()],2),t._v(" "),t.isVirtualization?t._e():i("bk-form-item",{attrs:{"error-display-type":"normal",label:"通知间隔",required:!0,property:"alarm_interval"}},[t._v("\n                若告警未恢复，则每隔\n                "),i("bk-input",{staticClass:"strategy-number",attrs:{min:1,precision:0,size:"small",type:"number"},model:{value:t.formObj.alarm_interval,callback:function(e){t.$set(t.formObj,"alarm_interval",e)},expression:"formObj.alarm_interval"}}),t._v("\n                分钟再进行告警\n            ")],1),t._v(" "),t.isShowNotify?i("bk-form-item",{attrs:{"error-display-type":"normal",label:"告警组",required:!0,property:"notice_groups"}},[i("bk-select",{attrs:{"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",multiple:!0,searchable:""},model:{value:t.formObj.notice_groups,callback:function(e){t.$set(t.formObj,"notice_groups",e)},expression:"formObj.notice_groups"}},t._l(t.noticeGroupList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):t._e(),t._v(" "),i("bk-form-item",{attrs:{"error-display-type":"normal",label:"启动状态",required:!0}},[i("bk-switcher",{staticStyle:{"margin-right":"10px"},attrs:{theme:"primary",size:"small"},model:{value:t.formObj.is_enabled,callback:function(e){t.$set(t.formObj,"is_enabled",e)},expression:"formObj.is_enabled"}})],1)],1)],1),t._v(" "),i("div",{staticClass:"operation"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",loading:t.confirmLoading},on:{click:t.submitForm}},[t._v("\n            确定\n        ")]),t._v(" "),i("bk-button",{staticClass:"mr10",on:{click:t.cancel}},[t._v("\n            取消\n        ")])],1),t._v(" "),i("monitor-target-select",{ref:"selectTargets",attrs:{"is-require":t.requireObjectInstListFlag},on:{getSelectedTargets:t.submitTarget}}),t._v(" "),i("strategy-item",{ref:"strategyItem",attrs:{"item-obj":t.itemObj,"event-item-list":t.eventItemList,"form-select-metric":t.formObj.monitor_item,"monitor-item-list":t.monitorItemList},on:{cancelItem:t.cancelItem,submitItem:t.submitItem}})],1)}),[],!1,null,"a14f8460",null);e.default=bt.exports}}]);