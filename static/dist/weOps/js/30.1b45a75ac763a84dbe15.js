(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{HVB9:function(e,t,n){"use strict";n.r(t);var i,r=n("JnIg"),a=n("G0B5"),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},c=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.visible=!1,t.loading=!1,t.roleInfo="",t.type="",t.formData={role_name:"",describe:"",id:""},t.rules={role_name:[{required:!0,message:"必填项",trigger:"blur"}]},t}return o(t,e),Object.defineProperty(t.prototype,"title",{get:function(){return"add"===this.type?"新增角色":"edit"===this.type?"编辑角色":"拷贝角色"},enumerable:!1,configurable:!0}),t.prototype.show=function(e,t){this.visible=!0,this.type=e,this.formData.role_name="",this.formData.describe="",["edit","copy"].includes(this.type)&&(this.roleInfo=t,this.formData.role_name=t.role_name,this.formData.describe=t.describe,"edit"===this.type&&(this.formData.id=t.id))},t.prototype.close=function(){this.visible=!1},t.prototype.confirm=function(){var e=this;this.$refs.roleValidateForm.validate().then((function(t){var n="",i={};["add","copy"].includes(e.type)?(n="createRole",i.role_name=e.formData.role_name,i.describe=e.formData.describe):(n="editRole",i=s({},e.formData)),e.loading=!0,e.$api.roleManage[n](i).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("".concat(e.title,"成功!")),e.$emit("refreshList"),e.close()})).finally((function(){e.loading=!1}))}))},t.prototype.closeDialog=function(){this.$refs.roleValidateForm.clearError()},t=c([a.a],t)}(a.e),u=l,p=n("KHd+"),d=Object(p.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bk-dialog",{attrs:{position:{top:150},theme:"primary",width:"600","mask-close":!1,"header-position":"left",title:e.title},on:{"after-leave":e.closeDialog},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"content-box"},[n("bk-form",{ref:"roleValidateForm",attrs:{"label-width":90,model:e.formData,rules:e.rules}},[n("bk-form-item",{attrs:{label:"角色名称",required:!0,property:"role_name"}},[n("bk-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.formData.role_name,callback:function(t){e.$set(e.formData,"role_name",t)},expression:"formData.role_name"}})],1),e._v(" "),n("bk-form-item",{attrs:{label:"角色描述"}},[n("bk-input",{attrs:{placeholder:"请输入角色描述",type:"textarea"},model:{value:e.formData.describe,callback:function(t){e.$set(e.formData,"describe",t)},expression:"formData.describe"}})],1)],1)],1),e._v(" "),n("template",{slot:"footer"},[n("bk-button",{staticClass:"mr10",attrs:{disabled:e.loading,theme:"primary",title:"确认"},on:{click:e.confirm}},[e._v("\n            确认\n        ")]),e._v(" "),n("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:e.close}},[e._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,h=n("7hWu"),f=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rtxList=[],t.rtxValue=[],t.sourceLength=0,t.targetLength=0,t.selectApp=[],t.appLoading=!1,t}return f(t,e),t.prototype.mounted=function(){var e=this;this.appLoading=!0,this.$emit("getAppLoading",this.appLoading),Promise.all([this.getBusiness(),this.getRoleApplications()]).then((function(t){var n=t[0],i=t[1];n.result&&(e.rtxList=n.data),i.result&&(e.rtxValue=i.data)})).finally((function(){e.appLoading=!1,e.$emit("getAppLoading",e.appLoading)}))},t.prototype.getRoleApplications=function(){return this.$api.roleManage.getRoleApplications({id:this.role.id})},t.prototype.confirm=function(){var e=this;this.appLoading=!0,this.$emit("getAppLoading",this.appLoading);var t={id:this.role.id,app_ids:this.selectApp.map((function(e){return e.bk_biz_id}))};this.$api.roleManage.setAppPermissions(t).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("应用权限设置成功！")})).finally((function(){e.appLoading=!1,e.$emit("getAppLoading",e.appLoading)}))},t.prototype.change=function(e,t){this.sourceLength=e.length,this.targetLength=t.length,this.selectApp=t},t.prototype.getBusiness=function(){return this.$api.Server.getBizs()},t.prototype.addAll=function(){this.rtxValue=this.rtxList.map((function(e){return e.bk_biz_id}))},t.prototype.removeAll=function(){this.rtxValue=[]},t.prototype.getLatestApp=function(){this.$emit("getLatestApp",this.selectApp.map((function(e){return e.bk_biz_id})))},v([Object(a.d)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=v([Object(a.a)({name:"app-permission",components:{bkTransfer:h.bkTransfer}})],t)}(a.e),g=m,y=Object(p.a)(g,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.appLoading,zIndex:10},expression:"{ isLoading: appLoading, zIndex: 10 }"}],staticClass:"app-permission"},[n("div",{staticClass:"content-box"},[n("bk-transfer",{attrs:{"source-list":e.rtxList,"target-list":e.rtxValue,"display-key":"bk_biz_name","sort-key":"bk_biz_id","setting-key":"bk_biz_id",sortable:!0},on:{change:e.change}},[n("div",{staticClass:"left-header",attrs:{slot:"left-header"},slot:"left-header"},[n("label",[e._v(e._s("无权限应用("+e.sourceLength+")"))]),e._v(" "),n("div",{staticClass:"add-all"},[e.sourceLength?n("span",{on:{click:e.addAll}},[e._v("选择全部")]):n("span",{staticClass:"disabled"},[e._v("选择全部")])])]),e._v(" "),n("div",{staticClass:"right-header",attrs:{slot:"right-header"},slot:"right-header"},[n("label",[e._v(e._s("有权限应用("+e.targetLength+")"))]),e._v(" "),n("div",{staticClass:"remove-all"},[e.targetLength?n("span",{on:{click:e.removeAll}},[e._v("全部移除")]):n("span",{staticClass:"disabled"},[e._v("全部移除")])])]),e._v(" "),n("div",{attrs:{slot:"left-empty-content"},slot:"left-empty-content"},[n("div",{staticClass:"empty-content"},[e._v("\n                    数据为空\n                ")])]),e._v(" "),n("div",{attrs:{slot:"right-empty-content"},slot:"right-empty-content"},[n("div",{staticClass:"empty-content"},[e._v("\n                    未选择任何数据\n                ")])])])],1)])}),[],!1,null,"03ac5f74",null).exports,b=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),k=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.menuList=[],t.menuLoading=!1,t.checkAuthMenusIds=[],t.operateAuthMenusIds=[],t}return b(t,e),t.prototype.mounted=function(){var e=this;this.menuList=JSON.parse(JSON.stringify(this.$store.state.permission.menuList)),this.menuList[this.menuList.length-1].children.forEach((function(t){var n;null===(n=t.children)||void 0===n||n.forEach((function(e){["SysUser","NoticeWays"].includes(e.id)&&(e.isHide=!0),t.children=t.children.filter((function(e){return!e.isHide}))})),["ServiceDeskManage"].includes(t.id)&&(t.isHide=!0),e.menuList[e.menuList.length-1].children=e.menuList[e.menuList.length-1].children.filter((function(e){return!e.isHide}))})),this.handleMenus(this.menuList),this.getRoleMenus()},t.prototype.confirm=function(){var e=this;this.menuLoading=!0,this.$emit("getMenuLoading",this.menuLoading),this.$api.roleManage.setRoleMenu({id:this.role.id,menu_ids:this.checkAuthMenusIds}).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("菜单权限设置成功！")})).finally((function(){e.menuLoading=!1,e.$emit("getMenuLoading",e.menuLoading)}))},t.prototype.getLatestMenu=function(){this.checkAuthMenusIds=[],this.operateAuthMenusIds=[],this.getSelectMenusIds(this.menuList),this.$emit("getLatestMenu",{checkAuthIds:this.checkAuthMenusIds,operateAuthIds:this.operateAuthMenusIds})},t.prototype.getSelectMenusIds=function(e){var t=this;e.forEach((function(e){e.children&&t.getSelectMenusIds(e.children);var n={menuId:e.id,operate_ids:[]};e.auth.forEach((function(i){"check"===i.type&&i.value&&t.checkAuthMenusIds.push(e.id),e.children||"operate"===i.type&&i.value&&n.operate_ids.push(i.key)})),n.operate_ids.length&&t.operateAuthMenusIds.push(n)}))},t.prototype.setExpandStatus=function(e){e.children&&this.$set(e,"isExpand",!e.isExpand)},t.prototype.getIndeterminateValue=function(e,t){if(e.children){var n=[];e.children.forEach((function(e){e.auth.forEach((function(e){e.type===t&&n.push(e)}))})),e.auth.forEach((function(e){e.type===t&&(e.value=n.every((function(e){return e.value})),e.isIndeterminate=!(n.every((function(e){return e.value}))||n.every((function(e){return!e.value})))||!!n.find((function(e){return e.isIndeterminate})))})),e.isChecked=e.auth.every((function(e){return e.value})),e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value})))||!!e.auth.find((function(e){return e.isIndeterminate}))}},t.prototype.handleOperateChecked=function(e,t,n){var i=this;e.isChecked=e.auth.every((function(e){return e.value})),e.auth.forEach((function(e){e.type===t&&(e.isIndeterminate=!1)})),"operate"===t&&e.auth.find((function(e){return"operate"===e.type&&e.value}))&&!n&&e.auth.forEach((function(t){"check"===t.type&&(t.value=!0,i.setCheckedStatus(e,t.value,"check"),i.handleParentChecked(e,"check"));var n=e.auth.find((function(e){return"manageAllArticlesAuth"===e.key}));"manageMyArticlesAuth"===t.key&&n.value&&(t.value=!0,i.setCheckedStatus(e,t.value,"check"),i.handleParentChecked(e,"check"))})),"check"!==t||e.auth.find((function(e){return"check"===e.type})).value||n||e.auth.forEach((function(t){"operate"===t.type&&(t.value=!1,i.setCheckedStatus(e,t.value,"operate"),i.handleParentChecked(e,"operate"))})),e.children?this.setCheckedStatus(e,e.auth.find((function(e){return e.type===t})).value,t):e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value}))),this.handleParentChecked(e,t)},t.prototype.handleParentChecked=function(e,t){if(e.parentId){var n=this.findItemById(e.parentId,this.menuList);t?this.getIndeterminateValue(n,t):this.handleAllCheckValue(n),n.parentId&&this.handleParentChecked(n,t)}},t.prototype.handleAllCheckValue=function(e){e.children&&(e.isChecked=e.children.every((function(e){return e.isChecked})),e.isIndeterminate=!!e.children.find((function(e){return e.isChecked}))||!!e.children.find((function(e){return e.isIndeterminate})),e.auth.forEach((function(t){var n=[];e.children.forEach((function(e){e.auth.forEach((function(e){e.type===t.type&&n.push(e)}))})),t.value=n.every((function(e){return e.value}));var i=n.every((function(e){return e.value}))||n.every((function(e){return!e.value}));t.isIndeterminate=!i||!!n.find((function(e){return e.isIndeterminate}))})))},t.prototype.handleMenuChecked=function(e){this.setCheckedStatus(e,e.isChecked,"all")},t.prototype.setCheckedStatus=function(e,t,n,i){var r=this;e.children&&e.children.forEach((function(e){"all"===n&&r.$set(e,"isChecked",t),r.setCheckedStatus(e,t,n)})),"all"===n?(e.auth.forEach((function(e){r.$set(e,"value",t)})),this.$set(e,"isIndeterminate",!1),this.handleParentChecked(e)):(e.auth.forEach((function(e){e.type===n&&(e.value=t)})),e.isChecked=e.auth.every((function(e){return e.value})),e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value}))))},t.prototype.handleMenus=function(e,t){var n=this;e.forEach((function(e){t&&n.$set(e,"parentId",t),n.$set(e,"isChecked",!1),n.$set(e,"isIndeterminate",!1),e.auth.forEach((function(e){n.$set(e,"isIndeterminate",!1)})),e.children&&(n.$set(e,"isExpand",!1),n.handleMenus(e.children,e.id))}))},t.prototype.findItemById=function(e,t){var n=t.find((function(t){return t.id===e}));if(n)return n;for(var i=0;i<t.length;i++)if(t[i].children instanceof Array&&t[i].children.length>0&&(n=this.findItemById(e,t[i].children)))return n;return null},t.prototype.getRoleMenus=function(){var e=this;this.menuLoading=!0,this.$emit("getMenuLoading",this.menuLoading),this.$api.roleManage.getRoleMenus({id:this.role.id}).then((function(t){if(!t.result)return!1;var n=function(n){t.data[n].forEach((function(t){var i=e.findItemById("operate_ids"===n?t.menuId:t,e.menuList);if(i)if("operate_ids"===n)t[n].forEach((function(t){var n=i.auth.find((function(e){return e.key===t}));n.value=!0,e.handleOperateChecked(i,n.type,!0)}));else{var r=i.auth.find((function(e){return"checkAuth"===e.key}));r.value=!0,e.handleOperateChecked(i,r.type)}}))};for(var i in t.data)n(i)})).finally((function(){e.menuLoading=!1,e.$emit("getMenuLoading",e.menuLoading)}))},k([Object(a.d)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=k([a.a],t)}(a.e),L=_,x=Object(p.a)(L,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.menuLoading,zIndex:10},expression:"{ isLoading: menuLoading, zIndex: 10 }"}],staticClass:"operation-permission"},[e._m(0),e._v(" "),n("div",{staticClass:"table-body"},e._l(e.menuList,(function(t){return n("div",{key:t.id,staticClass:"menu-list"},[n("div",{staticClass:"first-level-box",on:{click:function(n){return e.setExpandStatus(t)}}},[n("div",{staticClass:"menu-name"},[t.children?n("bk-icon",{staticClass:"expand-icon",attrs:{type:t.isExpand?"down-shape":"right-shape"}}):e._e(),e._v(" "),n("bk-checkbox",{class:["check-box",!t.children&&"check-box-left"],attrs:{indeterminate:t.isIndeterminate,"true-value":!0,"false-value":!1},on:{change:function(n){return e.handleMenuChecked(t)}},nativeOn:{click:function(e){return e.stopPropagation(),function(){}.apply(null,arguments)}},model:{value:t.isChecked,callback:function(n){e.$set(t,"isChecked",n)},expression:"item.isChecked"}}),e._v(" "),n("span",[e._v(e._s(t.name))])],1),e._v(" "),t.auth?n("div",{staticClass:"menu-operate"},e._l(t.auth,(function(i,r){return n("div",{key:r},[n("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1,indeterminate:i.isIndeterminate},on:{change:function(n){return e.handleOperateChecked(t,i.type)}},nativeOn:{click:function(e){return e.stopPropagation(),function(){}.apply(null,arguments)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authItem.value"}}),e._v(" "),n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()]),e._v(" "),t.isExpand?n("div",e._l(t.children,(function(t){return n("div",{key:t.id},[n("div",{staticClass:"second-level-box",on:{click:function(n){return e.setExpandStatus(t)}}},[n("div",{staticClass:"menu-name",staticStyle:{"padding-left":"40px"}},[t.children?n("bk-icon",{staticClass:"expand-icon",attrs:{type:t.isExpand?"down-shape":"right-shape"}}):e._e(),e._v(" "),n("bk-checkbox",{class:["check-box",!t.children&&"check-box-left"],attrs:{indeterminate:t.isIndeterminate,"true-value":!0,"false-value":!1},on:{change:function(n){return e.handleMenuChecked(t)}},nativeOn:{click:function(e){return e.stopPropagation(),function(){}.apply(null,arguments)}},model:{value:t.isChecked,callback:function(n){e.$set(t,"isChecked",n)},expression:"tex.isChecked"}}),e._v(" "),n("span",[e._v(e._s(t.name))])],1),e._v(" "),t.auth?n("div",{staticClass:"menu-operate"},e._l(t.auth,(function(i,r){return n("div",{key:r},[n("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1,indeterminate:i.isIndeterminate},on:{change:function(n){return e.handleOperateChecked(t,i.type)}},nativeOn:{click:function(e){return e.stopPropagation(),function(){}.apply(null,arguments)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authTex.value"}}),e._v(" "),n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()]),e._v(" "),t.isExpand?n("div",e._l(t.children,(function(t){return n("div",{key:t.id,staticClass:"third-level-box"},[n("div",{staticClass:"menu-name",staticStyle:{"padding-left":"90px"}},[n("bk-checkbox",{class:["check-box"],attrs:{"true-value":!0,"false-value":!1,indeterminate:t.isIndeterminate},on:{change:function(n){return e.handleMenuChecked(t)}},model:{value:t.isChecked,callback:function(n){e.$set(t,"isChecked",n)},expression:"nev.isChecked"}}),e._v(" "),n("span",[e._v(e._s(t.name))])],1),e._v(" "),t.auth?n("div",{staticClass:"menu-operate"},e._l(t.auth,(function(i,r){return n("div",{key:r},[n("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1},on:{change:function(n){return e.handleOperateChecked(t,i.type)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authNev.value"}}),e._v(" "),n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()])})),0):e._e()])})),0):e._e()])})),0)])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"table-header"},[n("div",{staticClass:"menu-box"},[e._v("菜单")]),e._v(" "),n("div",{staticClass:"operate-box"},[e._v("操作权限")])])}],!1,null,"98eec9d4",null),w=x.exports,C=n("ac6i"),O=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),P=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.panels=[{name:"operationPermission",label:"操作权限"},{name:"appPermission",label:"应用权限"}],t.active="operationPermission",t.role={},t.menuLoading=!1,t.appLoading=!1,t.latestMenu=[],t.latestOperate=[],t.latestApp=[],t.loading=!1,t}return O(t,e),Object.defineProperty(t.prototype,"disableBtn",{get:function(){return"operationPermission"===this.active?this.menuLoading:this.appLoading},enumerable:!1,configurable:!0}),t.prototype.getLatestMenu=function(e){this.latestMenu=e.checkAuthIds,this.latestOperate=e.operateAuthIds},t.prototype.getLatestApp=function(e){this.latestApp=e},t.prototype.getMenuLoading=function(e){this.menuLoading=e},t.prototype.getAppLoading=function(e){this.appLoading=e},t.prototype.show=function(e){this.isShow=!0,this.role=e,this.active="operationPermission"},t.prototype.toTabMenu=function(e){this.active=e.name},t.prototype.confirm=function(){var e=this;this.$refs.menuPermission.getLatestMenu(),this.$refs.appPermission.getLatestApp(),this.loading=!0,this.$api.roleManage.setRoleMenu({id:this.role.id,menu_ids:this.latestMenu||[],operate_ids:this.latestOperate||[],app_ids:this.latestApp||[]}).then((function(t){var n=t.result,i=t.message;if(!n)return e.$error(i),!1;e.$success("权限设置成功!"),e.isShow=!1})).finally((function(){e.loading=!1}))},t=P([Object(a.a)({name:"permission-settings",components:{appPermission:y,operationPermission:w,menuTab:C.a}})],t)}(a.e),$=I,A=Object(p.a)($,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bk-sideslider",{attrs:{"is-show":e.isShow,"quick-close":!0,title:"权限管理",width:850},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[n("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[n("menu-tab",{attrs:{panels:e.panels,"active-panel":e.active},on:{click:e.toTabMenu}}),e._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"main-box"},[n("operation-permission",{directives:[{name:"show",rawName:"v-show",value:"operationPermission"===e.active,expression:"active === 'operationPermission'"}],ref:"menuPermission",attrs:{role:e.role},on:{getMenuLoading:e.getMenuLoading,getLatestMenu:e.getLatestMenu}}),e._v(" "),n("app-permission",{directives:[{name:"show",rawName:"v-show",value:"appPermission"===e.active,expression:"active === 'appPermission'"}],ref:"appPermission",attrs:{role:e.role},on:{getAppLoading:e.getAppLoading,getLatestApp:e.getLatestApp}})],1),e._v(" "),n("div",{staticClass:"footer-box"},[n("bk-button",{attrs:{disabled:e.disableBtn||e.loading,theme:"primary",title:"确定"},on:{click:e.confirm}},[e._v("\n                确定\n            ")])],1)],1)])}),[],!1,null,"26e565d4",null).exports,M=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),j=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},E=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},R=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tableLoading=!1,t.dataList=[],t.columns=[{label:"角色名称",key:"role_name",align:"left",minWidth:"100px"},{label:"角色描述",key:"describe",align:"left",minWidth:"300px"},{label:"是否内置",key:"built_in",align:"left",minWidth:"100px",scopedSlots:"built_in"},{label:"创建时间",key:"created_at",align:"left",minWidth:"120"},{label:"操作",key:"operation",align:"left",width:"200px",scopedSlots:"operation"}],t.pagination={current:1,count:1,limit:20},t.maxHeight="",t.search="",t}return M(t,e),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),t.prototype.created=function(){var e=this;this.getRoleList();this.maxHeight=window.innerHeight-184,window.onresize=function(){e.maxHeight=window.innerHeight-184}},t.prototype.handlerIconClick=function(){this.pagination.current=1,this.getRoleList()},t.prototype.setPermission=function(e){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.permissionSettings.show(e)},t.prototype.operateRole=function(e,t){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.operateRole.show(e,t)},t.prototype.refreshList=function(){this.getRoleList()},t.prototype.deleteRole=function(e){var t=this;if(!this.$BtnPermission(this.powerParams))return!1;this.$bkInfo({title:"确认要删除该角色？",confirmLoading:!0,confirmFn:function(){return E(t,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return E(this,void 0,void 0,(function(){var t;return R(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.roleManage.deleteRole({id:e.id})];case 1:return(t=n.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getRoleList()):this.$error(t.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.getRoleList=function(){var e=this,t={page:this.pagination.current,page_size:this.pagination.limit,search:this.search};this.tableLoading=!0,this.$api.roleManage.getRoleList(t).then((function(t){if(!t.result)return!1;e.dataList=t.data.items,e.pagination.count=t.data.count})).finally((function(){e.tableLoading=!1}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getRoleList()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.getRoleList()},t=j([Object(a.a)({name:"role-manage",components:{comTable:r.a,operateRole:d,permissionSettings:A}})],t)}(a.e),D=S,z=Object(p.a)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"role-manage"},[n("div",{staticClass:"operate-box"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",title:"新增角色",icon:"plus"},on:{click:function(t){return e.operateRole("add")}}},[e._v("\n            新增角色\n        ")]),e._v(" "),n("bk-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handlerIconClick,enter:e.handlerIconClick,clear:e.handlerIconClick},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),n("div",{staticClass:"table-box"},[n("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"comTable",attrs:{data:e.dataList,columns:e.columns,pagination:e.pagination,"max-height":e.maxHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"built_in",fn:function(t){var n=t.row;return[e._v("\n                "+e._s(n.built_in?"是":"否")+"\n            ")]}},{key:"operation",fn:function(t){var i=t.row;return[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:i.is_super||"itsm_admin_group"===i.role_name},on:{click:function(t){return e.setPermission(i)}}},[e._v("\n                    设置权限\n                ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:i.built_in},on:{click:function(t){return e.operateRole("edit",i)}}},[e._v("\n                    编辑\n                ")]),e._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:i.built_in},on:{click:function(t){return e.deleteRole(i)}}},[e._v("\n                    删除\n                ")])]}}])})],1),e._v(" "),n("operate-role",{ref:"operateRole",on:{refreshList:e.refreshList}}),e._v(" "),n("permission-settings",{ref:"permissionSettings"})],1)}),[],!1,null,"3848ca0c",null);t.default=z.exports}}]);