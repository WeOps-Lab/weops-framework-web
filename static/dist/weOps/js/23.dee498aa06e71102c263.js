(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{JDjE:function(t,e,n){"use strict";n.r(e);var i,r=n("G0B5"),o=n("uMZD"),a=n("ac6i"),s=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},u=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isCollected=!1,e}return s(e,t),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"permissionObj",{get:function(){return{id:this.$route.name,type:"manageDeskArticlesAuth"}},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){document.querySelector("body").style.overflowY="hidden"},e.prototype.destroyed=function(){document.querySelector("body").style.overflowY=null},e.prototype.updateData=function(t){return void 0===t&&(t=""),t},e.prototype.getPerMission=function(t){return{id:this.$route.name,type:this.userInfo.username===t.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"}},e.prototype.setHelpDeskArticle=function(t){var e=this;this.$bkInfo({title:"确认".concat(t.is_it_service?"取消":"","设置该文章").concat(t.is_it_service?"":"为服务台文章","？"),confirmLoading:!0,confirmFn:function(){return c(e,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.confirmSetHelpDesk(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmSetHelpDesk=function(t){return c(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.lore.setIsItService({id:t.id,judge:!t.is_it_service})];case 1:return(e=n.sent()).result?(this.$success(t.is_it_service?"取消成功":"设置服务台文章成功"),this.updateData()):this.$error(e.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.linkToDetail=function(t){this.$router.push({name:"ArticleDetail",query:{id:t}})},e.prototype.linkToTemplate=function(t){if(!this.$BtnPermission({id:this.$route.name,type:this.userInfo.username===t.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"}))return!1;var e=t.id,n=t.title;this.$router.push({name:"AticleOperation",query:{articleId:e,subName:n}})},e.prototype.deleteArticle=function(t){return void 0===t&&(t={}),c(this,void 0,void 0,(function(){var e=this;return u(this,(function(n){return this.$BtnPermission({id:this.$route.name,type:this.userInfo.username===t.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"})?(this.$bkInfo({title:"提示",subTitle:"确定删除该文章吗？",theme:"primary",confirmFn:function(){e.$emit("maskLoad",!0),e.confirmDelete(t.id)}}),[2]):[2,!1]}))}))},e.prototype.confirmDelete=function(t){return c(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return[4,this.$api.lore.deleteAricle({id:t})];case 1:return(e=n.sent()).result?(this.$success("删除成功"),this.updateData("isDelete"),[2]):(this.$error(e.message),this.$emit("maskLoad",!1),[2])}}))}))},e.prototype.handleCollect=function(t){return c(this,void 0,void 0,(function(){var e,n,i,r,o;return u(this,(function(a){switch(a.label){case 0:return e=t.id,n=t.collect,i=n?"cancelCollect":"collect",r=n?"已取消收藏":"收藏成功",[4,this.$api.lore[i]({id:e})];case 1:return(o=a.sent()).result?(this.$success(r),this.updateData(),[2]):(this.$error(o.message),[2])}}))}))},l([Object(r.d)({type:Array,default:[]})],e.prototype,"articleList",void 0),l([Object(r.b)("updateData")],e.prototype,"updateData",null),e=l([Object(r.a)({components:{}})],e)}(r.e),f=p,h=n("KHd+"),d=Object(h.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.articleList,(function(e){return n("div",{key:e.id,staticClass:"article-list"},[n("div",{staticClass:"article-list-main",on:{click:function(n){return t.linkToDetail(e.id)}}},[n("div",{staticClass:"article-list-main-title"},[n("bk-icon",{class:["collect-icon",e.collect&&"active"],attrs:{type:e.collect?"star-shape":"star"},on:{click:function(n){return n.stopPropagation(),t.handleCollect(e)}}}),t._v(" "),n("span",[t._v(t._s(e.title))]),t._v(" "),t.$BtnPermission(t.permissionObj)&&t.userInfo.applications.includes("itsm")?n("div",{class:["help-desk",e.is_it_service&&"help-desk-active",t.$BtnPermission(t.permissionObj)&&"help-desk-hover"],on:{click:function(n){return n.stopPropagation(),t.setHelpDeskArticle(e)}}},[t._v("\n                    服务台文章\n                ")]):t._e()],1),t._v(" "),n("div",[e.labels&&e.labels.length?n("ul",{staticClass:"article-list-main-tags"},t._l(e.labels,(function(e,i){return n("li",{key:i,staticClass:"tags-item"},[n("bk-tag",{attrs:{radius:"20px"}},[t._v(t._s(e))])],1)})),0):t._e(),t._v(" "),n("div",{staticClass:"article-list-main-content"},[t._v("\n                    "+t._s(e.content)+"\n                ")]),t._v(" "),n("div",{staticClass:"article-list-main-description"},[n("span",[t._v("作者："+t._s(e.created_by))]),t._v(" "),n("span",[t._v("最后修改时间："+t._s(e.update_time))])])])]),t._v(" "),n("div",{staticClass:"article-list-operation"},[n("bk-popconfirm",{attrs:{"ext-cls":"pop-custom",width:"120",placement:"bottom"}},[n("div",{attrs:{slot:"content"},slot:"content"},[n("ul",[n("li",[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.getPerMission(e),expression:"getPerMission(item)"}],attrs:{text:"",theme:"default",icon:"edit"},on:{click:function(n){return t.linkToTemplate(e)}}},[t._v("\n                                编辑文章\n                            ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.getPerMission(e),expression:"getPerMission(item)"}],attrs:{text:"",theme:"default",icon:"delete"},on:{click:function(n){return t.deleteArticle(e)}}},[t._v("\n                                删除文章\n                            ")])],1)])]),t._v(" "),n("bk-icon",{staticClass:"icon",attrs:{type:"ellipsis"}})],1)],1)])})),0)}),[],!1,null,"1bdce147",null).exports,g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},m=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.loading=!1,e.labels=[],e.activeIndex="",e.isActive=!1,e.searchType="all",e.pagingConfig={page:1,limit:20,count:0},e}return g(e,t),Object.defineProperty(e.prototype,"selectedTags",{get:function(){var t=this;return this.labels.filter((function(e){return e.label_name.includes(t.search)}))},enumerable:!1,configurable:!0}),e.prototype.updateData=function(t){return t},e.prototype.initTagList=function(t){this.searchType=t,this.getTagList()},e.prototype.handleScroll=function(t){var e=this.$refs.showListBox,n=this.pagingConfig,i=n.page,r=n.limit,o=n.count;if(e.clientHeight+e.scrollTop+1>e.scrollHeight){if(this.loading||i*r>=o)return;this.pagingConfig.page++,this.getTagList("more")}},e.prototype.getSelectedTag=function(){return this.activeIndex},e.prototype.selectLabel=function(t){this.activeIndex!==t.id?(this.activeIndex=t.id,this.isActive=!0):(this.activeIndex="",this.isActive=!1),this.updateData(this.activeIndex)},e.prototype.initFilters=function(){Object.assign(this.$data,this.$options.data.call(this))},e.prototype.getTagList=function(t){return void 0===t&&(t=""),y(this,void 0,void 0,(function(){var t,e;return m(this,(function(n){switch(n.label){case 0:this.loading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),t={search:this.search,search_type:this.searchType,page_size:-2},"helpDesk"===this.active&&(t.is_it_service=!0),[4,this.$api.lore.getRepositoryLabels(t)];case 2:return(e=n.sent()).result?(this.labels=e.data.items,this.pagingConfig.count=e.data.count,[3,4]):(this.$error(e.message),[2]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},v([Object(r.d)({type:String,default:function(){return"all"}})],e.prototype,"active",void 0),v([Object(r.b)("updateData")],e.prototype,"updateData",null),e=v([Object(r.a)({components:{}})],e)}(r.e),_=b,w=Object(h.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"tag-selector"},[n("div",{staticClass:"tag-selector-title"},[t._v("标签")]),t._v(" "),n("bk-input",{staticClass:"tag-selector-search",attrs:{placeholder:"请输入关键字搜索",clearable:""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),t._v(" "),n("ul",{ref:"showListBox",class:["tag-selector-list","user"===t.active&&"user-list"]},t._l(t.selectedTags,(function(e){return n("li",{key:e.id,class:["item",t.activeIndex===e.id&&t.isActive&&"active"],on:{click:function(n){return t.selectLabel(e)}}},[n("span",{},[t._v(t._s(e.label_name))]),t._v(" "),n("span",{staticClass:"count"},[t._v(t._s(e.use_count))])])})),0)],1)}),[],!1,null,"48b88631",null).exports,A=n("KJcb"),k=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),x=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e}return k(e,t),e.prototype.show=function(){this.visible=!0},e.prototype.handleClose=function(){this.visible=!1},e=x([Object(r.a)({components:{ArticleTemplate:A.a}})],e)}(r.e),C=O,L=Object(h.a)(C,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("bk-sideslider",{attrs:{"is-show":t.visible,"quick-close":!0,width:800,"ext-cls":"common-dialog-wrapper",title:"选择模板"},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e},hidden:t.handleClose}},[n("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[n("ArticleTemplate",{attrs:{"is-editable":!1},on:{close:t.handleClose}})],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{attrs:{theme:"default"},on:{click:function(e){t.visible=!1}}},[t._v("取消")])],1)])],1)}),[],!1,null,null,null).exports,$=n("JnIg"),j=n("ToxV"),D=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),S=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},P=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},T=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.columns=[{label:"文章名称",key:"name",minWidth:"80px"},{label:"文件大小",key:"originSize",minWidth:"80px",scopedSlots:"originSize"},{label:"操作",key:"operation",width:"144px",prop:"operation",scopedSlots:"operation"}],e.activeName=["list"],e.visible=!1,e.formData={fileList:[],tags:[]},e.loading=!1,e}return D(e,t),Object.defineProperty(e.prototype,"filesLength",{get:function(){var t;return null===(t=this.formData.fileList)||void 0===t?void 0:t.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filesSize",{get:function(){var t=this.formData.fileList.reduce((function(t,e){return e.size+t}),0);return this.getOriginSize({size:t})},enumerable:!1,configurable:!0}),e.prototype.handleUpload=function(t){t.fileList.reduce((function(t,e){return 1e3*e.size/1024/1024+t}),0)>200&&(t.fileList.splice(t.fileList.length-1,1),this.$error("上传的文件不能超过200Mb！")),this.$set(this.formData,"fileList",t.fileList)},e.prototype.getOriginSize=function(t){var e=1e3*t.size/1024,n=e>=1024,i=n?(e/1024).toFixed(2):e.toFixed(2);return"".concat(i).concat(n?"MB":"KB")},e.prototype.handleDeleteFile=function(t,e){this.formData.fileList.splice(e,1)},e.prototype.removeFiles=function(){this.$refs.uploadFiles.fileList=[],this.formData.fileList=[]},e.prototype.show=function(t){Object.assign(this.$data,this.$options.data.call(this)),this.visible=!0},e.prototype.confirm=function(){var t=new FormData,e=JSON.stringify(this.formData.tags.map((function(t){return t.id})));t.append("labels",e),this.formData.fileList.forEach((function(e){t.append("files",e.origin)})),this.uploadFiles(t)},e.prototype.uploadFiles=function(t){return P(this,void 0,void 0,(function(){var e;return T(this,(function(n){switch(n.label){case 0:this.loading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.lore.uploadRepositories(t)];case 2:return(e=n.sent()).result?(this.visible=!1,this.$success("导入成功"),this.updateArticleList(),[3,4]):(this.$error(e.message),this.loading=!1,[2]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.cancel=function(){this.visible=!1,Object.assign(this.$data,this.$options.data.call(this))},e.prototype.updateArticleList=function(){return""},S([Object(r.b)("updateArticleList")],e.prototype,"updateArticleList",null),e=S([Object(r.a)({components:{ComTable:$.a,AddTag:j.a}})],e)}(r.e),M=I,E=Object(h.a)(M,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("bk-sideslider",{attrs:{width:800,"is-show":t.visible,"quick-close":!0,"ext-cls":"common-dialog-wrapper",title:"导入文章",transfer:!1,"before-close":t.cancel},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[n("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[n("bk-upload",{ref:"uploadFiles",attrs:{"with-credentials":!0,"custom-request":t.handleUpload,files:t.formData.fileList,url:"",accept:".docx,.doc,.txt",multiple:!1,"ext-cls":"upload-sec",size:102400,tip:"支持上传word、txt格式文件，一次不超过200MB"}}),t._v(" "),n("AddTag",{ref:"addTag",attrs:{tags:t.formData.tags}}),t._v(" "),t.filesLength?n("div",[n("bk-collapse",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("bk-collapse-item",{staticClass:"collapse-item",attrs:{name:"list"}},[t._v("\n                        已识别"+t._s(t.filesLength)+"篇文章，共"+t._s(t.filesSize)+"\n                        "),t._v(" "),n("div",{staticClass:"f13",staticStyle:{"margin-bottom":"10px"},attrs:{slot:"content"},slot:"content"},[n("ComTable",{attrs:{data:t.formData.fileList,columns:t.columns},scopedSlots:t._u([{key:"originSize",fn:function(e){var i=e.row;return[n("span",[t._v(t._s(t.getOriginSize(i)))])]}},{key:"operation",fn:function(e){var i=e.row,r=e.index;return[n("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.handleDeleteFile(i,r)}}},[t._v("\n                                        删除\n                                    ")])]}}],null,!1,4023997710)})],1)])],1)],1):t._e()],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading||!t.filesLength,theme:"primary"},on:{click:t.confirm}},[t._v("\n                提交\n            ")]),t._v(" "),n("bk-button",{on:{click:t.cancel}},[t._v("\n                取消\n            ")])],1)])],1)}),[],!1,null,"5215fef3",null).exports,R=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),z=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},N=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},F=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},B=function(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))},H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.search="",e.loading=!1,e.draftList=[],e.searchType="all",e.pagingConfig={page:1,limit:10,count:0},e.activeIndex=-1,e.showOperation=!1,e}return R(e,t),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.getDraftList()},e.prototype.updateData=function(t){return t},e.prototype.handleMouseenter=function(t){this.showOperation=!0,this.activeIndex=t},e.prototype.handleMouseleave=function(t){this.showOperation=!1},e.prototype.handleScroll=function(t){var e=this.$refs.showListBox,n=this.pagingConfig,i=n.page,r=n.limit,o=n.count;if(e.clientHeight+e.scrollTop+1>e.scrollHeight){if(this.loading||i*r>=o)return;this.pagingConfig.page++,this.getDraftList("more")}},e.prototype.initFilters=function(){Object.assign(this.$data,this.$options.data.call(this))},e.prototype.getDraftList=function(t){return void 0===t&&(t=""),N(this,void 0,void 0,(function(){var e,n,i;return F(this,(function(r){switch(r.label){case 0:this.loading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),e={page:this.pagingConfig.page,page_size:this.pagingConfig.limit},[4,this.$api.lore.getDrafts(e)];case 2:return(n=r.sent()).result?(i=t?B(B([],this.draftList,!0),n.data.items,!0):n.data.items,this.draftList=i,this.pagingConfig.count=n.data.count,[3,4]):(this.$error(n.message),[2]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.linkToDetail=function(t){this.$router.push({name:"ArticleDetail",query:{id:t,draftId:t}})},e.prototype.handleEdit=function(t){this.$router.push({name:"AticleOperation",query:{articleId:t.id,subName:t.title,draftId:t.id}})},e.prototype.handleDelete=function(t){return N(this,void 0,void 0,(function(){var e=this;return F(this,(function(n){return this.$bkInfo({title:"提示",subTitle:"确定删除该草稿吗？",theme:"primary",confirmFn:function(){e.confirmDelete(t.id)}}),[2]}))}))},e.prototype.confirmDelete=function(t){return N(this,void 0,void 0,(function(){var e;return F(this,(function(n){switch(n.label){case 0:return this.loading=!0,[4,this.$api.lore.deleteAricle({id:t})];case 1:return(e=n.sent()).result?(this.$success("删除成功"),this.pagingConfig.page=1,this.pagingConfig.limit=10,this.getDraftList(),[2]):(this.$error(e.message),this.loading=!1,[2])}}))}))},z([Object(r.d)({type:String,default:function(){return"all"}})],e.prototype,"active",void 0),z([Object(r.b)("updateData")],e.prototype,"updateData",null),e=z([Object(r.a)({components:{}})],e)}(r.e),q=H,G=Object(h.a)(q,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"draft"},[n("div",{staticClass:"draft-title"},[t._v("我的草稿"),n("span",{staticClass:"draft-title-count"},[t._v("（"+t._s(t.pagingConfig.count)+"）")])]),t._v(" "),n("div",{ref:"showListBox",staticClass:"draft-list",on:{scroll:t.handleScroll}},t._l(t.draftList,(function(e,i){return n("div",{key:e.id,staticClass:"draft-item",on:{mouseenter:function(e){return t.handleMouseenter(i)},mouseleave:function(e){return t.handleMouseleave(i)}}},[n("div",{staticClass:"draft-desc",on:{click:function(n){return t.linkToDetail(e.id)}}},[n("div",{staticClass:"title"},[n("bk-icon",{staticClass:"spot",attrs:{type:"circle-shape"}}),t._v(" "),t.activeIndex===i&&t.showOperation?n("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"name"},[t._v(t._s(e.title))]):n("span",{staticClass:"name"},[t._v(t._s(e.title))])],1),t._v(" "),n("span",{staticClass:"time"},[t._v(t._s(e.updated_at))])]),t._v(" "),n("div",{class:["operation",t.activeIndex===i&&t.showOperation&&"active"]},[n("i",{directives:[{name:"permission",rawName:"v-permission",value:{id:t.$route.name,type:t.userInfo.username===e.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"},expression:"{\n                        id: $route.name,\n                        type: userInfo.username === item.username ? 'manageMyArticlesAuth' : 'manageAllArticlesAuth',\n                        secondAuth: 'manageAllArticlesAuth'\n                    }"}],staticClass:"cw-icon weops-edit edit-icon",on:{click:function(n){return t.handleEdit(e)}}}),t._v(" "),n("i",{directives:[{name:"permission",rawName:"v-permission",value:{id:t.$route.name,type:t.userInfo.username===e.username?"manageMyArticlesAuth":"manageAllArticlesAuth",secondAuth:"manageAllArticlesAuth"},expression:"{\n                        id: $route.name,\n                        type: userInfo.username === item.username ? 'manageMyArticlesAuth' : 'manageAllArticlesAuth',\n                        secondAuth: 'manageAllArticlesAuth'\n                    }"}],staticClass:"cw-icon weops-delete delete-icon",on:{click:function(n){return t.handleDelete(e)}}})])])})),0)])}),[],!1,null,"7260ba50",null).exports,J=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),K=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},U=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},W=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text="",e.labelId="",e.pagingConfig={current:1,limit:20,count:0,location:"left",align:"right",showLimit:!0,limitList:[10,20,50]},e.articleList=[],e.pageLoading=!1,e}return J(e,t),e.prototype.onActiveChanged=function(t){var e=this;t&&(this.initParams(),this.getArticleList(),this.$nextTick((function(){e.$refs.tagSelector.initTagList(t)})))},e.prototype.activated=function(){this.getArticleList(),this.$refs.tagSelector.initTagList(this.active),this.$refs.draft&&this.$refs.draft.getDraftList()},e.prototype.handleMaskLoad=function(t){this.pageLoading=t},e.prototype.handleEnter=function(){this.pagingConfig.current=1,this.getArticleList()},e.prototype.pageChange=function(t){this.text="",this.pagingConfig.current=t,this.getArticleList()},e.prototype.limitChange=function(t){this.pagingConfig.current=1,this.pagingConfig.limit=t,this.getArticleList()},e.prototype.updateAticleList=function(t){this.labelId=t,this.getArticleList()},e.prototype.updateList=function(t){this.getArticleList(),"isDelete"===t&&this.$refs.draft&&this.$refs.draft.getDraftList()},e.prototype.initParams=function(){var t=this;this.text="",this.labelId="",this.pagingConfig.current=1,this.$nextTick((function(){t.$refs.tagSelector.initFilters()}))},e.prototype.getArticleList=function(){return U(this,void 0,void 0,(function(){var t,e;return W(this,(function(n){switch(n.label){case 0:this.pageLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),t=this.getParams(),[4,this.$api.lore.getRepository(t)];case 2:return(e=n.sent()).result?(this.articleList=e.data.items,this.pagingConfig.count=e.data.count,[3,4]):(this.$error(e.message),[2]);case 3:return this.pageLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getParams=function(){var t=this.pagingConfig,e={page_size:t.limit,page:t.current,label_id:this.labelId,text:this.text,search_type:this.active};return"helpDesk"===this.active&&(e.is_it_service=!0),e},e.prototype.operation=function(t){if(!this.$BtnPermission({id:this.$route.name,type:"manageMyArticlesAuth",secondAuth:"manageAllArticlesAuth"}))return!1;this.$refs[t].show()},K([Object(r.d)({type:String,default:"all"})],e.prototype,"active",void 0),K([Object(r.f)("active",{immediate:!0})],e.prototype,"onActiveChanged",null),e=K([Object(r.a)({components:{ArticleList:d,TagSelector:w,TemplateDialog:L,ImportArticleDialog:E,Draft:G}})],e)}(r.e),V=Y,Z=Object(h.a)(V,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],staticClass:"article-wrapper"},[n("div",{staticClass:"article-wrapper-main"},[n("div",{staticClass:"article-wrapper-main-list"},[n("div",{staticClass:"article-wrapper-nav-area"},[n("bk-input",{staticClass:"nav-area-search",staticStyle:{width:"200px"},attrs:{placeholder:"请输入文章关键字搜索",clearable:""},on:{enter:t.handleEnter},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),t._v(" "),n("div",{staticClass:"nav-area-right"},[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:t.$route.name,type:"manageMyArticlesAuth",secondAuth:"manageAllArticlesAuth"},expression:"{\n                            id: $route.name,\n                            type: 'manageMyArticlesAuth',\n                            secondAuth: 'manageAllArticlesAuth'\n                        }"}],staticClass:"mr10",on:{click:function(e){return t.operation("importArticleDialog")}}},[t._v("\n                        导入\n                    ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:t.$route.name,type:"manageMyArticlesAuth",secondAuth:"manageAllArticlesAuth"},expression:"{\n                            id: $route.name,\n                            type: 'manageMyArticlesAuth',\n                            secondAuth: 'manageAllArticlesAuth'\n                        }"}],attrs:{theme:"primary"},on:{click:function(e){return t.operation("templateDialog")}}},[t._v("\n                        写文章\n                    ")])],1)],1),t._v(" "),n("div",{staticClass:"box"},[t.articleList.length?n("ArticleList",{attrs:{"article-list":t.articleList},on:{updateData:t.updateList,maskLoad:t.handleMaskLoad}}):n("bk-exception",{attrs:{type:"empty",scene:"part"}})],1),t._v(" "),t.pagingConfig.count?n("div",{staticClass:"pagination"},[n("span",{staticClass:"count"},[t._v("共"+t._s(t.pagingConfig.count)+"条")]),t._v(" "),n("bk-pagination",{staticClass:"paging-config",attrs:{size:"small",current:t.pagingConfig.current,limit:t.pagingConfig.limit,count:t.pagingConfig.count,location:t.pagingConfig.location,align:t.pagingConfig.align,"show-limit":t.pagingConfig.showLimit,"limit-list":t.pagingConfig.limitList},on:{"update:current":function(e){return t.$set(t.pagingConfig,"current",e)},change:t.pageChange,"limit-change":t.limitChange}})],1):t._e()]),t._v(" "),n("div",{staticClass:"article-wrapper-main-tag"},[n("TagSelector",{ref:"tagSelector",attrs:{active:t.active},on:{updateData:t.updateAticleList}}),t._v(" "),"user"===t.active?n("Draft",{ref:"draft"}):t._e()],1)]),t._v(" "),n("TemplateDialog",{ref:"templateDialog"}),t._v(" "),n("ImportArticleDialog",{ref:"importArticleDialog",on:{updateArticleList:function(e){return t.getArticleList()}}})],1)}),[],!1,null,"7225e2c5",null).exports,Q=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),X=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},tt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.panels=[{name:"all",label:"所有文章",isShow:!0},{name:"user",label:"我的文章",isShow:!0},{name:"collect",label:"我的收藏",isShow:!0},{name:"helpDesk",label:"服务台文章",isShow:!0}],e.active="all",e}return Q(e,t),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),e.prototype.created=function(){if(!this.$BtnPermission({id:this.$route.name,type:"manageDeskArticlesAuth"})){var t=this.panels.findIndex((function(t){return"helpDesk"===t.name}));-1!==t&&this.panels.splice(t,1)}this.userInfo.applications.includes("repository")||this.panels.forEach((function(t,e){e<3&&(t.isShow=!1)})),this.userInfo.applications.includes("itsm")||(this.panels.at(-1).isShow=!1),this.panels=this.panels.filter((function(t){return t.isShow})),1===this.panels.length&&this.toTabMenu(this.panels[0])},e.prototype.toTabMenu=function(t){this.active=t.name},e=X([Object(r.a)({name:"knowledge",components:{MenuTab:a.a,HeaderSub:o.a,ArticleContent:Z},beforeRouteLeave:function(t,e,n){this.$handleKeepAlive(t,e),n()}})],e)}(r.e),et=tt,nt=Object(h.a)(et,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("HeaderSub",{staticClass:"notice-manage-header"},[n("template",{slot:"title"},[n("MenuTab",{attrs:{panels:t.panels,type:"line","active-panel":t.active},on:{click:t.toTabMenu}})],1)],2),t._v(" "),n("div",{staticClass:"article-content"},[n("ArticleContent",{attrs:{active:t.active}})],1)],1)}),[],!1,null,"4837da27",null);e.default=nt.exports}}]);