(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{e58Q:function(t,e,n){"use strict";n.r(e);var a,i=n("JnIg"),r=n("ac6i"),s=n("uMZD"),o=n("G0B5"),c=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(t,e,n,a){var i,r=arguments.length,s=r<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,a);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(s=(r<3?i(s):r>3?i(e,n,s):i(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s},u=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function s(t){try{c(a.next(t))}catch(t){r(t)}}function o(t){try{c(a.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,o)}c((a=a.apply(t,e||[])).next())}))},h=function(t,e){var n,a,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.active="all",e.keywords="",e.loading=!1,e.panels=[{name:"all",label:"所有视图"},{name:"mine",label:"我的视图"},{name:"collect",label:"我的收藏"}],e.pagination={current:1,count:0,limit:20},e.columns=[{label:"名称",key:"name",scopedSlots:"name"},{label:"创建人",key:"created_by_cn"},{label:"最后修改人",key:"updated_by_cn"},{label:"最后修改时间",key:"updated_at"},{label:"操作",key:"operation",width:"250px",prop:"operation",scopedSlots:"operation"}],e.dataList=[],e}return c(e,t),e.prototype.changeActive=function(t,e){this.getDashboard()},Object.defineProperty(e.prototype,"permission",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.getDashboard=function(){return u(this,void 0,void 0,(function(){var t,e;return h(this,(function(n){switch(n.label){case 0:this.loading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.dashBoard.getDashboard({page_size:this.pagination.limit,page:this.pagination.current,search_type:this.active,name:this.keywords})];case 2:return(t=n.sent()).result?(e=t.data,this.pagination.count=e.count,this.dataList=e.items,[3,4]):(this.dataList=[],this.pagination.count=0,[2,this.$error(t.message)]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.handleAdd=function(){this.$BtnPermission(this.permission)&&this.$router.push({name:"DashboardLayout"})},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getDashboard()},e.prototype.handleLimitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getDashboard()},e.prototype.handleCollect=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return[4,this.$api.dashBoard.collectDashboard({id:t.id})];case 1:return(e=n.sent()).result?(this.$success("".concat(t.name).concat(t.is_collected?"取消收藏":"收藏","成功")),t.is_collected=!t.is_collected,[2]):e.message?[2,this.$error(e.message)]:[2,this.$error("".concat(t.name).concat(t.is_collected?"取消收藏":"收藏","失败，请稍后重试"))]}}))}))},e.prototype.handleCheck=function(t,e){this.$router.push({name:"DashboardLayout",query:{id:t.id,subName:t.name}})},e.prototype.handleClone=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:if(!this.$BtnPermission(this.permission))return[2];t.loading=!0,n.label=1;case 1:return n.trys.push([1,,4,5]),[4,this.$api.dashBoard.cloneDashboard({id:t.id})];case 2:return(e=n.sent()).result?[4,this.getDashboard()]:[2,this.$error(e.message)];case 3:return n.sent(),[3,5];case 4:return t.loading=!1,[7];case 5:return[2]}}))}))},e.prototype.handleShare=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return this.$BtnPermission(this.permission)?[4,this.$api.dashBoard.shareDashboard({id:t.id})]:[2];case 1:return(e=n.sent()).result?[4,this.getDashboard()]:[2,this.$error(e.message)];case 2:return n.sent(),[2]}}))}))},e.prototype.handleDelete=function(t){var e=this;this.$BtnPermission(this.permission)&&this.$bkInfo({title:"是否删除".concat(t.name,"仪表盘"),confirmLoading:!0,confirmFn:function(){return u(e,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.confirmDelete(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmDelete=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return[4,this.$api.dashBoard.deleteDashboard({id:t.id})];case 1:return(e=n.sent()).result?(this.$success("".concat(t.name,"删除成功")),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,[4,this.getDashboard()]):[2,this.$error(e.message)];case 2:return n.sent(),[2]}}))}))},l([Object(o.f)("active",{immediate:!0})],e.prototype,"changeActive",null),e=l([Object(o.a)({components:{MenuTab:r.a,HeaderSub:s.a,DashBoardTable:i.a}})],e)}(o.e),p=d,f=n("KHd+"),m=Object(f.a)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dash-board-container"},[n("header-sub",{staticClass:"dash-board-header"},[n("template",{slot:"title"},[n("menu-tab",{attrs:{type:"line",panels:t.panels},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}})],1)],2),t._v(" "),n("div",{staticClass:"nav-area"},[n("bk-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入仪表盘名称","right-icon":"bk-icon icon-search"},on:{enter:t.getDashboard,clear:t.getDashboard},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}}),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permission,expression:"permission"}],attrs:{theme:"primary"},on:{click:t.handleAdd}},[t._v("\n            新建仪表盘\n        ")])],1),t._v(" "),n("dash-board-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"dash-board-table",attrs:{data:t.dataList,columns:t.columns,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.handleLimitChange},scopedSlots:t._u([{key:"name",fn:function(e){var a=e.row;return[n("div",{staticClass:"cell-name"},[n("bk-icon",{class:{"collect-active":a.is_collected},staticStyle:{cursor:"pointer"},attrs:{type:a.is_collected?"star-shape":"star"},on:{click:function(e){return t.handleCollect(a)}}}),t._v(" "),n("bk-button",{staticClass:"name",attrs:{text:"",type:"primary"},on:{click:function(e){return t.handleCheck(a)}}},[t._v("\n                    "+t._s(a.name)+"\n                ")])],1)]}},{key:"operation",fn:function(e){var a=e.row;return[n("div",[n("bk-button",{staticClass:"mr10",attrs:{text:"",theme:"primary"},on:{click:function(e){return t.handleCheck(a)}}},[t._v("\n                    查看\n                ")]),t._v(" "),"mine"===t.active?n("bk-button",{staticClass:"mr10",staticStyle:{width:"50px"},attrs:{text:"",theme:"primary"},on:{click:function(e){return t.handleShare(a)}}},[t._v("\n                    "+t._s(a.is_shared?"取消共享":"共享")+"\n                ")]):t._e(),t._v(" "),a.loading?n("bk-spin",{staticClass:"mr10",attrs:{size:"mini"}}):n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permission,expression:"permission"}],staticClass:"mr10",attrs:{text:"",theme:"primary"},on:{click:function(e){return t.handleClone(a)}}},[t._v("\n                    克隆\n                ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permission,expression:"permission"}],staticClass:"mr10",attrs:{text:"",disabled:a.read_only,theme:"primary"},on:{click:function(e){return t.handleDelete(a)}}},[t._v("\n                    删除\n                ")])],1)]}}])})],1)}),[],!1,null,"e8ef4a8c",null);e.default=m.exports}}]);