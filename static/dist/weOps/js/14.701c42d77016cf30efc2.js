(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{sZ02:function(t,e,i){"use strict";i.r(e);var r,n=i("G0B5"),a=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.iconList=[],e.activeIndex=0,e.selectIconUrl="",e}return a(e,t),e.prototype.mounted=function(){this.iconList=n.e.prototype.$getSvgIcon().map((function(t){return{url:t.split("_")[0],describe:t.split("_")[1]}})).filter((function(t){return t.url&&t.describe}))},e.prototype.cancel=function(){this.setIcon(),this.visible=!1},e.prototype.selectIcon=function(t,e){this.activeIndex=e},e.prototype.show=function(t){if(this.visible=!0,t){var e=this.iconList.findIndex((function(e){return e.url===t}));-1!==e&&(this.activeIndex=e)}},e.prototype.setIcon=function(){return this.selectIconUrl=this.iconList[this.activeIndex].url,this.selectIconUrl},o([Object(n.b)("setIcon")],e.prototype,"setIcon",null),e=o([n.a],e)}(n.e),l=s,c=i("KHd+"),u=Object(c.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("bk-dialog",{attrs:{width:"600",position:{top:100},theme:"primary","mask-close":!1,"header-position":"left",title:"选择图标"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[r("div",{staticClass:"icon-show-list"},t._l(t.iconList,(function(e,n){return r("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.describe,expression:"item.describe",modifiers:{top:!0}}],key:n,staticClass:"top-middle",class:["icon-item",t.activeIndex===n&&"active-icon"],on:{click:function(i){return t.selectIcon(e,n)}}},[r("img",{attrs:{src:i("qohj")("./"+e.url+".svg")}})])})),0),t._v(" "),r("template",{slot:"footer"},[r("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:t.cancel}},[t._v("\n            确认\n        ")]),t._v(" "),r("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n            取消\n        ")])],1)],2)}),[],!1,null,"7deaaa50",null).exports,d=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),p=function(){return p=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},p.apply(this,arguments)},f=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.formData={group:"",onlyMark:"",name:""},e.rules={name:[{required:!0,message:"必填项",trigger:"blur"}],onlyMark:[{required:!0,message:"必填项",trigger:"blur"}],group:[{required:!0,message:"必填项",trigger:"blur"}]},e.iconUrl="cc-default",e.loading=!1,e.currentType="add",e.modelDetail="",e.formDataV2={},e}return d(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.currentType},enumerable:!1,configurable:!0}),e.prototype.setIcon=function(t){this.iconUrl=t},e.prototype.show=function(t,e){this.currentType=t,this.isShow=!0,"edit"===t?(this.iconUrl=e.bk_obj_icon.split("icon-")[1]||"cc-default",this.modelDetail=e,this.formData={group:e.bk_classification_id,onlyMark:e.bk_obj_id,name:e.bk_obj_name}):(this.iconUrl="cc-default",this.initData()),this.formDataV2=JSON.parse(JSON.stringify(this.formData))},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var i={bk_obj_name:t.formData.name,bk_obj_id:t.formData.onlyMark,bk_obj_icon:"icon-"+t.iconUrl};t.isAdd?i.bk_classification_id=t.formData.group:i.id=t.modelDetail.id,t.createModel(i)}))},e.prototype.createModel=function(t){var e=this;this.loading=!0,this.$api.modelSetting[this.isAdd?"createModel":"updateModel"](t).then((function(i){if(!i.result)return e.$error(i.message),!1;e.$success("".concat(e.isAdd?"新增":"编辑","模型成功!")),e.isShow=!1,e.isAdd?e.$emit("getAllModelList"):e.$emit("refreshModel",p({bk_classification_id:e.formData.group},t)),e.isAdd&&e.$store.dispatch("getOtherMenus")})).finally((function(){e.loading=!1}))},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataV2)?this.isShow=!1:this.$bkInfo({title:"是否放弃本次操作？",subTitle:"放弃将导致未保存信息丢失",theme:"primary",confirmFn:function(){t.isShow=!1}})},e.prototype.selectIcon=function(){this.$refs.selectIcon.show(this.isAdd?"":this.iconUrl)},e.prototype.initData=function(){this.modelDetail="",this.formData={group:"",onlyMark:"",name:""}},f([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"groupList",void 0),e=f([Object(n.a)({components:{SelectIcon:u}})],e)}(n.e),h=m,b=Object(c.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("bk-sideslider",{attrs:{width:500,"is-show":t.isShow,"before-close":t.cancel,"quick-close":!0},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e}}},[r("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s((t.isAdd?"新建":"编辑")+"模型"))]),t._v(" "),r("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[r("div",{staticClass:"icon-box"},[r("div",{staticClass:"icon",on:{click:t.selectIcon}},[r("img",{attrs:{src:i("qohj")("./"+t.iconUrl+".svg"),alt:""}})]),t._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"8px"}},[t._v("选择图标")])]),t._v(" "),r("bk-form",{ref:"validateForm",staticStyle:{flex:"1"},attrs:{"label-width":110,model:t.formData,rules:t.rules,"form-type":"vertical"}},[r("bk-form-item",{attrs:{label:"所属分组",required:!0,property:"group","error-display-type":"normal"}},[r("bk-select",{attrs:{disabled:!t.isAdd},model:{value:t.formData.group,callback:function(e){t.$set(t.formData,"group",e)},expression:"formData.group"}},t._l(t.groupList,(function(t){return r("bk-option",{key:t.bk_classification_id,attrs:{id:t.bk_classification_id,name:t.bk_classification_name}})})),1)],1),t._v(" "),r("bk-form-item",{attrs:{label:"唯一标识",required:!0,desc:"可使用英文、数字、下划线，需以字母开头","desc-type":"icon",property:"onlyMark","error-display-type":"normal"}},[r("bk-input",{attrs:{disabled:!t.isAdd,placeholder:"请输入唯一标识"},model:{value:t.formData.onlyMark,callback:function(e){t.$set(t.formData,"onlyMark",e)},expression:"formData.onlyMark"}})],1),t._v(" "),r("bk-form-item",{attrs:{label:"名称",required:!0,property:"name",desc:"请填写模型名","desc-type":"icon","error-display-type":"normal"}},[r("bk-input",{attrs:{placeholder:"请输入名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),t._v(" "),r("div",{staticClass:"foot-box"},[r("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n                    取消\n                ")]),t._v(" "),r("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                    确认\n                ")])],1)],1)]),t._v(" "),r("select-icon",{ref:"selectIcon",on:{setIcon:t.setIcon}})],1)}),[],!1,null,"4a58dc08",null).exports,y=i("JnIg"),v=[{id:"singlechar",name:"短字符"},{id:"longchar",name:"长字符"},{id:"int",name:"数字"},{id:"float",name:"浮点"},{id:"enum",name:"枚举"},{id:"date",name:"日期"},{id:"time",name:"时间"},{id:"objuser",name:"用户"},{id:"singleasst",name:"单关联"},{id:"multiasst",name:"多关联"},{id:"timezone",name:"时区"},{id:"bool",name:"布尔"},{id:"list",name:"列表"}],g=[{id:"singlechar",name:"短字符"},{id:"longchar",name:"长字符"},{id:"int",name:"数字"},{id:"enum",name:"枚举"},{id:"date",name:"日期"},{id:"time",name:"时间"},{id:"objuser",name:"用户"},{id:"bool",name:"布尔"}],_=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),k=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.currentType="",e.formData={propertyID:"",name:"",valueType:"",group:"",isOnly:"",isRequired:"",fieldEdit:{isEdit:!1,defaultValue:!0,regularCheck:"",minValue:"",maxValue:"",enumDefaultValue:""}},e.formDataV2={},e.rules={propertyID:[{required:!0,message:"请输入属性ID",trigger:"blur"},{regex:/^[a-zA-Z]([a-zA-Z0-9_]+)?$/,message:"请填写英文开头，下划线、数字、英文的组合",trigger:"blur"},{validator:function(t){return!t.startsWith("bk_")},message:"不能以“bk_”开头",trigger:"blur"}],name:[{required:!0,message:"请输入属性名",trigger:"blur"}],valueType:[{required:!0,message:"请选择值类型",trigger:"blur"}],group:[{required:!0,message:"请选择所属分组",trigger:"blur"}],isOnly:[{required:!0,message:"请选择是否唯一",trigger:"blur"}],isRequired:[{required:!0,message:"请选择是否必填",trigger:"blur"}]},e.valueTypeList=g,e.groupList=[],e.loading=!1,e.operationMap={singlechar:"regularCheck",longchar:"regularCheck",bool:"defaultValue"},e.oldData="",e.dragStartId="",e.dragEndId="",e.dragStartIndex="",e.dragEndIndex="",e.alreadyAddList=[],e.enumDefaultList=[],e.attrData={},e.defaultMinValue="",e.defaultMaxValue="",e}return _(e,t),e.prototype.onAlreadyAddListChanged=function(t){this.enumDefaultList=t.filter((function(t){return t.valueId&&t.name})).map((function(t){return{id:t.name,name:t.name}})),this.enumDefaultList=this.$ArrayObjDup(this.enumDefaultList,"id"),1===this.enumDefaultList.length&&(this.formData.fieldEdit.enumDefaultValue=this.enumDefaultList[0].id)},e.prototype.verificationNumber=function(t){var e=this,i=Number(this.formData.fieldEdit.minValue),r=Number(this.formData.fieldEdit.maxValue);""!==this.formData.fieldEdit.minValue&&""!==this.formData.fieldEdit.maxValue&&i>=r&&("min"===t?this.$nextTick((function(){e.formData.fieldEdit.minValue=r-1})):this.$nextTick((function(){e.formData.fieldEdit.maxValue=i+1})))},e.prototype.handleErrorMsg=function(t,e,i,r){var n=this;t[i]||(t[r]="该字段是必填项"),this.alreadyAddList.forEach((function(a,o){("该字段是必填项"!==a[r]||e===o&&t[i])&&(a[r]=""),n.alreadyAddList.forEach((function(t,e){o!==e&&t[i]&&a[i]===t[i]&&(t[r]="重复的值",a[r]="重复的值")}))}))},e.prototype.changeValueId=function(t,e){this.handleErrorMsg(t,e,"valueId","valueIdErrorMsg")},e.prototype.changeName=function(t,e){this.handleErrorMsg(t,e,"name","nameErrorMsg")},e.prototype.deleteListTypeData=function(t){this.alreadyAddList.splice(t,1)},e.prototype.changeValueType=function(){this.alreadyAddList=[],["list","enum"].includes(this.formData.valueType)&&(this.alreadyAddList=[{id:this.$random(5),name:"",valueId:"",valueIdErrorMsg:"",nameErrorMsg:""}])},e.prototype.addListTypeData=function(){this.alreadyAddList.push({id:this.$random(5),name:"",valueId:"",valueIdErrorMsg:"",nameErrorMsg:""})},e.prototype.dragstart=function(t,e){this.oldData=t,this.dragStartId=t.id,this.dragStartIndex=e},e.prototype.dragenter=function(t,e){this.dragEndId=t.id,this.dragEndIndex=e},e.prototype.dragover=function(t){t.preventDefault()},e.prototype.getDragend=function(){var t=this;if(this.dragStartId!==this.dragEndId){var e=this.alreadyAddList.findIndex((function(e){return e.id===t.dragStartId})),i=this.alreadyAddList.findIndex((function(e){return e.id===t.dragEndId}));this.alreadyAddList.splice(e,1),this.alreadyAddList.splice(i,0,this.oldData)}this.dragEndId=""},e.prototype.show=function(t){this.isShow=!0,this.currentType=t.type,this.groupList=t.groupList,this.formData.valueType=this.valueTypeList[0].id,"编辑"===t.type&&this.handleEditTypeFirst(t),this.formDataV2=this.$deepClone(this.formData)},e.prototype.handleEditTypeFirst=function(t){this.attrData=t.rowData,this.formData={propertyID:this.attrData.bk_property_id,name:this.attrData.bk_property_name||"",valueType:this.attrData.bk_property_type||"",group:this.attrData.bk_property_group||"",isOnly:this.attrData.isonly||!1,isRequired:this.attrData.isrequired||!1,fieldEdit:{isEdit:this.attrData.editable||!1,defaultValue:!0,regularCheck:"",minValue:"",maxValue:"",enumDefaultValue:""}},this.handleEditTypeSecond()},e.prototype.handleEditTypeSecond=function(){var t=this;["bool"].includes(this.formData.valueType)&&(this.formData.fieldEdit.defaultValue=this.attrData.option||!1),["singlechar","longchar"].includes(this.formData.valueType)&&(this.formData.fieldEdit.regularCheck=this.attrData.option||""),["int","float"].includes(this.formData.valueType)&&(this.formData.fieldEdit.minValue=this.attrData.option.min||"",this.formData.fieldEdit.maxValue=this.attrData.option.max||""),["list","enum"].includes(this.formData.valueType)&&(this.alreadyAddList=this.attrData.option.map((function(e){return e.is_default&&(t.formData.fieldEdit.enumDefaultValue=e.name),{id:t.$random(5),name:e.name,valueId:e.id,valueIdErrorMsg:"",nameErrorMsg:""}})))},e.prototype.validate=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var i=t.handleParams();t.save(i)}))},e.prototype.handleParams=function(){var t={bk_obj_id:this.modelId,attr_id:this.attrData.id,attr_key:this.attrData.bk_property_id,data:{bk_property_id:this.formData.propertyID,bk_property_name:this.formData.name,bk_property_type:this.formData.valueType,isonly:this.formData.isOnly,isrequired:this.formData.isRequired,editable:this.formData.fieldEdit.isEdit,option:"",bk_property_group:this.formData.group}};return"添加"!==this.currentType&&(t.data.bk_obj_id=this.modelId),this.handleNormalType(t),this.handleEnumType(t),t},e.prototype.handleNormalType=function(t){["singlechar","longchar","bool"].includes(this.formData.valueType)&&(t.data.option=this.formData.fieldEdit[this.operationMap[this.formData.valueType]]),["int","float"].includes(this.formData.valueType)&&(t.data.option={min:Number(this.formData.fieldEdit.minValue),max:Number(this.formData.fieldEdit.maxValue)}),"list"===this.formData.valueType&&(t.data.option=this.alreadyAddList.map((function(t){return t.name})))},e.prototype.handleEnumType=function(t){var e=this;if("enum"===this.formData.valueType){if(this.alreadyAddList.find((function(t){return!t.valueId||!t.name||t.nameErrorMsg||t.valueIdErrorMsg})))return this.alreadyAddList.forEach((function(t){t.name?t.nameErrorMsg="":t.nameErrorMsg="该字段是必填项",t.valueId?t.valueIdErrorMsg="":t.valueIdErrorMsg="该字段是必填项"})),!1;t.data.option=this.alreadyAddList.map((function(t){var i={id:t.valueId,is_default:!1,name:t.name,type:"text"};return t.name===e.formData.fieldEdit.enumDefaultValue&&(i.is_default=!0),i}))}},e.prototype.save=function(t){var e=this;this.loading=!0,this.$api.modelSetting["添加"===this.currentType?"addModelAttr":"modifyModelAttr"](t).then((function(t){var i="";if(!t.result)return e.$error(t.message),!1;i="添加"===e.currentType?"新增属性成功!":"修改属性成功!",e.$success(i),e.isShow=!1,e.$emit("getTableData")})).finally((function(){e.loading=!1}))},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataV2)?this.isShow=!1:this.$bkInfo({title:"是否放弃本次操作？",subTitle:"放弃将导致未保存信息丢失",theme:"primary",confirmFn:function(){t.isShow=!1}})},e.prototype.hiddenSlider=function(){Object.assign(this.$data,this.$options.data.call(this))},k([Object(n.d)({type:String,default:function(){return""}})],e.prototype,"modelId",void 0),k([Object(n.f)("alreadyAddList",{immediate:!0,deep:!0})],e.prototype,"onAlreadyAddListChanged",null),e=k([Object(n.a)({name:"attributes-operation"})],e)}(n.e),D=w,x=Object(c.a)(D,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("bk-sideslider",{attrs:{width:538,"is-show":t.isShow,"quick-close":!0,"before-close":t.cancel},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e},hidden:t.hiddenSlider}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.currentType)+"属性")]),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"slider-content-box"},[i("div",{staticClass:"form-box"},[i("bk-form",{ref:"validateForm",attrs:{"label-width":94,model:t.formData,rules:t.rules}},[i("bk-form-item",{attrs:{label:"属性ID",required:!0,desc:"请填写英文开头，下划线、数字、英文的组合（不能以“bk_”开头）","desc-type":"icon",property:"propertyID","error-display-type":"normal"}},[i("bk-input",{attrs:{disabled:"编辑"===t.currentType,placeholder:"请输入属性ID"},model:{value:t.formData.propertyID,callback:function(e){t.$set(t.formData,"propertyID",e)},expression:"formData.propertyID"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"属性名",required:!0,property:"name","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入属性名"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"值类型",required:!0,property:"valueType","error-display-type":"normal"}},[i("bk-select",{attrs:{placeholder:"请选择值类型",searchable:"",clearable:!1,disabled:"编辑"===t.currentType},on:{change:t.changeValueType},model:{value:t.formData.valueType,callback:function(e){t.$set(t.formData,"valueType",e)},expression:"formData.valueType"}},t._l(t.valueTypeList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),i("div",{staticClass:"field-setting"},[i("div",{staticClass:"field-setting-item"},[i("div",{staticClass:"label"},[t._v("字段设置")]),t._v(" "),i("bk-checkbox",{attrs:{"true-value":!0,"false-value":!1},model:{value:t.formData.fieldEdit.isEdit,callback:function(e){t.$set(t.formData.fieldEdit,"isEdit",e)},expression:"formData.fieldEdit.isEdit"}},[t._v("\n                                    可编辑\n                                ")])],1),t._v(" "),["bool"].includes(t.formData.valueType)?i("div",{staticClass:"field-setting-item"},[i("div",{staticClass:"label"},[t._v("默认值")]),t._v(" "),i("bk-switcher",{attrs:{theme:"primary"},model:{value:t.formData.fieldEdit.defaultValue,callback:function(e){t.$set(t.formData.fieldEdit,"defaultValue",e)},expression:"formData.fieldEdit.defaultValue"}})],1):t._e(),t._v(" "),["singlechar","longchar"].includes(t.formData.valueType)?i("div",{staticClass:"field-setting-item"},[i("div",{staticClass:"label"},[t._v("正则校验")]),t._v(" "),i("bk-input",{attrs:{placeholder:"请输入",type:"textarea",rows:3},model:{value:t.formData.fieldEdit.regularCheck,callback:function(e){t.$set(t.formData.fieldEdit,"regularCheck",e)},expression:"formData.fieldEdit.regularCheck"}})],1):t._e(),t._v(" "),["int","float"].includes(t.formData.valueType)?i("div",{staticClass:"field-setting-item"},[i("div",{staticClass:"label line-height-32"},[t._v("最小值")]),t._v(" "),i("bk-input",{attrs:{type:"number",placeholder:"请输入最小数值"},on:{change:function(e){return t.verificationNumber("min")}},model:{value:t.formData.fieldEdit.minValue,callback:function(e){t.$set(t.formData.fieldEdit,"minValue",e)},expression:"formData.fieldEdit.minValue"}})],1):t._e(),t._v(" "),["int","float"].includes(t.formData.valueType)?i("div",{staticClass:"field-setting-item"},[i("div",{staticClass:"label line-height-32"},[t._v("最大值")]),t._v(" "),i("bk-input",{attrs:{type:"number",placeholder:"请输入最大数值"},on:{change:function(e){return t.verificationNumber("max")}},model:{value:t.formData.fieldEdit.maxValue,callback:function(e){t.$set(t.formData.fieldEdit,"maxValue",e)},expression:"formData.fieldEdit.maxValue"}})],1):t._e(),t._v(" "),["list","enum"].includes(t.formData.valueType)?i("div",{staticClass:"field-setting-item"},[i("div",{staticClass:"label"},[t._v(t._s("list"===t.formData.valueType?"列表":"枚举")+"值")]),t._v(" "),i("div",{staticClass:"list-type",staticStyle:{flex:"1"}},[i("div",{staticClass:"already-add-list"},[i("transition-group",{staticClass:"container",attrs:{name:"sort"}},t._l(t.alreadyAddList,(function(e,r){return i("div",{key:e.id,class:["already-add-list-item",0!==r&&"item-top",e.id===t.dragEndId&&t.dragStartId!==t.dragEndId&&(t.dragStartIndex>t.dragEndIndex?"already-add-active-top":"already-add-active-bottom")]},[i("div",{staticClass:"drag-box",attrs:{draggable:"true"},on:{dragstart:function(i){return t.dragstart(e,r)},dragenter:function(i){return t.dragenter(e,r)},dragend:function(e){return t.getDragend()},dragover:function(e){return t.dragover(e)}}},[i("div",{staticStyle:{"margin-right":"5px"}},[i("i",{staticClass:"cw-icon weops-drag-drop"})]),t._v(" "),i("div",{staticClass:"input-box"},["enum"===t.formData.valueType?i("bk-input",{staticStyle:{width:"110px","margin-right":"10px"},attrs:{placeholder:"请输入ID"},on:{change:function(i){return t.changeValueId(e,r)}},model:{value:e.valueId,callback:function(i){t.$set(e,"valueId",i)},expression:"item.valueId"}}):t._e(),t._v(" "),i("span",{staticClass:"error-input-msg"},[t._v(t._s(e.valueIdErrorMsg))])],1),t._v(" "),i("div",{staticClass:"input-box",staticStyle:{flex:"1"}},[i("bk-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入值"},on:{change:function(i){return t.changeName(e,r)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"item.name"}}),t._v(" "),i("span",{staticClass:"error-input-msg"},[t._v(t._s(e.nameErrorMsg))])],1),t._v(" "),i("div",{staticClass:"icon-box",style:{flexDirection:t.alreadyAddList.length>1?"row":"row-reverse"}},[i("i",{staticClass:"cw-icon weops-add",on:{click:t.addListTypeData}}),t._v(" "),t.alreadyAddList.length>1?i("i",{staticClass:"cw-icon weops-delete",on:{click:function(e){return t.deleteListTypeData(r)}}}):t._e()])])])})),0)],1)])]):t._e(),t._v(" "),["enum"].includes(t.formData.valueType)?i("div",{staticClass:"field-setting-item default-value-setting",staticStyle:{display:"flex"}},[i("div",{staticClass:"label line-height-32"},[t._v("默认值设置")]),t._v(" "),i("bk-select",{staticStyle:{flex:"1"},attrs:{placeholder:"请选择默认值",clearable:!1,searchable:""},model:{value:t.formData.fieldEdit.enumDefaultValue,callback:function(e){t.$set(t.formData.fieldEdit,"enumDefaultValue",e)},expression:"formData.fieldEdit.enumDefaultValue"}},t._l(t.enumDefaultList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):t._e()]),t._v(" "),i("bk-form-item",{attrs:{label:"所属分组",required:!0,property:"group","error-display-type":"normal"}},[i("bk-select",{attrs:{placeholder:"请选择所属分组",searchable:"",disabled:"编辑"===t.currentType,clearable:!1},model:{value:t.formData.group,callback:function(e){t.$set(t.formData,"group",e)},expression:"formData.group"}},t._l(t.groupList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"是否唯一",required:!0,property:"isOnly","ext-cls":"whether-class","error-display-type":"normal"}},[i("bk-radio-group",{model:{value:t.formData.isOnly,callback:function(e){t.$set(t.formData,"isOnly",e)},expression:"formData.isOnly"}},[i("bk-radio",{staticStyle:{"margin-right":"27px"},attrs:{value:!0}},[t._v("是")]),t._v(" "),i("bk-radio",{attrs:{value:!1}},[t._v("否")])],1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"是否必填",required:!0,property:"isRequired","ext-cls":"whether-class","error-display-type":"normal"}},[i("bk-radio-group",{model:{value:t.formData.isRequired,callback:function(e){t.$set(t.formData,"isRequired",e)},expression:"formData.isRequired"}},[i("bk-radio",{staticStyle:{"margin-right":"27px"},attrs:{value:!0}},[t._v("是")]),t._v(" "),i("bk-radio",{attrs:{value:!1}},[t._v("否")])],1)],1)],1)],1)])]),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticStyle:{"margin-left":"20px","margin-right":"8px"},attrs:{disabled:t.loading,theme:"primary"},on:{click:t.validate}},[t._v("提交")]),t._v(" "),i("bk-button",{attrs:{disabled:t.loading,theme:"default"},on:{click:t.cancel}},[t._v("取消")])],1)])],1)}),[],!1,null,"ad2cf210",null).exports,O=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),C=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hostDetail="",e.isShow=!1,e.formData={sourceModel:"",targetModel:"",connectType:"",targetBind:"",describe:""},e.formDataV2={},e.rules={sourceModel:[{required:!0,message:"必填项",trigger:"blur"}],targetModel:[{required:!0,message:"必填项",trigger:"blur"}],connectType:[{required:!0,message:"必填项",trigger:"blur"}],targetBind:[{required:!0,message:"必填项",trigger:"blur"}]},e.loading=!1,e.protocolList=[{id:"rdp",name:"RDP"},{id:"ssh",name:"SSH"}],e.targetBindList=[{id:"n:n",name:"N-N"},{id:"1:n",name:"1-N"},{id:"1:1",name:"1-1"}],e.connectTypeList=[],e.type="",e.relDetail="",e}return O(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.type},enumerable:!1,configurable:!0}),e.prototype.changeModel=function(t){"source"===t?this.formData.sourceModel||(this.formData.targetModel=this.modelId):this.formData.targetModel||(this.formData.sourceModel=this.modelId)},e.prototype.show=function(t,e){this.formData={sourceModel:"",targetModel:"",connectType:"",targetBind:"",describe:""},this.type=t,this.isShow=!0,this.formData.sourceModel=this.modelId,this.getConnectTypeList(),this.isAdd||(this.relDetail=e,this.formData.sourceModel=this.relDetail.bk_obj_id,this.formData.targetModel=this.relDetail.bk_asst_obj_id,this.formData.targetBind=this.relDetail.mapping,this.formData.connectType=this.relDetail.bk_asst_id,this.formData.describe=this.relDetail.bk_obj_asst_name),this.formDataV2=JSON.parse(JSON.stringify(this.formData))},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var i={};i=t.isAdd?{bk_asst_id:t.formData.connectType,bk_asst_obj_id:t.formData.targetModel,bk_obj_asst_id:"".concat(t.formData.sourceModel,"_").concat(t.formData.connectType,"_").concat(t.formData.targetModel),bk_obj_asst_name:t.formData.describe,bk_obj_id:t.formData.sourceModel,mapping:t.formData.targetBind}:{id:t.relDetail.id,body:{bk_obj_asst_id:t.relDetail.bk_obj_asst_id,bk_obj_asst_name:t.formData.describe,bk_obj_id:t.formData.sourceModel}},t.save(i)}))},e.prototype.save=function(t){var e=this;this.loading=!0;var i=this.isAdd?"createConnectRel":"editConnectRel";this.$api.modelSetting[i](t).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("".concat(e.isAdd?"新增":"编辑","模型关系成功")),e.isShow=!1,e.$emit("refreshRel")})).finally((function(){e.loading=!1}))},e.prototype.getConnectTypeList=function(){var t=this;this.$api.modelSetting.getConnectTypeList().then((function(e){if(!e.result)return!1;t.connectTypeList=e.data.map((function(t){return{id:t.bk_asst_id,name:"(".concat(t.bk_asst_id,")").concat(t.bk_asst_name)}}))}))},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataV2)?this.isShow=!1:this.$bkInfo({title:"是否放弃本次操作？",subTitle:"放弃将导致未保存信息丢失",theme:"primary",confirmFn:function(){t.isShow=!1}})},C([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"modelList",void 0),C([Object(n.d)({type:String,default:function(){return""}})],e.prototype,"modelId",void 0),e=C([n.a],e)}(n.e),L=j,$=Object(c.a)(L,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:550,"is-show":t.isShow,"before-close":t.cancel,"quick-close":!0},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e}}},[i("div",{staticClass:"content-header",attrs:{slot:"header"},slot:"header"},[i("span",[t._v(t._s(t.isAdd?"新建关联":"编辑关联"))])]),t._v(" "),i("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[i("bk-form",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],ref:"validateForm",staticStyle:{flex:"1"},attrs:{"label-width":110,model:t.formData,rules:t.rules,"form-type":"vertical"}},[i("bk-form-item",{attrs:{label:"源模型",required:!0,property:"sourceModel","error-display-type":"normal"}},[i("bk-select",{attrs:{disabled:!t.isAdd},on:{change:function(e){return t.changeModel("source")}},model:{value:t.formData.sourceModel,callback:function(e){t.$set(t.formData,"sourceModel",e)},expression:"formData.sourceModel"}},t._l(t.modelList,(function(e){return i("bk-option-group",{key:e.bk_classification_id,attrs:{name:e.bk_classification_name}},t._l(e.list,(function(t){return i("bk-option",{key:t.bk_obj_id,attrs:{disabled:t.disabled,id:t.bk_obj_id,name:t.bk_obj_name}})})),1)})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"目标模型",required:!0,property:"targetModel","error-display-type":"normal"}},[i("bk-select",{attrs:{disabled:!t.isAdd},on:{change:function(e){return t.changeModel("target")}},model:{value:t.formData.targetModel,callback:function(e){t.$set(t.formData,"targetModel",e)},expression:"formData.targetModel"}},t._l(t.modelList,(function(e){return i("bk-option-group",{key:e.bk_classification_id,attrs:{name:e.bk_classification_name}},t._l(e.list,(function(t){return i("bk-option",{key:t.bk_obj_id,attrs:{disabled:t.disabled,id:t.bk_obj_id,name:t.bk_obj_name}})})),1)})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"关联类型",required:!0,property:"connectType","error-display-type":"normal"}},[i("bk-select",{attrs:{disabled:!t.isAdd,clearable:!1},model:{value:t.formData.connectType,callback:function(e){t.$set(t.formData,"connectType",e)},expression:"formData.connectType"}},t._l(t.connectTypeList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"源-目标约束",required:!0,property:"targetBind","error-display-type":"normal"}},[i("bk-select",{attrs:{clearable:!1,disabled:!t.isAdd},model:{value:t.formData.targetBind,callback:function(e){t.$set(t.formData,"targetBind",e)},expression:"formData.targetBind"}},t._l(t.targetBindList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"关联描述","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入关联描述",type:"textarea",rows:4},model:{value:t.formData.describe,callback:function(e){t.$set(t.formData,"describe",e)},expression:"formData.describe"}})],1)],1),t._v(" "),i("div",{staticClass:"foot-box"},[i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n                取消\n            ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                确认\n            ")])],1)],1)])}),[],!1,null,"faefe1ac",null).exports,I=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),S=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.groupData="",e.loading=!1,e.formData={groupName:""},e.rules={groupName:[{required:!0,message:"必填项",trigger:"blur"}]},e.type="",e}return I(e,t),e.prototype.show=function(t,e){this.visible=!0,this.type=t,"edit"===t&&(this.groupData=e,this.formData.groupName=this.groupData.bk_property_group_name)},e.prototype.close=function(){this.visible=!1},e.prototype.afterLeaveDialog=function(){this.formData.groupName="",this.$refs.validatePsdForm.clearError()},e.prototype.confirm=function(){var t=this;this.$refs.validatePsdForm.validate().then((function(e){t.loading=!0;var i,r="add"===t.type?"createObjectAttGroup":"updateObjectAttGroup";i="add"===t.type?{bk_group_index:t.groupList.length+2,bk_group_name:t.formData.groupName,bk_obj_id:t.modelId,bk_supplier_account:"0",is_collapse:!1}:{condition:{id:t.groupData.id},data:{bk_group_name:t.formData.groupName,is_collapse:!1}},t.$api.modelSetting[r](i).then((function(e){if(!e.result)return t.$error(e.message),!1;t.$success("".concat("add"===t.type?"新建":"修改","属性分组成功!")),t.$emit("refreshAttr")})).finally((function(){t.loading=!1,t.close()}))}))},S([Object(n.d)({type:String,default:function(){return""}})],e.prototype,"modelId",void 0),S([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"groupList",void 0),e=S([Object(n.a)({name:"attributes-group"})],e)}(n.e),A=T,M=Object(c.a)(A,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"add"===t.type?"新建分组":"编辑分组"},on:{"after-leave":t.afterLeaveDialog},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[i("bk-form",{ref:"validatePsdForm",attrs:{"label-width":80,model:t.formData,rules:t.rules}},[i("bk-form-item",{attrs:{label:"分组名称",required:!0,property:"groupName","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:!0,placeholder:"请输入分组名称"},model:{value:t.formData.groupName,callback:function(e){t.$set(t.formData,"groupName",e)},expression:"formData.groupName"}})],1)],1)],1),t._v(" "),i("template",{slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{disabled:t.loading,theme:"primary",title:"确认"},on:{click:t.confirm}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:t.close}},[t._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,P=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),E=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return P(e,t),Object.defineProperty(e.prototype,"powerParams",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.getValueType=function(t){var e=this.valueTypeList.find((function(e){return e.id===t}));return e?e.name:"--"},e.prototype.editAttributes=function(t){this.$emit("editAttributes",t)},e.prototype.deleteAttributes=function(t){this.$emit("deleteAttributes",t)},e.prototype.editRel=function(t){this.$emit("editRel",t)},e.prototype.deleteRel=function(t){this.$emit("deleteRel",t)},e.prototype.updateColumns=function(){var t=this.$refs.sourceTable;t&&t.updateColumns(this.columns)},E([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"tableData",void 0),E([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"columns",void 0),E([Object(n.d)({type:[String,Number],default:function(){return""}})],e.prototype,"maxHeight",void 0),E([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"valueTypeList",void 0),e=E([Object(n.a)({name:"commonTable",components:{comTable:y.a}})],e)}(n.e),q=R,F=Object(c.a)(q,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("com-table",{ref:"sourceTable",attrs:{id:"center_table",data:t.tableData,"max-height":t.maxHeight,columns:t.columns},scopedSlots:t._u([{key:"isonly",fn:function(e){var r=e.row;return[i("span",[t._v(t._s(r.isonly?"是":"否"))])]}},{key:"isrequired",fn:function(e){var r=e.row;return[i("span",[t._v(t._s(r.isrequired?"是":"否"))])]}},{key:"bk_property_type",fn:function(e){var r=e.row;return[i("span",[t._v(t._s(t.getValueType(r.bk_property_type)))])]}},{key:"operationAttr",fn:function(e){var r=e.row;return[i("div",{staticStyle:{"font-size":"0",cursor:"pointer"}},[i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],class:["cw-icon","weops-edit","内置"===r.type&&"edit-disabled"],on:{click:function(e){return t.editAttributes(r)}}}),t._v(" "),i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],class:["cw-icon","weops-delete","内置"===r.type&&"edit-disabled"],on:{click:function(e){return t.deleteAttributes(r)}}})])]}},{key:"operationRel",fn:function(e){var r=e.row;return[i("div",{staticStyle:{"font-size":"0",cursor:"pointer"}},[i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],class:["cw-icon","weops-edit","内置"===r.type&&"edit-disabled"],on:{click:function(e){return t.editRel(r)}}}),t._v(" "),i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],class:["cw-icon","weops-delete","内置"===r.type&&"edit-disabled"],on:{click:function(e){return t.deleteRel(r)}}})])]}}])})}),[],!1,null,"6c3e3bf0",null).exports,N=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),V=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},G=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},z=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},B=function(t,e,i){if(i||2===arguments.length)for(var r,n=0,a=e.length;n<a;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))},K=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShow=!1,e.loading=!1,e.modelId="",e.activeTab="attributes",e.tableData=[],e.columns=[],e.attrColumns=[{label:"属性名",key:"bk_property_name",align:"left",width:"96px"},{label:"所属分组",key:"bk_property_group_name",align:"left",width:"94px"},{label:"属性ID",key:"bk_property_id",align:"left",minWidth:"115px"},{label:"值类型",key:"bk_property_type",align:"left",minWidth:"80px",scopedSlots:"bk_property_type"},{label:"是否唯一",key:"isonly",align:"left",minWidth:"80px",scopedSlots:"isonly"},{label:"是否必填",key:"isrequired",align:"left",minWidth:"80px",scopedSlots:"isrequired"},{label:"操作",key:"operationAttr",scopedSlots:"operationAttr"}],e.relColumns=[{label:"关联名",key:"bk_asst_name",align:"left"},{label:"关联ID",key:"bk_obj_asst_id",align:"left",minWidth:"155px"},{label:"源模型ID",key:"bk_obj_id",align:"left"},{label:"目标模型ID",key:"bk_asst_obj_id",align:"left"},{label:"目标模型名称",key:"bk_obj_asst_name",align:"left"},{label:"操作",key:"operationRel",scopedSlots:"operationRel"}],e.groupList=[],e.valueTypeList=v,e.deleteRow="",e.pluginStatus=[{id:"collect",name:"自动采集",state:0},{id:"discover",name:"自动发现",state:0}],e.maxHeight="",e.modelName="",e.isBuiltIn=!0,e.modelDetail="",e}return N(e,t),Object.defineProperty(e.prototype,"powerParams",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modelPopoverVisible",{get:function(){return"attributes"===this.activeTab||!this.isBuiltIn},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){var t=this;this.maxHeight=window.innerHeight-258,window.onresize=function(){t.maxHeight=window.innerHeight-258}},e.prototype.changeAttrGroupIndex=function(t,e){var i=this,r="",n="",a=0,o=0;if("up"===t){if(0===e)return!1;r=this.tableData[e],n=this.tableData[e-1],a=e,o=e+1}else{if(e===this.tableData.length-1)return!1;r=this.tableData[e+1],n=this.tableData[e],a=e+1,o=e+2}var s={asc:{condition:{id:r.id},data:{bk_group_index:a}},desc:{condition:{id:n.id},data:{bk_group_index:o}}};this.$api.modelSetting.updateObjectAttGroupOrder(s).then((function(t){if(!t.result)return i.$error(t.message),!1;i.getModelAttributeList()}))},e.prototype.deleteAttrGroup=function(t){var e=this;if(t.data.length)return!1;this.$bkInfo({title:"确认要删除该属性分组？",confirmLoading:!0,confirmFn:function(){return G(e,void 0,void 0,(function(){return z(this,(function(e){switch(e.label){case 0:return[4,this.confirmDelAttrGroup(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmDelAttrGroup=function(t){return G(this,void 0,void 0,(function(){var e;return z(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$api.modelSetting.deleteObjectAttGroup({id:t.id})];case 1:return(e=i.sent()).result?(this.$success("删除成功!"),this.getModelAttributeList()):this.$error(e.message),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.setCollapseStatus=function(t){t.is_collapse=!t.is_collapse},e.prototype.operateAttrGroup=function(t,e){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.attributesGroup.show(t,e)},e.prototype.deleteModel=function(){var t=this;if(!this.$BtnPermission(this.powerParams))return!1;this.$bkInfo({title:"确认要删除该模型？",confirmLoading:!0,confirmFn:function(){return G(t,void 0,void 0,(function(){return z(this,(function(t){switch(t.label){case 0:return[4,this.confirmDeleteModel()];case 1:return t.sent(),[2]}}))}))}})},e.prototype.confirmDeleteModel=function(){return G(this,void 0,void 0,(function(){var t;return z(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.$api.modelSetting.deleteModel({id:this.modelDetail.id,bk_obj_id:this.modelDetail.bk_obj_id})];case 1:return(t=e.sent()).result?(this.$success("删除成功!"),this.$emit("getAllModelList"),this.close()):this.$error(t.message),[2,!0];case 2:return e.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.refreshModel=function(t){this.modelName=t.bk_obj_name,this.modelDetail=t,this.$emit("getAllModelList")},e.prototype.editModel=function(){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.editModel.show("edit",this.modelDetail)},e.prototype.editRel=function(t){return!!this.$BtnPermission(this.powerParams)&&("内置"!==t.type&&void this.$refs.connectOperation.show("edit",t))},e.prototype.deleteRel=function(t){var e=this;return!!this.$BtnPermission(this.powerParams)&&("内置"!==t.type&&(this.deleteRow=t,void this.$bkInfo({title:"确定删除该模型关联关系？",theme:"primary",confirmFn:function(){e.confirmDelete("rel")}})))},e.prototype.addRel=function(){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.connectOperation.show("add")},e.prototype.show=function(t){this.isShow=!0,this.modelId=t.bk_obj_id,this.modelName=t.bk_obj_name,this.isBuiltIn="内置"===t.type,this.modelDetail=t,this.activeTab="attributes",this.handlerChange()},e.prototype.setTagStatus=function(t){switch(t.state){case 0:return{background:"#F0F1F5",color:"#63656E"};case 1:return{background:"#FFF1DB",color:"#FE9C00"}}},e.prototype.getValueType=function(t){var e=this.valueTypeList.find((function(e){return e.id===t}));return e?e.name:"--"},e.prototype.addAttributes=function(){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.attributesOperation.show({id:this.modelId,type:"添加",groupList:this.groupList})},e.prototype.editAttributes=function(t){return!!this.$BtnPermission(this.powerParams)&&(!(!g.find((function(e){return e.id===t.bk_property_type}))||"内置"===t.type)&&void this.$refs.attributesOperation.show({id:t.id,rowData:t,type:"编辑",groupList:this.groupList}))},e.prototype.deleteAttributes=function(t){var e=this;return!!this.$BtnPermission(this.powerParams)&&(this.deleteRow=t,"内置"!==t.type&&void this.$bkInfo({title:"确定删除该属性？",subTitle:"删除后无法恢复此属性",theme:"primary",confirmFn:function(){e.confirmDelete("attr")}}))},e.prototype.confirmDelete=function(t){var e=this;this.loading=!0;var i="deleteModelAttr",r={attr_id:this.deleteRow.id,attr_key:this.deleteRow.bk_property_id,bk_obj_id:this.deleteRow.bk_obj_id};"rel"===t&&(i="delConnectRel",r={id:this.deleteRow.id,body:{bk_obj_asst_id:this.deleteRow.bk_obj_asst_id,bk_obj_id:this.deleteRow.bk_obj_id}}),this.$api.modelSetting[i](r).then((function(i){if(!i.result)return e.$error(i.message),!1;e.handlerChange(),e.$success("删除".concat("attr"===t?"属性":"模型关联关系","成功!"))})).finally((function(){e.loading=!1}))},e.prototype.handlerChange=function(){var t=this;"attributes"===this.activeTab?(this.getModelAttributeList(),this.columns=this.attrColumns):(this.getModelConnectionRel(),this.columns=this.relColumns),this.$nextTick((function(){var e=t.$refs.commonTable;e&&(Array.isArray(B([],e,!0))?B([],e,!0).forEach((function(t){t.updateColumns()})):e.updateColumns())}))},e.prototype.close=function(){this.isShow=!1},e.prototype.getModelAttributeList=function(){var t=this;this.loading=!0,this.tableData=[],this.$api.modelSetting.getModelAttributeList({bk_obj_id:this.modelId}).then((function(e){if(!e.result)return!1;var i=[];e.data.forEach((function(t){i.find((function(e){return e.id===t.bk_property_group_name}))||i.push({id:t.bk_property_group,name:t.bk_property_group_name})})),t.groupList=i,t.tableData=e.data})).finally((function(){t.loading=!1}))},e.prototype.getModelConnectionRel=function(){var t=this;this.loading=!0,this.tableData=[],this.$api.modelSetting.getModelConnectionRel({bk_obj_id:this.modelId}).then((function(e){if(!e.result)return!1;t.tableData=e.data})).finally((function(){t.loading=!1}))},V([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"modelList",void 0),V([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"modelGroupList",void 0),e=V([Object(n.a)({name:"model-detail",components:{comTable:y.a,attributesOperation:x,connectOperation:$,editModel:b,attributesGroup:M,commonTable:F}})],e)}(n.e),H=K,U=Object(c.a)(H,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"model-detail"},[i("bk-sideslider",{attrs:{width:753,"is-show":t.isShow,"quick-close":!0,"before-close":t.close},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("模型详情-"+t._s(t.modelName))]),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"slider-content-box"},[i("div",{staticClass:"action-bar"},[i("bk-radio-group",{on:{change:t.handlerChange},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[i("bk-radio-button",{attrs:{value:"attributes"}},[t._v("\n                            属性\n                        ")]),t._v(" "),i("bk-radio-button",{attrs:{value:"related"}},[t._v("\n                            关联\n                        ")])],1),t._v(" "),i("bk-popover",{attrs:{"ext-cls":"model-popover",placement:"bottom"}},[t.modelPopoverVisible?i("bk-icon",{staticStyle:{"font-size":"24px",cursor:"pointer"},attrs:{type:"ellipsis"}}):t._e(),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[t.isBuiltIn?t._e():i("div",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"action-item mb10",on:{click:t.editModel}},[i("i",{staticClass:"cw-icon weops-edit",staticStyle:{"font-size":"13px"}}),t._v("\n                                编辑\n                            ")]),t._v(" "),t.isBuiltIn?t._e():i("div",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"action-item mb10",on:{click:t.deleteModel}},[i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"cw-icon weops-delete",staticStyle:{"font-size":"13px"}}),t._v("\n                                删除\n                            ")]),t._v(" "),"attributes"===t.activeTab?i("div",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"action-item",on:{click:function(e){return t.operateAttrGroup("add")}}},[i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"cw-icon weops-add",staticStyle:{"font-size":"13px"}}),t._v("\n                                新增属性分组\n                            ")]):t._e()])],1)],1),t._v(" "),i("div",{staticClass:"add-attributes-box"},["attributes"===t.activeTab?i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],attrs:{theme:"primary"},on:{click:t.addAttributes}},[t._v("\n                        添加属性\n                    ")]):i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],attrs:{theme:"primary"},on:{click:t.addRel}},[t._v("\n                        新建关联\n                    ")])],1),t._v(" "),i("div",{staticClass:"table-box"},["attributes"===t.activeTab?i("div",t._l(t.tableData,(function(e){return i("div",{key:e.id,staticClass:"attr-group-list"},[i("div",{staticClass:"group-header"},[i("i",{class:["cw-icon",e.is_collapse?"weops-angle-right":"weops-angle-down","mr15","collapse-icon"],on:{click:function(i){return t.setCollapseStatus(e)}}}),t._v(" "),i("span",{staticClass:"mr15 title"},[t._v(t._s(e.bk_property_group_name))]),t._v(" "),i("div",{staticClass:"operate-icon-box"},[i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"cw-icon weops-edit mr5",on:{click:function(i){return t.operateAttrGroup("edit",e)}}}),t._v(" "),i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],class:["cw-icon","weops-delete","mr5",e.data.length&&"edit-disabled"],on:{click:function(i){return t.deleteAttrGroup(e)}}})])]),t._v(" "),e.is_collapse?t._e():i("common-table",{ref:"commonTable",refInFor:!0,attrs:{"table-data":e.data,columns:t.columns,"value-type-list":t.valueTypeList},on:{editAttributes:t.editAttributes,deleteAttributes:t.deleteAttributes,editRel:t.editRel,deleteRel:t.deleteRel}})],1)})),0):i("common-table",{ref:"commonTable",attrs:{"table-data":t.tableData,"max-height":t.maxHeight,columns:t.columns,"value-type-list":t.valueTypeList},on:{editAttributes:t.editAttributes,deleteAttributes:t.deleteAttributes,editRel:t.editRel,deleteRel:t.deleteRel}})],1)])]),t._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{attrs:{theme:"default"},on:{click:t.close}},[t._v("关闭")])],1)]),t._v(" "),i("attributes-operation",{ref:"attributesOperation",attrs:{"model-id":t.modelId},on:{getTableData:t.handlerChange}}),t._v(" "),i("connect-operation",{ref:"connectOperation",attrs:{"model-list":t.modelList,"model-id":t.modelId},on:{refreshRel:t.getModelConnectionRel}}),t._v(" "),i("edit-model",{ref:"editModel",attrs:{"group-list":t.modelGroupList},on:{refreshModel:t.refreshModel}}),t._v(" "),i("attributes-group",{ref:"attributesGroup",attrs:{"model-id":t.modelId,"group-list":t.tableData},on:{refreshAttr:t.getModelAttributeList}})],1)}),[],!1,null,"3e1d591a",null).exports,W=i("5Vuv"),J=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Z=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},Q=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},X=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.formData={onlyMark:"",name:""},e.formDataCopy={},e.groupDetial={},e.rules={onlyMark:[{required:!0,message:"请输入唯一标识",trigger:"blur"}],name:[{required:!0,message:"请输入唯一名称",trigger:"blur"}]},e.loading=!1,e.currentType="add",e}return J(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.currentType},enumerable:!1,configurable:!0}),e.prototype.show=function(t,e){if(this.currentType=t,this.visible=!0,"edit"===t)return this.formData={onlyMark:e.bk_classification_id,name:e.bk_classification_name},this.groupDetial=e,void(this.formDataCopy=this.$copy(this.formData));this.initData()},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var i={bk_classification_name:t.formData.name};t.isAdd?i.bk_classification_id=t.formData.onlyMark:i.id=t.groupDetial.id,t.createOrEditGroup(i)}))},e.prototype.createOrEditGroup=function(t){return Q(this,void 0,void 0,(function(){var e,i;return X(this,(function(r){switch(r.label){case 0:this.loading=!0,e=this.isAdd?"createGroup":"updateGroup",r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.$api.modelSetting[e](t)];case 2:return(i=r.sent()).result?(this.$success("".concat(this.isAdd?"新增":"编辑","分组成功!")),this.visible=!1,this.getAllModelList(),[3,4]):(this.$error(i.message),[2]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataCopy)?this.visible=!1:this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.visible=!1}})},e.prototype.initData=function(){this.groupDetial={},this.formData={onlyMark:"",name:""},this.formDataCopy=this.$copy(this.formData)},e.prototype.getAllModelList=function(){return""},Z([Object(n.b)("getAllModelList")],e.prototype,"getAllModelList",null),e=Z([Object(n.a)({components:{}})],e)}(W.a),tt=Y,et=Object(c.a)(tt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("bk-sideslider",{attrs:{width:500,"is-show":t.visible,"quick-close":!0,"ext-cls":"common-dialog-wrapper","before-close":t.cancel},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s((t.isAdd?"新建":"编辑")+"分组"))]),t._v(" "),i("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"validateForm",attrs:{"label-width":110,model:t.formData,rules:t.rules,"form-type":"vertical"}},[i("bk-form-item",{attrs:{label:"唯一标识",required:!0,desc:"可使用英文、数字、下划线，需以字母开头","desc-type":"icon",property:"onlyMark","error-display-type":"normal"}},[i("bk-input",{ref:"onlyMark",attrs:{disabled:!t.isAdd,placeholder:"请输入唯一标识"},model:{value:t.formData.onlyMark,callback:function(e){t.$set(t.formData,"onlyMark",e)},expression:"formData.onlyMark"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"名称",required:!0,property:"name","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.btnForbidden||t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                确认\n            ")]),t._v(" "),i("bk-button",{on:{click:t.cancel}},[t._v("\n                取消\n            ")])],1)])],1)}),[],!1,null,null,null).exports,it=[{key:"host",icon:"cc-host"},{key:"oracle",icon:"cc-oracle"},{key:"mysql",icon:"cc-mysql"},{key:"mssql",icon:"cc-sql-server"},{key:"redis",icon:"cc-redis"},{key:"mongodb",icon:"cc-mongodb"},{key:"db_cluster",icon:"cc-db-cluster"},{key:"active_directory",icon:"cc-active-directory"},{key:"exchange_server",icon:"cc-mail-server"},{key:"apache",icon:"cc-apache"},{key:"tomcat",icon:"cc-tomcat"},{key:"nginx",icon:"cc-nginx"},{key:"iis",icon:"cc-iis"},{key:"cloud_plat",icon:"cc-cloud-plat"},{key:"esxi_host",icon:"cc-esxi-host"},{key:"vcenter",icon:"cc-vmware"},{key:"bk_switch",icon:"cc-switch2"},{key:"bk_router",icon:"cc-router"},{key:"bk_firewall",icon:"cc-firewall"},{key:"bk_loadbalance",icon:"cc-balance"},{key:"bk_server",icon:"cc-server"},{key:"bk_port",icon:"cc-net-port"},{key:"bk_line",icon:"cc-line"},{key:"k8s_cluster",icon:"cc-k8s-cluster"},{key:"k8s_namespace",icon:"cc-k8s-namespace"},{key:"k8s_workload",icon:"cc-k8s-workload"},{key:"bk_node",icon:"cc-node"},{key:"k8s_pod",icon:"cc-pod"}],rt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),nt=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},at=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},ot=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.searchKey="",e.loading=!1,e.modelList=[],e.groupList=[],e.allModelList=[],e}return rt(e,t),e.prototype.mounted=function(){this.getAllModelList()},Object.defineProperty(e.prototype,"modelGroupList",{get:function(){return this.groupList.filter((function(t){return"bk_host_manage"!==t.bk_classification_id&&"主机管理"!==t.bk_classification_name}))},enumerable:!1,configurable:!0}),e.prototype.handleTipsConfig=function(t){return{placement:"left-start",content:"内置模型组不支持删除和修改",disabled:t.bk_classification_id.startsWith("ex_")}},e.prototype.goAssetRecord=function(t,e){if("bk_file"===t.bk_classification_id)return!1;"bk_host_manage"===t.bk_classification_id?this.$router.push({name:"AssetRecordsHost"}):this.$router.push({name:t.bk_classification_id,params:{activeId:e.bk_obj_id}})},e.prototype.checkModelDetail=function(t){this.$refs.modelDetail.show(t)},e.prototype.getAllModelList=function(){var t=this;this.loading=!0,Promise.all([this.getClassification(),this.getModelInfoList()]).then((function(e){var i=e[0],r=e[1];return i.result?r.result?(t.groupList=i.data||[],i.result&&r.result&&(t.modelList=t.groupList.map((function(t){return t.list=r.data.filter((function(e){return e.bk_classification_id===t.bk_classification_id})),t}))),void(t.searchKey||(t.allModelList=JSON.parse(JSON.stringify(t.modelList))))):(t.$error(r.message),t.modelList=[],!1):(t.$error(i.message),t.modelList=[],!1)})).finally((function(){t.loading=!1}))},e.prototype.addModel=function(){this.btnForbidden||this.$refs.addModel.show("add")},e.prototype.groupOperation=function(t,e){(void 0===e&&(e={}),this.btnForbidden&&"edit"!==t)||this.$refs.groupOperation.show(t,e)},e.prototype.getIconUrl=function(t){var e=it.find((function(e){return e.key===t.bk_obj_id}));if(e)return i("qohj")("./".concat(e.icon,".svg"));if(!t.bk_obj_icon)return i("hva8");var r=t.bk_obj_icon.split("icon-")[1];return i("qohj")("./".concat(r||"cc-default",".svg"))},e.prototype.getModelInfoList=function(){return this.$api.modelSetting.getModelInfoList({bk_obj_name:this.searchKey})},e.prototype.getClassification=function(){return this.$api.modelSetting.getClassification()},e.prototype.handleDelete=function(t){var e=this;if(!this.btnForbidden){var i={id:t.id,bk_classification_name:t.bk_classification_name};this.$bkInfo({title:"提示",subTitle:"确认要删除此分组？",theme:"primary",confirmFn:function(){e.confirmDeleteGroup(i)}})}},e.prototype.confirmDeleteGroup=function(t){return at(this,void 0,void 0,(function(){var e;return ot(this,(function(i){switch(i.label){case 0:return this.loading=!0,[4,this.$api.modelSetting.deleteGroup(t)];case 1:return(e=i.sent()).result?(this.$message.success("删除成功"),this.getAllModelList(),[2]):(this.$message.error(e.message),this.loading=!1,[2])}}))}))},e=nt([Object(n.a)({components:{addModel:b,modelDetail:U,groupOperation:et}})],e)}(W.a),lt=st,ct=Object(c.a)(lt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"asset-model"},[i("div",{staticClass:"action-bar"},[i("bk-input",{staticStyle:{flex:"1"},attrs:{clearable:"",placeholder:"请输入关键词","right-icon":"bk-icon icon-search"},on:{enter:t.getAllModelList,clear:t.getAllModelList,"right-icon-click":t.getAllModelList},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"ml20",attrs:{theme:"primary"},on:{click:t.addModel}},[t._v("\n            新建模型\n        ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"ml20",on:{click:function(e){return t.groupOperation("add")}}},[t._v("\n            新建分组\n        ")])],1),t._v(" "),i("div",{staticClass:"show-box"},t._l(t.modelList,(function(e){return i("div",{key:e.id,staticClass:"model-list"},[i("div",{staticClass:"model-header"},[i("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.handleTipsConfig(e),expression:"handleTipsConfig(item)"}]},[i("span",{staticClass:"name"},[t._v(t._s(e.bk_classification_name))]),t._v(" "),i("span",{staticClass:"count"},[t._v(t._s("("+e.list.length+")"))])]),t._v(" "),e.bk_classification_id.startsWith("ex_")?i("div",{staticClass:"model-header-operation show-operation"},[i("i",{staticClass:"cw-icon weops-edit icon",on:{click:function(i){return t.groupOperation("edit",e)}}}),t._v(" "),i("i",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"cw-icon weops-delete",on:{click:function(i){return t.handleDelete(e)}}})]):t._e()]),t._v(" "),i("div",{staticClass:"model-body"},t._l(e.list,(function(r){return i("div",{key:r.id,staticClass:"model-info"},[i("div",{staticClass:"left-info",on:{click:function(e){return t.checkModelDetail(r)}}},[i("div",{staticClass:"icon-box"},[i("img",{attrs:{src:t.getIconUrl(r),alt:""}})]),t._v(" "),i("div",{staticClass:"info-box"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"hide-text"},[t._v("\n                                "+t._s(r.bk_obj_name)+"\n                            ")]),t._v(" "),i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"model-id hide-text"},[t._v("\n                                "+t._s(r.bk_obj_id)+"\n                            ")])])]),t._v(" "),i("div",{class:["right-info","is-show","bk_file"===e.bk_classification_id&&"is-disabled"],on:{click:function(i){return t.goAssetRecord(e,r)}}},[i("bk-icon",{attrs:{type:"calendar"}}),t._v(" "),i("span",[t._v(t._s(r.count>999?"999+":r.count))])],1)])})),0)])})),0),t._v(" "),i("add-model",{ref:"addModel",attrs:{"group-list":t.modelGroupList},on:{getAllModelList:t.getAllModelList}}),t._v(" "),i("group-operation",{ref:"groupOperation",on:{getAllModelList:t.getAllModelList}}),t._v(" "),i("model-detail",{ref:"modelDetail",attrs:{"model-list":t.allModelList,"model-group-list":t.modelGroupList},on:{getAllModelList:t.getAllModelList}})],1)}),[],!1,null,"07965f59",null).exports,ut=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),dt=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},pt=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},ft=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},mt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.visible=!1,e.rules={},e.formData={task_name:"",bk_cluster:"",collection_frequency:5},e.collectionOption=[5,10,30,60],e}return ut(e,t),e.prototype.created=function(){var t=this;[{key:"task_name",tip:"请输入任务名称"},{key:"bk_cluster",tip:"请选择K8S集群"},{key:"collection_frequency",tip:"请选择采集频率"}].forEach((function(e){t.rules[e.key]=[{required:!0,message:e.tip,trigger:"blur"}]}))},e.prototype.showSlider=function(t){this.visible=!0;var e={task_name:(null==t?void 0:t.task_name)||"",bk_cluster:(null==t?void 0:t.bk_cluster)||"",collection_frequency:(null==t?void 0:t.collection_frequency)||5};(null==t?void 0:t.id)&&(e.id=t.id),this.formData=this.$Copy(e),this.initData=e},e.prototype.handleClose=function(){var t=this;this.$compareFormData(this.formData,this.initData)?this.visible=!1:this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.visible=!1}})},e.prototype.handleConfirm=function(){var t=this;this.$refs.taskForm.validate().then((function(e){return pt(t,void 0,void 0,(function(){var t,e;return ft(this,(function(i){switch(i.label){case 0:this.loading=!0,t=this.formData.id?"updateTask":"createTask",i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.$api.modelSetting[t](this.formData)];case 2:return(e=i.sent()).result?(this.visible=!1,this.$success("创建成功"),this.$emit("refresh"),[3,4]):[2,this.$error(e.message)];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))}))},dt([Object(n.d)([])],e.prototype,"clusterData",void 0),e=dt([Object(n.a)({components:{}})],e)}(n.e),ht=mt,bt=Object(c.a)(ht,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:480,"quick-close":!0,"before-close":t.handleClose,"is-show":t.visible,"ext-cls":"common-dialog-wrapper"},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n        "+t._s(t.formData.id?"修改":"新建")+"任务\n        "),t.formData.id?i("span",{staticClass:"sub-title"},[t._v("\n            - "+t._s(t.initData.task_name)+"\n        ")]):t._e()]),t._v(" "),i("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"taskForm",attrs:{"label-width":100,rules:t.rules,model:t.formData}},[i("bk-form-item",{attrs:{label:"任务名称",required:!0,property:"task_name","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:!0,placeholder:"请输入任务名称"},model:{value:t.formData.task_name,callback:function(e){t.$set(t.formData,"task_name",e)},expression:"formData.task_name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"K8S集群",required:!0,property:"bk_cluster","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"100%"},attrs:{searchable:"",disabled:!!t.formData.id,placeholder:"请选择K8S集群"},model:{value:t.formData.bk_cluster,callback:function(e){t.$set(t.formData,"bk_cluster",e)},expression:"formData.bk_cluster"}},t._l(t.clusterData,(function(t){return i("bk-option",{key:t.bk_inst_id,attrs:{id:t.bk_inst_id,name:t.bk_inst_name}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"采集频率",required:!0,placeholder:"请选择采集频率",property:"collection_frequency","error-display-type":"normal"}},[i("bk-select",{staticStyle:{width:"100%"},model:{value:t.formData.collection_frequency,callback:function(e){t.$set(t.formData,"collection_frequency",e)},expression:"formData.collection_frequency"}},t._l(t.collectionOption,(function(t){return i("bk-option",{key:t,attrs:{id:t,name:t+"分钟"}})})),1)],1)],1)],1),t._v(" "),i("template",{slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{title:"确认",theme:"primary",loading:t.loading},on:{click:t.handleConfirm}},[t._v("\n            确认\n        ")]),t._v(" "),i("bk-button",{attrs:{type:"submit",theme:"default",title:"取消",disabled:t.loading},on:{click:function(e){return t.handleClose()}}},[t._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,yt=i("jAee"),vt=i("ceJc"),gt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),_t=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},kt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.beginFocus=!1,e.endFocus=!1,e.beginError=!1,e.endError=!1,e.beginIpAdress=[{value:"",type:"beginInput",disabled:!1},{value:"",type:"beginInput",disabled:!1},{value:"",type:"beginInput",disabled:!1},{value:"",type:"beginInput",disabled:!1}],e.endIpAdress=[{value:"",type:"endInput",disabled:!0},{value:"",type:"endInput",disabled:!0},{value:"",type:"endInput",disabled:!0},{value:"",type:"endInput",disabled:!1}],e}return gt(e,t),e.prototype.onValueChanged=function(t){if(t.length)for(var e=t.at().split("."),i=t.at(-1).split("."),r=0;r<e.length;r++)this.beginIpAdress[r].value=e[r],this.endIpAdress[r].value=i[r]},e.prototype.onBeginIpAdressChanged=function(t){var e=this;t.forEach((function(t,i){i<3&&(e.endIpAdress[i].value=t.value,e.value[1]=e.endIpAdress.reduce((function(t,e){return t=t+e.value+"."}),"").slice(0,-1))}))},e.prototype.checkIpVal=function(t,e){var i=parseInt((String(t.value)||"").trim(),10);i=isNaN(i)?"":(i=i<0?0:i)>255?255:i,t.value=i;var r=this.value.at().split("."),n=this.value.at(-1).split(".");"beginInput"===t.type?(r[e]=i,this.value[0]=r.reduce((function(t,e){return t=t+e+"."}),"").slice(0,-1)):(n[e]=i,this.value[1]=n.reduce((function(t,e){return t=t+e+"."}),"").slice(0,-1)),i>99&&3!==e&&this.$refs[t.type][e+1].focus()},e.prototype.handleFocus=function(t){"beginInput"!==t.type?this.endFocus=!0:this.beginFocus=!0},e.prototype.turnIpPOS=function(t,e,i){32===(i||window.event).keyCode&&3!==e&&this.$refs[t.type][e+1].focus()},e.prototype.setDefaultVal=function(t){"beginInput"!==t.type?this.endFocus=!1:this.beginFocus=!1},e.prototype.validate=function(){var t=/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;this.beginError=!t.test(this.value.at()),this.endError=!t.test(this.value.at(-1))},_t([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"value",void 0),_t([Object(n.f)("value",{deep:!0})],e.prototype,"onValueChanged",null),_t([Object(n.f)("beginIpAdress",{immediate:!0,deep:!0})],e.prototype,"onBeginIpAdressChanged",null),e=_t([Object(n.a)({name:"ipInput",components:{}})],e)}(n.e),wt=kt,Dt=Object(c.a)(wt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ip-input"},[i("ul",{class:["ip-adress",t.beginFocus&&"focus-input",t.beginError&&"error-input"]},t._l(t.beginIpAdress,(function(e,r){return i("li",{key:r},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item.value"}],ref:"beginInput",refInFor:!0,staticClass:"input-item",staticStyle:{color:"#63656e"},attrs:{type:"text"},domProps:{value:e.value},on:{blur:function(i){return t.setDefaultVal(e)},input:[function(i){i.target.composing||t.$set(e,"value",i.target.value)},function(i){return t.checkIpVal(e,r)}],keyup:function(i){return t.turnIpPOS(e,r,i)},focus:function(i){return t.handleFocus(e)}}}),t._v(" "),i("div",{staticClass:"point"})])})),0),t._v(" "),i("span",{staticClass:"line"},[t._v("-")]),t._v(" "),i("ul",{class:["ip-adress",t.endFocus&&"focus-input",t.endError&&"error-input"]},t._l(t.endIpAdress,(function(e,r){return i("li",{key:r},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item.value"}],ref:"endInput",refInFor:!0,class:["input-item",e.disabled&&"input-disabled"],staticStyle:{color:"#63656e"},attrs:{type:"text",disabled:e.disabled},domProps:{value:e.value},on:{blur:function(i){return t.setDefaultVal(e)},input:[function(i){i.target.composing||t.$set(e,"value",i.target.value)},function(i){return t.checkIpVal(e,r)}],keyup:function(i){return t.turnIpPOS(e,r,i)},focus:t.handleFocus}}),t._v(" "),i("div",{staticClass:"point"})])})),0)])}),[],!1,null,"6bd883af",null).exports,xt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ot=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},Ct=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},jt=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Lt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.pageLoading=!1,e.visible=!1,e.rules={},e.formData={task_name:"",scanPeriod:"close",collectionFrequency:1,beginTime:"00:00",ip_range:"",evidence:[],vcenter:"",credentialsId:"",area:[],timeout:0,access_point:""},e.frequencyList=[1,2,3,4,6,8,12],e.vcenterList=[],e.initData={},e.instanceFields=[],e.typeItem={},e.voucherList=[],e.areaList=[],e.refreshLoading=!1,e.isFirstRender=!0,e.ipAdress=[],e.accessPointList=[],e}return xt(e,t),Object.defineProperty(e.prototype,"isVmware",{get:function(){return"vmware_vc"===this.currentNode.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCloud",{get:function(){return["qcloud_cvm","aliyun_ecs","vmware_vc","ManageOne"].includes(this.currentNode.id)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isManageOne",{get:function(){return"ManageOne"===this.currentNode.id},enumerable:!1,configurable:!0}),e.prototype.created=function(){var t=this;[{key:"task_name",tip:"请输入任务名称"},{key:"scanPeriod",tip:"请选择扫描周期"},{key:"ip_adress",tip:"请输入正确的IP范围",validator:function(){return t.valiIp()}},{key:"credentialsId",tip:"凭据不能为空",validator:function(){var e;return!!(null===(e=t.formData.credentialsId)||void 0===e?void 0:e.length)||!!t.formData.credentialsId}},{key:"vcenter",tip:"请选择Vcenter"},{key:"cloud",tip:"请选择云账号",validator:function(){return!!t.formData.vcenter}},{key:"manageOne",tip:"请选择ManageOne平台",validator:function(){return!!t.formData.vcenter}},{key:"area",tip:"请选择云区域"},{key:"timeout",tip:"请输入超时时长"},{key:"access_point",tip:"请选择接入点"}].forEach((function(e){t.rules[e.key]=[{required:!0,message:e.tip,trigger:"blur"}],["credentialsId","cloud","ip_adress","manageOne"].includes(e.key)&&(t.rules[e.key][0].validator=e.validator)}))},e.prototype.getBkObjIdParams=function(t,e){var i=this.$copy(t),r=this.currentNode.id;switch(r){case"aliyun_ecs":i[e]="aliyun_account";break;case"qcloud_cvm":i[e]="qcloud_account";break;case"ManageOne":i[e]="mo_account";break;default:i[e]=r}return i},e.prototype.handleVcenterChange=function(t){!this.isFirstRender&&this.isCloud&&(this.formData.credentialsId=""),this.isFirstRender=!1,t&&-1!==this.moduleCredDesign&&this.getCredential()},e.prototype.valiIp=function(){var t=/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;return t.test(this.ipAdress.at())&&t.test(this.ipAdress.at(-1))},e.prototype.getCredential=function(){var t;return Ct(this,void 0,void 0,(function(){var e,i;return jt(this,(function(r){switch(r.label){case 0:return e={page_size:99999,page:1,name:"",module_cred_design:this.moduleCredDesign,search_type:"all",bk_inst_id:this.isCloud?this.formData.vcenter:""},[4,this.$api.remoteConnect.getVaultCredential(e)];case 1:return(i=r.sent()).result?(this.voucherList=null===(t=i.data)||void 0===t?void 0:t.items,[2]):(this.$error(i.message),[2])}}))}))},e.prototype.getFieldsList=function(t){return void 0===t&&(t=""),Ct(this,void 0,void 0,(function(){var e,i,r;return jt(this,(function(n){switch(n.label){case 0:e="loading"===t,this.refreshLoading=e,n.label=1;case 1:return n.trys.push([1,,3,4]),(i={}).bk_obj_id=this.typeItem.name,i.credential_id=this.formData.credentialsId,[4,this.$api.modelSetting.getRegionsList(i)];case 2:return(r=n.sent()).result?(this.areaList=r.data,e&&this.$success("刷新成功"),[3,4]):(this.$error(r.message),[2]);case 3:return this.refreshLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getAutomateAccessPoint=function(){return Ct(this,void 0,void 0,(function(){var t,e,i;return jt(this,(function(r){switch(r.label){case 0:return[4,this.$api.modelSetting.getAutomateAccessPoint()];case 1:return t=r.sent(),e=t.data,i=t.message,t.result?(this.accessPointList=e.result,[2]):(this.$error(i),[2])}}))}))},e.prototype.selectCredential=function(t){t&&["qcloud_cvm","aliyun_ecs"].includes(this.currentNode.id)&&this.getFieldsList()},e.prototype.createCredential=function(){this.$refs.voucherDialog.show("add",{})},e.prototype.updateCredential=function(t){if(this.getCredential(),this.isCloud)return this.relateHost(t.id),void(this.formData.credentialsId=t.id);this.formData.credentialsId.push(t.id)},e.prototype.relateHost=function(t){return Ct(this,void 0,void 0,(function(){var e,i,r;return jt(this,(function(n){switch(n.label){case 0:return[4,this.$api.remoteConnect.setCredResourceList({id:t,body:{bk_inst_id_list:[this.formData.vcenter]}})];case 1:return e=n.sent(),i=e.result,r=e.message,i||this.$error(r),[2]}}))}))},e.prototype.handleAllFields=function(t){var e=this;t.forEach((function(t,i){"list"!==t.bk_property_type&&"bool"!==t.bk_property_type||("list"===t.bk_property_type&&(t.option=t.option.map((function(t){return{id:t,name:t}}))),"bool"===t.bk_property_type&&(t.option=[{id:!0,name:"是"},{id:!1,name:"否"}])),t.checked=!1,t.batchValue="",t.editStatus=!1,t.editValue="",t.editLoading=!1,t.editIconShow=!1,e.buildFieldData(t,e.instanceFields)}))},e.prototype.buildFieldData=function(t,e){var i=e.findIndex((function(e){return e.key===t.bk_property_group}));-1===i?e.push({title:t.bk_property_group_name,children:[t],key:t.bk_property_group,collapseStatus:!0,id:this.$random(3)}):e[i].children.push(t)},e.prototype.getAppCustomFields=function(){return Ct(this,void 0,void 0,(function(){var t,e;return jt(this,(function(i){switch(i.label){case 0:return t=this.getBkObjIdParams({},"bk_obj_id"),[4,this.$api.Resource[this.typeItem.filedUrl](t)];case 1:return(e=i.sent()).result?(this.instanceFields=[],this.handleAllFields(e.data.all_field),[2]):(this.$error(e.message),[2])}}))}))},e.prototype.handleCreate=function(){var t=this.$deepClone(this.instanceFields);t.forEach((function(t){t.children=t.children.filter((function(t){return!["录入方式","录入时间"].includes(t.bk_property_name)}))}));var e=this.getBkObjIdParams(this.typeItem,"name");this.$refs.addResource.showDialog(e,t)},e.prototype.createTargetSuccess=function(t){this.formData.vcenter=t.id,this.getVcenterList()},e.prototype.getMateType=function(t){return{mysql:0,oracle:0,mssql:0,redis:0,network:1,vmware_vc:2,aliyun_ecs:3,qcloud_cvm:4,ManageOne:5}[t]},e.prototype.showSlider=function(t){return Ct(this,void 0,void 0,(function(){var e,i,r,n=this;return jt(this,(function(a){return this.visible=!0,this.pageLoading=!0,this.isFirstRender=!0,e=this.currentNode,i=e.id,r=e.name,this.typeItem={name:i,nameCn:r,label:r,listUrl:"getOtherResourceList",filedUrl:"getOtherResourceFields",updateFieldUrl:"updateOtherResourceFields",batchEditUrl:"modifyOtherResourceBulk",changeRecordUrl:"getOtherSrcChange",isEdit:!!(null==t?void 0:t.id)},Promise.all([this.getAutomateAccessPoint(),!this.isCloud&&this.getCredential(),this.isCloud&&this.getVcenterList(),this.isCloud&&this.getAppCustomFields(),this.typeItem.isEdit&&this.getAutomateDetail(t.id)]).finally((function(){n.pageLoading=!1})),this.typeItem.isEdit||this.initPageData({}),[2]}))}))},e.prototype.getEvidenceDetail=function(t){return Ct(this,void 0,void 0,(function(){var e=this;return jt(this,(function(i){return this.initData=this.$copy(this.formData),t.forEach((function(t){return Ct(e,void 0,void 0,(function(){var e;return jt(this,(function(i){switch(i.label){case 0:return[4,this.$api.remoteConnect.getCredentialDetail({id:t})];case 1:return(e=i.sent()).result?(this.formData.evidence.push(e.data),this.initData.evidence.push(e.data),[2]):(this.$error(e.message),[2])}}))}))})),[2]}))}))},e.prototype.handleClose=function(){var t=this;this.$compareFormData(this.formData,this.initData)?this.visible=!1:this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.visible=!1}})},e.prototype.handleConfirm=function(){var t,e=this;null===(t=this.$refs.ipInput)||void 0===t||t.validate(),this.$refs.taskForm.validate().then((function(t){return Ct(e,void 0,void 0,(function(){var t,e,i,r,n,a,o,s,l,c,u,d=this;return jt(this,(function(p){switch(p.label){case 0:for(this.loading=!0,t=this.formData.id?"updateAutomateTask":"createAutomateTask",e={},i=0,r=["task_name","vcenter","timeout"];i<r.length;i++)e[n=r[i]]=this.formData[n];e.ip_range=this.ipAdress.join("-"),a=this.formData,o=a.scanPeriod,s=a.beginTime,l=a.collectionFrequency,e.scan_cycle={value_type:o,value:"close"===o?"":"timing"===o?s:l},c=this.currentNode.id,e.bk_obj_id="ManageOne"===c?"mo_server":c,e.mate_type=this.getMateType(c),e.other_params={region_ids:this.formData.area,instance:this.formData.vcenter},this.formData.id&&(e.id=this.formData.id),e.credential=this.isCloud?[this.formData.credentialsId]:this.formData.credentialsId,e.access_point=this.accessPointList.find((function(t){return t.name===d.formData.access_point}))||{},p.label=1;case 1:return p.trys.push([1,,3,4]),[4,this.$api.modelSetting[t](e)];case 2:return(u=p.sent()).result?(this.visible=!1,this.$success(this.formData.id?"修改成功":"创建成功"),this.$emit("refresh"),[3,4]):[2,this.$error(u.message)];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))}))},e.prototype.getVcenterList=function(){return Ct(this,void 0,void 0,(function(){var t,e;return jt(this,(function(i){switch(i.label){case 0:return t=this.getBkObjIdParams({},"bk_obj_id"),[4,this.$api.modelSetting.getVcenterList(t)];case 1:return(e=i.sent()).result?(this.vcenterList=e.data.result,[2]):(this.$error(e.message),[2])}}))}))},e.prototype.getAutomateDetail=function(t){return Ct(this,void 0,void 0,(function(){var e;return jt(this,(function(i){switch(i.label){case 0:return[4,this.$api.modelSetting.getAutomateDetail({id:t})];case 1:return(e=i.sent()).result?(this.initPageData(e.data),[2]):(this.$error(e.message),[2])}}))}))},e.prototype.initPageData=function(t){var e,i,r,n,a=(null==t?void 0:t.ip_range)||"",o={task_name:(null==t?void 0:t.task_name)||"",scanPeriod:(null==t?void 0:t.cycle_value_type)||"close",collectionFrequency:"cycle"===(null==t?void 0:t.cycle_value_type)?t.cycle_value:1,beginTime:"timing"===(null==t?void 0:t.cycle_value_type)?t.cycle_value:"00:00",ip_range:a,evidence:[],vcenter:(null===(e=null==t?void 0:t.other_params)||void 0===e?void 0:e.instance)||"",credentialsId:this.isCloud?(null===(i=null==t?void 0:t.credential)||void 0===i?void 0:i.at())||"":(null==t?void 0:t.credential)||[],area:(null===(r=null==t?void 0:t.other_params)||void 0===r?void 0:r.region_ids)||[],access_point:(null===(n=null==t?void 0:t.access_point)||void 0===n?void 0:n.name)||""};if(null==t?void 0:t.timeout)o.timeout=null==t?void 0:t.timeout;else{var s=this.currentNode.id;o.timeout=["mysql","oracle","redis"].includes(s)?10:"vmware_vc"===s?60:"network"===s?20:0}if(a.includes("-"))this.ipAdress=a.split("-");else if(a.includes("/")){this.ipAdress=a.split("/");var l=this.ipAdress.at().split("."),c="";l.forEach((function(t,e){e<3&&(c=c+t+".")})),this.ipAdress[1]=c+this.ipAdress.at(-1)}else this.ipAdress=[a,a];this.typeItem.isEdit&&(o.id=t.id),this.formData=o,this.initData=this.$copy(this.formData)},Ot([Object(n.d)({})],e.prototype,"currentNode",void 0),Ot([Object(n.d)({type:Array,default:function(){return[]}})],e.prototype,"evidenceFormParams",void 0),Ot([Object(n.d)({type:Number,default:function(){return-1}})],e.prototype,"moduleCredDesign",void 0),e=Ot([Object(n.a)({components:{AddResource:yt.a,VoucherDialog:vt.a,IpInput:Dt}})],e)}(n.e),$t=Lt,It=Object(c.a)($t,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("bk-sideslider",{attrs:{width:700,"quick-close":!0,"before-close":t.handleClose,"is-show":t.visible,"ext-cls":"common-dialog-wrapper"},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n            "+t._s(t.formData.id?"修改":"新建")+"任务\n            "),t.formData.id?i("span",{staticClass:"sub-title"},[t._v("\n                - "+t._s(t.initData.task_name)+"\n            ")]):t._e()]),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:1},expression:"{ isLoading: pageLoading, zIndex: 1 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"taskForm",attrs:{"label-width":t.isManageOne?136:100,rules:t.rules,model:t.formData}},[i("bk-form-item",{attrs:{label:"任务名称",required:"",property:"task_name","error-display-type":"normal"}},[i("bk-input",{attrs:{clearable:"",placeholder:"请输入任务名称"},model:{value:t.formData.task_name,callback:function(e){t.$set(t.formData,"task_name",e)},expression:"formData.task_name"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"扫描周期",required:""}},[i("bk-radio-group",{model:{value:t.formData.scanPeriod,callback:function(e){t.$set(t.formData,"scanPeriod",e)},expression:"formData.scanPeriod"}},[i("div",{staticClass:"radio-item"},[i("bk-radio",{attrs:{value:"timing"}},[t._v("每天一次，在\n                                "),i("bk-time-picker",{staticStyle:{"margin-left":"4px"},attrs:{clearable:!1,placeholder:"选择时间",transfer:"","ext-popover-cls":"custom-popover-cls",format:"HH:mm"},model:{value:t.formData.beginTime,callback:function(e){t.$set(t.formData,"beginTime",e)},expression:"formData.beginTime"}})],1)],1),t._v(" "),i("div",{staticClass:"radio-item"},[i("bk-radio",{attrs:{value:"cycle"}},[t._v("每")]),t._v(" "),i("bk-select",{staticStyle:{width:"64px",margin:"0 4px"},attrs:{clearable:!1,placeholder:"请选择"},model:{value:t.formData.collectionFrequency,callback:function(e){t.$set(t.formData,"collectionFrequency",e)},expression:"formData.collectionFrequency"}},t._l(t.frequencyList,(function(t){return i("bk-option",{key:"option"+t,attrs:{id:t,name:t}})})),1),i("span",{staticStyle:{"font-size":"14px"}},[t._v("小时一次")])],1),t._v(" "),i("div",{staticClass:"radio-item"},[i("bk-radio",{attrs:{value:"close"}},[t._v("不开启周期扫描")])],1)])],1),t._v(" "),t.isCloud?i("bk-form-item",{attrs:{label:t.isVmware?"Vcenter":t.isManageOne?"ManageOne平台":"云账号",required:"",property:t.isVmware?"vcenter":t.isManageOne?"manageOne":"cloud","error-display-type":"normal"}},[i("bk-select",{attrs:{disabled:t.typeItem.isEdit,placeholder:t.isVmware?"请选择Vcenter":t.isManageOne?"请选择ManageOne平台":"请选择云账号"},on:{change:t.handleVcenterChange},model:{value:t.formData.vcenter,callback:function(e){t.$set(t.formData,"vcenter",e)},expression:"formData.vcenter"}},[t._l(t.vcenterList,(function(t){return i("bk-option",{key:t.bk_inst_id,attrs:{id:t.bk_inst_id,name:t.bk_inst_name}})})),t._v(" "),i("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:t.handleCreate},slot:"extension"},[i("i",{staticClass:"bk-icon icon-plus-circle mr5"}),t._v(t._s("新建"+(t.isVmware?"vCenter":t.isManageOne?"ManageOne平台":"云账号"))+"\n                        ")])],2)],1):i("bk-form-item",{attrs:{label:"IP范围",required:"",property:"ip_adress","error-display-type":"normal"}},[i("IpInput",{ref:"ipInput",attrs:{value:t.ipAdress}})],1),t._v(" "),!t.isCloud||t.isCloud&&t.formData.vcenter?i("bk-form-item",{attrs:{label:"凭据",required:"",property:"credentialsId","error-display-type":"normal"}},[i("bk-select",{attrs:{searchable:"",multiple:!t.isCloud},on:{change:t.selectCredential},model:{value:t.formData.credentialsId,callback:function(e){t.$set(t.formData,"credentialsId",e)},expression:"formData.credentialsId"}},[t._l(t.voucherList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),t._v(" "),i("div",{staticClass:"credential-create",attrs:{slot:"extension"},slot:"extension"},[i("bk-button",{staticStyle:{color:"#63656e"},attrs:{icon:"plus-circle",text:"",disabled:t.isCloud&&!t.formData.vcenter},on:{click:t.createCredential}},[t._v("\n                                新建凭据\n                            ")])],1)],2)],1):t._e(),t._v(" "),["qcloud_cvm","aliyun_ecs"].includes(t.currentNode.id)?i("bk-form-item",{attrs:{label:"区域",required:"",property:"area","error-display-type":"normal"}},[i("div",{staticClass:"cloud-area"},[i("bk-select",{staticClass:"cloud-operate",attrs:{placeholder:"请选择云区域",searchable:"",multiple:""},model:{value:t.formData.area,callback:function(e){t.$set(t.formData,"area",e)},expression:"formData.area"}},t._l(t.areaList,(function(t){return i("bk-option",{key:t.resource_id,attrs:{id:t.resource_id,name:t.resource_name}})})),1),t._v(" "),t.refreshLoading?i("bk-spin",{attrs:{size:"mini"}}):i("bk-icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"刷新",expression:"'刷新'"}],staticClass:"icon-position",attrs:{type:"refresh"},on:{click:function(e){return t.getFieldsList("loading")}}})],1)]):t._e(),t._v(" "),!t.isCloud||t.isVmware?i("bk-form-item",{attrs:{label:"超时时间",required:"",property:"timeout","error-display-type":"normal",desc:"该超时时间为IP段内单个IP的扫描超时时间，超过该时长将跳过该IP的扫描。"}},[i("bk-input",{staticClass:"timeout-input",attrs:{type:"number",min:1,precision:0,clearable:"",placeholder:"请输入超时时长"},model:{value:t.formData.timeout,callback:function(e){t.$set(t.formData,"timeout",e)},expression:"formData.timeout"}}),t._v("\n                    s\n                ")],1):t._e(),t._v(" "),i("bk-form-item",{attrs:{label:"接入点",required:"",property:"access_point","error-display-type":"normal"}},[i("bk-select",{attrs:{placeholder:"请选择接入点",searchable:""},model:{value:t.formData.access_point,callback:function(e){t.$set(t.formData,"access_point",e)},expression:"formData.access_point"}},t._l(t.accessPointList,(function(t){return i("bk-option",{key:t.ip+t.name,attrs:{id:t.name,name:t.ip+"（"+t.name+"）"}})})),1)],1)],1)],1),t._v(" "),i("template",{slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{title:"确认",theme:"primary",loading:t.loading},on:{click:t.handleConfirm}},[t._v("\n                确认\n            ")]),t._v(" "),i("bk-button",{attrs:{type:"submit",theme:"default",title:"取消",disabled:t.loading},on:{click:function(e){return t.handleClose()}}},[t._v("\n                取消\n            ")])],1)],2),t._v(" "),i("AddResource",{ref:"addResource",on:{"on-success":t.createTargetSuccess}}),t._v(" "),i("VoucherDialog",{ref:"voucherDialog",attrs:{"module-cred-design":t.moduleCredDesign,"evidence-form-params":t.evidenceFormParams},on:{updateCredential:t.updateCredential}})],1)}),[],!1,null,"e16bcca2",null).exports,St=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Tt=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},At=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},Mt=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Pt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading=!1,e.searchValue="",e.pagination={current:1,count:0,limit:10},e.activeColumns=[],e.columns=[{label:"任务名称",key:"task_name"},{label:"Vcenter",key:"instance",showLabel:["vmware_vc"]},{label:"云账号",key:"instance",showLabel:["qcloud_cvm","aliyun_ecs"]},{label:"ManageOne平台",key:"instance",showLabel:["ManageOne"]},{label:"K8S集群",key:"k8s",scopedSlots:"cluster",showLabel:["k8s"]},{label:"执行状态",key:"exec_status",showLabel:["network","vmware_vc","mysql","oracle","mssql","redis","qcloud_cvm","aliyun_ecs","ManageOne"],filters:[{text:"未执行",value:0},{text:"正在采集",value:1},{text:"正在纳管",value:5},{text:"成功",value:2},{text:"异常",value:3},{text:"超时",value:4}],filterMultiple:!1,filterRemote:!0,scopedSlots:"status"},{label:"执行状态",key:"state",showLabel:["k8s"],scopedSlots:"status"},{label:"创建者",key:"create_by",showLabel:["k8s"]},{label:"创建者",key:"updated_by_cn",showLabel:["network","vmware_vc","mysql","oracle","mssql","redis","qcloud_cvm","aliyun_ecs","ManageOne"]},{label:"发现情况",key:"solution",minWidth:"120px",scopedSlots:"solution",showLabel:["k8s"]},{label:"执行时间",key:"exec_time",minWidth:"120px",showLabel:["network","vmware_vc","mysql","oracle","mssql","redis","qcloud_cvm","aliyun_ecs","ManageOne"]},{label:"操作",key:"operation",width:"200px",scopedSlots:"operation"}],e.dataList=[],e.clusterData=[],e.groupList=[],e.currentNode={},e.statusList=[],e.tableKey=String(new Date),e.statusMap={0:{bgColor:"#c4c6cc",displayStatus:"未执行"},1:{bgColor:"#3a84ff",displayStatus:"正在采集"},2:{bgColor:"#60c170",displayStatus:"成功"},3:{bgColor:"#fc5b5b",displayStatus:"异常"},4:{bgColor:"#fc5b5b",displayStatus:"超时"},5:{bgColor:"#3a84ff",displayStatus:"正在纳管"}},e.status="",e.moduleCredDesign=-1,e.evidenceFormParams=[],e.timer=null,e}return St(e,t),Object.defineProperty(e.prototype,"clusterMap",{get:function(){return Object.fromEntries(this.clusterData.map((function(t){return[t.bk_inst_id,t.bk_inst_name]})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isK8s",{get:function(){return"k8s"===this.currentNode.id},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){this.getObjGroupList(),this.getClusterData()},e.prototype.destroyed=function(){this.clearTimer()},e.prototype.clearTimer=function(){this.timer&&clearInterval(this.timer)},e.prototype.checkTopo=function(){this.btnForbidden||this.$router.push({name:"NetTopology",query:{mode:"edit",id:this.currentNode.id,name:this.currentNode.name}})},e.prototype.sourceFilterMethod=function(t){var e;this.status=null!==(e=Object.values(t).flat()[0])&&void 0!==e?e:"",this.statusList=t.state,this.pagination.current=1,this.getTaskList()},e.prototype.getStatus=function(t,e){var i;return(null===(i=this.statusMap[t])||void 0===i?void 0:i[e])||("bgColor"===e?"#c4c6cc":"--")},e.prototype.getObjGroupList=function(t){var e;return void 0===t&&(t={}),At(this,void 0,void 0,(function(){var i,r,n,a=this;return Mt(this,(function(o){return this.groupList=[{id:"k8s",name:"K8S",children:[]},{id:"network",name:"网络设备",children:[]},{id:"bk_database",name:"数据库",children:[{id:"redis",name:"Redis"},{id:"mysql",name:"MySQL"},{id:"oracle",name:"Oracle"}]},{id:"cloud",name:"云平台",children:[{id:"vmware_vc",name:"VMware"},{id:"qcloud_cvm",name:"腾讯云"},{id:"aliyun_ecs",name:"阿里云"},{id:"ManageOne",name:"ManageOne"}]}],i=this.groupList.at(0),r=null===(e=i.children)||void 0===e?void 0:e.at(0),n=t.id||(null==r?void 0:r.id)||i.id,this.$nextTick((function(){a.$refs.tree.setSelected(a.bkObjId||n),a.$refs.tree.setExpanded(a.bkObjId||n)})),[2]}))}))},e.prototype.beforeSelect=function(t){var e=t.data,i=t.id;return!["bk_database","cloud"].includes(i)&&(this.clearTimer(),this.currentNode=e,this.pagination.limit=10,this.pagination.current=1,this.searchValue="",this.status="",this.statusList=[],this.tableKey=String(new Date),this.activeColumns=this.columns.filter((function(t){var e;return(null===(e=t.showLabel)||void 0===e?void 0:e.includes(i))||!t.showLabel})),this.$refs.taskTable.updateColumns(this.activeColumns),"k8s"===i?this.getTaskList():this.getCredParams(),!0)},e.prototype.getClusterData=function(){var t;return At(this,void 0,void 0,(function(){var e;return Mt(this,(function(i){switch(i.label){case 0:return[4,this.$api.Resource.getOtherResourceList({bk_obj_id:"k8s_cluster",body:{page:1,page_size:20,bk_classification_id:"K8S"}})];case 1:return(e=i.sent()).result&&(this.clusterData=(null===(t=e.data)||void 0===t?void 0:t.info)||[]),[2]}}))}))},e.prototype.getTaskList=function(t){var e;return At(this,void 0,void 0,(function(){var i,r,n=this;return Mt(this,(function(a){switch(a.label){case 0:i=this.isK8s?"searchTask":"getAutomateList",this.loading="noLoading"!==t,this.clearTimer(),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.modelSetting[i]({page:this.pagination.current,page_size:this.pagination.limit,task_name:this.searchValue,exec_status:this.status,bk_obj_id:"ManageOne"===this.currentNode.id?"mo_server":this.currentNode.id})];case 2:return(r=a.sent()).result?(this.dataList=null===(e=r.data)||void 0===e?void 0:e.items,this.pagination.count=r.data.count,this.clearTimer(),this.dataList.some((function(t){return n.showLoading(t)}))&&(this.timer=setInterval((function(){n.getTaskList("noLoading")}),3e3)),[3,4]):(this.dataList=[],this.pagination.count=0,[2,this.$error(r.message)]);case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.prototype.handleModifyTask=function(t){this.btnForbidden||(this.isK8s?this.$refs.addTask.showSlider(t):this.$refs.taskOperation.showSlider(t))},e.prototype.handleRunTask=function(t){return At(this,void 0,void 0,(function(){var e,i;return Mt(this,(function(r){switch(r.label){case 0:if(this.btnForbidden)return[2];this.$set(t,"loading",!0),e=this.isK8s?"runTask":"runAutomateTask",r.label=1;case 1:return r.trys.push([1,,4,5]),[4,this.$api.modelSetting[e]({id:t.id})];case 2:return(i=r.sent()).result?(this.$success("执行任务成功"),[4,this.getTaskList()]):[2,this.$error(i.message)];case 3:return r.sent(),[3,5];case 4:return this.isK8s&&(t.loading=!1),[7];case 5:return[2]}}))}))},e.prototype.showLoading=function(t){return this.isK8s?t.loading||!!t.process_status:[1,5].includes(t.exec_status)},e.prototype.handleSearch=function(){this.pagination.current=1,this.getTaskList()},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getTaskList()},e.prototype.handleLimitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getTaskList()},e.prototype.handleDelete=function(t){var e=this;this.btnForbidden||this.$bkInfo({title:"提示",subTitle:"确定删除该任务吗？",theme:"primary",confirmFn:function(){e.confirmDelete(t.id)}})},e.prototype.confirmDelete=function(t){return At(this,void 0,void 0,(function(){var e,i;return Mt(this,(function(r){switch(r.label){case 0:return e=this.isK8s?"deleteTask":"deleteAutomateTask",[4,this.$api.modelSetting[e]({id:t})];case 1:return(i=r.sent()).result?(this.$success("删除成功"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,[4,this.getTaskList()]):[2,this.$error(i.message)];case 2:return r.sent(),[2]}}))}))},e.prototype.getCredParams=function(){var t=this;this.$api.remoteConnect.getCredParams({bk_obj_id:this.currentNode.id}).then((function(e){var i=e.result,r=e.data;if(!i)return t.dataList=[],t.$error(e.message);t.moduleCredDesign=r.module_cred_design,t.evidenceFormParams=r.params,t.getTaskList()}))},Tt([Object(n.d)({type:String,default:function(){return""}})],e.prototype,"bkObjId",void 0),e=Tt([Object(n.a)({components:{AddTask:bt,TaskOperation:It,ComTable:y.a},deactivated:function(){this.clearTimer()},activated:function(){this.getTaskList()}})],e)}(W.a),Et=Pt,Rt=Object(c.a)(Et,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"auto-discovery-wrapper"},[i("div",{staticClass:"model-list"},[i("bk-big-tree",{ref:"tree",attrs:{data:t.groupList,"enable-title-tip":"",selectable:!0,"show-checkbox":!1,"show-link-line":!1,"use-default-empty":!0,options:{idKey:"id",nameKey:"name"},"before-select":t.beforeSelect},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.node,n=e.data;return r.level?i("div",{staticClass:"tree-node"},[i("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"tree-node-name"},[t._v(t._s(n.name))])]):t._e()}}],null,!0)})],1),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"auto-discovery-header"},[i("div",{staticClass:"header-left"},[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.handleModifyTask()}}},[t._v("\n                    新建任务\n                ")]),t._v(" "),"network"===t.currentNode.id?i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"ml10",on:{click:t.checkTopo}},[t._v("\n                    网络拓扑\n                ")]):t._e()],1),t._v(" "),i("bk-input",{staticStyle:{width:"350px"},attrs:{clearable:"",placeholder:"请输入任务名","right-icon":"bk-icon icon-search"},on:{clear:t.handleSearch,"right-icon-click":t.handleSearch,enter:t.handleSearch},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1),t._v(" "),i("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],key:t.tableKey,ref:"taskTable",attrs:{data:t.dataList,columns:t.activeColumns,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.handleLimitChange,"filter-change":t.sourceFilterMethod},scopedSlots:t._u([{key:"cluster",fn:function(e){var i=e.row;return[t._v("\n                "+t._s(t.clusterMap[i.bk_cluster]||"--")+"\n            ")]}},{key:"status",fn:function(e){var r=e.row;return[t.isK8s?i("div",{staticClass:"run-status"},[i("span",{staticClass:"status",style:{background:1===r.state?"#60c170":2===r.state?"#fc5b5b":"--"}}),t._v("\n                    "+t._s(1===r.state?"正常":2===r.state?"失败":"--")+"\n                ")]):i("div",{staticClass:"run-status"},[1===r.exec_status?i("bk-progress",{staticStyle:{width:"100%"},attrs:{"text-inside":!0,percent:(r.percent||0)/100}}):[i("span",{staticClass:"status",style:{background:t.getStatus(r.exec_status,"bgColor")}}),t._v("\n                        "+t._s(t.getStatus(r.exec_status,"displayStatus"))+"\n                    ")]],2)]}},{key:"solution",fn:function(e){var i=e.row;return[t._v("\n                namespace："+t._s(i.namespace_count)+"，node："+t._s(i.node_count)+"，pod："+t._s(i.pod_count)+"，workload："+t._s(i.workload_count)+"\n            ")]}},{key:"operation",fn:function(e){var r=e.row;return[i("div",{staticStyle:{display:"flex"}},[t.showLoading(r)?i("div",[i("bk-spin",{attrs:{size:"mini"}}),t._v(" "),i("bk-button",{staticClass:"mr10",staticStyle:{color:"#575961"},attrs:{theme:"primary",text:""}},[t._v("正在执行")])],1):i("div",[i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10 pd-l-16",attrs:{text:"",theme:"primary"},on:{click:function(e){return t.handleRunTask(r)}}},[t._v("\n                            立即执行\n                        ")])],1),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{text:"",theme:"primary",disabled:t.showLoading(r)},on:{click:function(e){return t.handleModifyTask(r)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{text:"",theme:"primary",disabled:t.showLoading(r)},on:{click:function(e){return t.handleDelete(r)}}},[t._v("\n                        删除\n                    ")])],1)]}}])})],1),t._v(" "),i("add-task",{ref:"addTask",attrs:{"cluster-data":t.clusterData},on:{refresh:t.getTaskList}}),t._v(" "),i("task-operation",{ref:"taskOperation",attrs:{"current-node":t.currentNode,"evidence-form-params":t.evidenceFormParams,"module-cred-design":t.moduleCredDesign},on:{refresh:t.getTaskList}})],1)}),[],!1,null,"0e35bbeb",null).exports,qt=i("ac6i"),Ft=i("uMZD"),Nt=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Vt=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},Gt=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},zt=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Bt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.deviceTypeList=[{text:"交换机",value:"switch"},{text:"路由器",value:"router"},{text:"防火墙",value:"firewall"},{text:"负载均衡",value:"loadbalancer"}],e.isShow=!1,e.formData={oid:"",device_type:"",brand:"",model:""},e.rules={device_type:[{required:!0,message:"必填项",trigger:"blur"}],oid:[{required:!0,message:"必填项",trigger:"blur"}],brand:[{required:!0,message:"必填项",trigger:"blur"}],model:[{required:!0,message:"必填项",trigger:"blur"}]},e.loading=!1,e.currentType="add",e.formDataV2={},e.oidDetail="",e}return Nt(e,t),Object.defineProperty(e.prototype,"isAdd",{get:function(){return"add"===this.currentType},enumerable:!1,configurable:!0}),e.prototype.show=function(t,e){return Gt(this,void 0,void 0,(function(){return zt(this,(function(i){return this.currentType=t,this.isShow=!0,this.formData={oid:"",device_type:"",brand:"",model:""},this.isAdd||(this.oidDetail=e,this.formData={oid:e.oid,device_type:e.device_type,brand:e.brand,model:e.model}),this.formDataV2=JSON.parse(JSON.stringify(this.formData)),[2]}))}))},e.prototype.confirm=function(){var t=this;this.$refs.validateForm.validate().then((function(e){var i={device_type:t.formData.device_type,model:t.formData.model,oid:t.formData.oid,brand:t.formData.brand},r={};t.isAdd||(r={id:t.oidDetail.id,body:i}),t.operateOid(t.isAdd?i:r)}))},e.prototype.operateOid=function(t){var e=this;this.loading=!0,this.$api.oid[this.isAdd?"createOid":"modifyOid"](t).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("".concat(e.isAdd?"新增":"编辑","映射成功!")),e.isShow=!1,e.$emit("refreshList")})).finally((function(){e.loading=!1}))},e.prototype.cancel=function(){var t=this;this.$compareFormData(this.formData,this.formDataV2)?this.isShow=!1:this.$bkInfo({title:"是否放弃本次操作？",subTitle:"放弃将导致未保存信息丢失",theme:"primary",confirmFn:function(){t.isShow=!1}})},e=Vt([Object(n.a)({name:"operateOid"})],e)}(n.e),Kt=Bt,Ht=Object(c.a)(Kt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bk-sideslider",{attrs:{width:650,"is-show":t.isShow,"before-close":t.cancel,"quick-close":!0},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s((t.isAdd?"新建":"编辑")+"映射"))]),t._v(" "),i("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"validateForm",staticStyle:{flex:"1","padding-bottom":"20px"},attrs:{"label-width":110,model:t.formData,rules:t.rules}},[i("bk-form-item",{attrs:{label:"设备类型",required:"",property:"device_type","error-display-type":"normal"}},[i("bk-select",{model:{value:t.formData.device_type,callback:function(e){t.$set(t.formData,"device_type",e)},expression:"formData.device_type"}},t._l(t.deviceTypeList,(function(t){return i("bk-option",{key:t.value,attrs:{id:t.value,name:t.text}})})),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:"sysObjectID",required:"",property:"oid","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入id"},model:{value:t.formData.oid,callback:function(e){t.$set(t.formData,"oid",e)},expression:"formData.oid"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"品牌",required:"",property:"brand","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入品牌"},model:{value:t.formData.brand,callback:function(e){t.$set(t.formData,"brand",e)},expression:"formData.brand"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:"型号",required:"",property:"model","error-display-type":"normal"}},[i("bk-input",{attrs:{placeholder:"请输入型号"},model:{value:t.formData.model,callback:function(e){t.$set(t.formData,"model",e)},expression:"formData.model"}})],1)],1),t._v(" "),i("div",{staticClass:"foot-box"},[i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:t.cancel}},[t._v("\n                取消\n            ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{loading:t.loading,disabled:t.loading,theme:"primary"},on:{click:t.confirm}},[t._v("\n                确认\n            ")])],1)],1)])}),[],!1,null,"1818e1a4",null).exports,Ut=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Wt=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},Jt=function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},Zt=function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Qt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tableLoading=!1,e.dataList=[],e.columns=[{label:"型号",key:"model",align:"left",minWidth:"120px"},{label:"sysObjectID",key:"oid",align:"left",minWidth:"100px"},{label:"品牌",key:"brand",align:"left",minWidth:"150px"},{label:"设备类型",key:"device_type",align:"left",minWidth:"100px",filterable:!0,filterMultiple:!1,filterRemote:!0,filters:[{text:"交换机",value:"switch"},{text:"路由器",value:"router"},{text:"防火墙",value:"firewall"},{text:"负载均衡",value:"loadbalancer"}],scopedSlots:"device_type"},{label:"操作",key:"operation",align:"left",width:"150px",scopedSlots:"operation",fixed:"right"}],e.deviceTypeMap={switch:"交换机",router:"路由器",firewall:"防火墙",loadbalancer:"负载均衡"},e.maxHeight="",e.pagination={current:1,count:1,limit:20},e.searchKey="",e.deviceType="",e.filterType="version",e.filterTypeList=[{id:"version",label:"型号"},{id:"oid",label:"OID"},{id:"brand",label:"品牌"}],e}return Ut(e,t),e.prototype.mounted=function(){var t=this;this.maxHeight=window.innerHeight-240,window.onresize=function(){t.maxHeight=window.innerHeight-240},this.getList()},e.prototype.operateMap=function(t,e){this.$refs.operateOid.show(t,e)},e.prototype.delMap=function(t){var e=this;this.$bkInfo({title:"确认要删除该映射？",confirmLoading:!0,confirmFn:function(){return Jt(e,void 0,void 0,(function(){return Zt(this,(function(e){switch(e.label){case 0:return[4,this.confirmDelete(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmDelete=function(t){return Jt(this,void 0,void 0,(function(){var e;return Zt(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$api.oid.deleteOid({id:t.id})];case 1:return(e=i.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getList()):this.$error(e.message),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.getList=function(){var t=this,e={page:this.pagination.current,page_size:this.pagination.limit,model:"version"===this.filterType?this.searchKey:"",oid:"oid"===this.filterType?this.searchKey:"",brand:"brand"===this.filterType?this.searchKey:"",device_type:this.deviceType};this.$api.oid.getOid(e).then((function(e){var i=e.result,r=e.data;if(!i)return!1;t.dataList=r.items,t.pagination.count=r.count}))},e.prototype.filterChange=function(t){this.deviceType=t.device_type.length?t.device_type[0]:"",this.getList()},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getList()},e.prototype.limitChange=function(t){this.pagination.limit=t,this.pagination.current=1,this.getList()},e=Wt([Object(n.a)({components:{ComTable:y.a,OperateOid:Ht}})],e)}(n.e),Xt=Qt,Yt=Object(c.a)(Xt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"oid"},[i("div",{staticClass:"action-bar"},[i("bk-button",{staticClass:"mr20",attrs:{theme:"primary"},on:{click:function(e){return t.operateMap("add")}}},[t._v("\n            新建映射\n        ")]),t._v(" "),i("div",{staticClass:"search-box"},[i("bk-select",{staticStyle:{width:"100px"},attrs:{disabled:!1,"ext-cls":"select-custom",clearable:!1,"ext-popover-cls":"select-popover-custom"},model:{value:t.filterType,callback:function(e){t.filterType=e},expression:"filterType"}},t._l(t.filterTypeList,(function(t){return i("bk-option",{key:t.id,attrs:{id:t.id,name:t.label}})})),1),t._v(" "),i("bk-input",{attrs:{clearable:!0},on:{enter:t.getList,clear:t.getList},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1)],1),t._v(" "),i("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"sourceTable",staticClass:"com-table",attrs:{id:"center_table",data:t.dataList,columns:t.columns,"max-height":t.maxHeight,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange,"filter-change":t.filterChange},scopedSlots:t._u([{key:"device_type",fn:function(e){var r=e.row;return[i("span",[t._v(t._s(t.deviceTypeMap[r.device_type]))])]}},{key:"operation",fn:function(e){var r=e.row;return[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.operateMap("edit",r)}}},[t._v("\n                修改\n            ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{disabled:r.built_in,theme:"primary",text:""},on:{click:function(e){return t.delMap(r)}}},[t._v("\n                删除\n            ")])]}}])}),t._v(" "),i("operate-oid",{ref:"operateOid",on:{refreshList:t.getList}})],1)}),[],!1,null,"5e4f9615",null).exports,te=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ee=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},ie=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.menuList=[{label:"模型管理",name:"model",belongModule:"senior_resource",show:!0},{label:"自动发现",name:"autoDiscovery",belongModule:"resource",show:!0},{label:"OID库",name:"oid",belongModule:"resource",show:!0}],e.active="model",e.bkObjId="",e}return te(e,t),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),e.prototype.created=function(){var t=this;this.menuList.forEach((function(e){t.userInfo.applications.includes(e.belongModule)||(e.show=!1)})),this.menuList=this.menuList.filter((function(t){return t.show})),this.active=this.menuList[0].name;var e=this.$route.query.bkObjId;e&&(this.active="autoDiscovery",this.bkObjId="VMware"===e?"vmware_vc":e)},e.prototype.toTabMenu=function(t){this.active=t.name},e=ee([Object(n.a)({name:"asset-model",components:{menuTab:qt.a,HeaderSub:Ft.a,ModelManage:ct,AutoDiscovery:Rt,OidManage:Yt},beforeRouteLeave:function(t,e,i){this.$handleKeepAlive(t,e),i()},deactivated:function(){this.$refs.discovery.clearTimer()}})],e)}(n.e),re=ie,ne=Object(c.a)(re,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"model-manage-index"},[i("header-sub",{staticClass:"model-manage-index-header"},[i("template",{slot:"title"},[i("menu-tab",{attrs:{panels:t.menuList,type:"line","active-panel":t.active},on:{click:t.toTabMenu}})],1)],2),t._v(" "),i("div",{staticClass:"show-box"},["model"===t.active?i("model-manage"):"oid"===t.active?i("oid-manage"):i("auto-discovery",{ref:"discovery",attrs:{"bk-obj-id":t.bkObjId}})],1)],1)}),[],!1,null,"7e105887",null);e.default=ne.exports}}]);