(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{iVVM:function(t,e,a){"use strict";a.r(e);var o,r=a("JnIg"),i=a("jqkw"),n=a("G0B5"),s=(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}),l=function(t,e,a,o){var r,i=arguments.length,n=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,a,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(n=(i<3?r(n):i>3?r(e,a,n):r(e,a))||n);return i>3&&n&&Object.defineProperty(e,a,n),n},c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.windowSType=[{name:"PowerShell",lang:"powershell"},{name:"Bat",lang:"bat"}],e.linuxType=[{name:"Shell",lang:"shell"},{name:"Python",lang:"python"}],e.formData={PowerShell:"",Bat:"",Shell:"",Python:""},e.activeType="PowerShell",e.monacoEditor=null,e.isValidate=!1,e}return s(e,t),Object.defineProperty(e.prototype,"editorValue",{get:function(){return this.monacoEditor?this.monacoEditor.getValue():""},enumerable:!1,configurable:!0}),e.prototype.onSystemTypeChanged=function(t){this.activeType="Windows"===t?"PowerShell":"Shell",this.setValue()},e.prototype.onDefaultActiveChanged=function(t){this.activeType=t},e.prototype.onValueChanged=function(t){this.monacoEditor.setValue(t)},e.prototype.onEditorValueChanged=function(t){this.$emit("refreshEditorValue",t)},e.prototype.mounted=function(){this.monacoEditor=i.a.create(this.$refs.container,{value:this.value,language:"sql",theme:"vs-dark"})},e.prototype.setValue=function(){"Python"===this.activeType&&0===this.editorValue.trim().length&&this.monacoEditor.setValue("#!/usr/bin/env python\r\n# -*- coding: utf8 -*-"),"Shell"===this.activeType&&0===this.editorValue.trim().length&&this.monacoEditor.setValue("#!/bin/bash")},e.prototype.toggleType=function(t){this.formData[this.activeType]=this.editorValue,this.activeType=t.name,this.monacoEditor.setValue(this.formData[this.activeType]),this.setValue(),i.a.setModelLanguage(this.monacoEditor.getModel(),t.lang)},e.prototype.validate=function(){this.isValidate=0===this.editorValue.trim().length,this.$emit("getEditValue",this.editorValue,this.activeType)},e.prototype.clearEditValue=function(){this.monacoEditor.setValue("")},l([Object(n.d)({type:String,default:function(){return""}})],e.prototype,"value",void 0),l([Object(n.d)({type:String})],e.prototype,"systemType",void 0),l([Object(n.d)({type:String})],e.prototype,"defaultActive",void 0),l([Object(n.d)({type:Boolean,default:function(){return!1}})],e.prototype,"hasYScroll",void 0),l([Object(n.d)({type:Boolean,default:function(){return!0}})],e.prototype,"isOperateSystem",void 0),l([Object(n.f)("systemType")],e.prototype,"onSystemTypeChanged",null),l([Object(n.f)("defaultActive")],e.prototype,"onDefaultActiveChanged",null),l([Object(n.f)("value")],e.prototype,"onValueChanged",null),l([Object(n.f)("editorValue")],e.prototype,"onEditorValueChanged",null),e=l([Object(n.a)({name:"monaco-editor"})],e)}(n.e),p=c,u=a("KHd+"),m=Object(u.a)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"code-editor-wrapper",attrs:{id:"editor"}},[t.isOperateSystem?a("div",{class:["code-editor-type",t.hasYScroll&&"code-editor-width"]},[a("ul",t._l("Windows"===t.systemType?t.windowSType:t.linuxType,(function(e){return a("li",{key:e.name,class:[t.activeType===e.name&&"active"],on:{click:function(a){return t.toggleType(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])})),0)]):t._e(),t._v(" "),a("div",{ref:"container",staticClass:"my-editor"}),t._v(" "),t.isValidate?a("span",{staticStyle:{color:"#ea3636","font-size":"12px"}},[t._v("请输入脚本内容")]):t._e()])}),[],!1,null,"9f1c3a94",null).exports,d=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function o(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(o.prototype=a.prototype,new o)}}(),f=function(){return f=Object.assign||function(t){for(var e,a=1,o=arguments.length;a<o;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},f.apply(this,arguments)},h=function(t,e,a,o){var r,i=arguments.length,n=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,a,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(n=(i<3?r(n):i>3?r(e,a,n):r(e,a))||n);return i>3&&n&&Object.defineProperty(e,a,n),n},y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.paramsType="add",e.paramsVisible=!1,e.paramsFormData={id:"",paramName:"",defaultParam:"",encryption:!1,tip:""},e.paramsRules={paramName:[{required:!0,message:"必填项",trigger:"blur"}],defaultParam:[{required:!0,message:"必填项",trigger:"blur"}]},e.isShow=!1,e.loading=!1,e.formData={tool_name:"",tool_type:[],host_type:"Windows",describe:"",content:"",content_type:"",contentTypeMap:"",params:[],protocolType:""},e.monacoEditorValue="",e.monacoEditorValueV2="",e.rules={tool_name:[{required:!0,message:"必填项",trigger:"blur"}],tool_type:[{required:!0,message:"必填项",trigger:"blur"}],host_type:[{required:!0,message:"必填项",trigger:"blur"}],protocolType:[{required:!0,message:"必填项",trigger:"blur"}]},e.operateSystemList=[{id:"Windows",name:"Windows"},{id:"Linux",name:"Linux"}],e.protocolTypeList=[{id:7,name:"Telnet"},{id:6,name:"SSH"}],e.tagList=["MySQL","Oracle","Exchange"],e.networkDeviceTagList=["交换机","防火墙","路由器","负载均衡"],e.operateType="",e.toolInfo="",e.scriptParams=[],e.scriptParamsV2=[],e.scriptParamsMap={Shell:1,Bat:2,Python:4,PowerShell:5},e.scriptMap={1:"Shell",2:"Bat",4:"Python",5:"PowerShell"},e.hasYScroll=!1,e.formDataV2={},e}return d(e,t),e.prototype.changeProtocolType=function(){this.scriptParams[this.scriptParams.length-1].defaultParam=6===this.formData.protocolType?"22":"23"},e.prototype.beforeClose=function(){var t=this,e=this.$compareFormData(this.formData,this.formDataV2),a=this.$compareFormData(this.scriptParams,this.scriptParamsV2),o=this.$compareFormData(this.monacoEditorValue,this.monacoEditorValueV2);a&&e&&o?this.isShow=!1:this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){return t.isShow=!1,!0}})},e.prototype.editScriptParams=function(t){this.paramsVisible=!0,this.paramsType="edit",this.paramsFormData={id:t.id,paramName:t.paramName,defaultParam:t.defaultParam,encryption:t.encryption,tip:t.tip,isRequired:t.isRequired},this.$refs.validateParamsForm.clearError()},e.prototype.confirmParams=function(){var t=this;this.$refs.validateParamsForm.validate().then((function(e){if("add"===t.paramsType)t.scriptParams.push({id:t.$random(5),paramName:t.paramsFormData.paramName,defaultParam:t.paramsFormData.defaultParam,encryption:t.paramsFormData.encryption,tip:t.paramsFormData.tip});else{var a=t.scriptParams.findIndex((function(e){return e.id===t.paramsFormData.id}));t.scriptParams[a]={id:t.paramsFormData.id,paramName:t.paramsFormData.paramName,defaultParam:t.paramsFormData.defaultParam,encryption:t.paramsFormData.encryption,tip:t.paramsFormData.tip}}t.paramsVisible=!1,t.getYScroll()}))},e.prototype.closeParamsDialog=function(){this.paramsVisible=!1},e.prototype.validateScriptParams=function(t){this.$set(t,"isValidate",!(0===t.value.trim().length))},e.prototype.deleteScriptParams=function(t,e){if(t.disabledDel)return!1;this.scriptParams.splice(e,1),this.getYScroll()},e.prototype.addScriptParams=function(){this.paramsType="add",this.paramsVisible=!0,this.paramsFormData={paramName:"",defaultParam:"",encryption:!1,tip:""}},e.prototype.getEditValue=function(t,e){this.formData.content=t,this.formData.content_type=e},e.prototype.refreshEditorValue=function(t){this.monacoEditorValue=t},e.prototype.changeSystem=function(){this.$refs.monacoEditor.clearEditValue()},e.prototype.show=function(t,e){var a=this;this.isShow=!0,this.operateType=t,this.toolInfo=e,this.getToolType(),"edit"===this.operateType?this.getToolDetail():(this.scriptParamsV2=JSON.parse(JSON.stringify(this.scriptParams)),this.formDataV2=JSON.parse(JSON.stringify(this.formData)),this.monacoEditorValueV2=JSON.parse(JSON.stringify(this.monacoEditorValue))),setTimeout((function(){a.getYScroll()}),500)},e.prototype.getToolDetail=function(){var t=this;this.loading=!0,this.$api.maintainTool.getToolDetail({id:this.toolInfo.id}).then((function(e){if(!e.result)return t.$error(e.message),!1;var a=e.data;t.formData={tool_name:a.tool_name,tool_type:a.labels,host_type:a.host_type,describe:a.describe,content:a.content,content_type:"",contentTypeMap:t.scriptMap[a.content_type],params:[],protocolType:a.content_type},t.scriptParams=a.params.map((function(e){return{id:t.$random(5),paramName:e.param_name||e,defaultParam:e.default_param||"",encryption:e.encryption||!1,tip:e.tip||""}})),t.monacoEditorValueV2=JSON.parse(JSON.stringify(t.formData.content)),t.formDataV2=JSON.parse(JSON.stringify(t.formData)),t.scriptParamsV2=JSON.parse(JSON.stringify(t.scriptParams))})).finally((function(){t.loading=!1}))},e.prototype.hiddenSlider=function(){Object.assign(this.$data,this.$options.data.call(this)),this.$refs.validateForm&&this.$refs.validateForm.clearError()},e.prototype.getYScroll=function(){var t=this;this.$nextTick((function(){var e=document.getElementById("mainBox");e&&(t.hasYScroll=e.scrollHeight>(e.innerHeight||e.clientHeight))}))},e.prototype.getToolType=function(){var t=this;this.$api.maintainTool.getAllTypeAndTag().then((function(e){if(!e.result)return!1;e.data[0].labels.forEach((function(e){t.tagList.includes(e)||t.tagList.push(e)}))}))},e.prototype.confirm=function(){var t=this;this.$refs.monacoEditor.validate(),this.$refs.validateForm.validate().then((function(e){if(0===t.formData.content.trim().length)return!1;t.scriptParams.length>0&&(t.formData.params=t.scriptParams.map((function(t){return{param_name:t.paramName,default_param:t.defaultParam,encryption:t.encryption,tip:t.tip}})));var a={},o={tool_name:t.formData.tool_name,labels:t.formData.tool_type,describe:t.formData.describe,host_type:t.isOperateSystem?t.formData.host_type:"network",content:t.formData.content,content_type:t.isOperateSystem?t.scriptParamsMap[t.formData.content_type]:t.formData.protocolType,params:t.formData.params,property_type:t.isOperateSystem?0:1},r="add"===t.operateType?"createTool":"modifyTool";"add"===t.operateType?a=f({},o):(a.body=o,a.id=t.toolInfo.id),t.save(r,a)}))},e.prototype.save=function(t,e){var a=this;this.loading=!0,this.$api.maintainTool[t](e).then((function(t){if(!t.result)return a.$error(t.message),!1;var e="add"===a.operateType?"新增工具成功":"修改工具成功";a.$success(e),a.$emit("refreshData"),a.isShow=!1})).finally((function(){a.loading=!1}))},h([Object(n.d)({type:Boolean,default:function(){return!0}})],e.prototype,"isOperateSystem",void 0),e=h([Object(n.a)({name:"operate-tool",components:{MonacoEditor:m}})],e)}(n.e),b=y,g=Object(u.a)(b,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("bk-sideslider",{attrs:{"is-show":t.isShow,"quick-close":!1,title:"add"===t.operateType?"新增工具":"编辑工具",width:700,"before-close":t.beforeClose},on:{"update:isShow":function(e){t.isShow=e},"update:is-show":function(e){t.isShow=e},hidden:t.hiddenSlider}},[a("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"main-box",attrs:{id:"mainBox"}},[a("bk-form",{ref:"validateForm",attrs:{"label-width":100,model:t.formData,rules:t.rules}},[a("bk-form-item",{attrs:{label:"工具名:",required:!0,property:"tool_name"}},[a("bk-input",{attrs:{placeholder:"请输入工具名称"},model:{value:t.formData.tool_name,callback:function(e){t.$set(t.formData,"tool_name",e)},expression:"formData.tool_name"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"标签:",required:!0,property:"tool_type"}},[a("bk-select",{attrs:{placeholder:"请选择标签",multiple:""},model:{value:t.formData.tool_type,callback:function(e){t.$set(t.formData,"tool_type",e)},expression:"formData.tool_type"}},t._l(t.isOperateSystem?t.tagList:t.networkDeviceTagList,(function(t){return a("bk-option",{key:t,attrs:{id:t,name:t}})})),1)],1),t._v(" "),a("bk-form-item",{attrs:{label:"工具介绍:"}},[a("bk-input",{attrs:{placeholder:"请输入工具介绍",type:"textarea"},model:{value:t.formData.describe,callback:function(e){t.$set(t.formData,"describe",e)},expression:"formData.describe"}})],1),t._v(" "),t.isOperateSystem?a("bk-form-item",{attrs:{label:"操作系统:",required:!0,property:"host_type"}},[a("bk-select",{attrs:{placeholder:"请选择操作系统"},on:{change:t.changeSystem},model:{value:t.formData.host_type,callback:function(e){t.$set(t.formData,"host_type",e)},expression:"formData.host_type"}},t._l(t.operateSystemList,(function(t){return a("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1):a("bk-form-item",{attrs:{label:"协议类型:",required:!0,property:"protocolType"}},[a("bk-select",{attrs:{placeholder:"请选择协议类型"},on:{change:t.changeProtocolType},model:{value:t.formData.protocolType,callback:function(e){t.$set(t.formData,"protocolType",e)},expression:"formData.protocolType"}},t._l(t.protocolTypeList,(function(t){return a("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1),t._v(" "),a("bk-form-item",{attrs:{label:"脚本内容:",required:!0}},[a("monaco-editor",{ref:"monacoEditor",attrs:{"system-type":t.formData.host_type,value:t.formData.content,"default-active":t.formData.contentTypeMap,"has-y-scroll":t.hasYScroll,"is-operate-system":t.isOperateSystem},on:{getEditValue:t.getEditValue,refreshEditorValue:t.refreshEditorValue}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"参数定义:"}},[a("div",{staticClass:"params-define"},[0===t.scriptParams.length?a("i",{staticClass:"cw-icon weops-add normal-add",staticStyle:{"font-size":"24px",cursor:"pointer"},on:{click:t.addScriptParams}}):t._e(),t._v(" "),t._l(t.scriptParams,(function(e,o){return a("div",{key:e.id,staticClass:"params-list"},[a("span",{staticClass:"required-icon"},[t._v("*")]),t._v(" "),a("span",[t._v(t._s("第"+(o+1)+"位置参数名称"))]),t._v(" "),a("div",{staticClass:"show-btn",on:{click:function(a){return t.editScriptParams(e)}}},[t._v("\n                                    "+t._s(e.paramName)+"\n                                ")]),t._v(" "),a("i",{staticClass:"cw-icon weops-add",staticStyle:{"font-size":"24px",cursor:"pointer"},on:{click:t.addScriptParams}}),t._v(" "),a("i",{class:["cw-icon","weops-reduce",e.disabledDel&&"disabled-del"],staticStyle:{"font-size":"24px",cursor:"pointer","margin-left":"5px"},on:{click:function(a){return t.deleteScriptParams(e,o)}}})])}))],2)])],1)],1),t._v(" "),a("div",{staticClass:"footer-box"},[a("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:t.beforeClose}},[t._v("\n                    取消\n                ")]),t._v(" "),a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:"确定"},on:{click:t.confirm}},[t._v("\n                    确定\n                ")])],1)])]),t._v(" "),a("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"add"===t.paramsType?"新增参数":"编辑参数"},model:{value:t.paramsVisible,callback:function(e){t.paramsVisible=e},expression:"paramsVisible"}},[a("div",[a("bk-form",{ref:"validateParamsForm",attrs:{"label-width":90,model:t.paramsFormData,rules:t.paramsRules}},[a("bk-form-item",{attrs:{label:"参数名称",required:!0,property:"paramName","error-display-type":"normal"}},[a("bk-input",{attrs:{clearable:!0,placeholder:"请输入参数名称"},model:{value:t.paramsFormData.paramName,callback:function(e){t.$set(t.paramsFormData,"paramName",e)},expression:"paramsFormData.paramName"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"是否加密",required:!0}},[a("bk-switcher",{attrs:{theme:"primary"},model:{value:t.paramsFormData.encryption,callback:function(e){t.$set(t.paramsFormData,"encryption",e)},expression:"paramsFormData.encryption"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"默认参数",required:t.paramsFormData.isRequired,"error-display-type":"normal"}},[a("bk-input",{attrs:{clearable:!0,type:t.paramsFormData.encryption?"password":"text",placeholder:"请输入默认参数"},model:{value:t.paramsFormData.defaultParam,callback:function(e){t.$set(t.paramsFormData,"defaultParam",e)},expression:"paramsFormData.defaultParam"}})],1),t._v(" "),a("bk-form-item",{attrs:{label:"提示信息"}},[a("bk-input",{attrs:{clearable:!0,type:"textarea",placeholder:"请输入提示信息"},model:{value:t.paramsFormData.tip,callback:function(e){t.$set(t.paramsFormData,"tip",e)},expression:"paramsFormData.tip"}})],1)],1)],1),t._v(" "),a("template",{slot:"footer"},[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:"确认"},on:{click:t.confirmParams}},[t._v("\n                确认\n            ")]),t._v(" "),a("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:t.closeParamsDialog}},[t._v("\n                取消\n            ")])],1)],2)],1)}),[],!1,null,"1acab6ca",null).exports,v=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function o(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(o.prototype=a.prototype,new o)}}(),_=function(t,e,a,o){var r,i=arguments.length,n=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,a,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(n=(i<3?r(n):i>3?r(e,a,n):r(e,a))||n);return i>3&&n&&Object.defineProperty(e,a,n),n},T=function(t,e,a,o){return new(a||(a=Promise))((function(r,i){function n(t){try{l(o.next(t))}catch(t){i(t)}}function s(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(n,s)}l((o=o.apply(t,e||[])).next())}))},w=function(t,e){var a,o,r,i,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){n.label=i[1];break}if(6===i[0]&&n.label<r[1]){n.label=r[1],r=i;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(i);break}r[2]&&n.ops.pop(),n.trys.pop();continue}i=e.call(t,n)}catch(t){i=[6,t],o=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tableLoading=!1,e.dataList=[],e.columns=[{label:"工具名",key:"tool_name",align:"left",minWidth:"150px"},{label:"状态",key:"status",align:"left",minWidth:"80px",scopedSlots:"status"},{label:"类型",key:"built_in",align:"left",minWidth:"100px",scopedSlots:"built_in"},{label:"脚本类型",key:"script_type",align:"left",minWidth:"150px"},{label:"标签",key:"tag",align:"left",minWidth:"250px",scopedSlots:"tag"},{label:"操作",key:"operation",fixed:"right",align:"left",width:"150px",scopedSlots:"operation"}],e.pagination={current:1,count:1,limit:20},e.roleList=[],e.maxHeight="",e.search="",e.toolTypeList=[{id:"operateSystem",level:"基础架构",countKey:"property_count",count:0},{id:"networkDevice",level:"网络设备",countKey:"network_count",count:0}],e.activeType="operateSystem",e}return v(e,t),Object.defineProperty(e.prototype,"powerParams",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),e.prototype.created=function(){var t=this;this.getToolList(),this.getToolTypeCount();this.maxHeight=window.innerHeight-184,window.onresize=function(){t.maxHeight=window.innerHeight-184}},e.prototype.getToolTypeCount=function(){var t=this;this.$api.maintainTool.getToolTypeCount().then((function(e){var a=e.result,o=e.data;if(!a)return!1;t.toolTypeList.forEach((function(t){t.count=o[t.countKey]}))}))},e.prototype.toggleType=function(t){this.activeType=t.id,this.pagination.current=1,this.getToolList()},e.prototype.modifyToolStatus=function(t){var e=this;if(!this.$BtnPermission(this.powerParams))return!1;this.$bkInfo({title:"确认要".concat(t.status?"停用":"启用","该工具？"),confirmLoading:!0,confirmFn:function(){return T(e,void 0,void 0,(function(){return w(this,(function(e){switch(e.label){case 0:return[4,this.confirmModifyStatus(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmModifyStatus=function(t){var e=this,a={id:t.id,body:{tool_name:t.tool_name,status:!t.status}};this.$api.maintainTool.modifyToolStatus(a).then((function(a){if(!a.result)return e.$error(a.message),!1;e.$success("".concat(t.status?"停用":"启用","成功!")),e.getToolList()}))},e.prototype.handlerIconClick=function(){this.pagination.current=1,this.getToolList()},e.prototype.operateTool=function(t,e){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.operateTool.show(t,e)},e.prototype.deleteTool=function(t){var e=this;if(!this.$BtnPermission(this.powerParams))return!1;this.$bkInfo({title:"确认要删除该工具？",confirmLoading:!0,confirmFn:function(){return T(e,void 0,void 0,(function(){return w(this,(function(e){switch(e.label){case 0:return[4,this.confirmDelete(t)];case 1:return e.sent(),[2]}}))}))}})},e.prototype.confirmDelete=function(t){return T(this,void 0,void 0,(function(){var e;return w(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.$api.maintainTool.deleteTool({id:t.id})];case 1:return(e=a.sent()).result?(this.$success("删除成功"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getToolList()):this.$error(e.message),[2,!0];case 2:return a.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.getToolList=function(){var t=this,e={page:this.pagination.current,page_size:this.pagination.limit,search:this.search,tool_class:"operateSystem"===this.activeType?0:1};this.tableLoading=!0,this.$api.maintainTool.getScriptToolList(e).then((function(e){if(!e.result)return t.dataList=[],t.$error(e.message),!1;t.dataList=e.data.items,t.pagination.count=e.data.count})).finally((function(){t.tableLoading=!1}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getToolList()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getToolList()},e=_([Object(n.a)({name:"tool-manage",components:{comTable:r.a,operateTool:g}})],e)}(n.e),S=k,P=Object(u.a)(S,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tool-manage"},[a("div",{staticClass:"left-tree"},t._l(t.toolTypeList,(function(e){return a("div",{key:e.id,class:["tree-item",e.id===t.activeType&&"tree-item-active"],on:{click:function(a){return t.toggleType(e)}}},[a("span",[t._v(t._s(e.level))]),t._v(" "),a("span",[t._v(t._s(e.count))])])})),0),t._v(" "),a("div",{staticClass:"right-list"},[a("div",{staticClass:"operate-box"},[a("bk-input",{staticStyle:{flex:"1","margin-right":"20px"},attrs:{clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":t.handlerIconClick,enter:t.handlerIconClick,clear:t.handlerIconClick},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],attrs:{theme:"primary",title:"新增工具",icon:"plus"},on:{click:function(e){return t.operateTool("add")}}},[t._v("\n                新增工具\n            ")])],1),t._v(" "),a("div",{staticClass:"table-box"},[a("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"comTable",attrs:{data:t.dataList,columns:t.columns,"max-height":t.maxHeight,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"status",fn:function(e){var o=e.row;return[a("span",{style:{color:o.status?"#14a568":"#ea3536"}},[t._v(t._s(o.status?"已启用":"已停用"))])]}},{key:"built_in",fn:function(e){var o=e.row;return[a("span",[t._v(t._s(o.built_in?"内置":"自定义"))])]}},{key:"tag",fn:function(e){var o=e.row;return[a("span",[t._v(t._s(o.labels.join(", ")||"--"))])]}},{key:"operation",fn:function(e){var o=e.row;return[a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.modifyToolStatus(o)}}},[t._v("\n                        "+t._s(o.status?"停用":"启用")+"\n                    ")]),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{disabled:o.built_in,theme:"primary",text:""},on:{click:function(e){return t.operateTool("edit",o)}}},[t._v("\n                        修改\n                    ")]),t._v(" "),a("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{disabled:o.built_in,theme:"primary",text:""},on:{click:function(e){return t.deleteTool(o)}}},[t._v("\n                        删除\n                    ")])]}}])})],1)]),t._v(" "),a("operate-tool",{ref:"operateTool",attrs:{"is-operate-system":"operateSystem"===t.activeType},on:{refreshData:t.handlerIconClick}})],1)}),[],!1,null,"cf843734",null);e.default=P.exports}}]);