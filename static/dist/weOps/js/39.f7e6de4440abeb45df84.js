(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{g6WN:function(t,e,n){"use strict";n.r(e);var i,a=n("JnIg"),o=n("G0B5"),r=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,n,r):a(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},l=function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}l((i=i.apply(t,e||[])).next())}))},c=function(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.row={},e.btnLoading=!1,e.pageLoading=!1,e.rowCopy={},e}return r(e,t),e.prototype.show=function(t){this.row=this.$copy(t),this.rowCopy=this.$copy(t),this.getDefaultParamsList(this.row.id),this.visible=!0},e.prototype.handleClose=function(){var t=this;this.$compareFormData(this.row.obj_param_voucher,this.rowCopy.obj_param_voucher)?this.commonHandleHide():this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.commonHandleHide()}})},e.prototype.commonHandleHide=function(){this.row={},this.visible=!1},e.prototype.getDefaultParamsList=function(t){return l(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:this.pageLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getDefaultParams({id:t})];case 2:return(e=n.sent()).result?(e.data.length&&(this.row.obj_param_voucher=e.data,this.rowCopy.obj_param_voucher=e.data),[3,4]):(this.$message.error(e.message),[2]);case 3:return this.pageLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.handleConfirm=function(){return l(this,void 0,void 0,(function(){var t,e,n,i;return c(this,(function(a){switch(a.label){case 0:this.btnLoading=!0,t=this.row,e=t.id,n=t.obj_param_voucher,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.editScanPackage({id:e,voucher:{params:n}})];case 2:return(i=a.sent()).result?(this.$message.success("编辑成功"),this.visible=!1,this.$emit("refreshTable"),[3,4]):(this.$message.error(i.message),[2]);case 3:return this.btnLoading=!1,[7];case 4:return[2]}}))}))},e=s([o.a],e)}(o.e),p=u,d=n("KHd+"),h=Object(d.a)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("bk-sideslider",{attrs:{"is-show":t.visible,"quick-close":!0,width:700,"ext-cls":"common-dialog-wrapper","before-close":t.handleClose},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[n("div",{attrs:{slot:"header"},slot:"header"},[t._v("默认参数"),n("span",{staticClass:"sub-title"},[t._v(t._s(" - "+t.row.package_name))])]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[n("bk-form",{ref:"validateForm",attrs:{"label-width":100}},t._l(t.row.obj_param_voucher,(function(e,i){return n("bk-form-item",{key:e.name+i,attrs:{label:e.name}},[n("bk-input",{attrs:{placeholder:"请输入"+e.name,"password-icon":[],type:e.encryption?"password":"text"},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}})],1)})),1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticClass:"mr20",attrs:{theme:"primary",loading:t.btnLoading,disabled:t.pageLoading},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleConfirm.apply(null,arguments)}}},[t._v("\n                确定\n            ")]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.handleClose}},[t._v("取消")])],1)])],1)}),[],!1,null,null,null),f=h.exports,m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,n,r):a(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.row={},e.formData={index_name:"",index_class:"",unit:"",risk_level:"",index_baseline:"",index_introduction:"",cure_advice:"",operation:""},e.formDataCopy={},e.enumList={index_class_dict:[],operation_dict:[],risk_level_dict:[]},e}return m(e,t),e.prototype.show=function(t,e){this.dealEnumList(e,t),this.visible=!0},e.prototype.dealEnumList=function(t,e){for(var n in this.row=this.$copy(e),t)for(var i in t[n])this.enumList[n].push({label:t[n][i],value:i});for(var n in this.row)this.formData.hasOwnProperty(n)&&(this.formData[n]=this.row[n]);this.formDataCopy=this.$copy(this.formData)},e.prototype.handleClose=function(){var t=this;this.$compareFormData(this.formData,this.formDataCopy)?this.commonHandleHide():this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.commonHandleHide()}})},e.prototype.commonHandleHide=function(){for(var t in this.row={},this.enumList)this.enumList[t]=[];this.visible=!1},e.prototype.handleConfirm=function(){this.$emit("getNewRow",Object.assign(this.row,this.formData)),this.commonHandleHide()},e=b([o.a],e)}(o.e),g=v,y=Object(d.a)(g,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("bk-sideslider",{attrs:{"is-show":t.visible,"quick-close":!0,width:500,title:"编辑检查项","ext-cls":"common-dialog-wrapper","before-close":t.handleClose},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[n("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[n("bk-form",{ref:"validateForm",attrs:{"label-width":100,model:t.formData}},[n("bk-form-item",{attrs:{label:"指标名称："}},[n("bk-input",{attrs:{placeholder:"请输入指标名称",disabled:""},model:{value:t.formData.index_name,callback:function(e){t.$set(t.formData,"index_name",e)},expression:"formData.index_name"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:"指标分类："}},[n("bk-select",{attrs:{placeholder:"请选择指标分类",clearable:!1,disabled:""},model:{value:t.formData.index_class,callback:function(e){t.$set(t.formData,"index_class",e)},expression:"formData.index_class"}},t._l(t.enumList.index_class_dict,(function(t){return n("bk-option",{key:t.vaule,attrs:{id:t.value,name:t.label}})})),1)],1),t._v(" "),n("bk-form-item",{attrs:{label:"指标单位："}},[n("bk-input",{attrs:{placeholder:"请输入指标单位",disabled:""},model:{value:t.formData.unit,callback:function(e){t.$set(t.formData,"unit",e)},expression:"formData.unit"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:"健康值："}},[t.enumList.operation_dict&&t.enumList.operation_dict.length?n("bk-compose-form-item",{staticClass:"tree-box-header-right"},[n("bk-select",{staticStyle:{width:"100px"},attrs:{clearable:!1},model:{value:t.formData.operation,callback:function(e){t.$set(t.formData,"operation",e)},expression:"formData.operation"}},t._l(t.enumList.operation_dict,(function(t){return n("bk-option",{key:t.value,attrs:{id:t.value,name:t.label}})})),1),t._v(" "),n("bk-input",{staticStyle:{width:"200px","margin-right":"4px"},attrs:{clearable:""},model:{value:t.formData.index_baseline,callback:function(e){t.$set(t.formData,"index_baseline",e)},expression:"formData.index_baseline"}}),t._v(" "),n("span",[t._v(t._s(t.formData.unit))])],1):t._e()],1),t._v(" "),n("bk-form-item",{attrs:{label:"风险等级："}},[n("bk-select",{attrs:{placeholder:"请选择风险等级"},model:{value:t.formData.risk_level,callback:function(e){t.$set(t.formData,"risk_level",e)},expression:"formData.risk_level"}},t._l(t.enumList.risk_level_dict,(function(t){return n("bk-option",{key:t.value,attrs:{id:t.value,name:t.label}})})),1)],1),t._v(" "),n("bk-form-item",{attrs:{label:"指标介绍："}},[n("bk-input",{attrs:{placeholder:"请输入指标介绍",type:"textarea",clearable:""},model:{value:t.formData.index_introduction,callback:function(e){t.$set(t.formData,"index_introduction",e)},expression:"formData.index_introduction"}})],1),t._v(" "),n("bk-form-item",{attrs:{label:"治愈建议："}},[n("bk-input",{attrs:{placeholder:"请输入治愈建议",type:"textarea",clearable:""},model:{value:t.formData.cure_advice,callback:function(e){t.$set(t.formData,"cure_advice",e)},expression:"formData.cure_advice"}})],1)],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticClass:"mr20",attrs:{theme:"primary"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleConfirm.apply(null,arguments)}}},[t._v("\n                确定\n            ")]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.handleClose}},[t._v("取消")])],1)])],1)}),[],!1,null,null,null),_=y.exports,k=n("sxP2"),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),x=function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,n,r):a(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},L=function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}l((i=i.apply(t,e||[])).next())}))},P=function(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.row={},e.enumList=[],e.btnLoading=!1,e.tableLoading=!1,e.dataList=[],e.dataListCopy=[],e.columns=[{label:"检查项",key:"index_name",minWidth:"200px",scopedSlots:"index_name"},{label:"检查项分类",key:"index_class",minWidth:"150px",scopedSlots:"index_class"},{label:"健康值",key:"index_baseline",minWidth:"120px",scopedSlots:"index_baseline"},{label:"操作",key:"operation",width:"80px",prop:"operation",scopedSlots:"operation"},{label:"开启",key:"is_open",minWidth:"80px",scopedSlots:"is_open"}],e.pagination={current:1,count:0,limit:20},e}return w(e,t),e.prototype.getConfigs=function(t){return{content:t.index_introduction,showOnInit:!1,placements:["auto-start"],theme:"dark"}},e.prototype.handleChange=function(t){var e=this;this.dataList.every((function(t){return!t.is_open}))&&this.$nextTick((function(){t.is_open=!0,e.$warn("至少开启一个检查项")}))},e.prototype.getNewRow=function(t){var e=this.dataList.findIndex((function(e){return e.id===t.id}));-1!==e&&this.$set(this.dataList,e,t)},e.prototype.show=function(t,e){this.row=this.$copy(t),this.enumList=e;var n=this.row.id;this.visible=!0,this.getTableList({id:n})},e.prototype.handleEdit=function(t){this.$refs.editIndex.show(t,this.enumList)},e.prototype.getBaseline=function(t){return"--"!==t.operation&&"--"!==t.index_baseline&&t.operation&&t.index_baseline?"".concat(t.operation).concat(t.index_baseline).concat(t.unit):"--"},e.prototype.getTableList=function(t){return L(this,void 0,void 0,(function(){var e;return P(this,(function(n){switch(n.label){case 0:this.tableLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getPackageIndexDetail(t)];case 2:return(e=n.sent()).result?(this.dataList=e.data,this.dataListCopy=this.$copy(e.data),[3,4]):(this.$message.error(e.message),[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.handleClose=function(){var t=this;this.$compareFormData(this.dataList,this.dataListCopy)?this.commonHandleHide():this.$bkInfo({title:"是否放弃本次操作",subTitle:"放弃将导致未保存信息丢失",confirmLoading:!0,confirmFn:function(){t.commonHandleHide()}})},e.prototype.commonHandleHide=function(){this.row={},this.visible=!1},e.prototype.handleConfirm=function(){var t=this;this.$bkInfo({title:"提示",subTitle:"关联任务的执行记录将被清除",theme:"primary",confirmFn:function(){t.editCheckedIndex()}})},e.prototype.editCheckedIndex=function(){return L(this,void 0,void 0,(function(){var t,e;return P(this,(function(n){switch(n.label){case 0:this.btnLoading=!0,t=this.row.id,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.editPackage({id:t,index_list:this.dataList})];case 2:return(e=n.sent()).result?(this.$message.success("编辑成功"),this.visible=!1,this.$emit("refreshTable"),[3,4]):(this.$message.error(e.message),[2]);case 3:return this.btnLoading=!1,[7];case 4:return[2]}}))}))},e=x([Object(o.a)({mixins:[k.a],components:{comTable:a.a,editIndexDialog:_}})],e)}(o.e),D=C,O=Object(d.a)(D,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("bk-sideslider",{attrs:{"is-show":t.visible,"quick-close":!0,width:700,"ext-cls":"common-dialog-wrapper","before-close":t.handleClose},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e}}},[n("div",{attrs:{slot:"header"},slot:"header"},[t._v("检查项"),n("span",{staticClass:"sub-title"},[t._v(t._s(" - "+t.row.package_name))])]),t._v(" "),n("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[n("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"indexTable",attrs:{data:t.dataList,columns:t.columns},scopedSlots:t._u([{key:"index_name",fn:function(e){return[n("div",[n("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.getConfigs(e.row),expression:"getConfigs(record.row)"}],staticClass:"top-start"},[n("bk-icon",{staticStyle:{"font-size":"14px"},attrs:{type:"question-circle-shape"}})],1),t._v(" "),n("span",[t._v(t._s(e.row.index_name))])])]}},{key:"index_baseline",fn:function(e){return[n("span",[t._v(t._s(t.getBaseline(e.row)))])]}},{key:"index_class",fn:function(e){return[n("span",[t._v(t._s(t.enumList.index_class_dict[e.row.index_class]))])]}},{key:"is_open",fn:function(e){return[n("bk-switcher",{attrs:{theme:"primary"},on:{change:function(n){return t.handleChange(e.row)}},model:{value:e.row.is_open,callback:function(n){t.$set(e.row,"is_open",n)},expression:"record.row.is_open"}})]}},{key:"operation",fn:function(e){return[n("div",[n("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(n){return t.handleEdit(e.row)}}},[t._v("编辑")])],1)]}}])})],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticClass:"mr20",attrs:{theme:"primary",loading:t.btnLoading,disabled:t.btnForbidden||t.btnLoading},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleConfirm.apply(null,arguments)}}},[t._v("\n                确认\n            ")]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.handleClose}},[t._v("关闭")])],1)]),t._v(" "),n("editIndexDialog",{ref:"editIndex",on:{getNewRow:t.getNewRow}})],1)}),[],!1,null,null,null),j=O.exports,$=n("EcEN"),S=n.n($),T=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),I=function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,n,r):a(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},F=function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}l((i=i.apply(t,e||[])).next())}))},H=function(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!1,e.importLoading=!1,e.targetFiles=[],e.timer={},e.isUploading=!1,e}return T(e,t),e.prototype.beforeDestroy=function(){this.clearTimer()},e.prototype.clearTimer=function(){if(this.timer)for(var t in this.timer)clearInterval(this.timer[t])},e.prototype.isDisabled=function(t){return!t.every((function(t){return"100%"===t.progress}))||!t.length||this.isUploading},e.prototype.show=function(){this.visible=!0,this.targetFiles=[]},e.prototype.handleClose=function(){this.targetFiles=[]},e.prototype.handleProgress=function(t,e,n){this.$set(t,"progress",e),this.$set(t,"currentSize",n)},e.prototype.handleUpload=function(t){var e=this;this.clearTimer(),t.fileList.forEach((function(t){return F(e,void 0,void 0,(function(){var e;return H(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t.origin.text()];case 1:return e=n.sent(),t.responeList=JSON.parse(e),t.id=S()(),1e3*t.size/1024/1024>4||t.uploadStatus?(t.uploadStatus=!0,t.message="文件不能超过4M,上传失败",this.handleProgress(t,"0%",0),[2]):(this.updatePercent(t),[3,3]);case 2:return n.sent(),t.uploadStatus=!0,this.$set(t,"responeList",{scan_package:"--"}),t.message="文件内容非json格式",t.progress="0%",[3,3];case 3:return[2]}}))}))})),this.targetFiles=t.fileList},e.prototype.updatePercent=function(t){var e=this,n=1e3*t.size/1024,i=0;this.timer[t.id]=setInterval((function(){var a=(i+=300)/n;e.handleProgress(t,"".concat(100*a,"%"),(n*a).toFixed(0)),a>=.9&&(clearInterval(e.timer[t.id]),e.handleProgress(t,"90%",(.9*n).toFixed(0)),e.getScanPackageList(t,n))}),300)},e.prototype.getScanPackageList=function(t,e){return F(this,void 0,void 0,(function(){var n,i,a;return H(this,(function(o){switch(o.label){case 0:this.isUploading=!0,o.label=1;case 1:return o.trys.push([1,,3,4]),n={package_name:t.responeList.scan_package,bk_obj_id:t.responeList.bk_obj_id,page_size:-1},[4,this.$api.healthAdvisor.getscanPackage(n)];case 2:return i=o.sent(),t.uploadStatus=!0,i.result&&i.data&&i.data.items?(a=i.data.items.length,t.message=a?"上传失败,已存在同名扫描包":"上传成功",this.handleProgress(t,a?"0%":"100%",a?0:e.toFixed(0)),[2]):(t.message="上传失败",this.handleProgress(t,"0%",0),[3,4]);case 3:return this.isUploading=!1,[7];case 4:return[2]}}))}))},e.prototype.importResource=function(){return F(this,void 0,void 0,(function(){var t,e,n;return H(this,(function(i){switch(i.label){case 0:t=this.targetFiles&&this.targetFiles[0].responeList,this.importLoading=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.importPackage(t)];case 2:return e=i.sent(),n=e.data,e.result&&n&&!n.exist?(this.visible=!1,this.$message.success("新增成功"),this.$emit("refreshTable"),[2]):(this.$error(n.message||e.message),[3,4]);case 3:return this.importLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.handleDelete=function(t){var e=this.targetFiles.findIndex((function(e){return e.id===t.id}));-1!==e&&this.targetFiles.splice(e,1)},e.prototype.handleDownload=function(){return F(this,void 0,void 0,(function(){var t,e,n,i;return H(this,(function(a){switch(a.label){case 0:return[4,this.$api.healthAdvisor.getPackageTemplate()];case 1:return(t=a.sent()).result?(e=JSON.stringify(t.data,void 0,4),n=new Blob([e],{type:"text/json"}),(i=document.createElement("a")).href=window.URL.createObjectURL(n),i.download="扫描包模板.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),[2]):(this.$error(t.message),[2])}}))}))},e=I([o.a],e)}(o.e),R=E,N=Object(d.a)(R,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("bk-sideslider",{attrs:{"is-show":t.visible,"quick-close":!0,width:500,title:"新增扫描包","ext-cls":"common-dialog-wrapper"},on:{"update:isShow":function(e){t.visible=e},"update:is-show":function(e){t.visible=e},hidden:t.handleClose}},[n("div",{staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"upload-wrapper"},[n("bk-upload",{attrs:{url:"0",accept:".json","with-credentials":!0,"ext-cls":"upload-sec",size:1e3,limit:1,multiple:!1,tip:"注：仅支持.json格式，请按照模板文件上传,且不超过4M","custom-request":t.handleUpload}}),t._v(" "),n("div",{staticClass:"result-response"},[n("ul",t._l(t.targetFiles,(function(e){return n("li",{key:e.id,staticClass:"response-list"},[n("div",{staticClass:"upload-progress"},[n("div",{staticClass:"progress-line",style:{width:e.progress}},[n("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"progress-name"},[t._v(t._s(e.name))])]),t._v(" "),n("div",{staticClass:"progress-tips"},[t._v("\n                                    "+t._s((e.currentSize||0)+"kb/"+e.size.toFixed(0)+"kb")+"\n                                ")])]),t._v(" "),e.uploadStatus?n("div",{staticClass:"response-box"},[n("div",{class:["box-status","0%"===e.progress&&"box-fail-status"]},[t._v(t._s(e.message))]),t._v(" "),n("bk-icon",{staticClass:"close-icon show-close",attrs:{type:"close-circle"},on:{click:function(n){return t.handleDelete(e)}}}),t._v(" "),e.responeList?n("ul",{staticClass:"box-list"},[n("li",[t._v("扫描包名称："+t._s(e.responeList.scan_package||"--"))]),t._v(" "),n("li",[t._v("对象名称："+t._s(e.responeList.bk_obj_id||"--"))]),t._v(" "),n("li",[t._v("检查项数："+t._s(e.responeList.index_list&&e.responeList.index_list.length||"--"))])]):t._e()],1):t._e()])})),0)])],1)]),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{staticClass:"mr20",attrs:{theme:"primary",loading:t.importLoading,disabled:t.isDisabled(t.targetFiles)},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.importResource.apply(null,arguments)}}},[t._v("\n                确定\n            ")]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:function(e){t.visible=!1}}},[t._v("取消")])],1)])],1)}),[],!1,null,"910ea3ec",null),z=N.exports,A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),W=function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,n,r):a(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},U=function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}l((i=i.apply(t,e||[])).next())}))},q=function(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},G=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.packageName="",e.tableLoading=!1,e.dataList=[],e.columns=[{label:"扫描包名称",key:"package_name",minWidth:"180px"},{label:"对象名称",key:"bk_obj_name",minWidth:"180px"},{label:"对象类型",key:"bk_classification_name",minWidth:"180px"},{label:"总检查项",key:"index_num",minWidth:"80px"},{label:"已开启检查项",key:"open_index_num",minWidth:"80px"},{label:"扫描包类型",key:"package_type_name",minWidth:"80px"},{label:"操作",key:"operation",width:"250px",prop:"operation",scopedSlots:"operation"}],e.pagination={current:1,count:0,limit:20},e.maxHeight="",e.taskId=null,e.enumList=[],e}return A(e,t),e.prototype.mounted=function(){return U(this,void 0,void 0,(function(){var t=this;return q(this,(function(e){switch(e.label){case 0:return[4,this.getPackageEnumList()];case 1:return e.sent(),this.getScanPackageList(),184,this.maxHeight=window.innerHeight-184,window.onresize=function(){t.maxHeight=window.innerHeight-184},[2]}}))}))},e.prototype.isDisabled=function(t){return"built_in"===t.package_type},e.prototype.dealParams=function(t){return t.obj_param_voucher&&!t.obj_param_voucher.length},e.prototype.getPassRate=function(t){return"--"!==t.pass_rate&&t.task_status?"".concat(t.pass_rate,"%"):"--"},e.prototype.getScanPackageList=function(){var t,e;return U(this,void 0,void 0,(function(){var n,i;return q(this,(function(a){switch(a.label){case 0:n=this.getParams(),this.tableLoading=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.healthAdvisor.getscanPackage(n)];case 2:return(i=a.sent()).result?(this.dataList=null===(t=i.data)||void 0===t?void 0:t.items,this.pagination.count=null===(e=i.data)||void 0===e?void 0:e.count,[3,4]):(this.$error(i.message),this.dataList=[],[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},e.prototype.getPackageEnumList=function(){return U(this,void 0,void 0,(function(){var t;return q(this,(function(e){switch(e.label){case 0:return[4,this.$api.healthAdvisor.getPackageEnumList()];case 1:return(t=e.sent()).result&&(this.enumList=t.data),[2]}}))}))},e.prototype.getParams=function(){var t=this.pagination;return{page_size:t.limit,page:t.current,package_name:this.packageName}},e.prototype.packageOperation=function(t,e){void 0===e&&(e={}),this.btnForbidden&&"checkIndex"!==t||this.$refs[t].show(e,this.enumList)},e.prototype.handleDelete=function(t){return U(this,void 0,void 0,(function(){var e,n=this;return q(this,(function(i){switch(i.label){case 0:return this.btnForbidden?[2]:[4,this.$api.healthAdvisor.getTaskCount({id:t.id})];case 1:return(e=i.sent()).result&&this.$bkInfo({title:"提示",subTitle:'扫描包"'.concat(t.package_name,'"关联').concat(e.data||0,"个任务，扫描包删除后，关联的任务将会删除，请谨慎处理。"),theme:"primary",confirmFn:function(){n.confirmDeletePackage(t.id)}}),[2]}}))}))},e.prototype.confirmDeletePackage=function(t){return U(this,void 0,void 0,(function(){var e;return q(this,(function(n){switch(n.label){case 0:return this.tableLoading=!0,[4,this.$api.healthAdvisor.deleteScanPackage({id:t})];case 1:return(e=n.sent()).result?(this.$message.success("删除成功"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getScanPackageList(),[2]):(this.$message.error(e.message),this.tableLoading=!1,[2])}}))}))},e.prototype.handlePageChange=function(t){this.pagination.current=t,this.getScanPackageList()},e.prototype.limitChange=function(t){this.pagination.current=1,this.pagination.limit=t,this.getScanPackageList()},e=W([Object(o.a)({components:{comTable:a.a,defaultParamsDialog:f,checkIndexDialog:j,addPackageDialog:z},mixins:[k.a]})],e)}(o.e),J=G,B=Object(d.a)(J,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"package-manage"},[n("div",{staticClass:"nav-area"},[n("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入扫描包名称",clearable:""},on:{enter:t.getScanPackageList},model:{value:t.packageName,callback:function(e){t.packageName=e},expression:"packageName"}}),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],attrs:{theme:"primary"},on:{click:function(e){return t.packageOperation("addPackage")}}},[t._v("\n            新增\n        ")])],1),t._v(" "),n("div",{staticClass:"table-area"},[n("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"healthTable",staticClass:"common-table-max-height",attrs:{data:t.dataList,columns:t.columns,"max-height":t.maxHeight,pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"package_type",fn:function(e){var i=e.row;return[n("span",[t._v(t._s(t.getPassRate(i)))])]}},{key:"operation",fn:function(e){var i=e.row;return[n("div",[n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){return t.packageOperation("checkIndex",i)}}},[t._v("\n                        检查项\n                    ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.dealParams(i)},on:{click:function(e){return t.packageOperation("defaultParams",i)}}},[t._v("\n                        默认参数\n                    ")]),t._v(" "),n("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:t.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{disabled:t.isDisabled(i),theme:"primary",text:""},on:{click:function(e){return t.handleDelete(i)}}},[t._v("\n                        删除\n                    ")])],1)]}}])})],1),t._v(" "),n("default-params-dialog",{ref:"defaultParams",on:{refreshTable:t.getScanPackageList}}),t._v(" "),n("check-index-dialog",{ref:"checkIndex",on:{refreshTable:t.getScanPackageList}}),t._v(" "),n("add-package-dialog",{ref:"addPackage",on:{refreshTable:t.getScanPackageList}})],1)}),[],!1,null,"1d5eac31",null);e.default=B.exports}}]);