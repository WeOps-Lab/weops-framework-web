(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{"9ByC":function(e,t,i){"use strict";i.r(t);var n,a=i("G0B5"),r=i("JnIg"),o=i("JozC"),s=i("aqBw"),l=i.n(s),c=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),u=function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},d=function(e,t,i,n){return new(i||(i=Promise))((function(a,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))},p=function(e,t){var i,n,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(a=2&r[0]?n.return:r[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hostDetail={},t.visible=!1,t.pageLoading=!1,t.type="add",t.formData={credential_name:"",agreement:null,port:"",username:"",password:"",describe:""},t.formDataV2={},t.rules={credential_name:[{required:!0,message:"请输入凭证名称",trigger:"blur"}],agreement:[{required:!0,message:"请选择远程协议",trigger:"blur"}],port:[{required:!0,message:"请输入远程端口",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:null,message:"密码不能包含非法字符",trigger:"blur"}]},t.loading=!1,t.isIncodeSuccess=!0,t.protocolList=[{id:1,name:"SSH"},{id:2,name:"RDP"},{id:3,name:"VNC"}],t}return c(t,e),Object.defineProperty(t.prototype,"isAdd",{get:function(){return"add"===this.type},enumerable:!1,configurable:!0}),t.prototype.show=function(e,t){this.type=t,this.isAdd?(this.hostDetail=e,this.setDefault(this.hostDetail.bk_os_type)):this.getVoucherDetial({id:e.id}),this.visible=!0,console.log(this.evidenceFormParams)},t.prototype.changeAgreement=function(e){this.isAdd&&(this.formData.port=2===e?"3389":"22")},t.prototype.setDefault=function(e){this.formData.password="",this.formData.credential_name="",this.formData.describe="","2"===e?(this.formData.agreement=2,this.formData.port="3389",this.formData.username="administrator"):(this.formData.agreement=1,this.formData.port="22",this.formData.username="root"),this.formDataV2=this.$copy(this.formData)},t.prototype.getVoucherDetial=function(e){return d(this,void 0,void 0,(function(){var t,i;return p(this,(function(n){switch(n.label){case 0:this.pageLoading=!0,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.$api.remoteConnect.getCredentialDetial(e)];case 2:if(!(t=n.sent()).result)return this.$error(t.message),[2];for(i in this.hostDetail=t.data,this.hostDetail)this.formData.hasOwnProperty(i)&&(this.formData[i]=t.data[i]);return this.formData.password=o.a.Decrypt(this.formData.password,!0),this.formDataV2=this.$copy(this.formData),[3,4];case 3:return this.pageLoading=!1,[7];case 4:return[2]}}))}))},t.prototype.confirm=function(){var e=this;this.rules.password[1].validator=function(){return!0},this.$refs.validateForm.validate().then((function(t){e.createCredential()}))},t.prototype.createCredential=function(){return d(this,void 0,void 0,(function(){var e,t,i;return p(this,(function(n){switch(n.label){case 0:this.loading=!0,n.label=1;case 1:return n.trys.push([1,3,4,5]),e=this.isAdd?"createCredential":"motifyCredential",t=this.$copy(this.formData),this.isAdd||(t.id=this.hostDetail.id),this.isIncodeSuccess=l.a.encode(this.formData.password),t.password=o.a.Encrypt(t.password,!0),[4,this.$api.remoteConnect[e](t)];case 2:return(i=n.sent()).result?(this.$success("操作成功"),this.updateCredential(i.data),this.visible=!1,[3,5]):(this.$error(i.message),[2]);case 3:return n.sent(),this.rules.password[1].validator=function(){return!1},this.$refs.validateForm.validate(),[3,5];case 4:return this.loading=!1,[7];case 5:return[2]}}))}))},t.prototype.cancel=function(){var e=this;this.$compareFormData(this.formData,this.formDataV2)?this.visible=!1:this.$bkInfo({title:"是否放弃本次操作？",subTitle:"放弃将导致未保存信息丢失",theme:"primary",confirmFn:function(){e.visible=!1}})},t.prototype.updateCredential=function(e){return e},u([Object(a.d)({type:Array,default:function(){return[]}})],t.prototype,"evidenceFormParams",void 0),u([Object(a.b)("updateCredential")],t.prototype,"updateCredential",null),t=u([Object(a.a)({components:{}})],t)}(a.e),m=h,f=i("KHd+"),b=Object(f.a)(m,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("bk-sideslider",{attrs:{width:500,"is-show":e.visible,"quick-close":!0,title:e.isAdd?"新建凭据":"修改凭据","ext-cls":"common-dialog-wrapper","before-close":e.cancel},on:{"update:isShow":function(t){e.visible=t},"update:is-show":function(t){e.visible=t}}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.pageLoading,zIndex:10},expression:"{ isLoading: pageLoading, zIndex: 10 }"}],staticClass:"common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"validateForm",attrs:{"label-width":90,model:e.formData,rules:e.rules}},[i("bk-form-item",{attrs:{label:"凭证名称",required:"",property:"credential_name"}},[i("bk-input",{attrs:{placeholder:"请输入凭证名称"},model:{value:e.formData.credential_name,callback:function(t){e.$set(e.formData,"credential_name",t)},expression:"formData.credential_name"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"远程协议",required:"",property:"agreement"}},[i("bk-select",{staticStyle:{width:"100%"},attrs:{clearable:!1},on:{change:e.changeAgreement},model:{value:e.formData.agreement,callback:function(t){e.$set(e.formData,"agreement",t)},expression:"formData.agreement"}},e._l(e.protocolList,(function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1),e._v(" "),i("bk-form-item",{attrs:{label:"远程端口",required:"",property:"port"}},[i("bk-input",{attrs:{placeholder:"请输入远程端口"},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",t)},expression:"formData.port"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"用户名",required:"",property:"username"}},[i("bk-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username",t)},expression:"formData.username"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"密码",required:"",property:"password"}},[i("bk-input",{attrs:{placeholder:"请输入密码",type:"password"},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"描述"}},[i("bk-input",{attrs:{placeholder:"请输入描述",type:"textarea"},model:{value:e.formData.describe,callback:function(t){e.$set(e.formData,"describe",t)},expression:"formData.describe"}})],1)],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",loading:e.loading},on:{click:e.confirm}},[e._v("\n            确认\n        ")]),e._v(" "),i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:e.cancel}},[e._v("\n            取消\n        ")])],1)])}),[],!1,null,null,null).exports,y=i("5Vuv"),v=i("ac6i"),g=i("uMZD"),_=i("5u7y"),k=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),w=function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectHostList=[],t.isShow=!1,t.loading=!1,t.tableLoading=!1,t.dataList=[],t.hostColumns=[{type:"selection",width:"50px"},{label:"内网IP",key:"inner_ip",align:"left",minWidth:"130px"},{label:"操作系统名称",key:"os_type",align:"left",minWidth:"110px"},{label:"应用名称",key:"bk_biz_name",align:"left",minWidth:"140px"}],t.activeDirectoryColumns=[{type:"selection",width:"50px"},{label:"实例ID",key:"bk_inst_id",align:"left",minWidth:"130px"},{label:"实例名",key:"bk_inst_name",align:"left",minWidth:"110px"}],t.pagination={current:1,count:1,limit:20,small:!0},t.maxHeight="",t.search="",t.credentialDetail="",t}return k(t,e),Object.defineProperty(t.prototype,"tableData",{get:function(){return this.dataList.slice((this.pagination.current-1)*this.pagination.limit,this.pagination.current*this.pagination.limit)},enumerable:!1,configurable:!0}),t.prototype.mounted=function(){var e=this;this.maxHeight=window.innerHeight-152,window.onresize=function(){e.maxHeight=window.innerHeight-152}},t.prototype.clearSelectHost=function(){this.selectHostList=[],this.$refs.comTable.clearSelection()},t.prototype.removeSelectHost=function(e,t){var i=this;this.selectHostList.splice(t,1),this.$nextTick((function(){i.tableData.forEach((function(t){t.bk_inst_id===e.bk_inst_id&&i.$refs.comTable.toggleRowSelection(t,!1)}))}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.setTableCheckStatus()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.setTableCheckStatus()},t.prototype.getHostList=function(){var e=this;this.tableLoading=!0,this.$api.remoteConnect.getCredResourceList({id:this.credentialDetail.id}).then((function(t){var i=t.result,n=t.data;if(!i)return!1;e.dataList=n,e.pagination.count=n.length,e.credentialDetail.bk_inst_id_list.forEach((function(t){var i=e.dataList.find((function(e){return e.bk_inst_id===t}));i&&(e.selectHostList.push(i),e.$nextTick((function(){e.$refs.comTable.toggleRowSelection(i,!0)})))}))})).finally((function(){e.tableLoading=!1}))},t.prototype.show=function(e){this.isShow=!0,this.selectHostList=[],this.credentialDetail=e,this.getHostList()},t.prototype.setTableCheckStatus=function(){var e=this;this.$nextTick((function(){e.selectHostList.length>0&&e.tableData.forEach((function(t){e.selectHostList.find((function(e){return e.bk_inst_id===t.bk_inst_id}))&&e.$refs.comTable.toggleRowSelection(t,!0)}))}))},t.prototype.selectTableData=function(e,t){var i=this.selectHostList.findIndex((function(e){return e.bk_inst_id===t.bk_inst_id}));-1===i?this.selectHostList.push(t):this.selectHostList.splice(i,1)},t.prototype.selectAllTableData=function(e){var t=this;0===e.length?this.selectHostList=this.selectHostList.filter((function(e){return!t.tableData.find((function(t){return e.bk_inst_id===t.bk_inst_id}))})):(e||[]).forEach((function(e){t.selectHostList.find((function(t){return t.bk_inst_id===e.bk_inst_id}))||t.selectHostList.push(e)}))},t.prototype.confirm=function(){var e=this;if(0===this.selectHostList.length)return this.$warn("请先选择关联的主机!"),!1;this.loading=!0,this.$api.remoteConnect.setCredResourceList({id:this.credentialDetail.id,body:{bk_inst_id_list:this.selectHostList.map((function(e){return e.bk_inst_id}))}}).then((function(t){var i=t.result,n=t.message;if(!i)return e.$error(n),!1;e.$success("关联成功!"),e.$emit("refresh-list"),e.cancel()})).finally((function(){e.loading=!1}))},t.prototype.cancel=function(){this.isShow=!1},w([Object(a.d)({type:Boolean,default:function(){return!1}})],t.prototype,"isMyCredentials",void 0),w([Object(a.d)({type:String,default:function(){return"host"}})],t.prototype,"activeTreeNode",void 0),w([Object(a.d)({type:String,default:function(){return"inner_ip"}})],t.prototype,"showLabelKey",void 0),t=w([a.a],t)}(a.e),C=x,D=Object(f.a)(C,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("bk-sideslider",{attrs:{width:800,"is-show":e.isShow,"before-close":e.cancel,"quick-close":!0},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[i("div",{attrs:{slot:"header"},slot:"header"},[e._v("关联")]),e._v(" "),i("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"main-box"},[i("div",{staticClass:"select-data"},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],staticClass:"table-box"},[i("bk-table",{ref:"comTable",attrs:{data:e.tableData,pagination:e.pagination,"max-height":e.isMyCredentials?e.maxHeight:e.maxHeight+52},on:{select:e.selectTableData,"select-all":e.selectAllTableData,"page-change":e.handlePageChange,"page-limit-change":e.limitChange}},e._l("host"===e.activeTreeNode?e.hostColumns:e.activeDirectoryColumns,(function(t){return i("bk-table-column",e._b({key:t.key,attrs:{label:t.label,prop:t.key,"column-key":t.key}},"bk-table-column",t,!1))})),1)],1)]),e._v(" "),i("div",{staticClass:"result-box"},[i("div",{staticClass:"title"},[e._v("结果预览")]),e._v(" "),i("div",{staticClass:"info"},[i("div",{staticClass:"info-left"},[i("span",[e._v("已选择")]),e._v(" "),i("span",{staticStyle:{color:"#659FFD"}},[e._v(e._s(e.selectHostList.length))]),e._v(" "),i("span",[e._v("项资产")])]),e._v(" "),i("div",{staticClass:"info-right",on:{click:e.clearSelectHost}},[e._v("清空")])]),e._v(" "),i("div",{staticClass:"list"},e._l(e.selectHostList,(function(t,n){return i("div",{key:t.bk_inst_id,class:["list-item",n!==e.selectHostList.length-1&&"list-item-border-bottom"]},[i("span",{staticClass:"value"},[e._v(e._s(t[e.showLabelKey]))]),e._v(" "),i("i",{staticClass:"cw-icon weops-close",on:{click:function(i){return e.removeSelectHost(t,n)}}})])})),0)])]),e._v(" "),e.isMyCredentials?i("div",{staticClass:"foot-box"},[i("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:e.cancel}},[e._v("\n                取消\n            ")]),e._v(" "),i("bk-button",{staticClass:"mr10",attrs:{loading:e.loading,disabled:e.loading,theme:"primary"},on:{click:e.confirm}},[e._v("\n                确认\n            ")])],1):e._e()])])}),[],!1,null,"3a2a1ad8",null).exports,L=i("ceJc"),W=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"协议",key:"agreement",minWidth:"70px"},{label:"端口",key:"port",minWidth:"80px"},{label:"用户名",key:"username",minWidth:"160px"},{label:"关联资产数",key:"resource_count",minWidth:"120px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],S=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"协议",key:"agreement",minWidth:"80px"},{label:"端口",key:"port",minWidth:"80px"},{label:"关联资产数",key:"resource_count",minWidth:"120px"},{label:"授权人",key:"created_by_cn",minWidth:"110px"},{label:"操作",key:"auth_operation",width:"140px",prop:"operation",scopedSlots:"auth_operation"}],O=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"协议",key:"snmp_version",minWidth:"70px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],$=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"协议",key:"snmp_version",minWidth:"70px"},{label:"授权人",key:"created_by_cn",minWidth:"110px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],P=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"端口",key:"port",minWidth:"80px"},{label:"用户名",key:"username",minWidth:"160px"},{label:"关联资产数",key:"resource_count",minWidth:"120px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],H=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"端口",key:"port",minWidth:"80px"},{label:"关联资产数",key:"resource_count",minWidth:"120px"},{label:"授权人",key:"created_by_cn",minWidth:"110px"},{label:"操作",key:"auth_operation",width:"140px",prop:"operation",scopedSlots:"auth_operation"}],j=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"access_key",key:"access_key",minWidth:"150px"},{label:"关联资产数",key:"resource_count",minWidth:"80px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],T=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"access_key",key:"access_key",minWidth:"150px"},{label:"关联资产数",key:"resource_count",minWidth:"80px"},{label:"操作",key:"auth_operation",width:"140px",prop:"operation",scopedSlots:"auth_operation"}],E=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"用户名",key:"username",minWidth:"150px"},{label:"关联资产数",key:"resource_count",minWidth:"80px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],N=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"用户名",key:"username",minWidth:"150px"},{label:"关联资产数",key:"resource_count",minWidth:"80px"},{label:"操作",key:"auth_operation",width:"140px",prop:"operation",scopedSlots:"auth_operation"}],q=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"端口",key:"port",minWidth:"80px"},{label:"用户名",key:"user",minWidth:"160px"},{label:"关联资产数",key:"resource_count",minWidth:"120px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],F=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"端口",key:"port",minWidth:"80px"},{label:"用户名",key:"user",minWidth:"160px"},{label:"关联资产数",key:"resource_count",minWidth:"120px"},{label:"操作",key:"auth_operation",width:"180px",prop:"operation",scopedSlots:"auth_operation"}],A=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"账号",key:"account",minWidth:"180px"},{label:"协议",key:"agreement",minWidth:"120px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],I=[{label:"凭据名称",key:"name",minWidth:"180px"},{label:"账号",key:"account",minWidth:"180px"},{label:"协议",key:"agreement",minWidth:"120px"},{label:"操作",key:"my_operation",width:"180px",prop:"operation",scopedSlots:"my_operation"}],K=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),R=function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},z=function(e,t,i,n){return new(i||(i=Promise))((function(a,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))},V=function(e,t){var i,n,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(a=2&r[0]?n.return:r[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeData=[{id:"operateSystem",name:"操作系统",isExpand:!0,children:[{id:"host",name:"主机",showLabelKey:"inner_ip"}]},{id:"database",name:"数据库",isExpand:!0,children:[{id:"mysql",name:"mysql",showLabelKey:"bk_inst_name"},{id:"oracle",name:"oracle",showLabelKey:"bk_inst_name"},{id:"redis",name:"redis",showLabelKey:"bk_inst_name"}]},{id:"network",name:"网络设备",hideExpand:!0,children:[]},{id:"hardware",name:"硬件设备",hideExpand:!0,children:[]},{id:"cloudPlatform",name:"云平台",isExpand:!0,children:[{id:"vmware_vc",name:"VMware",showLabelKey:"bk_inst_name"},{id:"qcloud_account",name:"腾讯云",showLabelKey:"bk_inst_name"},{id:"aliyun_account",name:"阿里云",showLabelKey:"bk_inst_name"},{id:"ManageOne",name:"ManageOne",showLabelKey:"bk_inst_name"}]},{id:"activeDirectory",name:"活动目录",isExpand:!0,children:[{id:"active_directory",name:"active_directory",showLabelKey:"bk_inst_name"}]}],t.activeTreeNode="host",t.showLabelKey="inner_ip",t.search="",t.tableLoading=!1,t.voucerData=[],t.agreementList=[{text:"SSH",value:1},{text:"RDP",value:2},{text:"VNC",value:3}],t.columns=[],t.pagination={current:1,count:0,limit:20},t.maxHeight="",t.agreement="",t.menuList=[{label:"我的凭据",name:"my_credentials"},{label:"授权凭据",name:"authorization_evidence"}],t.active="my_credentials",t.moduleCredDesign=-1,t.evidenceFormParams=[],t.credParamsLoading=!1,t}return K(t,e),t.prototype.created=function(){this.columns=W,this.updateColumns()},t.prototype.mounted=function(){return z(this,void 0,void 0,(function(){var e=this;return V(this,(function(t){return this.getCredParams(),238,this.maxHeight=window.innerHeight-238,window.onresize=function(){e.maxHeight=window.innerHeight-238},[2]}))}))},t.prototype.relevance=function(e){this.$refs.relevance.show(e)},t.prototype.nodeClick=function(e){if(e.children&&!["network","hardware"].includes(e.id))return e.isExpand=!e.isExpand,!1;this.activeTreeNode=e.id,this.showLabelKey=e.showLabelKey,this.updateColumns(),this.getCredParams()},t.prototype.imPower=function(e){this.$refs.authWhiteList.showSlider({role:[],user:[]},e)},t.prototype.toTabMenu=function(e){this.active=e.name,this.updateColumns(),this.getCredential()},t.prototype.sourceFilterMethod=function(e){var t=e.agreement;t.length?this.agreement=t[0]:this.agreement="",this.getCredential()},t.prototype.getCredParams=function(){var e=this;this.credParamsLoading=!0,this.$api.remoteConnect.getCredParams({bk_obj_id:this.activeTreeNode}).then((function(t){var i=t.result,n=t.data;if(!i)return!1;e.moduleCredDesign=n.module_cred_design,e.evidenceFormParams=n.params,e.getCredential()})).finally((function(){e.credParamsLoading=!1}))},t.prototype.getAgreement=function(e){var t=this.agreementList.find((function(t){return t.value===e.agreement}));return t?t.text:"--"},t.prototype.handleChange=function(e){return z(this,void 0,void 0,(function(){var t,i,n,a;return V(this,(function(r){switch(r.label){case 0:return t=e.id,i=e.is_enable,n=e.name,a={id:t,is_enable:i,name:n},this.tableLoading=!0,[4,this.$api.selfCureProcess.updateStatus(a)];case 1:return r.sent().result?(this.$message.success("操作成功"),this.getCredential(),[2]):(this.tableLoading=!1,[2])}}))}))},t.prototype.updateColumns=function(){var e="my_credentials"===this.active;switch(this.activeTreeNode){case"network":this.columns=e?O:$;break;case"hardware":this.columns=e?A:I;break;case"vmware_vc":this.columns=e?P:H;break;case"aliyun_account":case"qcloud_account":this.columns=e?j:T;break;case"ManageOne":this.columns=e?E:N;break;case"mysql":case"oracle":case"redis":this.columns=e?q:F;break;default:this.columns=e?W:S}var t=this.$refs.voucherTable;t&&t.updateColumns(this.columns)},t.prototype.getCredential=function(){var e,t;return z(this,void 0,void 0,(function(){var i,n;return V(this,(function(a){switch(a.label){case 0:this.tableLoading=!0,i=this.getParams(),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.$api.remoteConnect.getVaultCredential(i)];case 2:return(n=a.sent()).result?(this.voucerData=null===(e=n.data)||void 0===e?void 0:e.items,this.pagination.count=null===(t=n.data)||void 0===t?void 0:t.count,[3,4]):(this.$error(n.message),this.voucerData=[],[2]);case 3:return this.tableLoading=!1,[7];case 4:return[2]}}))}))},t.prototype.getParams=function(){var e=this.pagination;return{page_size:e.limit,page:e.current,name:this.search,module_cred_design:this.moduleCredDesign,search_type:"my_credentials"===this.active?"mine":"auth"}},t.prototype.voucherOperation=function(e,t){void 0===e&&(e="add"),void 0===t&&(t={}),this.btnForbidden||this.$refs.operateCredential.show(e,t)},t.prototype.handleDelete=function(e){return z(this,void 0,void 0,(function(){var t=this;return V(this,(function(i){return this.btnForbidden||this.$bkInfo({title:"确定删除该凭据？",confirmLoading:!0,confirmFn:function(){return z(t,void 0,void 0,(function(){return V(this,(function(t){switch(t.label){case 0:return[4,this.confirmDeleteVoucher(e)];case 1:return t.sent(),[2]}}))}))}}),[2]}))}))},t.prototype.confirmDeleteVoucher=function(e){var t=e.id;return z(this,void 0,void 0,(function(){var e;return V(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$api.remoteConnect.deleteCredential({id:t})];case 1:return(e=i.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getCredential()):this.$error(e.message),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getCredential()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.getCredential()},t=R([Object(a.a)({components:{ComTable:r.a,VoucherDialog:b,menuTab:v.a,HeaderSub:g.a,AuthWhiteList:_.a,relevance:D,OperateCredential:L.a}})],t)}(y.a),J=M,B=Object(f.a)(J,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"index-page"},[i("header-sub",{staticClass:"index-header"},[i("template",{slot:"title"},[i("menu-tab",{attrs:{panels:e.menuList,type:"line","active-panel":e.active},on:{click:e.toTabMenu}})],1)],2),e._v(" "),i("div",{staticClass:"index-box"},[i("div",{staticClass:"my-credentials"},[i("div",{staticClass:"left-tree"},e._l(e.nodeData,(function(t){return i("div",{key:t.id,staticClass:"custom-tree"},[i("div",{staticClass:"first-level-tree",on:{click:function(i){return e.nodeClick(t)}}},[t.hideExpand?e._e():i("bk-icon",{attrs:{type:t.isExpand?"down-shape":"right-shape"}}),e._v(" "),i("span",{class:{"no-expand":t.hideExpand,"active-tree-node":t.id===e.activeTreeNode}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])],1),e._v(" "),t.isExpand?i("div",{staticClass:"second-level-tree"},e._l(t.children,(function(t){return i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],key:t.id,class:["second-level-item","hide-text",t.id===e.activeTreeNode&&"active-tree-node"],on:{click:function(i){return e.nodeClick(t)}}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])})),0):e._e()])})),0),e._v(" "),i("div",{staticClass:"remote-voucher"},[i("div",{staticClass:"nav-area"},[i("bk-input",{staticClass:"nav-area-search",attrs:{placeholder:"请输入凭据名称",clearable:""},on:{enter:e.getCredential,clear:e.getCredential},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),"my_credentials"===e.active?i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"ml20",attrs:{theme:"primary",disabled:e.credParamsLoading},on:{click:function(t){return e.voucherOperation("add")}}},[e._v("\n                        新建凭据\n                    ")]):e._e()],1),e._v(" "),i("div",{staticClass:"table-area"},[i("ComTable",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading||e.credParamsLoading,zIndex:10},expression:"{ isLoading: tableLoading || credParamsLoading, zIndex: 10 }"}],ref:"voucherTable",staticClass:"common-table-max-height",attrs:{data:e.voucerData,columns:e.columns,pagination:e.pagination,"max-height":e.maxHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange,"filter-change":e.sourceFilterMethod},scopedSlots:e._u([{key:"my_operation",fn:function(t){var n=t.row;return[i("div",[["network","hardware"].includes(e.activeTreeNode)?e._e():i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.relevance(n)}}},[e._v("\n                                    关联\n                                ")]),e._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.imPower(n)}}},[e._v("\n                                    授权\n                                ")]),e._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.voucherOperation("edit",n)}}},[e._v("\n                                    修改\n                                ")]),e._v(" "),i("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permissionObj,expression:"permissionObj"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.handleDelete(n)}}},[e._v("\n                                    删除\n                                ")])],1)]}},{key:"auth_operation",fn:function(t){var n=t.row;return[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.relevance(n)}}},[e._v("\n                                查看关联\n                            ")])]}}])})],1)])])]),e._v(" "),i("auth-white-list",{ref:"authWhiteList",attrs:{"is-my-credentials":!0,title:"凭据授权"}}),e._v(" "),i("relevance",{ref:"relevance",attrs:{"is-my-credentials":"my_credentials"===e.active,"show-label-key":e.showLabelKey,"active-tree-node":e.activeTreeNode},on:{"refresh-list":e.getCredential}}),e._v(" "),i("operate-credential",{ref:"operateCredential",attrs:{"module-cred-design":e.moduleCredDesign,"evidence-form-params":e.evidenceFormParams},on:{updateCredential:e.getCredential}})],1)}),[],!1,null,"24c6bc31",null);t.default=B.exports}}]);